{"version":3,"file":"tiki.DGYXhP31.js","sources":["../../../../../../node_modules/@codemirror/legacy-modes/mode/tiki.js"],"sourcesContent":["function inBlock(style, terminator, returnTokenizer) {\n  return function(stream, state) {\n    while (!stream.eol()) {\n      if (stream.match(terminator)) {\n        state.tokenize = inText;\n        break;\n      }\n      stream.next();\n    }\n\n    if (returnTokenizer) state.tokenize = returnTokenizer;\n\n    return style;\n  };\n}\n\nfunction inLine(style) {\n  return function(stream, state) {\n    while(!stream.eol()) {\n      stream.next();\n    }\n    state.tokenize = inText;\n    return style;\n  };\n}\n\nfunction inText(stream, state) {\n  function chain(parser) {\n    state.tokenize = parser;\n    return parser(stream, state);\n  }\n\n  var sol = stream.sol();\n  var ch = stream.next();\n\n  //non start of line\n  switch (ch) { //switch is generally much faster than if, so it is used here\n  case \"{\": //plugin\n    stream.eat(\"/\");\n    stream.eatSpace();\n    stream.eatWhile(/[^\\s\\u00a0=\\\"\\'\\/?(}]/);\n    state.tokenize = inPlugin;\n    return \"tag\";\n  case \"_\": //bold\n    if (stream.eat(\"_\"))\n      return chain(inBlock(\"strong\", \"__\", inText));\n    break;\n  case \"'\": //italics\n    if (stream.eat(\"'\"))\n      return chain(inBlock(\"em\", \"''\", inText));\n    break;\n  case \"(\":// Wiki Link\n    if (stream.eat(\"(\"))\n      return chain(inBlock(\"link\", \"))\", inText));\n    break;\n  case \"[\":// Weblink\n    return chain(inBlock(\"url\", \"]\", inText));\n    break;\n  case \"|\": //table\n    if (stream.eat(\"|\"))\n      return chain(inBlock(\"comment\", \"||\"));\n    break;\n  case \"-\":\n    if (stream.eat(\"=\")) {//titleBar\n      return chain(inBlock(\"header string\", \"=-\", inText));\n    } else if (stream.eat(\"-\")) {//deleted\n      return chain(inBlock(\"error tw-deleted\", \"--\", inText));\n    }\n    break;\n  case \"=\": //underline\n    if (stream.match(\"==\"))\n      return chain(inBlock(\"tw-underline\", \"===\", inText));\n    break;\n  case \":\":\n    if (stream.eat(\":\"))\n      return chain(inBlock(\"comment\", \"::\"));\n    break;\n  case \"^\": //box\n    return chain(inBlock(\"tw-box\", \"^\"));\n    break;\n  case \"~\": //np\n    if (stream.match(\"np~\"))\n      return chain(inBlock(\"meta\", \"~/np~\"));\n    break;\n  }\n\n  //start of line types\n  if (sol) {\n    switch (ch) {\n    case \"!\": //header at start of line\n      if (stream.match('!!!!!')) {\n        return chain(inLine(\"header string\"));\n      } else if (stream.match('!!!!')) {\n        return chain(inLine(\"header string\"));\n      } else if (stream.match('!!!')) {\n        return chain(inLine(\"header string\"));\n      } else if (stream.match('!!')) {\n        return chain(inLine(\"header string\"));\n      } else {\n        return chain(inLine(\"header string\"));\n      }\n      break;\n    case \"*\": //unordered list line item, or <li /> at start of line\n    case \"#\": //ordered list line item, or <li /> at start of line\n    case \"+\": //ordered list line item, or <li /> at start of line\n      return chain(inLine(\"tw-listitem bracket\"));\n      break;\n    }\n  }\n\n  //stream.eatWhile(/[&{]/); was eating up plugins, turned off to act less like html and more like tiki\n  return null;\n}\n\n// Return variables for tokenizers\nvar pluginName, type;\nfunction inPlugin(stream, state) {\n  var ch = stream.next();\n  var peek = stream.peek();\n\n  if (ch == \"}\") {\n    state.tokenize = inText;\n    //type = ch == \")\" ? \"endPlugin\" : \"selfclosePlugin\"; inPlugin\n    return \"tag\";\n  } else if (ch == \"(\" || ch == \")\") {\n    return \"bracket\";\n  } else if (ch == \"=\") {\n    type = \"equals\";\n\n    if (peek == \">\") {\n      stream.next();\n      peek = stream.peek();\n    }\n\n    //here we detect values directly after equal character with no quotes\n    if (!/[\\'\\\"]/.test(peek)) {\n      state.tokenize = inAttributeNoQuote();\n    }\n    //end detect values\n\n    return \"operator\";\n  } else if (/[\\'\\\"]/.test(ch)) {\n    state.tokenize = inAttribute(ch);\n    return state.tokenize(stream, state);\n  } else {\n    stream.eatWhile(/[^\\s\\u00a0=\\\"\\'\\/?]/);\n    return \"keyword\";\n  }\n}\n\nfunction inAttribute(quote) {\n  return function(stream, state) {\n    while (!stream.eol()) {\n      if (stream.next() == quote) {\n        state.tokenize = inPlugin;\n        break;\n      }\n    }\n    return \"string\";\n  };\n}\n\nfunction inAttributeNoQuote() {\n  return function(stream, state) {\n    while (!stream.eol()) {\n      var ch = stream.next();\n      var peek = stream.peek();\n      if (ch == \" \" || ch == \",\" || /[ )}]/.test(peek)) {\n        state.tokenize = inPlugin;\n        break;\n      }\n    }\n    return \"string\";\n  };\n}\n\nvar curState, setStyle;\nfunction pass() {\n  for (var i = arguments.length - 1; i >= 0; i--) curState.cc.push(arguments[i]);\n}\n\nfunction cont() {\n  pass.apply(null, arguments);\n  return true;\n}\n\nfunction pushContext(pluginName, startOfLine) {\n  var noIndent = curState.context && curState.context.noIndent;\n  curState.context = {\n    prev: curState.context,\n    pluginName: pluginName,\n    indent: curState.indented,\n    startOfLine: startOfLine,\n    noIndent: noIndent\n  };\n}\n\nfunction popContext() {\n  if (curState.context) curState.context = curState.context.prev;\n}\n\nfunction element(type) {\n  if (type == \"openPlugin\") {curState.pluginName = pluginName; return cont(attributes, endplugin(curState.startOfLine));}\n  else if (type == \"closePlugin\") {\n    var err = false;\n    if (curState.context) {\n      err = curState.context.pluginName != pluginName;\n      popContext();\n    } else {\n      err = true;\n    }\n    if (err) setStyle = \"error\";\n    return cont(endcloseplugin(err));\n  }\n  else if (type == \"string\") {\n    if (!curState.context || curState.context.name != \"!cdata\") pushContext(\"!cdata\");\n    if (curState.tokenize == inText) popContext();\n    return cont();\n  }\n  else return cont();\n}\n\nfunction endplugin(startOfLine) {\n  return function(type) {\n    if (\n      type == \"selfclosePlugin\" ||\n        type == \"endPlugin\"\n    )\n      return cont();\n    if (type == \"endPlugin\") {pushContext(curState.pluginName, startOfLine); return cont();}\n    return cont();\n  };\n}\n\nfunction endcloseplugin(err) {\n  return function(type) {\n    if (err) setStyle = \"error\";\n    if (type == \"endPlugin\") return cont();\n    return pass();\n  };\n}\n\nfunction attributes(type) {\n  if (type == \"keyword\") {setStyle = \"attribute\"; return cont(attributes);}\n  if (type == \"equals\") return cont(attvalue, attributes);\n  return pass();\n}\nfunction attvalue(type) {\n  if (type == \"keyword\") {setStyle = \"string\"; return cont();}\n  if (type == \"string\") return cont(attvaluemaybe);\n  return pass();\n}\nfunction attvaluemaybe(type) {\n  if (type == \"string\") return cont(attvaluemaybe);\n  else return pass();\n}\nexport const tiki = {\n  name: \"tiki\",\n  startState: function() {\n    return {tokenize: inText, cc: [], indented: 0, startOfLine: true, pluginName: null, context: null};\n  },\n  token: function(stream, state) {\n    if (stream.sol()) {\n      state.startOfLine = true;\n      state.indented = stream.indentation();\n    }\n    if (stream.eatSpace()) return null;\n\n    setStyle = type = pluginName = null;\n    var style = state.tokenize(stream, state);\n    if ((style || type) && style != \"comment\") {\n      curState = state;\n      while (true) {\n        var comb = state.cc.pop() || element;\n        if (comb(type || style)) break;\n      }\n    }\n    state.startOfLine = false;\n    return setStyle || style;\n  },\n  indent: function(state, textAfter, cx) {\n    var context = state.context;\n    if (context && context.noIndent) return 0;\n    if (context && /^{\\//.test(textAfter))\n      context = context.prev;\n    while (context && !context.startOfLine)\n      context = context.prev;\n    if (context) return context.indent + cx.unit;\n    else return 0;\n  }\n};\n"],"names":["inBlock","style","terminator","returnTokenizer","stream","state","inText","inLine","chain","parser","sol","ch","inPlugin","pluginName","type","peek","inAttributeNoQuote","inAttribute","quote","curState","setStyle","pass","i","cont","pushContext","startOfLine","noIndent","popContext","element","attributes","endplugin","err","endcloseplugin","attvalue","attvaluemaybe","tiki","comb","textAfter","cx","context"],"mappings":"AAAA,SAASA,EAAQC,EAAOC,EAAYC,EAAiB,CACnD,OAAO,SAASC,EAAQC,EAAO,CAC7B,KAAO,CAACD,EAAO,OAAO,CACpB,GAAIA,EAAO,MAAMF,CAAU,EAAG,CAC5BG,EAAM,SAAWC,EACjB,KACD,CACDF,EAAO,KAAI,CACZ,CAED,OAAID,IAAiBE,EAAM,SAAWF,GAE/BF,CACX,CACA,CAEA,SAASM,EAAON,EAAO,CACrB,OAAO,SAASG,EAAQC,EAAO,CAC7B,KAAM,CAACD,EAAO,OACZA,EAAO,KAAI,EAEb,OAAAC,EAAM,SAAWC,EACVL,CACX,CACA,CAEA,SAASK,EAAOF,EAAQC,EAAO,CAC7B,SAASG,EAAMC,EAAQ,CACrB,OAAAJ,EAAM,SAAWI,EACVA,EAAOL,EAAQC,CAAK,CAC5B,CAED,IAAIK,EAAMN,EAAO,MACbO,EAAKP,EAAO,OAGhB,OAAQO,EAAE,CACV,IAAK,IACH,OAAAP,EAAO,IAAI,GAAG,EACdA,EAAO,SAAQ,EACfA,EAAO,SAAS,uBAAuB,EACvCC,EAAM,SAAWO,EACV,MACT,IAAK,IACH,GAAIR,EAAO,IAAI,GAAG,EAChB,OAAOI,EAAMR,EAAQ,SAAU,KAAMM,CAAM,CAAC,EAC9C,MACF,IAAK,IACH,GAAIF,EAAO,IAAI,GAAG,EAChB,OAAOI,EAAMR,EAAQ,KAAM,KAAMM,CAAM,CAAC,EAC1C,MACF,IAAK,IACH,GAAIF,EAAO,IAAI,GAAG,EAChB,OAAOI,EAAMR,EAAQ,OAAQ,KAAMM,CAAM,CAAC,EAC5C,MACF,IAAK,IACH,OAAOE,EAAMR,EAAQ,MAAO,IAAKM,CAAM,CAAC,EAE1C,IAAK,IACH,GAAIF,EAAO,IAAI,GAAG,EAChB,OAAOI,EAAMR,EAAQ,UAAW,IAAI,CAAC,EACvC,MACF,IAAK,IACH,GAAII,EAAO,IAAI,GAAG,EAChB,OAAOI,EAAMR,EAAQ,gBAAiB,KAAMM,CAAM,CAAC,EAC9C,GAAIF,EAAO,IAAI,GAAG,EACvB,OAAOI,EAAMR,EAAQ,mBAAoB,KAAMM,CAAM,CAAC,EAExD,MACF,IAAK,IACH,GAAIF,EAAO,MAAM,IAAI,EACnB,OAAOI,EAAMR,EAAQ,eAAgB,MAAOM,CAAM,CAAC,EACrD,MACF,IAAK,IACH,GAAIF,EAAO,IAAI,GAAG,EAChB,OAAOI,EAAMR,EAAQ,UAAW,IAAI,CAAC,EACvC,MACF,IAAK,IACH,OAAOQ,EAAMR,EAAQ,SAAU,GAAG,CAAC,EAErC,IAAK,IACH,GAAII,EAAO,MAAM,KAAK,EACpB,OAAOI,EAAMR,EAAQ,OAAQ,OAAO,CAAC,EACvC,KACD,CAGD,GAAIU,EACF,OAAQC,EAAE,CACV,IAAK,IACH,OAAIP,EAAO,MAAM,OAAO,GAEbA,EAAO,MAAM,MAAM,GAEnBA,EAAO,MAAM,KAAK,GAElBA,EAAO,MAAM,IAAI,EACnBI,EAAMD,EAAO,eAAe,CAAC,EAKxC,IAAK,IACL,IAAK,IACL,IAAK,IACH,OAAOC,EAAMD,EAAO,qBAAqB,CAAC,CAE3C,CAIH,OAAO,IACT,CAGA,IAAIM,EAAYC,EAChB,SAASF,EAASR,EAAQC,EAAO,CAC/B,IAAIM,EAAKP,EAAO,OACZW,EAAOX,EAAO,OAElB,OAAIO,GAAM,KACRN,EAAM,SAAWC,EAEV,OACEK,GAAM,KAAOA,GAAM,IACrB,UACEA,GAAM,KACfG,EAAO,SAEHC,GAAQ,MACVX,EAAO,KAAI,EACXW,EAAOX,EAAO,QAIX,SAAS,KAAKW,CAAI,IACrBV,EAAM,SAAWW,KAIZ,YACE,SAAS,KAAKL,CAAE,GACzBN,EAAM,SAAWY,EAAYN,CAAE,EACxBN,EAAM,SAASD,EAAQC,CAAK,IAEnCD,EAAO,SAAS,qBAAqB,EAC9B,UAEX,CAEA,SAASa,EAAYC,EAAO,CAC1B,OAAO,SAASd,EAAQC,EAAO,CAC7B,KAAO,CAACD,EAAO,OACb,GAAIA,EAAO,KAAM,GAAIc,EAAO,CAC1Bb,EAAM,SAAWO,EACjB,KACD,CAEH,MAAO,QACX,CACA,CAEA,SAASI,GAAqB,CAC5B,OAAO,SAASZ,EAAQC,EAAO,CAC7B,KAAO,CAACD,EAAO,OAAO,CACpB,IAAIO,EAAKP,EAAO,OACZW,EAAOX,EAAO,OAClB,GAAIO,GAAM,KAAOA,GAAM,KAAO,QAAQ,KAAKI,CAAI,EAAG,CAChDV,EAAM,SAAWO,EACjB,KACD,CACF,CACD,MAAO,QACX,CACA,CAEA,IAAIO,EAAUC,EACd,SAASC,GAAO,CACd,QAASC,EAAI,UAAU,OAAS,EAAGA,GAAK,EAAGA,IAAKH,EAAS,GAAG,KAAK,UAAUG,CAAC,CAAC,CAC/E,CAEA,SAASC,GAAO,CACd,OAAAF,EAAK,MAAM,KAAM,SAAS,EACnB,EACT,CAEA,SAASG,EAAYX,EAAYY,EAAa,CAC5C,IAAIC,EAAWP,EAAS,SAAWA,EAAS,QAAQ,SACpDA,EAAS,QAAU,CACjB,KAAMA,EAAS,QACf,WAAYN,EACZ,OAAQM,EAAS,SACjB,YAAaM,EACb,SAAUC,CACd,CACA,CAEA,SAASC,GAAa,CAChBR,EAAS,UAASA,EAAS,QAAUA,EAAS,QAAQ,KAC5D,CAEA,SAASS,EAAQd,EAAM,CACrB,GAAIA,GAAQ,aAAe,OAAAK,EAAS,WAAaN,EAAmBU,EAAKM,EAAYC,EAAUX,EAAS,WAAW,CAAC,EAC/G,GAAIL,GAAQ,cAAe,CAC9B,IAAIiB,EAAM,GACV,OAAIZ,EAAS,SACXY,EAAMZ,EAAS,QAAQ,YAAcN,EACrCc,KAEAI,EAAM,GAEJA,IAAKX,EAAW,SACbG,EAAKS,EAAeD,CAAG,CAAC,CAChC,KACI,QAAIjB,GAAQ,YACX,CAACK,EAAS,SAAWA,EAAS,QAAQ,MAAQ,WAAUK,EAAY,QAAQ,EAC5EL,EAAS,UAAYb,GAAQqB,EAAU,GACpCJ,EAAI,CAGf,CAEA,SAASO,EAAUL,EAAa,CAC9B,OAAO,SAASX,EAAM,CACpB,OACEA,GAAQ,mBACNA,GAAQ,aAGRA,GAAQ,aAAcU,EAAYL,EAAS,WAAYM,CAAW,EAAUF,EAAI,CAExF,CACA,CAEA,SAASS,EAAeD,EAAK,CAC3B,OAAO,SAASjB,EAAM,CAEpB,OADIiB,IAAKX,EAAW,SAChBN,GAAQ,YAAoBS,IACzBF,EAAI,CACf,CACA,CAEA,SAASQ,EAAWf,EAAM,CACxB,OAAIA,GAAQ,WAAYM,EAAW,YAAoBG,EAAKM,CAAU,GAClEf,GAAQ,SAAiBS,EAAKU,EAAUJ,CAAU,EAC/CR,EAAI,CACb,CACA,SAASY,EAASnB,EAAM,CACtB,OAAIA,GAAQ,WAAYM,EAAW,SAAiBG,EAAI,GACpDT,GAAQ,SAAiBS,EAAKW,CAAa,EACxCb,EAAI,CACb,CACA,SAASa,EAAcpB,EAAM,CAC3B,OAAIA,GAAQ,SAAiBS,EAAKW,CAAa,EACnCb,EAAI,CAClB,CACY,MAACc,EAAO,CAClB,KAAM,OACN,WAAY,UAAW,CACrB,MAAO,CAAC,SAAU7B,EAAQ,GAAI,CAAA,EAAI,SAAU,EAAG,YAAa,GAAM,WAAY,KAAM,QAAS,IAAI,CAClG,EACD,MAAO,SAASF,EAAQC,EAAO,CAK7B,GAJID,EAAO,QACTC,EAAM,YAAc,GACpBA,EAAM,SAAWD,EAAO,eAEtBA,EAAO,WAAY,OAAO,KAE9BgB,EAAWN,EAAOD,EAAa,KAC/B,IAAIZ,EAAQI,EAAM,SAASD,EAAQC,CAAK,EACxC,IAAKJ,GAASa,IAASb,GAAS,UAE9B,IADAkB,EAAWd,IACE,CACX,IAAI+B,EAAO/B,EAAM,GAAG,IAAG,GAAMuB,EAC7B,GAAIQ,EAAKtB,GAAQb,CAAK,EAAG,KAC1B,CAEH,OAAAI,EAAM,YAAc,GACbe,GAAYnB,CACpB,EACD,OAAQ,SAASI,EAAOgC,EAAWC,EAAI,CACrC,IAAIC,EAAUlC,EAAM,QACpB,GAAIkC,GAAWA,EAAQ,SAAU,MAAO,GAGxC,IAFIA,GAAW,OAAO,KAAKF,CAAS,IAClCE,EAAUA,EAAQ,MACbA,GAAW,CAACA,EAAQ,aACzBA,EAAUA,EAAQ,KACpB,OAAIA,EAAgBA,EAAQ,OAASD,EAAG,KAC5B,CACb,CACH","x_google_ignoreList":[0]}