import{s as ze,y as Ce,e as d,k as N,t as L,c as m,a as p,d as f,o as T,b as W,f as u,i as ne,g as i,u as pe,z as He,h as H,A as Re,B as Ge,p as Je,j as Ke,n as Pe,C as fe,D as xe}from"./scheduler.CRl-z1y4.js";import{S as Qe,i as Xe,f as Ye,b as Y,d as Z,m as ee,g as Ze,a as S,c as et,t as O,e as te}from"./index.Ci9MLlfz.js";import{g as tt}from"./entry.CKIhGktT.js";import{C as nt}from"./CodeEditor.DoVTosZ2.js";import{C as st}from"./ConfirmDialog.BpLky8Hi.js";import{B as ot}from"./Badge.C9HRfTMB.js";import{T as Ie}from"./Tooltip.DuavYtFf.js";import{C as lt}from"./ChevronLeft.Dk6bIOFh.js";function at(n){let e,t,s,r,o;return t=new lt({props:{strokeWidth:"2.5"}}),{c(){e=d("button"),Y(t.$$.fragment),this.h()},l(a){e=m(a,"BUTTON",{class:!0,type:!0});var _=p(e);Z(t.$$.fragment,_),_.forEach(f),this.h()},h(){u(e,"class","w-full text-left text-sm py-1.5 px-1 rounded-lg dark:text-gray-300 dark:hover:text-white hover:bg-black/5 dark:hover:bg-gray-850"),u(e,"type","button")},m(a,_){ne(a,e,_),ee(t,e,null),s=!0,r||(o=pe(e,"click",n[14]),r=!0)},p:Pe,i(a){s||(O(t.$$.fragment,a),s=!0)},o(a){S(t.$$.fragment,a),s=!1},d(a){a&&f(e),te(t),r=!1,o()}}}function it(n){let e,t,s,r;return{c(){e=d("input"),this.h()},l(o){e=m(o,"INPUT",{class:!0,type:!0,placeholder:!0}),this.h()},h(){u(e,"class","w-full text-2xl font-medium bg-transparent outline-none font-primary"),u(e,"type","text"),u(e,"placeholder",t=n[9].t("Function Name")),e.required=!0},m(o,a){ne(o,e,a),fe(e,n[0]),s||(r=pe(e,"input",n[15]),s=!0)},p(o,a){a&512&&t!==(t=o[9].t("Function Name"))&&u(e,"placeholder",t),a&1&&e.value!==o[0]&&fe(e,o[0])},d(o){o&&f(e),s=!1,r()}}}function rt(n){let e,t;return e=new Ie({props:{className:"w-full",content:n[9].t("e.g. my_filter"),placement:"top-start",$$slots:{default:[ft]},$$scope:{ctx:n}}}),{c(){Y(e.$$.fragment)},l(s){Z(e.$$.fragment,s)},m(s,r){ee(e,s,r),t=!0},p(s,r){const o={};r&512&&(o.content=s[9].t("e.g. my_filter")),r&1073742356&&(o.$$scope={dirty:r,ctx:s}),e.$set(o)},i(s){t||(O(e.$$.fragment,s),t=!0)},o(s){S(e.$$.fragment,s),t=!1},d(s){te(e,s)}}}function ut(n){let e,t;return{c(){e=d("div"),t=L(n[2]),this.h()},l(s){e=m(s,"DIV",{class:!0});var r=p(e);t=W(r,n[2]),r.forEach(f),this.h()},h(){u(e,"class","text-sm text-gray-500 flex-shrink-0")},m(s,r){ne(s,e,r),i(e,t)},p(s,r){r&4&&H(t,s[2])},i:Pe,o:Pe,d(s){s&&f(e)}}}function ft(n){let e,t,s,r;return{c(){e=d("input"),this.h()},l(o){e=m(o,"INPUT",{class:!0,type:!0,placeholder:!0}),this.h()},h(){u(e,"class","w-full text-sm disabled:text-gray-500 bg-transparent outline-none"),u(e,"type","text"),u(e,"placeholder",t=n[9].t("Function ID")),e.required=!0,e.disabled=n[4]},m(o,a){ne(o,e,a),fe(e,n[2]),s||(r=pe(e,"input",n[16]),s=!0)},p(o,a){a&512&&t!==(t=o[9].t("Function ID"))&&u(e,"placeholder",t),a&16&&(e.disabled=o[4]),a&4&&e.value!==o[2]&&fe(e,o[2])},d(o){o&&f(e),s=!1,r()}}}function ct(n){let e,t,s,r;return{c(){e=d("input"),this.h()},l(o){e=m(o,"INPUT",{class:!0,type:!0,placeholder:!0}),this.h()},h(){u(e,"class","w-full text-sm bg-transparent outline-none"),u(e,"type","text"),u(e,"placeholder",t=n[9].t("Function Description")),e.required=!0},m(o,a){ne(o,e,a),fe(e,n[3].description),s||(r=pe(e,"input",n[17]),s=!0)},p(o,a){a&512&&t!==(t=o[9].t("Function Description"))&&u(e,"placeholder",t),a&8&&e.value!==o[3].description&&fe(e,o[3].description)},d(o){o&&f(e),s=!1,r()}}}function dt(n){let e,t,s,r=n[9].t("Please carefully review the following warnings:")+"",o,a,_,w,x=n[9].t("Functions allow arbitrary code execution.")+"",$,b,V,I=n[9].t("Do not install functions from sources you do not fully trust.")+"",k,j,v,y=n[9].t("I acknowledge that I have read and I understand the implications of my action. I am aware of the risks associated with executing arbitrary code and I have verified the trustworthiness of the source.")+"",E;return{c(){e=d("div"),t=d("div"),s=d("div"),o=L(r),a=N(),_=d("ul"),w=d("li"),$=L(x),b=N(),V=d("li"),k=L(I),j=N(),v=d("div"),E=L(y),this.h()},l(D){e=m(D,"DIV",{class:!0});var g=p(e);t=m(g,"DIV",{class:!0});var M=p(t);s=m(M,"DIV",{});var A=p(s);o=W(A,r),A.forEach(f),a=T(M),_=m(M,"UL",{class:!0});var F=p(_);w=m(F,"LI",{});var R=p(w);$=W(R,x),R.forEach(f),b=T(F),V=m(F,"LI",{});var P=p(V);k=W(P,I),P.forEach(f),F.forEach(f),M.forEach(f),j=T(g),v=m(g,"DIV",{class:!0});var B=p(v);E=W(B,y),B.forEach(f),g.forEach(f),this.h()},h(){u(_,"class","mt-1 list-disc pl-4 text-xs"),u(t,"class","bg-yellow-500/20 text-yellow-700 dark:text-yellow-200 rounded-lg px-4 py-3"),u(v,"class","my-3"),u(e,"class","text-sm text-gray-500")},m(D,g){ne(D,e,g),i(e,t),i(t,s),i(s,o),i(t,a),i(t,_),i(_,w),i(w,$),i(_,b),i(_,V),i(V,k),i(e,j),i(e,v),i(v,E)},p(D,g){g&512&&r!==(r=D[9].t("Please carefully review the following warnings:")+"")&&H(o,r),g&512&&x!==(x=D[9].t("Functions allow arbitrary code execution.")+"")&&H($,x),g&512&&I!==(I=D[9].t("Do not install functions from sources you do not fully trust.")+"")&&H(k,I),g&512&&y!==(y=D[9].t("I acknowledge that I have read and I understand the implications of my action. I am aware of the risks associated with executing arbitrary code and I have verified the trustworthiness of the source.")+"")&&H(E,y)},d(D){D&&f(e)}}}function mt(n){let e,t,s,r,o,a,_,w,x,$,b,V,I,k,j,v,y,E,D,g,M,A,F,R,P,B,C,G,se=n[9].t("Warning:")+"",le,c,ce=n[9].t("Functions allow arbitrary code execution")+"",_e,ke,Ee,De,ae,de=n[9].t("don't install random functions from sources you don't trust.")+"",ve,$e,oe,me=n[9].t("Save")+"",ge,be,U,Fe,J,Ve,Ne;w=new Ie({props:{content:n[9].t("Back"),$$slots:{default:[at]},$$scope:{ctx:n}}}),b=new Ie({props:{content:n[9].t("e.g. My Filter"),placement:"top-start",$$slots:{default:[it]},$$scope:{ctx:n}}}),k=new ot({props:{type:"muted",content:n[9].t("Function")}});const Te=[ut,rt],K=[];function Ae(l,h){return l[4]?0:1}y=Ae(n),E=K[y]=Te[y](n),g=new Ie({props:{className:"w-full self-center items-center flex",content:n[9].t("e.g. A filter to remove profanity from text"),placement:"top-start",$$slots:{default:[ct]},$$scope:{ctx:n}}});let We={value:n[1],lang:"python",boilerplate:n[11]};F=new nt({props:We}),n[18](F),F.$on("change",n[19]),F.$on("save",n[20]);function je(l){n[23](l)}let Be={$$slots:{default:[dt]},$$scope:{ctx:n}};return n[6]!==void 0&&(Be.show=n[6]),U=new st({props:Be}),Ce.push(()=>Ye(U,"show",je)),U.$on("confirm",n[24]),{c(){e=d("div"),t=d("div"),s=d("form"),r=d("div"),o=d("div"),a=d("div"),_=d("div"),Y(w.$$.fragment),x=N(),$=d("div"),Y(b.$$.fragment),V=N(),I=d("div"),Y(k.$$.fragment),j=N(),v=d("div"),E.c(),D=N(),Y(g.$$.fragment),M=N(),A=d("div"),Y(F.$$.fragment),R=N(),P=d("div"),B=d("div"),C=d("div"),G=d("span"),le=L(se),c=N(),_e=L(ce),ke=N(),Ee=d("br"),De=L(`—
							`),ae=d("span"),ve=L(de),$e=N(),oe=d("button"),ge=L(me),be=N(),Y(U.$$.fragment),this.h()},l(l){e=m(l,"DIV",{class:!0});var h=p(e);t=m(h,"DIV",{class:!0});var ie=p(t);s=m(ie,"FORM",{class:!0});var re=p(s);r=m(re,"DIV",{class:!0});var z=p(r);o=m(z,"DIV",{class:!0});var Q=p(o);a=m(Q,"DIV",{class:!0});var q=p(a);_=m(q,"DIV",{class:!0});var he=p(_);Z(w.$$.fragment,he),he.forEach(f),x=T(q),$=m(q,"DIV",{class:!0});var ue=p($);Z(b.$$.fragment,ue),ue.forEach(f),V=T(q),I=m(q,"DIV",{});var Me=p(I);Z(k.$$.fragment,Me),Me.forEach(f),q.forEach(f),j=T(Q),v=m(Q,"DIV",{class:!0});var we=p(v);E.l(we),D=T(we),Z(g.$$.fragment,we),we.forEach(f),Q.forEach(f),M=T(z),A=m(z,"DIV",{class:!0});var Ue=p(A);Z(F.$$.fragment,Ue),Ue.forEach(f),R=T(z),P=m(z,"DIV",{class:!0});var ye=p(P);B=m(ye,"DIV",{class:!0});var qe=p(B);C=m(qe,"DIV",{class:!0});var X=p(C);G=m(X,"SPAN",{class:!0});var Se=p(G);le=W(Se,se),Se.forEach(f),c=T(X),_e=W(X,ce),ke=T(X),Ee=m(X,"BR",{}),De=W(X,`—
							`),ae=m(X,"SPAN",{class:!0});var Oe=p(ae);ve=W(Oe,de),Oe.forEach(f),X.forEach(f),qe.forEach(f),$e=T(ye),oe=m(ye,"BUTTON",{class:!0,type:!0});var Le=p(oe);ge=W(Le,me),Le.forEach(f),ye.forEach(f),z.forEach(f),re.forEach(f),ie.forEach(f),h.forEach(f),be=T(l),Z(U.$$.fragment,l),this.h()},h(){u(_,"class","flex-shrink-0 mr-2"),u($,"class","flex-1"),u(a,"class","flex w-full items-center"),u(v,"class","flex gap-2 px-1 items-center"),u(o,"class","w-full mb-2 flex flex-col gap-0.5"),u(A,"class","mb-2 flex-1 overflow-auto h-0 rounded-lg"),u(G,"class","font-semibold dark:text-gray-200"),u(ae,"class","font-medium dark:text-gray-400"),u(C,"class","text-xs text-gray-500 line-clamp-2"),u(B,"class","flex-1 pr-3"),u(oe,"class","px-3.5 py-1.5 text-sm font-medium bg-black hover:bg-gray-900 text-white dark:bg-white dark:text-black dark:hover:bg-gray-100 transition rounded-full"),u(oe,"type","submit"),u(P,"class","pb-3 flex justify-between"),u(r,"class","flex flex-col flex-1 overflow-auto h-0 rounded-lg"),u(s,"class","flex flex-col max-h-[100dvh] h-full"),u(t,"class","mx-auto w-full md:px-0 h-full"),u(e,"class","flex flex-col justify-between w-full overflow-y-auto h-full")},m(l,h){ne(l,e,h),i(e,t),i(t,s),i(s,r),i(r,o),i(o,a),i(a,_),ee(w,_,null),i(a,x),i(a,$),ee(b,$,null),i(a,V),i(a,I),ee(k,I,null),i(o,j),i(o,v),K[y].m(v,null),i(v,D),ee(g,v,null),i(r,M),i(r,A),ee(F,A,null),i(r,R),i(r,P),i(P,B),i(B,C),i(C,G),i(G,le),i(C,c),i(C,_e),i(C,ke),i(C,Ee),i(C,De),i(C,ae),i(ae,ve),i(P,$e),i(P,oe),i(oe,ge),n[21](s),ne(l,be,h),ee(U,l,h),J=!0,Ve||(Ne=pe(s,"submit",He(n[22])),Ve=!0)},p(l,[h]){const ie={};h&512&&(ie.content=l[9].t("Back")),h&1073741824&&(ie.$$scope={dirty:h,ctx:l}),w.$set(ie);const re={};h&512&&(re.content=l[9].t("e.g. My Filter")),h&1073742337&&(re.$$scope={dirty:h,ctx:l}),b.$set(re);const z={};h&512&&(z.content=l[9].t("Function")),k.$set(z);let Q=y;y=Ae(l),y===Q?K[y].p(l,h):(Ze(),S(K[Q],1,1,()=>{K[Q]=null}),et(),E=K[y],E?E.p(l,h):(E=K[y]=Te[y](l),E.c()),O(E,1),E.m(v,D));const q={};h&512&&(q.content=l[9].t("e.g. A filter to remove profanity from text")),h&1073742344&&(q.$$scope={dirty:h,ctx:l}),g.$set(q);const he={};h&2&&(he.value=l[1]),F.$set(he),(!J||h&512)&&se!==(se=l[9].t("Warning:")+"")&&H(le,se),(!J||h&512)&&ce!==(ce=l[9].t("Functions allow arbitrary code execution")+"")&&H(_e,ce),(!J||h&512)&&de!==(de=l[9].t("don't install random functions from sources you don't trust.")+"")&&H(ve,de),(!J||h&512)&&me!==(me=l[9].t("Save")+"")&&H(ge,me);const ue={};h&1073742336&&(ue.$$scope={dirty:h,ctx:l}),!Fe&&h&64&&(Fe=!0,ue.show=l[6],Re(()=>Fe=!1)),U.$set(ue)},i(l){J||(O(w.$$.fragment,l),O(b.$$.fragment,l),O(k.$$.fragment,l),O(E),O(g.$$.fragment,l),O(F.$$.fragment,l),O(U.$$.fragment,l),J=!0)},o(l){S(w.$$.fragment,l),S(b.$$.fragment,l),S(k.$$.fragment,l),S(E),S(g.$$.fragment,l),S(F.$$.fragment,l),S(U.$$.fragment,l),J=!1},d(l){l&&(f(e),f(be)),te(w),te(b),te(k),K[y].d(),te(g),n[18](null),te(F),n[21](null),te(U,l),Ve=!1,Ne()}}}function ht(n,e,t){let s;const r=Ge(),o=Je("i18n");Ke(n,o,c=>t(9,s=c));let a=null,_=!1,{edit:w=!1}=e,{clone:x=!1}=e,{id:$=""}=e,{name:b=""}=e,{meta:V={description:""}}=e,{content:I=""}=e,k="";const j=()=>{t(7,k=I)};let v,y=`"""
title: Example Filter
author: open-webui
author_url: https://github.com/open-webui
funding_url: https://github.com/open-webui
version: 0.1
"""

from pydantic import BaseModel, Field
from typing import Optional


class Filter:
    class Valves(BaseModel):
        priority: int = Field(
            default=0, description="Priority level for the filter operations."
        )
        max_turns: int = Field(
            default=8, description="Maximum allowable conversation turns for a user."
        )
        pass

    class UserValves(BaseModel):
        max_turns: int = Field(
            default=4, description="Maximum allowable conversation turns for a user."
        )
        pass

    def __init__(self):
        # Indicates custom file handling logic. This flag helps disengage default routines in favor of custom
        # implementations, informing the WebUI to defer file-related operations to designated methods within this class.
        # Alternatively, you can remove the files directly from the body in from the inlet hook
        # self.file_handler = True

        # Initialize 'valves' with specific configurations. Using 'Valves' instance helps encapsulate settings,
        # which ensures settings are managed cohesively and not confused with operational flags like 'file_handler'.
        self.valves = self.Valves()
        pass

    def inlet(self, body: dict, __user__: Optional[dict] = None) -> dict:
        # Modify the request body or validate it before processing by the chat completion API.
        # This function is the pre-processor for the API where various checks on the input can be performed.
        # It can also modify the request before sending it to the API.
        print(f"inlet:{__name__}")
        print(f"inlet:body:{body}")
        print(f"inlet:user:{__user__}")

        if __user__.get("role", "admin") in ["user", "admin"]:
            messages = body.get("messages", [])

            max_turns = min(__user__["valves"].max_turns, self.valves.max_turns)
            if len(messages) > max_turns:
                raise Exception(
                    f"Conversation turn limit exceeded. Max turns: {max_turns}"
                )

        return body

    def outlet(self, body: dict, __user__: Optional[dict] = None) -> dict:
        # Modify or analyze the response body after processing by the API.
        # This function is the post-processor for the API, which can be used to modify the response
        # or perform additional checks and analytics.
        print(f"outlet:{__name__}")
        print(f"outlet:body:{body}")
        print(f"outlet:user:{__user__}")

        return body
`;const E=async()=>{r("save",{id:$,name:b,meta:V,content:I})},D=async()=>{if(v){t(1,I=k),await xe();const c=await v.formatPythonCodeHandler();await xe(),t(1,I=k),await xe(),c&&(console.log("Code formatted successfully"),E())}},g=()=>{tt("/admin/functions")};function M(){b=this.value,t(0,b)}function A(){$=this.value,t(2,$),t(0,b),t(4,w),t(13,x)}function F(){V.description=this.value,t(3,V)}function R(c){Ce[c?"unshift":"push"](()=>{v=c,t(8,v)})}const P=c=>{t(7,k=c.detail.value)},B=async()=>{a&&a.requestSubmit()};function C(c){Ce[c?"unshift":"push"](()=>{a=c,t(5,a)})}const G=()=>{w?D():t(6,_=!0)};function se(c){_=c,t(6,_)}const le=()=>{D()};return n.$$set=c=>{"edit"in c&&t(4,w=c.edit),"clone"in c&&t(13,x=c.clone),"id"in c&&t(2,$=c.id),"name"in c&&t(0,b=c.name),"meta"in c&&t(3,V=c.meta),"content"in c&&t(1,I=c.content)},n.$$.update=()=>{n.$$.dirty&2&&I&&j(),n.$$.dirty&8209&&b&&!w&&!x&&t(2,$=b.replace(/\s+/g,"_").toLowerCase())},[b,I,$,V,w,a,_,k,v,s,o,y,D,x,g,M,A,F,R,P,B,C,G,se,le]}class kt extends Qe{constructor(e){super(),Xe(this,e,ht,mt,ze,{edit:4,clone:13,id:2,name:0,meta:3,content:1})}}export{kt as F};
//# sourceMappingURL=FunctionEditor.7l7hOH4d.js.map
