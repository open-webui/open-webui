const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./twlQqEV6.js","./C1FmrZbK.js","./QjJsDpFa.js","./B4oLWPTI.js","./CWj6FrbW.js","./69_IOA4Y.js","./DIeogL5L.js","./0WpKKl27.js","./C3k0oZ3o.js","./DpN1w328.js","./BVrWTcfB.js","./Cmf4RC8y.js","./PCOILo-8.js","./DLhnqOlE.js","./CZ1y6KaE.js","./DLQ8GCeM.js","./3-JilrU5.js","./Db0gdTVr.js","./Bo3ZTtFv.js","./B9ZVCkUG.js","./B3Vrv829.js","./CxNpLfvs.js","./4JkFaImo.js","./C-V_EQOO.js","./BtReZMDb.js","./2TdC0ITJ.js","./Cb8_Fw4l.js","./CbBS0GYN.js","./u5Cnd4mY.js","./Q6Bnvzbc.js","./CZmZoefv.js","../assets/Overview.DJY6z4BB.css"])))=>i.map(i=>d[i]);
var go=Object.defineProperty;var mo=(Y,n,r)=>n in Y?go(Y,n,{enumerable:!0,configurable:!0,writable:!0,value:r}):Y[n]=r;var er=(Y,n,r)=>mo(Y,typeof n!="symbol"?n+"":n,r);import"./CWj6FrbW.js";import"./69_IOA4Y.js";import{H as Rr,I as po,aS as ho,J as _o,br as ks,ao as wo,af as yo,ap as bo,ae as rs,O as xo,ar as ss,Q as Cs,m as q,bs as $o,bt as ko,bu as Co,bv as Io,E as So,bj as Eo,p as Xt,y as ar,o as Ya,i as s,j as e,n as $e,b as ea,B as ga,t as Z,a as l,g as la,x as ot,d as ct,e as ke,w as o,f as v,c as a,r as t,s as Le,u as B,l as Qe,k as m,q as Tt,v as Da,aQ as Pt,bg as Mo,aM as Yr,aP as us,A as nr,aR as Po,z as Ir,h as To,$ as zo}from"./0WpKKl27.js";import{B as No,i as N}from"./Cmf4RC8y.js";import{t as za}from"./DXo52D7g.js";import{h as Ao}from"./Bwqchdu-.js";import{a as $t,s as gt,c as wa,d as Is,f as hr,r as Lo}from"./CZ1y6KaE.js";import{b as Ja}from"./Bo3ZTtFv.js";import{i as ta}from"./C3k0oZ3o.js";import{p as E}from"./DpN1w328.js";import{s as na,a as ze}from"./BVrWTcfB.js";import{t as at}from"./DYdr9DjX.js";import{C as Fo,a as Do,g as os,b as ns,I as Bo,c as Gs,d as Oo,P as jo}from"./DUmcHkcJ.js";import{a as sr,f as mr}from"./CiB29Aqe.js";import{g as Sr}from"./B5RARo22.js";import{p as Ss}from"./CLoTtgoA.js";import{a as Fa,P as Uo,b as Ro}from"./DLhnqOlE.js";import{w as Jr,e as Va,u as Ka,c as xr,v as Ba,t as Za,A as Kr,b as Ra,a as Lr,z as Pa,m as Qr,T as vs,P as Ta,E as ra,J as lr,I as qa,F as ir,Q as Er,L as Wo,s as fs,O as Ho,g as Vo,f as qr,H as Go,G as Es,R as dr,r as Oa,K as Ms,S as Wr,i as Jo,W as qo,U as Zo}from"./PCOILo-8.js";import{z as ja,B as $a,A as Yo,b as Ko,p as Qo,q as Xo,r as en,t as tn,u as an,v as rn,w as sn,x as on,O as nn,y as ln,d as xa,m as _r,n as bs,F as dn,l as cn,g as un,C as Hr,P as vn,Q as fn,N as gn,R as mn,M as ls,L as is,f as pn}from"./cX8aofVu.js";import{m as Js,n as hn,u as Mr,j as gs,o as _n,i as Ua,a as ms,p as Ps,q as wn,r as Ts,t as yn,v as bn}from"./DR3TfYWm.js";import{a as xn}from"./Bp8N0x0r.js";import{c as $n,p as kn}from"./B56tcsjd.js";import{u as zs,k as Cn}from"./BaVH4moA.js";import{t as In,v as Sn,w as En,x as Mn,y as Pn,z as Tn,A as zn}from"./B6gyXX6T.js";import{g as Xr,e as Nn,f as An,b as Ln}from"./gENSTQXg.js";import{D as Fn,u as qs}from"./CYBNiUQ7.js";import{e as Dn,f as Bn,g as Zs,b as On}from"./Dcv_5MKS.js";import{u as ps,g as Ns,d as jn}from"./DesYX7fr.js";import As from"./B9ZVCkUG.js";import{k as Ls}from"./fZxlt1qL.js";import{e as ua,i as Ca}from"./u5Cnd4mY.js";import{h as Ys}from"./BzXoxdC4.js";import{a as Un,b as Rn,c as Wn}from"./kb1CvZ3a.js";import{b as Ks}from"./CMoC6kdu.js";import{p as pr}from"./Bfc47y5P.js";import{d as tr,r as Hn}from"./BC4znSyB.js";import"./BkyXqnA-.js";import{d as Vn}from"./DfIywdCw.js";import{_ as Pr}from"./C1FmrZbK.js";import{K as Gn,M as Qs,S as Jn}from"./C-5A-I7X.js";import{g as qn}from"./iLDRgysW.js";import{c as Zn}from"./OBWwOOIN.js";import{s as es}from"./3-JilrU5.js";import{C as hs}from"./BtReZMDb.js";import{b as ts,c as _a}from"./DA2vpIKA.js";import{f as br}from"./Dbtivbjp.js";import{D as as}from"./DD5ATWsz.js";import{T as mt}from"./Db0gdTVr.js";import{P as xs,D as Xs,F as eo,a as _s}from"./DetCT4Dy.js";import{C as wr}from"./DAAddo_l.js";import{C as Cr}from"./B0N4-HfZ.js";import{S as Sa}from"./BO1efK8r.js";import{L as Tr}from"./l5Bi75JT.js";import{a as Yn}from"./CqXJ173x.js";import{f as Kn,j as Qn}from"./D93vMDi1.js";import{A as Xn}from"./DmHUk7u7.js";import{G as $s}from"./D4rRqD24.js";import{R as to,V as el}from"./ZPyp4hUC.js";import{F as tl}from"./6usEtNPi.js";import{M as al}from"./CcreKc1w.js";import{C as yr,I as rl,f as sl,S as ol,F as nl}from"./mfo8rR81.js";import{X as Ga}from"./CZmZoefv.js";import{S as ao}from"./D_50Gyqd.js";import{m as ll}from"./DbVsO-UY.js";import{S as kr}from"./NOxjCBoP.js";import{V as il,a as dl}from"./LIBr8nyO.js";import{D as ro}from"./DcAIj4L_.js";import{S as cl,F as ul,a as vl}from"./C8udzHqa.js";import{S as fl}from"./BYJE9BEZ.js";import{M as Fs,a as Ds,b as Bs}from"./DCQoPc4L.js";import{f as so}from"./CsWaRabF.js";import{T as gl}from"./DluZzLRt.js";import{M as ml,A as pl,U as hl,E as _l}from"./DB6UFW7h.js";import{S as wl}from"./DM0r1jA3.js";import{D as oo}from"./CmPVC7JK.js";import{B as ds}from"./BbeEwsTa.js";import{S as yl}from"./CGW29DRJ.js";import{E as no}from"./C2rnPICT.js";import{A as bl}from"./D_eQ6KZY.js";import{s as xl,t as $l}from"./CjABQmgs.js";import{C as lo}from"./ByHAJgVC.js";import{E as kl}from"./BAAu3n3-.js";import{C as Vr}from"./BTdOvR0T.js";import{E as Cl}from"./BwmNngm2.js";const Os=0,cs=1;function js(Y,n,r,i,u){Rr&&po();var S=ho(),w=Eo,y=S?Cs(w):q(w,!1,!1),pe=S?Cs(w):q(w,!1,!1),h=new No(Y);_o(()=>{var T=n(),M=!1;let O=Rr&&ks(T)===(Y.data===wo);if(O&&(yo(bo()),rs(!1)),ks(T)){var C=$o(),X=!1;const ge=ae=>{if(!M){X=!0,C(!1),ko.ensure(),Rr&&rs(!1);try{ae()}finally{Co(),Io||So()}}};T.then(ae=>{ge(()=>{ss(y,ae),h.ensure(cs,i&&(Re=>i(Re,y)))})},ae=>{ge(()=>{if(ss(pe,ae),h.ensure(cs,u&&(Re=>u(Re,pe))),!u)throw pe.v})}),Rr?h.ensure(Os,r):xo(()=>{X||ge(()=>{h.ensure(Os,r)})})}else ss(y,T),h.ensure(cs,i&&(ge=>i(ge,y)));return O&&rs(!0),()=>{M=!0}})}function Il(Y,n){Xt(n,!1);const r=()=>ze(Jr,"$_tags",i),[i,u]=na(),S=ar();let w=E(n,"chatId",8,""),y=q([]);const pe=async()=>await Js(localStorage.token,w()).catch(async M=>[]),h=async M=>{await hn(localStorage.token,w(),M).catch(async C=>(at.error(`${C}`),null))&&(s(y,await pe()),await Mr(localStorage.token,w(),{tags:e(y)}),await Jr.set(await gs(localStorage.token)),S("add",{name:M}))},T=async M=>{await _n(localStorage.token,w(),M),s(y,await pe()),await Mr(localStorage.token,w(),{tags:e(y)}),await Jr.set(await gs(localStorage.token)),S("delete",{name:M})};Ya(async()=>{w()&&s(y,await pe())}),ta();{let M=$e(()=>r()??[]);gl(Y,{get tags(){return e(y)},get suggestionTags(){return e(M)},$$events:{delete:O=>{T(O.detail)},add:O=>{h(O.detail)}}})}ea(),u()}function Sl(Y){let n,r,i,u,S,w,y;return pe(),{feed:h,reset:pe};function pe(){n=!0,r="",i=0,u=-1,S=void 0,w=void 0,y=""}function h(M){r=r?r+M:M,n&&El(r)&&(r=r.slice(io.length)),n=!1;const O=r.length;let C=0,X=!1;for(;C<O;){X&&(r[C]===`
`&&++C,X=!1);let ge=-1,ae=u,Re;for(let Pe=i;ge<0&&Pe<O;++Pe)Re=r[Pe],Re===":"&&ae<0?ae=Pe-C:Re==="\r"?(X=!0,ge=Pe-C):Re===`
`&&(ge=Pe-C);if(ge<0){i=O-C,u=ae;break}else i=0,u=-1;T(r,C,ae,ge),C+=ge+1}C===O?r="":C>0&&(r=r.slice(C))}function T(M,O,C,X){if(X===0){y.length>0&&(Y({type:"event",id:S,event:w||void 0,data:y.slice(0,-1)}),y="",S=void 0),w=void 0;return}const ge=C<0,ae=M.slice(O,O+(ge?X:C));let Re=0;ge?Re=X:M[O+C+1]===" "?Re=C+2:Re=C+1;const Pe=O+Re,ve=X-Re,D=M.slice(Pe,Pe+ve).toString();if(ae==="data")y+=D?"".concat(D,`
`):`
`;else if(ae==="event")w=D;else if(ae==="id"&&!D.includes("\0"))S=D;else if(ae==="retry"){const Ae=parseInt(D,10);Number.isNaN(Ae)||Y({type:"reconnect-interval",value:Ae})}}}const io=[239,187,191];function El(Y){return io.every((n,r)=>Y.charCodeAt(r)===n)}class Ml extends TransformStream{constructor(){let n;super({start(r){n=Sl(i=>{i.type==="event"&&r.enqueue(i)})},transform(r){n.feed(r)}})}}async function Pl(Y,n){const r=Y.pipeThrough(new TextDecoderStream).pipeThrough(new Ml).getReader();let i=Tl(r);return n&&(i=zl(i)),i}async function*Tl(Y){var n,r,i;for(;;){const{value:u,done:S}=await Y.read();if(S){yield{done:!0,value:""};break}if(!u)continue;const w=u.data;if(w.startsWith("[DONE]")){yield{done:!0,value:""};break}try{const y=JSON.parse(w);if(y.error){yield{done:!0,value:"",error:y.error};break}if(y.sources){yield{done:!1,value:"",sources:y.sources};continue}if(y.selected_model_id){yield{done:!1,value:"",selectedModelId:y.selected_model_id};continue}if(y.usage){yield{done:!1,value:"",usage:y.usage};continue}yield{done:!1,value:((i=(r=(n=y.choices)==null?void 0:n[0])==null?void 0:r.delta)==null?void 0:i.content)??""}}catch{}}}async function*zl(Y){for await(const n of Y){if(n.done){yield n;return}if(n.error){yield n;continue}if(n.sources){yield n;continue}if(n.selectedModelId){yield n;continue}if(n.usage){yield n;continue}let r=n.value;if(r.length<5){yield{done:!1,value:r};continue}for(;r!="";){const i=Math.min(Math.floor(Math.random()*3)+1,r.length);yield{done:!1,value:r.slice(0,i)},(document==null?void 0:document.visibilityState)!=="hidden"&&await Nl(5),r=r.slice(i)}}}const Nl=Y=>new Promise(n=>setTimeout(n,Y));var Al=ga('<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="m21 7.5-9-5.25L3 7.5m18 0-9 5.25m9-5.25v9l-9 5.25M3 7.5l9 5.25M3 7.5v9l9 5.25m0-9v9"></path></svg>');function Ll(Y,n){let r=E(n,"className",8,"size-4"),i=E(n,"strokeWidth",8,"2");var u=Al();Z(()=>{$t(u,"stroke-width",i()),gt(u,0,wa(r()))}),l(Y,u)}class Fl{constructor(n){this.audio=n,this.queue=[],this.current=null,this.id=null,this._onEnded=()=>this.next(),this.audio.addEventListener("ended",this._onEnded),this.onStopped=null}setId(n){this.id!==n&&(this.stop(),this.id=n,this.onStopped&&this.onStopped({event:"id-change",id:n}))}setPlaybackRate(n){this.audio.playbackRate=n}enqueue(n){this.queue.push(n),this.audio.paused&&!this.current&&this.next()}play(){!this.current&&this.queue.length>0?this.next():this.audio.play()}next(){this.current=this.queue.shift(),this.current?(this.audio.src=this.current,this.audio.play(),this.current):(this.stop(),this.onStopped&&this.onStopped({event:"empty-queue",id:this.id}))}stop(){this.audio.pause(),this.audio.currentTime=0,this.audio.src="",this.queue=[],this.current=null,this.onStopped&&this.onStopped({event:"stop",id:this.id})}destroy(){this.audio.removeEventListener("ended",this._onEnded),this.stop(),this.onStopped=null,this.audio=null}}let zr="",Nr="";async function Dl(){var r,i;const Y=await fetch("/api/config");if(!Y.ok)throw new Error("Failed to fetch Google Drive credentials");const n=await Y.json();if(zr=(r=n.google_drive)==null?void 0:r.api_key,Nr=(i=n.google_drive)==null?void 0:i.client_id,!zr||!Nr)throw new Error("Google Drive API credentials not configured")}const Bl=["https://www.googleapis.com/auth/drive.readonly","https://www.googleapis.com/auth/drive.file"],Ol=()=>{if(!zr||!Nr)throw new Error("Google Drive API credentials not configured");if(zr===""||Nr==="")throw new Error("Please configure valid Google Drive API credentials")};let Gr=null,Us=!1;const jl=()=>new Promise((Y,n)=>{if(typeof gapi>"u"){const r=document.createElement("script");r.src="https://apis.google.com/js/api.js",r.onload=()=>{gapi.load("picker",()=>{Y(!0)})},r.onerror=n,document.body.appendChild(r)}else gapi.load("picker",()=>{Y(!0)})}),Ul=()=>new Promise((Y,n)=>{if(typeof google>"u"){const r=document.createElement("script");r.src="https://accounts.google.com/gsi/client",r.onload=Y,r.onerror=n,document.body.appendChild(r)}else Y(!0)}),Rl=async()=>Gr||new Promise((Y,n)=>{google.accounts.oauth2.initTokenClient({client_id:Nr,scope:Bl.join(" "),callback:i=>{i.access_token?(Gr=i.access_token,Y(Gr)):n(new Error("Failed to get access token"))},error_callback:i=>{n(new Error(i.message||"OAuth error occurred"))}}).requestAccessToken()}),Wl=async()=>{Us||(await Dl(),Ol(),await Promise.all([jl(),Ul()]),Us=!0)},Hl=()=>new Promise(async(Y,n)=>{try{await Wl();const r=await Rl();if(!r)throw new Error("Unable to get OAuth token");new google.picker.PickerBuilder().enableFeature(google.picker.Feature.NAV_HIDDEN).enableFeature(google.picker.Feature.MULTISELECT_ENABLED).addView(new google.picker.DocsView().setIncludeFolders(!1).setSelectFolderEnabled(!1).setMimeTypes("application/pdf,text/plain,application/vnd.openxmlformats-officedocument.wordprocessingml.document,application/vnd.google-apps.document,application/vnd.google-apps.spreadsheet,application/vnd.google-apps.presentation")).setOAuthToken(r).setDeveloperKey(zr).setCallback(async u=>{if(u[google.picker.Response.ACTION]===google.picker.Action.PICKED)try{const S=u[google.picker.Response.DOCUMENTS][0],w=S[google.picker.Document.ID],y=S[google.picker.Document.NAME],pe=S[google.picker.Document.URL];if(!w||!y)throw new Error("Required file details missing");const h=S[google.picker.Document.MIME_TYPE];let T,M;h.includes("google-apps")?(h.includes("document")?M="text/plain":h.includes("spreadsheet")?M="text/csv":h.includes("presentation")?M="text/plain":M="application/pdf",T=`https://www.googleapis.com/drive/v3/files/${w}/export?mimeType=${encodeURIComponent(M)}`):T=`https://www.googleapis.com/drive/v3/files/${w}?alt=media`;const O=await fetch(T,{headers:{Authorization:`Bearer ${r}`,Accept:"*/*"}});if(!O.ok){const ge=await O.text();throw O.status,O.statusText,new Error(`Failed to download file (${O.status}): ${ge}`)}const C=await O.blob(),X={id:w,name:y,url:T,blob:C,headers:{Authorization:`Bearer ${r}`,Accept:"*/*"}};Y(X)}catch(S){n(S)}else u[google.picker.Response.ACTION]===google.picker.Action.CANCEL&&Y(null)}).build().setVisible(!0)}catch(r){n(r)}}),or=class or{constructor(){er(this,"clientIdPersonal","");er(this,"clientIdBusiness","");er(this,"sharepointUrl","");er(this,"sharepointTenantId","");er(this,"msalInstance",null);er(this,"currentAuthorityType","personal")}static getInstance(){return or.instance||(or.instance=new or),or.instance}async initialize(n){n&&this.currentAuthorityType!==n&&(this.currentAuthorityType=n,this.msalInstance=null),await this.getCredentials()}async ensureInitialized(n){await this.initialize(n)}async getCredentials(){var i,u,S,w;const n=await fetch("/api/config",{headers:{"Content-Type":"application/json"},credentials:"include"});if(!n.ok)throw new Error("Failed to fetch OneDrive credentials");const r=await n.json();if(this.clientIdPersonal=(i=r.onedrive)==null?void 0:i.client_id_personal,this.clientIdBusiness=(u=r.onedrive)==null?void 0:u.client_id_business,this.sharepointUrl=(S=r.onedrive)==null?void 0:S.sharepoint_url,this.sharepointTenantId=(w=r.onedrive)==null?void 0:w.sharepoint_tenant_id,!this.clientIdPersonal&&!this.clientIdBusiness)throw new Error("OneDrive personal or business client ID not configured")}async getMsalInstance(n){if(await this.ensureInitialized(n),!this.msalInstance){const r=this.currentAuthorityType==="organizations"?this.sharepointTenantId||"common":"consumers",i=this.currentAuthorityType==="organizations"?this.clientIdBusiness:this.clientIdPersonal;if(!i)throw new Error("OneDrive client ID not configured");const u={auth:{authority:`https://login.microsoftonline.com/${r}`,clientId:i}},{PublicClientApplication:S}=await Pr(async()=>{const{PublicClientApplication:w}=await import("./DQEFeAfs.js");return{PublicClientApplication:w}},[],import.meta.url);this.msalInstance=new S(u),this.msalInstance.initialize&&await this.msalInstance.initialize()}return this.msalInstance}getAuthorityType(){return this.currentAuthorityType}getSharepointUrl(){return this.sharepointUrl}getSharepointTenantId(){return this.sharepointTenantId}getBaseUrl(){if(this.currentAuthorityType==="organizations"){if(!this.sharepointUrl||this.sharepointUrl==="")throw new Error("Sharepoint URL not configured");let n=this.sharepointUrl.replace(/^https?:\/\//,"");return n=n.replace(/\/$/,""),`https://${n}`}else return"https://onedrive.live.com/picker"}};er(or,"instance");let Ar=or;async function ws(Y,n){const r=Ar.getInstance();await r.ensureInitialized(n);const S={scopes:r.getAuthorityType()==="organizations"?[`${Y||r.getBaseUrl()}/.default`]:["OneDrive.ReadWrite"]};let w="";try{w=(await(await r.getMsalInstance(n)).acquireTokenSilent(S)).accessToken}catch{const y=await r.getMsalInstance(n);try{const pe=await y.loginPopup(S);y.setActiveAccount(pe.account),pe.idToken&&(w=(await y.acquireTokenSilent(S)).accessToken)}catch(pe){throw new Error("Failed to login: "+(pe instanceof Error?pe.message:String(pe)))}}if(!w)throw new Error("Failed to acquire access token");return w}function Vl(){var i;const Y=ja(),n=Ar.getInstance(),r={sdk:"8.0",entry:{oneDrive:{}},authentication:{},messaging:{origin:((i=window==null?void 0:window.location)==null?void 0:i.origin)||"",channelId:Y},search:{enabled:!0},typesAndSources:{mode:"files",pivots:{oneDrive:!0,recent:!0,myOrganization:n.getAuthorityType()==="organizations"}}};return n.getAuthorityType()!=="organizations"&&(r.entry.oneDrive={files:{}}),r}async function Gl(Y,n){const r=await ws(void 0,n);if(!r)throw new Error("Unable to retrieve OneDrive access token.");const i=`${Y["@sharePoint.endpoint"]}/drives/${Y.parentReference.driveId}/items/${Y.id}`,u=await fetch(i,{headers:{Authorization:`Bearer ${r}`}});if(!u.ok)throw new Error(`Failed to fetch file information: ${u.status} ${u.statusText}`);const w=(await u.json())["@content.downloadUrl"];if(!w)throw new Error("Download URL not found in file data");const y=await fetch(w);if(!y.ok)throw new Error(`Failed to download file: ${y.status} ${y.statusText}`);return await y.blob()}async function Jl(Y){if(typeof window>"u")throw new Error("Not in browser environment");const n=Ar.getInstance();return await n.initialize(Y),new Promise((r,i)=>{let u=null,S=null;const w=Vl(),y=n.getBaseUrl(),pe=O=>{var X;if(O.source!==u)return;const C=O.data;if((C==null?void 0:C.type)==="initialize"&&(C==null?void 0:C.channelId)===w.messaging.channelId){if(S=(X=O.ports)==null?void 0:X[0],!S)return;S.addEventListener("message",h),S.start(),S.postMessage({type:"activate"})}},h=async O=>{const C=O.data;switch(C.type){case"notification":break;case"command":{S==null||S.postMessage({type:"acknowledge",id:C.id});const X=C.data;switch(X.command){case"authenticate":{try{const ge=n.getAuthorityType()==="organizations"?X.resource:void 0,ae=await ws(ge,Y);if(ae)S==null||S.postMessage({type:"result",id:C.id,data:{result:"token",token:ae}});else throw new Error("Could not retrieve auth token")}catch{S==null||S.postMessage({type:"result",id:C.id,data:{result:"error",error:{code:"tokenError",message:"Failed to get token"}}})}break}case"close":{T(),r(null);break}case"pick":{S==null||S.postMessage({type:"result",id:C.id,data:{result:"success"}}),T(),r(X);break}default:{S==null||S.postMessage({result:"error",error:{code:"unsupportedCommand",message:X.command},isExpected:!0});break}}break}}};function T(){window.removeEventListener("message",pe),S&&S.removeEventListener("message",h),u&&(u.close(),u=null)}(async()=>{try{const O=await ws(void 0,Y);if(!O)return i(new Error("Failed to acquire access token"));if(u=window.open("","OneDrivePicker","width=800,height=600"),!u)return i(new Error("Failed to open OneDrive picker window"));const C=new URLSearchParams({filePicker:JSON.stringify(w)});let X="";n.getAuthorityType()==="organizations"?X=y+`/_layouts/15/FilePicker.aspx?${C}`:X=y+`?${C}`;const ge=u.document.createElement("form");ge.setAttribute("action",X),ge.setAttribute("method","POST");const ae=u.document.createElement("input");ae.setAttribute("type","hidden"),ae.setAttribute("name","access_token"),ae.setAttribute("value",O),ge.appendChild(ae),u.document.body.appendChild(ge),ge.submit(),window.addEventListener("message",pe)}catch(O){u&&u.close(),i(O)}})()})}async function ql(Y){const n=await Jl(Y);if(!n||!n.items||n.items.length===0)return null;const r=n.items[0];return{blob:await Gl(r,Y),name:r.name}}var Zl=ga('<svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" fill="none" viewBox="0 0 24 24"><path d="M12 6L12 12L18 12" stroke-linecap="round" stroke-linejoin="round"></path><path d="M21.8883 10.5C21.1645 5.68874 17.013 2 12 2C6.47715 2 2 6.47715 2 12C2 17.5228 6.47715 22 12 22C16.1006 22 19.6248 19.5318 21.1679 16" stroke-linecap="round" stroke-linejoin="round"></path><path d="M17 16H21.4C21.7314 16 22 16.2686 22 16.6V21" stroke-linecap="round" stroke-linejoin="round"></path></svg>');function Yl(Y,n){let r=E(n,"className",8,"w-4 h-4"),i=E(n,"strokeWidth",8,"1.5");var u=Zl();Z(()=>{gt(u,0,wa(r())),$t(u,"stroke-width",i())}),l(Y,u)}var Kl=v('<div class="text-center text-xs text-gray-500 py-3"> </div>'),Ql=v('<div class="line-clamp-1 flex-1"> </div>'),Xl=v('<button type="button"><div class="text-black dark:text-gray-100 flex items-center gap-1.5"><!></div></button>'),ei=v('<div class="w-full flex justify-center py-4 text-xs animate-pulse items-center gap-2"><!> <div class=" "> </div></div>'),ti=v('<div class="flex flex-col gap-0.5"><!> <!></div>'),ai=v('<div class="py-4.5"><!></div>');function ri(Y,n){Xt(n,!1);const r=()=>ze(Va,"$chatId",u),i=()=>ze(w,"$i18n",u),[u,S]=na(),w=la("i18n");let y=E(n,"onSelect",8,D=>{}),pe=q(!1),h=q([]),T=q(0),M=1,O=q(!1),C=q(!1);const X=async()=>{e(C)||(M+=1,await ge())},ge=async()=>{s(O,!0);let D=await Ua(localStorage.token,M,!0,!0).catch(()=>[]);return(D??[]).length===0?s(C,!0):s(C,!1),s(h,[...e(h),...D.filter(Ae=>(Ae==null?void 0:Ae.id)!==r()).map(Ae=>({...Ae,type:"chat",name:Ae.title,description:tr(Ae.updated_at*1e3).fromNow()}))]),s(O,!1),D};Ya(async()=>{await ge(),await ot(),s(pe,!0)}),ta();var ae=ct(),Re=ke(ae);{var Pe=D=>{var Ae=ct(),_=ke(Ae);{var we=re=>{var Ye=Kl(),J=a(Ye,!0);t(Ye),Z(L=>Le(J,L),[()=>(i(),o(()=>i().t("No chats found")))]),l(re,Ye)},ee=re=>{var Ye=ti(),J=a(Ye);ua(J,1,()=>e(h),Ca,(g,f,$)=>{var I=Xl(),ye=a(I),Ce=a(ye);{let de=$e(()=>(e(f),B($a),o(()=>{var Me;return e(f).description||$a((Me=e(f))==null?void 0:Me.name)})));mt(Ce,{get content(){return e(de)},placement:"top-start",children:(Me,xe)=>{var Ge=Ql(),We=a(Ge,!0);t(Ge),Z(me=>Le(We,me),[()=>(B($a),e(f),o(()=>{var me;return $a((me=e(f))==null?void 0:me.name)}))]),l(Me,Ge)},$$slots:{default:!0}})}t(ye),t(I),Z(()=>{gt(I,1,` px-2.5 py-1 rounded-xl w-full text-left flex justify-between items-center text-sm ${$===e(T)?" bg-gray-50 dark:bg-gray-800 dark:text-gray-100 selected-command-option-button":""}`),$t(I,"data-selected",$===e(T))}),Qe("click",I,()=>{y()(e(f))}),Qe("mousemove",I,()=>{s(T,$)}),Qe("mouseleave",I,()=>{$===0&&s(T,-1)}),l(g,I)});var L=m(J,2);{var k=g=>{Tr(g,{$$events:{visible:f=>{e(O)||X()}},children:(f,$)=>{var I=ei(),ye=a(I);Sa(ye,{className:" size-4"});var Ce=m(ye,2),de=a(Ce,!0);t(Ce),t(I),Z(Me=>Le(de,Me),[()=>(i(),o(()=>i().t("Loading...")))]),l(f,I)},$$slots:{default:!0}})};N(L,g=>{e(C)||g(k)})}t(Ye),l(re,Ye)};N(_,re=>{e(h),o(()=>e(h).length===0)?re(we):re(ee,!1)})}l(D,Ae)},ve=D=>{var Ae=ai(),_=a(Ae);Sa(_,{}),t(Ae),l(D,Ae)};N(Re,D=>{e(pe)?D(Pe):D(ve,!1)})}l(Y,ae),ea(),S()}var si=v('<div class="text-center text-xs text-gray-500 py-3"> </div>'),oi=v('<div class="line-clamp-1 flex-1"> </div>'),ni=v('<button type="button"><div class="text-black dark:text-gray-100 flex items-center gap-1.5"><!> <!></div></button>'),li=v('<div class="w-full flex justify-center py-4 text-xs animate-pulse items-center gap-2"><!> <div class=" "> </div></div>'),ii=v('<div class="flex flex-col gap-0.5"><!> <!></div>'),di=v('<div class="py-4.5"><!></div>');function ci(Y,n){Xt(n,!1);const r=()=>ze(S,"$i18n",i),[i,u]=na(),S=la("i18n");let w=E(n,"onSelect",8,ve=>{}),y=q(!1),pe=q([]),h=q(0),T=1,M=q(!1),O=q(!1);const C=async()=>{e(O)||(T+=1,await X())},X=async()=>{s(M,!0);let ve=await Yn(localStorage.token,T).catch(()=>[]);return(ve??[]).length===0?s(O,!0):s(O,!1),s(pe,[...e(pe),...ve.map(D=>({...D,type:"note",name:D.title,description:tr(D.updated_at/1e6).fromNow()}))]),s(M,!1),ve};Ya(async()=>{await X(),await ot(),s(y,!0)}),ta();var ge=ct(),ae=ke(ge);{var Re=ve=>{var D=ct(),Ae=ke(D);{var _=ee=>{var re=si(),Ye=a(re,!0);t(re),Z(J=>Le(Ye,J),[()=>(r(),o(()=>r().t("No notes found")))]),l(ee,re)},we=ee=>{var re=ii(),Ye=a(re);ua(Ye,1,()=>e(pe),Ca,(k,g,f)=>{var $=ni(),I=a($),ye=a(I);{let de=$e(()=>(r(),o(()=>r().t("Note"))));mt(ye,{get content(){return e(de)},placement:"top",children:(Me,xe)=>{xs(Me,{className:"size-4"})},$$slots:{default:!0}})}var Ce=m(ye,2);{let de=$e(()=>(e(g),B($a),o(()=>{var Me;return e(g).description||$a((Me=e(g))==null?void 0:Me.name)})));mt(Ce,{get content(){return e(de)},placement:"top-start",children:(Me,xe)=>{var Ge=oi(),We=a(Ge,!0);t(Ge),Z(me=>Le(We,me),[()=>(B($a),e(g),o(()=>{var me;return $a((me=e(g))==null?void 0:me.name)}))]),l(Me,Ge)},$$slots:{default:!0}})}t(I),t($),Z(()=>{gt($,1,` px-2.5 py-1 rounded-xl w-full text-left flex justify-between items-center text-sm ${f===e(h)?" bg-gray-50 dark:bg-gray-800 dark:text-gray-100 selected-command-option-button":""}`),$t($,"data-selected",f===e(h))}),Qe("click",$,()=>{w()(e(g))}),Qe("mousemove",$,()=>{s(h,f)}),Qe("mouseleave",$,()=>{f===0&&s(h,-1)}),l(k,$)});var J=m(Ye,2);{var L=k=>{Tr(k,{$$events:{visible:g=>{e(M)||C()}},children:(g,f)=>{var $=li(),I=a($);Sa(I,{className:" size-4"});var ye=m(I,2),Ce=a(ye,!0);t(ye),t($),Z(de=>Le(Ce,de),[()=>(r(),o(()=>r().t("Loading...")))]),l(g,$)},$$slots:{default:!0}})};N(J,k=>{e(O)||k(L)})}t(re),l(ee,re)};N(Ae,ee=>{e(pe),o(()=>e(pe).length===0)?ee(_):ee(we,!1)})}l(ve,D)},Pe=ve=>{var D=di(),Ae=a(D);Sa(Ae,{}),t(D),l(ve,D)};N(ae,ve=>{e(y)?ve(Re):ve(Pe,!1)})}l(Y,ge),ea(),u()}var ui=v('<div class="py-4 text-center text-sm text-gray-500 dark:text-gray-400"> </div>'),vi=v('<div class="line-clamp-1 flex-1 text-sm"> </div>'),fi=v('<button type="button" class=" ml-2 opacity-50 hover:opacity-100 transition"><!></button>'),gi=v('<div class=" py-1 flex justify-center"><!></div>'),mi=v('<div class=" text-xs text-gray-500 dark:text-gray-400 italic py-0.5 px-2"> </div>'),pi=v('<div class="line-clamp-1 flex-1 text-sm"> </div>'),hi=v('<button class=" px-2.5 py-1 rounded-xl w-full text-left flex justify-between items-center text-sm hover:bg-gray-50 hover:dark:bg-gray-800 hover:dark:text-gray-100" type="button"><div class=" flex items-center gap-1.5"><!> <!></div></button>'),_i=v('<div class="w-full flex justify-center py-4 text-xs animate-pulse items-center gap-2"><!> <div class=" "> </div></div>'),wi=v("<!> <!>",1),yi=v('<div class="pl-3 mb-1 flex flex-col gap-0.5"><!></div>'),bi=v('<div><button class="w-full flex-1" type="button"><div class="  text-black dark:text-gray-100 flex items-center gap-1 shrink-0"><!> <!></div></button> <!></div> <!>',1),xi=v('<div class="w-full flex justify-center py-4 text-xs animate-pulse items-center gap-2"><!> <div class=" "> </div></div>'),$i=v("<!> <!>",1),ki=v('<div class="flex flex-col gap-0.5"><!></div>'),Ci=v('<div class="py-4.5"><!></div>');function Ii(Y,n){Xt(n,!1);const r=()=>ze(S,"$i18n",i),[i,u]=na(),S=la("i18n");let w=E(n,"onSelect",8,g=>{}),y=q(!1),pe=q(0),h=q(null),T=1,M=q(null),O=q(null),C=q(!1),X=q(!1);const ge=async()=>{T=1,s(M,null),s(O,null),s(X,!1),s(C,!1),await ot(),await Re()},ae=async()=>{e(X)||(T+=1,await Re())},Re=async()=>{if(!e(h))return;s(C,!0);const g=await Kn(localStorage.token,e(h).id,null,null,null,null,T).catch(()=>null);if(g){s(O,g.total);const f=g.items;(f??[]).length===0?s(X,!0):s(X,!1),e(M)?s(M,[...e(M),...f]):s(M,f)}return s(C,!1),g};let Pe=1,ve=q(null),D=q(!1),Ae=q(!1);const _=async()=>{we(),await ot(),await re()},we=()=>{Pe=1,s(ve,null),s(Ae,!1),s(D,!1)},ee=async()=>{e(Ae)||(Pe+=1,await re())},re=async()=>{s(D,!0);const g=await Qn(localStorage.token,Pe).catch(()=>null);if(g){g.total;const f=g.items;(f??[]).length===0?s(Ae,!0):s(Ae,!1),e(ve)?s(ve,[...e(ve),...f]):s(ve,f)}return s(D,!1),g};Ya(async()=>{await ot(),s(y,!0)}),Tt(()=>e(h),()=>{e(h)&&ge()}),Tt(()=>e(y),()=>{e(y)&&_()}),Da(),ta();var Ye=ct(),J=ke(Ye);{var L=g=>{var f=ki(),$=a(f);{var I=Ce=>{var de=ui(),Me=a(de,!0);t(de),Z(xe=>Le(Me,xe),[()=>(r(),o(()=>r().t("No knowledge bases found.")))]),l(Ce,de)},ye=Ce=>{var de=$i(),Me=ke(de);ua(Me,3,()=>e(ve),We=>We.id,(We,me,x)=>{var Ie=bi(),He=ke(Ie),Se=a(He),he=a(Se),U=a(he);{let V=$e(()=>(r(),o(()=>r().t("Collection"))));mt(U,{get content(){return e(V)},placement:"top",children:(_e,d)=>{Xs(_e,{className:"size-4"})},$$slots:{default:!0}})}var H=m(U,2);{let V=$e(()=>(e(me),B($a),o(()=>{var _e;return e(me).description||$a((_e=e(me))==null?void 0:_e.name)})));mt(H,{get content(){return e(V)},placement:"top-start",children:(_e,d)=>{var A=vi(),G=a(A,!0);t(A),Z(j=>Le(G,j),[()=>(B($a),e(me),o(()=>{var j;return $a((j=e(me))==null?void 0:j.name)}))]),l(_e,A)},$$slots:{default:!0}})}t(he),t(Se);var De=m(Se,2);{let V=$e(()=>(r(),o(()=>r().t("Show Files"))));mt(De,{get content(){return e(V)},placement:"top",children:(_e,d)=>{var A=fi(),G=a(A);{var j=R=>{hs(R,{className:"size-3"})},z=R=>{wr(R,{className:"size-3"})};N(G,R=>{e(h),e(me),o(()=>e(h)&&e(h).id===e(me).id)?R(j):R(z,!1)})}t(A),Qe("click",A,()=>{e(h)&&e(h).id===e(me).id?s(h,null):s(h,e(me))}),l(_e,A)},$$slots:{default:!0}})}t(He);var Te=m(He,2);{var Je=V=>{var _e=yi(),d=a(_e);{var A=j=>{var z=gi(),R=a(z);Sa(R,{className:"size-3"}),t(z),l(j,z)},G=j=>{var z=ct(),R=ke(z);{var K=ue=>{var Ee=mi(),Oe=a(Ee,!0);t(Ee),Z(qe=>Le(Oe,qe),[()=>(r(),o(()=>r().t("No files in this knowledge base.")))]),l(ue,Ee)},oe=ue=>{var Ee=wi(),Oe=ke(Ee);ua(Oe,3,()=>e(M),se=>se.id,(se,ne)=>{var Fe=hi(),Ze=a(Fe),Ue=a(Ze);{let lt=$e(()=>(r(),o(()=>r().t("Collection"))));mt(Ue,{get content(){return e(lt)},placement:"top",children:(vt,bt)=>{Fn(vt,{className:"size-4"})},$$slots:{default:!0}})}var Xe=m(Ue,2);{let lt=$e(()=>(B($a),e(ne),o(()=>{var vt,bt;return $a((bt=(vt=e(ne))==null?void 0:vt.meta)==null?void 0:bt.name)})));mt(Xe,{get content(){return e(lt)},placement:"top-start",children:(vt,bt)=>{var Ft=pi(),Wt=a(Ft,!0);t(Ft),Z(sa=>Le(Wt,sa),[()=>(B($a),e(ne),o(()=>{var sa,Ht;return $a((Ht=(sa=e(ne))==null?void 0:sa.meta)==null?void 0:Ht.name)}))]),l(vt,Ft)},$$slots:{default:!0}})}t(Ze),t(Fe),Qe("click",Fe,()=>{var lt,vt;e(ne),w()({type:"file",name:(vt=(lt=e(ne))==null?void 0:lt.meta)==null?void 0:vt.name,...e(ne)})}),l(se,Fe)});var qe=m(Oe,2);{var W=se=>{Tr(se,{$$events:{visible:async ne=>{e(C)||await ae()}},children:(ne,Fe)=>{var Ze=_i(),Ue=a(Ze);Sa(Ue,{className:" size-3"});var Xe=m(Ue,2),lt=a(Xe,!0);t(Xe),t(Ze),Z(vt=>Le(lt,vt),[()=>(r(),o(()=>r().t("Loading...")))]),l(ne,Ze)},$$slots:{default:!0}})};N(qe,se=>{!e(X)&&!e(C)&&se(W)})}l(ue,Ee)};N(R,ue=>{e(O)===0?ue(K):ue(oe,!1)},!0)}l(j,z)};N(d,j=>{e(M)===null&&e(O)===null?j(A):j(G,!1)})}t(_e),l(V,_e)};N(Te,V=>{e(h),e(me),o(()=>e(h)&&e(h).id===e(me).id)&&V(Je)})}Z(()=>{gt(He,1,` px-2.5 py-1 rounded-xl w-full text-left flex justify-between items-center text-sm ${e(x)===e(pe)?" bg-gray-50 dark:bg-gray-800 dark:text-gray-100 selected-command-option-button":""}`),$t(Se,"data-selected",e(x)===e(pe))}),Qe("click",Se,()=>{w()({type:"collection",...e(me)})}),Qe("mousemove",Se,()=>{s(pe,e(x))}),Qe("mouseleave",Se,()=>{e(x)===0&&s(pe,-1)}),l(We,Ie)});var xe=m(Me,2);{var Ge=We=>{Tr(We,{$$events:{visible:me=>{e(D)||ee()}},children:(me,x)=>{var Ie=xi(),He=a(Ie);Sa(He,{className:" size-4"});var Se=m(He,2),he=a(Se,!0);t(Se),t(Ie),Z(U=>Le(he,U),[()=>(r(),o(()=>r().t("Loading...")))]),l(me,Ie)},$$slots:{default:!0}})};N(xe,We=>{e(Ae)||We(Ge)})}l(Ce,de)};N($,Ce=>{e(ve),o(()=>e(ve).length===0)?Ce(I):Ce(ye,!1)})}t(f),l(g,f)},k=g=>{var f=Ci(),$=a(f);Sa($,{}),t(f),l(g,f)};N(J,g=>{e(y)&&e(ve)!==null?g(L):g(k,!1)})}l(Y,Ye),ea(),u()}var Si=v('<!> <div class="line-clamp-1"> </div>',1),Ei=v('<!> <div class=" line-clamp-1"> </div>',1),Mi=v('<!> <div class="line-clamp-1"> </div>',1),Pi=v('<button><!> <div class="flex items-center w-full justify-between"><div class=" line-clamp-1"> </div> <div class="text-gray-500"><!></div></div></button>'),Ti=v('<button><!> <div class="flex items-center w-full justify-between"><div class=" line-clamp-1"> </div> <div class="text-gray-500"><!></div></div></button>'),zi=v('<button><!> <div class="flex items-center w-full justify-between"><div class=" line-clamp-1"> </div> <div class="text-gray-500"><!></div></div></button>'),Ni=v('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 87.3 78" class="w-4"><path d="m6.6 66.85 3.85 6.65c.8 1.4 1.95 2.5 3.3 3.3l13.75-23.8h-27.5c0 1.55.4 3.1 1.2 4.5z" fill="#0066da"></path><path d="m43.65 25-13.75-23.8c-1.35.8-2.5 1.9-3.3 3.3l-25.4 44a9.06 9.06 0 0 0 -1.2 4.5h27.5z" fill="#00ac47"></path><path d="m73.55 76.8c1.35-.8 2.5-1.9 3.3-3.3l1.6-2.75 7.65-13.25c.8-1.4 1.2-2.95 1.2-4.5h-27.502l5.852 11.5z" fill="#ea4335"></path><path d="m43.65 25 13.75-23.8c-1.35-.8-2.9-1.2-4.5-1.2h-18.5c-1.6 0-3.15.45-4.5 1.2z" fill="#00832d"></path><path d="m59.8 53h-32.3l-13.75 23.8c1.35.8 2.9 1.2 4.5 1.2h50.8c1.6 0 3.15-.45 4.5-1.2z" fill="#2684fc"></path><path d="m73.4 26.5-12.7-22c-.8-1.4-1.95-2.5-3.3-3.3l-13.75 23.8 16.15 28h27.45c0-1.55-.4-3.1-1.2-4.5z" fill="#ffba00"></path></svg> <div class="line-clamp-1"> </div>',1),Ai=v('<button><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32" class="size-4" fill="none"><mask id="mask0_87_7796" style="mask-type:alpha" maskUnits="userSpaceOnUse" x="0" y="6" width="32" height="20"><path d="M7.82979 26C3.50549 26 0 22.5675 0 18.3333C0 14.1921 3.35322 10.8179 7.54613 10.6716C9.27535 7.87166 12.4144 6 16 6C20.6308 6 24.5169 9.12183 25.5829 13.3335C29.1316 13.3603 32 16.1855 32 19.6667C32 23.0527 29 26 25.8723 25.9914L7.82979 26Z" fill="#C4C4C4"></path></mask><g mask="url(#mask0_87_7796)"><path d="M7.83017 26.0001C5.37824 26.0001 3.18957 24.8966 1.75391 23.1691L18.0429 16.3335L30.7089 23.4647C29.5926 24.9211 27.9066 26.0001 26.0004 25.9915C23.1254 26.0001 12.0629 26.0001 7.83017 26.0001Z" fill="url(#paint0_linear_87_7796)"></path><path d="M25.5785 13.3149L18.043 16.3334L30.709 23.4647C31.5199 22.4065 32.0004 21.0916 32.0004 19.6669C32.0004 16.1857 29.1321 13.3605 25.5833 13.3337C25.5817 13.3274 25.5801 13.3212 25.5785 13.3149Z" fill="url(#paint1_linear_87_7796)"></path><path d="M7.06445 10.7028L18.0423 16.3333L25.5779 13.3148C24.5051 9.11261 20.6237 6 15.9997 6C12.4141 6 9.27508 7.87166 7.54586 10.6716C7.3841 10.6773 7.22358 10.6877 7.06445 10.7028Z" fill="url(#paint2_linear_87_7796)"></path><path d="M1.7535 23.1687L18.0425 16.3331L7.06471 10.7026C3.09947 11.0792 0 14.3517 0 18.3331C0 20.1665 0.657197 21.8495 1.7535 23.1687Z" fill="url(#paint3_linear_87_7796)"></path></g><defs><linearGradient id="paint0_linear_87_7796" x1="4.42591" y1="24.6668" x2="27.2309" y2="23.2764" gradientUnits="userSpaceOnUse"><stop stop-color="#2086B8"></stop><stop offset="1" stop-color="#46D3F6"></stop></linearGradient><linearGradient id="paint1_linear_87_7796" x1="23.8302" y1="19.6668" x2="30.2108" y2="15.2082" gradientUnits="userSpaceOnUse"><stop stop-color="#1694DB"></stop><stop offset="1" stop-color="#62C3FE"></stop></linearGradient><linearGradient id="paint2_linear_87_7796" x1="8.51037" y1="7.33333" x2="23.3335" y2="15.9348" gradientUnits="userSpaceOnUse"><stop stop-color="#0D3D78"></stop><stop offset="1" stop-color="#063B83"></stop></linearGradient><linearGradient id="paint3_linear_87_7796" x1="-0.340429" y1="19.9998" x2="14.5634" y2="14.4649" gradientUnits="userSpaceOnUse"><stop stop-color="#16589B"></stop><stop offset="1" stop-color="#1464B7"></stop></linearGradient></defs></svg> <div class="flex items-center w-full justify-between"><div class=" line-clamp-1"> </div> <div class="text-gray-500"><!></div></div></button>'),Li=v("<!> <!>",1),Fi=v("<div><!> <!> <!> <!> <!> <!> <!></div>"),Di=v('<div><button class="flex w-full justify-between gap-2 items-center px-3 py-1.5 text-sm cursor-pointer rounded-xl hover:bg-gray-50 dark:hover:bg-gray-800/50"><!> <div class="flex items-center w-full justify-between"><div> </div></div></button> <!></div>'),Bi=v('<div><button class="flex w-full justify-between gap-2 items-center px-3 py-1.5 text-sm cursor-pointer rounded-xl hover:bg-gray-50 dark:hover:bg-gray-800/50"><!> <div class="flex items-center w-full justify-between"><div> </div></div></button> <!></div>'),Oi=v('<div><button class="flex w-full justify-between gap-2 items-center px-3 py-1.5 text-sm cursor-pointer rounded-xl hover:bg-gray-50 dark:hover:bg-gray-800/50"><!> <div class="flex items-center w-full justify-between"><div> </div></div></button> <!></div>'),ji=v('<div class="flex flex-col"><div class="line-clamp-1"> </div></div>'),Ui=v('<div class="flex flex-col"><div class="line-clamp-1"> </div> <div class="text-xs text-gray-500"> </div></div>'),Ri=v('<div><button class="flex w-full justify-between gap-2 items-center px-3 py-1.5 text-sm cursor-pointer rounded-xl hover:bg-gray-50 dark:hover:bg-gray-800/50"><!> <div class="flex items-center w-full justify-between"><div> </div></div></button> <!> <!></div>'),Wi=v('<div slot="content"><!></div>'),Hi=v('<!> <input id="camera-input" type="file" accept="image/*" capture="environment" style="display: none;"/> <!>',1);function Vi(Y,n){Xt(n,!1);const r=()=>ze(Ka,"$user",w),i=()=>ze(pe,"$i18n",w),u=()=>ze(xr,"$config",w),S=()=>ze(Ba,"$chats",w),[w,y]=na(),pe=la("i18n");let h=E(n,"files",28,()=>[]),T=E(n,"selectedModels",24,()=>[]),M=E(n,"fileUploadCapableModels",24,()=>[]),O=E(n,"screenCaptureHandler",8),C=E(n,"uploadFilesHandler",8),X=E(n,"inputFilesHandler",8),ge=E(n,"uploadGoogleDriveHandler",8),ae=E(n,"uploadOneDriveHandler",8),Re=E(n,"onUpload",8),Pe=E(n,"onClose",8),ve=q(!1),D=q(""),Ae=q(!1),_=q(!0);const we=()=>{const g=navigator.userAgent||navigator.vendor||window.opera;return/android|iphone|ipad|ipod|windows phone/i.test(g)},ee=g=>{var $;const f=Array.from(($=g.target)==null?void 0:$.files);f&&f.length>0&&X()(f)},re=g=>{h().find(f=>f.id===g.id)||(h([...h(),{...g,status:"processed"}]),s(ve,!1))};Tt(()=>(B(M()),B(T()),r()),()=>{var g,f,$,I;s(_,M().length===T().length&&(((g=r())==null?void 0:g.role)==="admin"||((I=($=(f=r())==null?void 0:f.permissions)==null?void 0:$.chat)==null?void 0:I.file_upload)))}),Tt(()=>(e(_),B(h())),()=>{!e(_)&&h().length>0&&h([])}),Da(),ta();var Ye=Hi(),J=ke(Ye);Xn(J,{onSubmit:g=>{Re()(g)},get show(){return e(Ae)},set show(g){s(Ae,g)},$$legacy:!0});var L=m(J,2),k=m(L,2);as(k,{get show(){return e(ve)},set show(g){s(ve,g)},$$events:{change:g=>{g.detail===!1&&Pe()()}},children:(g,f)=>{{let $=$e(()=>(i(),o(()=>i().t("More"))));mt(g,{get content(){return e($)},children:(I,ye)=>{var Ce=ct(),de=ke(Ce);es(de,n,"default",{},null),l(I,Ce)},$$slots:{default:!0}})}},$$slots:{default:!0,content:(g,f)=>{var $=Wi(),I=a($);ts(I,{class:"w-full max-w-70 rounded-2xl px-1 py-1  border border-gray-100  dark:border-gray-800 z-50 bg-white dark:bg-gray-850 dark:text-white shadow-lg max-h-72 overflow-y-auto overflow-x-hidden scrollbar-thin transition",sideOffset:4,alignOffset:-6,side:"bottom",align:"start",get transition(){return br},children:(ye,Ce)=>{var de=ct(),Me=ke(de);{var xe=We=>{var me=Fi(),x=a(me);{let V=$e(()=>(B(M()),B(T()),i(),e(_),o(()=>M().length!==T().length?i().t("Model(s) do not support file upload"):e(_)?"":i().t("You do not have permission to upload files."))));mt(x,{get content(){return e(V)},className:"w-full",children:(_e,d)=>{{let A=$e(()=>e(_)?"":"opacity-50");_a(_e,{get class(){return`flex gap-2 items-center px-3 py-1.5 text-sm cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800/50 rounded-xl ${e(A)??""}`},$$events:{click:()=>{e(_)&&C()()}},children:(G,j)=>{var z=Si(),R=ke(z);Fo(R,{});var K=m(R,2),oe=a(K,!0);t(K),Z(ue=>Le(oe,ue),[()=>(i(),o(()=>i().t("Upload Files")))]),l(G,z)},$$slots:{default:!0}})}},$$slots:{default:!0}})}var Ie=m(x,2);{let V=$e(()=>(B(M()),B(T()),i(),e(_),o(()=>M().length!==T().length?i().t("Model(s) do not support file upload"):e(_)?"":i().t("You do not have permission to upload files."))));mt(Ie,{get content(){return e(V)},className:"w-full",children:(_e,d)=>{{let A=$e(()=>e(_)?"":"opacity-50");_a(_e,{get class(){return`flex gap-2 items-center px-3 py-1.5 text-sm  cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800/50  rounded-xl ${e(A)??""}`},$$events:{click:()=>{if(e(_))if(!we())O()();else{const G=document.getElementById("camera-input");G&&G.click()}}},children:(G,j)=>{var z=Ei(),R=ke(z);Do(R,{});var K=m(R,2),oe=a(K,!0);t(K),Z(ue=>Le(oe,ue),[()=>(i(),o(()=>i().t("Capture")))]),l(G,z)},$$slots:{default:!0}})}},$$slots:{default:!0}})}var He=m(Ie,2);{let V=$e(()=>(B(M()),B(T()),i(),e(_),o(()=>M().length!==T().length?i().t("Model(s) do not support file upload"):e(_)?"":i().t("You do not have permission to upload files."))));mt(He,{get content(){return e(V)},className:"w-full",children:(_e,d)=>{{let A=$e(()=>e(_)?"":"opacity-50");_a(_e,{get class(){return`flex gap-2 items-center px-3 py-1.5 text-sm cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 rounded-xl ${e(A)??""}`},$$events:{click:()=>{e(_)&&s(Ae,!0)}},children:(G,j)=>{var z=Mi(),R=ke(z);$s(R,{});var K=m(R,2),oe=a(K,!0);t(K),Z(ue=>Le(oe,ue),[()=>(i(),o(()=>i().t("Attach Webpage")))]),l(G,z)},$$slots:{default:!0}})}},$$slots:{default:!0}})}var Se=m(He,2);{var he=V=>{{let _e=$e(()=>(B(M()),B(T()),i(),e(_),o(()=>M().length!==T().length?i().t("Model(s) do not support file upload"):e(_)?"":i().t("You do not have permission to upload files."))));mt(V,{get content(){return e(_e)},className:"w-full",children:(d,A)=>{var G=Pi(),j=a(G);xs(j,{});var z=m(j,2),R=a(z),K=a(R,!0);t(R);var oe=m(R,2),ue=a(oe);wr(ue,{}),t(oe),t(z),t(G),Z(Ee=>{gt(G,1,`flex gap-2 w-full items-center px-3 py-1.5 text-sm cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800/50 rounded-xl ${e(_)?"":"opacity-50"}`),Le(K,Ee)},[()=>(i(),o(()=>i().t("Attach Notes")))]),Qe("click",G,()=>{s(D,"notes")}),l(d,G)},$$slots:{default:!0}})}};N(Se,V=>{u(),o(()=>{var _e,d;return((d=(_e=u())==null?void 0:_e.features)==null?void 0:d.enable_notes)??!1})&&V(he)})}var U=m(Se,2);{let V=$e(()=>(B(M()),B(T()),i(),e(_),o(()=>M().length!==T().length?i().t("Model(s) do not support file upload"):e(_)?"":i().t("You do not have permission to upload files."))));mt(U,{get content(){return e(V)},className:"w-full",children:(_e,d)=>{var A=Ti(),G=a(A);Xs(G,{});var j=m(G,2),z=a(j),R=a(z,!0);t(z);var K=m(z,2),oe=a(K);wr(oe,{}),t(K),t(j),t(A),Z(ue=>{gt(A,1,`flex gap-2 w-full items-center px-3 py-1.5 text-sm cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800/50 rounded-xl ${e(_)?"":"opacity-50"}`),Le(R,ue)},[()=>(i(),o(()=>i().t("Attach Knowledge")))]),Qe("click",A,()=>{s(D,"knowledge")}),l(_e,A)},$$slots:{default:!0}})}var H=m(U,2);{var De=V=>{{let _e=$e(()=>(B(M()),B(T()),i(),e(_),o(()=>M().length!==T().length?i().t("Model(s) do not support file upload"):e(_)?"":i().t("You do not have permission to upload files."))));mt(V,{get content(){return e(_e)},className:"w-full",children:(d,A)=>{var G=zi(),j=a(G);Yl(j,{});var z=m(j,2),R=a(z),K=a(R,!0);t(R);var oe=m(R,2),ue=a(oe);wr(ue,{}),t(oe),t(z),t(G),Z(Ee=>{gt(G,1,`flex gap-2 w-full items-center px-3 py-1.5 text-sm cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800/50 rounded-xl ${e(_)?"":"opacity-50"}`),Le(K,Ee)},[()=>(i(),o(()=>i().t("Reference Chats")))]),Qe("click",G,()=>{s(D,"chats")}),l(d,G)},$$slots:{default:!0}})}};N(H,V=>{S(),o(()=>(S()??[]).length>0)&&V(De)})}var Te=m(H,2);{var Je=V=>{var _e=Li(),d=ke(_e);{var A=z=>{_a(z,{class:"flex gap-2 items-center px-3 py-1.5 text-sm cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800/50 rounded-xl",$$events:{click:()=>{ge()()}},children:(R,K)=>{var oe=Ni(),ue=m(ke(oe),2),Ee=a(ue,!0);t(ue),Z(Oe=>Le(Ee,Oe),[()=>(i(),o(()=>i().t("Google Drive")))]),l(R,oe)},$$slots:{default:!0}})};N(d,z=>{u(),o(()=>{var R,K;return(K=(R=u())==null?void 0:R.features)==null?void 0:K.enable_google_drive_integration})&&z(A)})}var G=m(d,2);{var j=z=>{var R=Ai(),K=m(a(R),2),oe=a(K),ue=a(oe,!0);t(oe);var Ee=m(oe,2),Oe=a(Ee);wr(Oe,{}),t(Ee),t(K),t(R),Z(qe=>{gt(R,1,`flex gap-2 w-full items-center px-3 py-1.5 text-sm cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800/50 rounded-xl ${e(_)?"":"opacity-50"}`),Le(ue,qe)},[()=>(i(),o(()=>i().t("Microsoft OneDrive")))]),Qe("click",R,()=>{s(D,"microsoft_onedrive")}),l(z,R)};N(G,z=>{u(),o(()=>{var R,K,oe,ue,Ee,Oe;return((K=(R=u())==null?void 0:R.features)==null?void 0:K.enable_onedrive_integration)&&(((ue=(oe=u())==null?void 0:oe.features)==null?void 0:ue.enable_onedrive_personal)||((Oe=(Ee=u())==null?void 0:Ee.features)==null?void 0:Oe.enable_onedrive_business))})&&z(j)})}l(V,_e)};N(Te,V=>{e(_)&&V(Je)})}t(me),za(1,me,()=>sr,()=>({x:-20,duration:150})),l(We,me)},Ge=We=>{var me=ct(),x=ke(me);{var Ie=Se=>{var he=Di(),U=a(he),H=a(U);Cr(H,{});var De=m(H,2),Te=a(De),Je=a(Te,!0);t(Te),t(De),t(U);var V=m(U,2);Ii(V,{onSelect:re}),t(he),Z(_e=>Le(Je,_e),[()=>(i(),o(()=>i().t("Knowledge")))]),Qe("click",U,()=>{s(D,"")}),za(1,he,()=>sr,()=>({x:20,duration:150})),l(Se,he)},He=Se=>{var he=ct(),U=ke(he);{var H=Te=>{var Je=Bi(),V=a(Je),_e=a(V);Cr(_e,{});var d=m(_e,2),A=a(d),G=a(A,!0);t(A),t(d),t(V);var j=m(V,2);ci(j,{onSelect:re}),t(Je),Z(z=>Le(G,z),[()=>(i(),o(()=>i().t("Notes")))]),Qe("click",V,()=>{s(D,"")}),za(1,Je,()=>sr,()=>({x:20,duration:150})),l(Te,Je)},De=Te=>{var Je=ct(),V=ke(Je);{var _e=A=>{var G=Oi(),j=a(G),z=a(j);Cr(z,{});var R=m(z,2),K=a(R),oe=a(K,!0);t(K),t(R),t(j);var ue=m(j,2);ri(ue,{onSelect:re}),t(G),Z(Ee=>Le(oe,Ee),[()=>(i(),o(()=>i().t("Chats")))]),Qe("click",j,()=>{s(D,"")}),za(1,G,()=>sr,()=>({x:20,duration:150})),l(A,G)},d=A=>{var G=ct(),j=ke(G);{var z=R=>{var K=Ri(),oe=a(K),ue=a(oe);Cr(ue,{});var Ee=m(ue,2),Oe=a(Ee),qe=a(Oe,!0);t(Oe),t(Ee),t(oe);var W=m(oe,2);{var se=Ze=>{_a(Ze,{class:"flex gap-2 items-center px-3 py-1.5 text-sm cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800/50 rounded-xl text-left",$$events:{click:()=>{ae()("personal")}},children:(Ue,Xe)=>{var lt=ji(),vt=a(lt),bt=a(vt,!0);t(vt),t(lt),Z(Ft=>Le(bt,Ft),[()=>(i(),o(()=>i().t("Microsoft OneDrive (personal)")))]),l(Ue,lt)},$$slots:{default:!0}})};N(W,Ze=>{u(),o(()=>{var Ue,Xe;return(Xe=(Ue=u())==null?void 0:Ue.features)==null?void 0:Xe.enable_onedrive_personal})&&Ze(se)})}var ne=m(W,2);{var Fe=Ze=>{_a(Ze,{class:"flex gap-2 items-center px-3 py-1.5 text-sm cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800/50 rounded-xl text-left",$$events:{click:()=>{ae()("organizations")}},children:(Ue,Xe)=>{var lt=Ui(),vt=a(lt),bt=a(vt,!0);t(vt);var Ft=m(vt,2),Wt=a(Ft,!0);t(Ft),t(lt),Z((sa,Ht)=>{Le(bt,sa),Le(Wt,Ht)},[()=>(i(),o(()=>i().t("Microsoft OneDrive (work/school)"))),()=>(i(),o(()=>i().t("Includes SharePoint")))]),l(Ue,lt)},$$slots:{default:!0}})};N(ne,Ze=>{u(),o(()=>{var Ue,Xe;return(Xe=(Ue=u())==null?void 0:Ue.features)==null?void 0:Xe.enable_onedrive_business})&&Ze(Fe)})}t(K),Z(Ze=>Le(qe,Ze),[()=>(i(),o(()=>i().t("Microsoft OneDrive")))]),Qe("click",oe,()=>{s(D,"")}),za(1,K,()=>sr,()=>({x:20,duration:150})),l(R,K)};N(j,R=>{e(D)==="microsoft_onedrive"&&R(z)},!0)}l(A,G)};N(V,A=>{e(D)==="chats"?A(_e):A(d,!1)},!0)}l(Te,Je)};N(U,Te=>{e(D)==="notes"?Te(H):Te(De,!1)},!0)}l(Se,he)};N(x,Se=>{e(D)==="knowledge"?Se(Ie):Se(He,!1)},!0)}l(We,me)};N(Me,We=>{e(D)===""?We(xe):We(Ge,!1)})}l(ye,de)},$$slots:{default:!0}}),t($),l(g,$)}},$$legacy:!0}),Qe("change",L,ee),l(Y,Ye),ea(),y()}var Gi=v('<div class=" flex justify-between dark:text-gray-300 px-5 pb-1"><div class=" text-base font-medium self-center"> </div></div>'),Ji=v('<div class="text-xs text-gray-500"> </div>'),qi=v('<div class="truncate"><div class="text-sm font-medium dark:text-gray-100 text-gray-800 truncate"> </div> <!></div>'),Zi=v('<!> <div class="px-5 pb-3 w-full flex flex-col justify-center"><div class=" text-sm dark:text-gray-300 mb-1"></div></div>',1),Yi=v('<div><div class="text-sm font-medium dark:text-gray-100 text-gray-800"> </div> <div class="text-xs text-gray-500"> </div> <div class="text-xs text-gray-500"> </div></div>'),Ki=v('<div class="my-1"><div class="font-medium text-gray-800 dark:text-gray-100"> </div> <div> </div></div>'),Qi=v('<div slot="content"></div>'),Xi=v('<div class=" flex justify-between dark:text-gray-300 px-5 pb-0.5"><div class=" text-base font-medium self-center"> </div></div> <div class="px-5 pb-5 w-full flex flex-col justify-center"><div class=" text-xs text-gray-600 dark:text-gray-300 mb-2"> <br/><a class="underline" href="https://github.com/open-webui/openapi-servers" target="_blank"> </a></div> <div class=" text-sm dark:text-gray-300 mb-1"></div></div>',1),ed=v('<div><div class=" flex justify-between dark:text-gray-300 px-5 pt-4 pb-0.5"><div class=" text-lg font-medium self-center"> </div> <button class="self-center"><!></button></div> <!> <!></div>');function td(Y,n){Xt(n,!1);const r=()=>ze(Za,"$tools",S),i=()=>ze(T,"$i18n",S),u=()=>ze(Kr,"$toolServers",S),[S,w]=na();let y=E(n,"show",12,!1),pe=E(n,"selectedToolIds",24,()=>[]),h=q([]);const T=la("i18n");Tt(()=>(r(),B(pe())),()=>{s(h,(r()??[]).filter(M=>pe().includes(M.id)))}),Da(),ta(),al(Y,{size:"md",get show(){return y()},set show(M){y(M)},children:(M,O)=>{var C=ed(),X=a(C),ge=a(X),ae=a(ge,!0);t(ge);var Re=m(ge,2),Pe=a(Re);Ga(Pe,{className:"size-5"}),t(Re),t(X);var ve=m(X,2);{var D=we=>{var ee=Zi(),re=ke(ee);{var Ye=k=>{var g=Gi(),f=a(g),$=a(f,!0);t(f),t(g),Z(I=>Le($,I),[()=>(i(),o(()=>i().t("Tools")))]),l(k,g)};N(re,k=>{u(),o(()=>u().length>0)&&k(Ye)})}var J=m(re,2),L=a(J);ua(L,5,()=>e(h),Ca,(k,g)=>{yr(k,{buttonClassName:"w-full mb-0.5",children:(f,$)=>{var I=qi(),ye=a(I),Ce=a(ye,!0);t(ye);var de=m(ye,2);{var Me=xe=>{var Ge=Ji(),We=a(Ge,!0);t(Ge),Z(()=>Le(We,(e(g),o(()=>{var me,x;return(x=(me=e(g))==null?void 0:me.meta)==null?void 0:x.description})))),l(xe,Ge)};N(de,xe=>{e(g),o(()=>{var Ge,We;return(We=(Ge=e(g))==null?void 0:Ge.meta)==null?void 0:We.description})&&xe(Me)})}t(I),Z(()=>Le(Ce,(e(g),o(()=>{var xe;return(xe=e(g))==null?void 0:xe.name})))),l(f,I)},$$slots:{default:!0}})}),t(L),t(J),l(we,ee)};N(ve,we=>{e(h),o(()=>e(h).length>0)&&we(D)})}var Ae=m(ve,2);{var _=we=>{var ee=Xi(),re=ke(ee),Ye=a(re),J=a(Ye,!0);t(Ye),t(re);var L=m(re,2),k=a(L),g=a(k),f=m(g,2),$=a(f,!0);t(f),t(k);var I=m(k,2);ua(I,5,u,Ca,(ye,Ce)=>{yr(ye,{buttonClassName:"w-full",chevron:!0,children:(de,Me)=>{var xe=Yi(),Ge=a(xe),We=a(Ge);t(Ge);var me=m(Ge,2),x=a(me,!0);t(me);var Ie=m(me,2),He=a(Ie,!0);t(Ie),t(xe),Z(()=>{Le(We,`${e(Ce),o(()=>{var Se,he,U;return(U=(he=(Se=e(Ce))==null?void 0:Se.openapi)==null?void 0:he.info)==null?void 0:U.title})??""} - v${e(Ce),o(()=>{var Se,he,U;return(U=(he=(Se=e(Ce))==null?void 0:Se.openapi)==null?void 0:he.info)==null?void 0:U.version})??""}`),Le(x,(e(Ce),o(()=>{var Se,he,U;return(U=(he=(Se=e(Ce))==null?void 0:Se.openapi)==null?void 0:he.info)==null?void 0:U.description}))),Le(He,(e(Ce),o(()=>{var Se;return(Se=e(Ce))==null?void 0:Se.url})))}),l(de,xe)},$$slots:{default:!0,content:(de,Me)=>{var xe=Qi();ua(xe,5,()=>(e(Ce),o(()=>{var Ge;return((Ge=e(Ce))==null?void 0:Ge.specs)??[]})),Ca,(Ge,We)=>{var me=Ki(),x=a(me),Ie=a(x,!0);t(x);var He=m(x,2),Se=a(He,!0);t(He),t(me),Z(()=>{Le(Ie,(e(We),o(()=>{var he;return(he=e(We))==null?void 0:he.name}))),Le(Se,(e(We),o(()=>{var he;return(he=e(We))==null?void 0:he.description})))}),l(Ge,me)}),t(xe),l(de,xe)}}})}),t(I),t(L),Z((ye,Ce,de)=>{Le(J,ye),Le(g,`${Ce??""} `),Le($,de)},[()=>(i(),o(()=>i().t("Tool Servers"))),()=>(i(),o(()=>i().t("Open WebUI can use tools provided by any OpenAPI server."))),()=>(i(),o(()=>i().t("Learn more about OpenAPI tool servers.")))]),l(we,ee)};N(Ae,we=>{u(),o(()=>u().length>0)&&we(_)})}t(C),Z(we=>Le(ae,we),[()=>(i(),o(()=>i().t("Available Tools")))]),Qe("click",Re,()=>{y(!1)}),l(M,C)},$$slots:{default:!0},$$legacy:!0}),ea(),w()}var ad=ga('<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true"><path d="M21 7.6V20.4C21 20.7314 20.7314 21 20.4 21H7.6C7.26863 21 7 20.7314 7 20.4V7.6C7 7.26863 7.26863 7 7.6 7H20.4C20.7314 7 21 7.26863 21 7.6Z" stroke-linecap="round" stroke-linejoin="round"></path><path d="M18 4H4.6C4.26863 4 4 4.26863 4 4.6V18" stroke-linecap="round" stroke-linejoin="round"></path><path d="M7 16.8L12.4444 15L21 18" stroke-linecap="round" stroke-linejoin="round"></path><path d="M16.5 13C15.6716 13 15 12.3284 15 11.5C15 10.6716 15.6716 10 16.5 10C17.3284 10 18 10.6716 18 11.5C18 12.3284 17.3284 13 16.5 13Z" stroke-linecap="round" stroke-linejoin="round"></path></svg>');function co(Y,n){let r=E(n,"className",8,"size-4"),i=E(n,"strokeWidth",8,"1.5");var u=ad();Z(()=>{$t(u,"stroke-width",i()),gt(u,0,wa(r()))}),l(Y,u)}var rd=ga('<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" aria-hidden="true" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M21.75 6.75a4.5 4.5 0 0 1-4.884 4.484c-1.076-.091-2.264.071-2.95.904l-7.152 8.684a2.548 2.548 0 1 1-3.586-3.586l8.684-7.152c.833-.686.995-1.874.904-2.95a4.5 4.5 0 0 1 6.336-4.486l-3.276 3.276a3.004 3.004 0 0 0 2.25 2.25l3.276-3.276c.256.565.398 1.192.398 1.852Z"></path><path stroke-linecap="round" stroke-linejoin="round" d="M4.867 19.125h.008v.008h-.008v-.008Z"></path></svg>');function ys(Y,n){let r=E(n,"className",8,"w-4 h-4"),i=E(n,"strokeWidth",8,"1.5");var u=rd();Z(()=>{$t(u,"stroke-width",i()),gt(u,0,wa(r()))}),l(Y,u)}var sd=ga('<svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 24 24" stroke="currentColor"><path d="M12 4L12 20" stroke-linecap="round" stroke-linejoin="round"></path><path d="M8 9L8 15" stroke-linecap="round" stroke-linejoin="round"></path><path d="M20 10L20 14" stroke-linecap="round" stroke-linejoin="round"></path><path d="M4 10L4 14" stroke-linecap="round" stroke-linejoin="round"></path><path d="M16 7L16 17" stroke-linecap="round" stroke-linejoin="round"></path></svg>');function od(Y,n){let r=E(n,"className",8,"w-4 h-4"),i=E(n,"strokeWidth",8,"1.5");var u=sd();Z(()=>{$t(u,"stroke-width",i()),gt(u,0,wa(r()))}),l(Y,u)}var nd=ga('<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true"><path d="M13 16H18" stroke-linecap="round" stroke-linejoin="round"></path><path d="M6 8L10 12L6 16" stroke-linecap="round" stroke-linejoin="round"></path><path d="M2 18V6C2 4.89543 2.89543 4 4 4H20C21.1046 4 22 4.89543 22 6V18C22 19.1046 21.1046 20 20 20H4C2.89543 20 2 19.1046 2 18Z" stroke-linecap="round" stroke-linejoin="round"></path></svg>');function uo(Y,n){let r=E(n,"className",8,"w-4 h-4"),i=E(n,"strokeWidth",8,"1.5");var u=nd();Z(()=>{$t(u,"stroke-width",i()),gt(u,0,wa(r()))}),l(Y,u)}var ld=ga('<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M10.5 6h9.75M10.5 6a1.5 1.5 0 1 1-3 0m3 0a1.5 1.5 0 1 0-3 0M3.75 6H7.5m3 12h9.75m-9.75 0a1.5 1.5 0 0 1-3 0m3 0a1.5 1.5 0 0 0-3 0m-3.75 0H7.5m9-6h3.75m-3.75 0a1.5 1.5 0 0 1-3 0m3 0a1.5 1.5 0 0 0-3 0m-9.75 0h9.75"></path></svg>');function Zr(Y,n){let r=E(n,"className",8,"w-4 h-4"),i=E(n,"strokeWidth",8,"1.5");var u=ld();Z(()=>{gt(u,0,wa(r())),$t(u,"stroke-width",i())}),l(Y,u)}var id=v('<button class="flex w-full justify-between gap-2 items-center px-3 py-1.5 text-sm cursor-pointer rounded-xl hover:bg-gray-50 dark:hover:bg-gray-800/50"><!> <div class="flex items-center w-full justify-between"><div class=" line-clamp-1"> <span class="ml-0.5 text-gray-500"> </span></div> <div class="text-gray-500"><!></div></div></button>'),dd=v('<div class="py-4"><!></div>'),cd=v('<div class="size-4 items-center flex justify-center"><img style="fill: currentColor;"/></div>'),ud=v('<button class="self-center w-fit text-sm text-gray-600 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300 transition rounded-full" type="button"><!></button>'),vd=v('<div class=" shrink-0"><!></div>'),fd=v('<button class="flex w-full justify-between gap-2 items-center px-3 py-1.5 text-sm cursor-pointer rounded-xl hover:bg-gray-50 dark:hover:bg-gray-800/50"><div class="flex-1 truncate"><div class="flex flex-1 gap-2 items-center"><div class="shrink-0"><!></div> <div class=" truncate"> </div></div></div> <!> <div class=" shrink-0"><!></div></button>'),gd=v('<button class="flex w-full justify-between gap-2 items-center px-3 py-1.5 text-sm cursor-pointer rounded-xl hover:bg-gray-50 dark:hover:bg-gray-800/50"><div class="flex-1 truncate"><div class="flex flex-1 gap-2 items-center"><div class="shrink-0"><!></div> <div class=" truncate"> </div></div></div> <div class=" shrink-0"><!></div></button>'),md=v('<button class="flex w-full justify-between gap-2 items-center px-3 py-1.5 text-sm cursor-pointer rounded-xl hover:bg-gray-50 dark:hover:bg-gray-800/50"><div class="flex-1 truncate"><div class="flex flex-1 gap-2 items-center"><div class="shrink-0"><!></div> <div class=" truncate"> </div></div></div> <div class=" shrink-0"><!></div></button>'),pd=v('<button class="flex w-full justify-between gap-2 items-center px-3 py-1.5 text-sm cursor-pointer rounded-xl hover:bg-gray-50 dark:hover:bg-gray-800/50"><div class="flex-1 truncate"><div class="flex flex-1 gap-2 items-center"><div class="shrink-0"><!></div> <div class=" truncate"> </div></div></div> <div class=" shrink-0"><!></div></button>'),hd=v("<div><!> <!> <!> <!> <!></div>"),_d=v('<div class="absolute inset-0 opacity-50 rounded-xl cursor-pointer z-10"></div>'),wd=v('<div class="shrink-0"><!></div>'),yd=v('<div class=" truncate"> </div>'),bd=v('<button class="self-center w-fit text-sm text-gray-600 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300 transition rounded-full" type="button"><!></button>'),xd=v('<div class=" shrink-0"><!></div>'),$d=v('<button class="relative flex w-full justify-between gap-2 items-center px-3 py-1.5 text-sm cursor-pointer rounded-xl hover:bg-gray-50 dark:hover:bg-gray-800/50"><!> <div class="flex-1 truncate"><div class="flex flex-1 gap-2 items-center"><!> <!></div></div> <!> <div class=" shrink-0"><!></div></button>'),kd=v('<div><button class="flex w-full justify-between gap-2 items-center px-3 py-1.5 text-sm cursor-pointer rounded-xl hover:bg-gray-50 dark:hover:bg-gray-800/50"><!> <div class="flex items-center w-full justify-between"><div> <span class="ml-0.5 text-gray-500"> </span></div></div></button> <!></div>'),Cd=v('<div slot="content"><!></div>');function Id(Y,n){Xt(n,!1);const r=()=>ze(Ka,"$user",w),i=()=>ze(Za,"$_tools",w),u=()=>ze(Kr,"$toolServers",w),S=()=>ze(pe,"$i18n",w),[w,y]=na(),pe=la("i18n");let h=E(n,"selectedToolIds",28,()=>[]),T=E(n,"selectedModels",24,()=>[]),M=E(n,"fileUploadCapableModels",24,()=>[]),O=E(n,"toggleFilters",24,()=>[]),C=E(n,"selectedFilterIds",28,()=>[]),X=E(n,"showWebSearchButton",8,!1),ge=E(n,"webSearchEnabled",12,!1),ae=E(n,"showImageGenerationButton",8,!1),Re=E(n,"imageGenerationEnabled",12,!1),Pe=E(n,"showCodeInterpreterButton",8,!1),ve=E(n,"codeInterpreterEnabled",12,!1),D=E(n,"onShowValves",8),Ae=E(n,"onClose",8);E(n,"closeOnOutsideClick",8,!0);let _=q(!1),we=q(""),ee=q(null),re=q(!0);const Ye=async()=>{var J;if(i()===null&&await Za.set(await Xr(localStorage.token)),i()&&s(ee,i().reduce((L,k,g,f)=>(L[k.id]={name:k.name,description:k.meta.description,enabled:h().includes(k.id),...k},L),{})),u())for(const L in u()){const k=u()[L];k.info&&Pt(ee,e(ee)[`direct_server:${L}`]={name:((J=k==null?void 0:k.info)==null?void 0:J.title)??k.url,description:k.info.description??"",enabled:h().includes(`direct_server:${L}`)})}h(h().filter(L=>Object.keys(e(ee)).includes(L)))};Tt(()=>e(_),()=>{e(_)&&Ye()}),Tt(()=>(B(M()),B(T()),r()),()=>{var J,L,k,g;s(re,M().length===T().length&&(((J=r())==null?void 0:J.role)==="admin"||((g=(k=(L=r())==null?void 0:L.permissions)==null?void 0:k.chat)==null?void 0:g.file_upload)))}),Da(),ta(),as(Y,{get show(){return e(_)},set show(J){s(_,J)},$$events:{change:J=>{J.detail===!1&&Ae()()}},children:(J,L)=>{{let k=$e(()=>(S(),o(()=>S().t("Integrations"))));mt(J,{get content(){return e(k)},placement:"top",children:(g,f)=>{var $=ct(),I=ke($);es(I,n,"default",{},null),l(g,$)},$$slots:{default:!0}})}},$$slots:{default:!0,content:(J,L)=>{var k=Cd(),g=a(k);ts(g,{class:"w-full max-w-70 rounded-2xl px-1 py-1  border border-gray-100  dark:border-gray-800 z-50 bg-white dark:bg-gray-850 dark:text-white shadow-lg max-h-72 overflow-y-auto overflow-x-hidden scrollbar-thin",sideOffset:4,alignOffset:-6,side:"bottom",align:"start",get transition(){return br},children:(f,$)=>{var I=ct(),ye=ke(I);{var Ce=Me=>{var xe=hd(),Ge=a(xe);{var We=Te=>{var Je=ct(),V=ke(Je);{var _e=d=>{var A=id(),G=a(A);ys(G,{});var j=m(G,2),z=a(j),R=a(z),K=m(R),oe=a(K,!0);t(K),t(z);var ue=m(z,2),Ee=a(ue);wr(Ee,{}),t(ue),t(j),t(A),Z((Oe,qe)=>{Le(R,`${Oe??""} `),Le(oe,qe)},[()=>(S(),o(()=>S().t("Tools"))),()=>(e(ee),o(()=>Object.keys(e(ee)).length))]),Qe("click",A,()=>{s(we,"tools")}),l(d,A)};N(V,d=>{e(ee),o(()=>Object.keys(e(ee)).length>0)&&d(_e)})}l(Te,Je)},me=Te=>{var Je=dd(),V=a(Je);Sa(V,{}),t(Je),l(Te,Je)};N(Ge,Te=>{e(ee)?Te(We):Te(me,!1)})}var x=m(Ge,2);{var Ie=Te=>{var Je=ct(),V=ke(Je);ua(V,3,()=>(B(O()),o(()=>O().sort((_e,d)=>_e.name.localeCompare(d.name,void 0,{sensitivity:"base"})))),_e=>_e.id,(_e,d)=>{{let A=$e(()=>(e(d),o(()=>{var G;return(G=e(d))==null?void 0:G.description})));mt(_e,{get content(){return e(A)},placement:"top-start",children:(G,j)=>{var z=fd(),R=a(z),K=a(R),oe=a(K),ue=a(oe);{var Ee=Ue=>{var Xe=cd(),lt=a(Xe);t(Xe),Z(vt=>{$t(lt,"src",(e(d),o(()=>e(d).icon))),gt(lt,1,`size-3.5 ${vt??""}`),$t(lt,"alt",(e(d),o(()=>e(d).name)))},[()=>(e(d),o(()=>e(d).icon.includes("svg")?"dark:invert-[80%]":""))]),l(Ue,Xe)},Oe=Ue=>{ao(Ue,{className:"size-4",strokeWidth:"1.75"})};N(ue,Ue=>{e(d),o(()=>{var Xe;return(Xe=e(d))==null?void 0:Xe.icon})?Ue(Ee):Ue(Oe,!1)})}t(oe);var qe=m(oe,2),W=a(qe,!0);t(qe),t(K),t(R);var se=m(R,2);{var ne=Ue=>{var Xe=vd(),lt=a(Xe);{let vt=$e(()=>(S(),o(()=>S().t("Valves"))));mt(lt,{get content(){return e(vt)},children:(bt,Ft)=>{var Wt=ud(),sa=a(Wt);Zr(sa,{}),t(Wt),Qe("click",Wt,Ht=>{Ht.stopPropagation(),Ht.preventDefault(),D()({type:"function",id:e(d).id})}),l(bt,Wt)},$$slots:{default:!0}})}t(Xe),l(Ue,Xe)};N(se,Ue=>{e(d),o(()=>{var Xe;return(Xe=e(d))==null?void 0:Xe.has_user_valves})&&Ue(ne)})}var Fe=m(se,2),Ze=a(Fe);{let Ue=$e(()=>(B(C()),e(d),o(()=>C().includes(e(d).id))));kr(Ze,{get state(){return e(Ue)},$$events:{change:async Xe=>{Xe.detail,await ot()}}})}t(Fe),t(z),Z(()=>Le(W,(e(d),o(()=>{var Ue;return(Ue=e(d))==null?void 0:Ue.name})))),Qe("click",z,()=>{C().includes(e(d).id)?C(C().filter(Ue=>Ue!==e(d).id)):C([...C(),e(d).id])}),l(G,z)},$$slots:{default:!0}})}}),l(Te,Je)};N(x,Te=>{B(O()),o(()=>O()&&O().length>0)&&Te(Ie)})}var He=m(x,2);{var Se=Te=>{{let Je=$e(()=>(S(),o(()=>S().t("Search the internet"))));mt(Te,{get content(){return e(Je)},placement:"top-start",children:(V,_e)=>{var d=gd(),A=a(d),G=a(A),j=a(G),z=a(j);$s(z,{}),t(j);var R=m(j,2),K=a(R,!0);t(R),t(G),t(A);var oe=m(A,2),ue=a(oe);kr(ue,{get state(){return ge()},$$events:{change:async Ee=>{Ee.detail,await ot()}}}),t(oe),t(d),Z(Ee=>Le(K,Ee),[()=>(S(),o(()=>S().t("Web Search")))]),Qe("click",d,()=>{ge(!ge())}),l(V,d)},$$slots:{default:!0}})}};N(He,Te=>{X()&&Te(Se)})}var he=m(He,2);{var U=Te=>{{let Je=$e(()=>(S(),o(()=>S().t("Generate an image"))));mt(Te,{get content(){return e(Je)},placement:"top-start",children:(V,_e)=>{var d=md(),A=a(d),G=a(A),j=a(G),z=a(j);co(z,{className:"size-4",strokeWidth:"1.5"}),t(j);var R=m(j,2),K=a(R,!0);t(R),t(G),t(A);var oe=m(A,2),ue=a(oe);kr(ue,{get state(){return Re()},$$events:{change:async Ee=>{Ee.detail,await ot()}}}),t(oe),t(d),Z(Ee=>Le(K,Ee),[()=>(S(),o(()=>S().t("Image")))]),Qe("click",d,()=>{Re(!Re())}),l(V,d)},$$slots:{default:!0}})}};N(he,Te=>{ae()&&Te(U)})}var H=m(he,2);{var De=Te=>{{let Je=$e(()=>(S(),o(()=>S().t("Execute code for analysis"))));mt(Te,{get content(){return e(Je)},placement:"top-start",children:(V,_e)=>{var d=pd(),A=a(d),G=a(A),j=a(G),z=a(j);uo(z,{className:"size-3.5",strokeWidth:"1.75"}),t(j);var R=m(j,2),K=a(R,!0);t(R),t(G),t(A);var oe=m(A,2),ue=a(oe);kr(ue,{get state(){return ve()},$$events:{change:async Ee=>{Ee.detail,await ot()}}}),t(oe),t(d),Z((Ee,Oe)=>{$t(d,"aria-pressed",ve()),$t(d,"aria-label",Ee),Le(K,Oe)},[()=>(B(ve()),S(),o(()=>ve()?S().t("Disable Code Interpreter"):S().t("Enable Code Interpreter"))),()=>(S(),o(()=>S().t("Code Interpreter")))]),Qe("click",d,()=>{ve(!ve())}),l(V,d)},$$slots:{default:!0}})}};N(H,Te=>{Pe()&&Te(De)})}t(xe),za(1,xe,()=>sr,()=>({x:-20,duration:150})),l(Me,xe)},de=Me=>{var xe=ct(),Ge=ke(xe);{var We=me=>{var x=kd(),Ie=a(x),He=a(Ie);Cr(He,{});var Se=m(He,2),he=a(Se),U=a(he),H=m(U),De=a(H,!0);t(H),t(he),t(Se),t(Ie);var Te=m(Ie,2);ua(Te,1,()=>(e(ee),o(()=>Object.keys(e(ee)))),Ca,(Je,V)=>{var _e=$d(),d=a(_e);{var A=Oe=>{var qe=_d();l(Oe,qe)};N(d,Oe=>{e(ee),e(V),o(()=>{var qe;return!(((qe=e(ee)[e(V)])==null?void 0:qe.authenticated)??!0)})&&Oe(A)})}var G=m(d,2),j=a(G),z=a(j);{let Oe=$e(()=>(e(ee),e(V),o(()=>{var qe;return((qe=e(ee)[e(V)])==null?void 0:qe.name)??""})));mt(z,{get content(){return e(Oe)},placement:"top",children:(qe,W)=>{var se=wd(),ne=a(se);ys(ne,{}),t(se),l(qe,se)},$$slots:{default:!0}})}var R=m(z,2);{let Oe=$e(()=>(e(ee),e(V),o(()=>{var qe;return((qe=e(ee)[e(V)])==null?void 0:qe.description)??""})));mt(R,{get content(){return e(Oe)},placement:"top-start",children:(qe,W)=>{var se=yd(),ne=a(se,!0);t(se),Z(()=>Le(ne,(e(ee),e(V),o(()=>e(ee)[e(V)].name)))),l(qe,se)},$$slots:{default:!0}})}t(j),t(G);var K=m(G,2);{var oe=Oe=>{var qe=xd(),W=a(qe);{let se=$e(()=>(S(),o(()=>S().t("Valves"))));mt(W,{get content(){return e(se)},children:(ne,Fe)=>{var Ze=bd(),Ue=a(Ze);Zr(Ue,{}),t(Ze),Qe("click",Ze,Xe=>{Xe.stopPropagation(),Xe.preventDefault(),D()({type:"tool",id:e(V)})}),l(ne,Ze)},$$slots:{default:!0}})}t(qe),l(Oe,qe)};N(K,Oe=>{e(ee),e(V),o(()=>{var qe;return(qe=e(ee)[e(V)])==null?void 0:qe.has_user_valves})&&Oe(oe)})}var ue=m(K,2),Ee=a(ue);kr(Ee,{get state(){return e(ee),e(V),o(()=>e(ee)[e(V)].enabled)}}),t(ue),t(_e),Qe("click",_e,async Oe=>{var qe;if(((qe=e(ee)[e(V)])==null?void 0:qe.authenticated)??!0){Pt(ee,e(ee)[e(V)].enabled=!e(ee)[e(V)].enabled);const W=e(ee)[e(V)].enabled;await ot(),h(W?[...h(),e(V)]:h().filter(se=>se!==e(V)))}else{Oe.preventDefault();let W=e(V).split(":"),se=(W==null?void 0:W.at(-1))??e(V);const ne=ll(se,"mcp");window.open(ne,"_self","noopener")}}),l(Je,_e)}),t(x),Z((Je,V)=>{Le(U,`${Je??""} `),Le(De,V)},[()=>(S(),o(()=>S().t("Tools"))),()=>(e(ee),o(()=>Object.keys(e(ee)).length))]),Qe("click",Ie,()=>{s(we,"")}),za(1,x,()=>sr,()=>({x:20,duration:150})),l(me,x)};N(Ge,me=>{e(we)==="tools"&&e(ee)&&me(We)},!0)}l(Me,xe)};N(ye,Me=>{e(we)===""?Me(Ce):Me(de,!1)})}l(f,I)},$$slots:{default:!0}}),t(k),l(J,k)}},$$legacy:!0}),ea(),y()}var Sd=ga('<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path d="M5.21173 15.1113L2.52473 12.4243C2.29041 12.1899 2.29041 11.8101 2.52473 11.5757L5.21173 8.88873C5.44605 8.65442 5.82595 8.65442 6.06026 8.88873L8.74727 11.5757C8.98158 11.8101 8.98158 12.1899 8.74727 12.4243L6.06026 15.1113C5.82595 15.3456 5.44605 15.3456 5.21173 15.1113Z"></path><path d="M11.5757 21.475L8.88874 18.788C8.65443 18.5537 8.65443 18.1738 8.88874 17.9395L11.5757 15.2525C11.8101 15.0182 12.19 15.0182 12.4243 15.2525L15.1113 17.9395C15.3456 18.1738 15.3456 18.5537 15.1113 18.788L12.4243 21.475C12.19 21.7094 11.8101 21.7094 11.5757 21.475Z"></path><path d="M11.5757 8.7475L8.88874 6.06049C8.65443 5.82618 8.65443 5.44628 8.88874 5.21197L11.5757 2.52496C11.8101 2.29065 12.19 2.29065 12.4243 2.52496L15.1113 5.21197C15.3456 5.44628 15.3456 5.82618 15.1113 6.06049L12.4243 8.7475C12.19 8.98181 11.8101 8.98181 11.5757 8.7475Z"></path><path d="M17.9396 15.1113L15.2526 12.4243C15.0183 12.1899 15.0183 11.8101 15.2526 11.5757L17.9396 8.88873C18.174 8.65442 18.5539 8.65442 18.7882 8.88873L21.4752 11.5757C21.7095 11.8101 21.7095 12.1899 21.4752 12.4243L18.7882 15.1113C18.5539 15.3456 18.174 15.3456 17.9396 15.1113Z"></path></svg>');function Ed(Y,n){let r=E(n,"className",8,"size-4"),i=E(n,"strokeWidth",8,"1.5");var u=Sd();Z(()=>{$t(u,"stroke-width",i()),gt(u,0,wa(r()))}),l(Y,u)}var Md=ga('<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path d="M6 12H12M18 12H12M12 12V6M12 12V18" stroke-linecap="round" stroke-linejoin="round"></path></svg>');function Pd(Y,n){let r=E(n,"className",8,"size-4"),i=E(n,"strokeWidth",8,"1.5");var u=Md();Z(()=>{$t(u,"stroke-width",i()),gt(u,0,wa(r()))}),l(Y,u)}var Td=v('<div class="flex h-full min-h-screen flex-col"><div class=" sticky top-0 z-30 flex justify-between bg-white px-4.5 pt-3 pb-3 dark:bg-gray-900 dark:text-gray-100"><div class=" font-primary self-center text-lg"> </div> <button class="self-center" aria-label="Close"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="h-5 w-5"><path d="M6.28 5.22a.75.75 0 00-1.06 1.06L8.94 10l-3.72 3.72a.75.75 0 101.06 1.06L10 11.06l3.72 3.72a.75.75 0 101.06-1.06L11.06 10l3.72-3.72a.75.75 0 00-1.06-1.06L10 8.94 6.28 5.22z"></path></svg></button></div> <div class="flex w-full px-4 dark:text-gray-200 min-h-full flex-1"><div class="flex-1 w-full min-h-full"><!></div></div></div>');function zd(Y,n){Xt(n,!1);const r=()=>ze(w,"$i18n",u),i=()=>ze(Ra,"$settings",u),[u,S]=na(),w=la("i18n");let y=E(n,"id",8,"input-modal"),pe=E(n,"show",12,!1),h=E(n,"value",12,null),T=E(n,"inputContent",12,null),M=E(n,"autocomplete",8,!1),O=E(n,"generateAutoCompletion",8,null),C=E(n,"onChange",8,()=>{}),X=E(n,"onClose",8,()=>{}),ge=q();ta(),ro(Y,{get show(){return pe()},set show(ae){pe(ae)},children:(ae,Re)=>{var Pe=Td(),ve=a(Pe),D=a(ve),Ae=a(D,!0);t(D);var _=m(D,2);_.__click=()=>{pe(!1),X()()},t(ve);var we=m(ve,2),ee=a(we),re=a(ee);{let Ye=$e(()=>(B(T()),o(()=>{var f;return(f=T())==null?void 0:f.json}))),J=$e(()=>(B(T()),o(()=>{var f;return(f=T())==null?void 0:f.html}))),L=$e(()=>(i(),o(()=>{var f;return((f=i())==null?void 0:f.richTextInput)??!0}))),k=$e(()=>(i(),o(()=>{var f;return((f=i())==null?void 0:f.showFormattingToolbar)??!1}))),g=$e(()=>(i(),o(()=>{var f;return((f=i())==null?void 0:f.insertPromptAsRichText)??!1})));Ja(to(re,{get id(){return y()},onChange:f=>{h(f.md),T(f),C()(f)},json:!0,get value(){return e(Ye)},get html(){return e(J)},get richText(){return e(L)},messageInput:!0,get showFormattingToolbar(){return e(k)},floatingMenuPlacement:"top-start",get insertPromptAsRichText(){return e(g)},get autocomplete(){return M()},get generateAutoCompletion(){return O()},$$legacy:!0}),f=>s(ge,f),()=>e(ge))}t(ee),t(we),t(Pe),Z(Ye=>Le(Ae,Ye),[()=>(r(),o(()=>r().t("Input")))]),l(ae,Pe)},$$slots:{default:!0},$$legacy:!0}),ea(),S()}Mo(["click"]);var Nd=ga('<svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M9 9L4 4M4 4V8M4 4H8" stroke-linecap="round" stroke-linejoin="round"></path><path d="M15 9L20 4M20 4V8M20 4H16" stroke-linecap="round" stroke-linejoin="round"></path><path d="M9 15L4 20M4 20V16M4 20H8" stroke-linecap="round" stroke-linejoin="round"></path><path d="M15 15L20 20M20 20V16M20 20H16" stroke-linecap="round" stroke-linejoin="round"></path></svg>');function Ad(Y,n){let r=E(n,"className",8,"w-4 h-4"),i=E(n,"strokeWidth",8,"1.5");var u=Nd();Z(()=>{gt(u,0,wa(r())),$t(u,"stroke-width",i())}),l(Y,u)}var Ld=v('<div class=" absolute -top-12 left-0 right-0 flex justify-center z-30 pointer-events-none"><button class=" bg-white border border-gray-100 dark:border-none dark:bg-white/20 p-1.5 rounded-full pointer-events-auto"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5"><path fill-rule="evenodd" d="M10 3a.75.75 0 01.75.75v10.638l3.96-4.158a.75.75 0 111.08 1.04l-5.25 5.5a.75.75 0 01-1.08 0l-5.25-5.5a.75.75 0 111.08-1.04l3.96 4.158V3.75A.75.75 0 0110 3z" clip-rule="evenodd"></path></svg></button></div>'),Fd=v('<div class="px-3 pt-3 text-left w-full flex flex-col z-10"><div class="flex items-center justify-between w-full"><div class="pl-[1px] flex items-center gap-2 text-sm dark:text-gray-500"><img alt="model profile" class="size-3.5 max-w-[28px] object-cover rounded-full"/> <div class="translate-y-[0.5px]"><span> </span></div></div> <div><button class="flex items-center dark:text-gray-500"><!></button></div></div></div>'),Dd=ga('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" class="size-4 fill-yellow-300"><path fill-rule="evenodd" d="M9.401 3.003c1.155-2 4.043-2 5.197 0l7.355 12.748c1.154 2-.29 4.5-2.599 4.5H4.645c-2.309 0-3.752-2.5-2.598-4.5L9.4 3.003ZM12 8.25a.75.75 0 0 1 .75.75v3.75a.75.75 0 0 1-1.5 0V9a.75.75 0 0 1 .75-.75Zm0 8.25a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5Z" clip-rule="evenodd"></path></svg>'),Bd=v('<div class=" relative group"><div class="relative flex items-center"><!> <!></div> <div class=" absolute -top-1 -right-1"><button type="button"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true" class="size-4"><path d="M6.28 5.22a.75.75 0 00-1.06 1.06L8.94 10l-3.72 3.72a.75.75 0 101.06 1.06L10 11.06l3.72 3.72a.75.75 0 101.06-1.06L11.06 10l3.72-3.72a.75.75 0 00-1.06-1.06L10 8.94 6.28 5.22z"></path></svg></button></div></div>'),Od=v('<div class="mx-2 mt-2.5 pb-1.5 flex items-center flex-wrap gap-2"></div>'),jd=v('<div class="fixed top-0 right-0 z-20"><div class="mt-2.5 mr-3"><button type="button" class="p-1 rounded-lg hover:bg-gray-100/50 dark:hover:bg-gray-800/50" aria-label="Expand input"><!></button></div></div>'),Ud=v('<div id="input-menu-button" class="bg-transparent hover:bg-gray-100 text-gray-700 dark:text-white dark:hover:bg-gray-800 rounded-full size-8 flex justify-center items-center outline-hidden focus:outline-hidden"><!></div>'),Rd=v('<div id="integration-menu-button" class="bg-transparent hover:bg-gray-100 text-gray-700 dark:text-white dark:hover:bg-gray-800 rounded-full size-8 flex justify-center items-center outline-hidden focus:outline-hidden"><!></div>'),Wd=v('<div class="flex self-center w-[1px] h-4 mx-1 bg-gray-200/50 dark:bg-gray-800/50"></div> <!>',1),Hd=v('<button type="button" id="model-valves-button" class="bg-transparent hover:bg-gray-100 text-gray-700 dark:text-white dark:hover:bg-gray-800 rounded-full size-8 flex justify-center items-center outline-hidden focus:outline-hidden"><!></button>'),Vd=v('<div class="ml-1 flex gap-1.5"><!></div>'),Gd=v('<button class="translate-y-[0.5px] px-1 flex gap-1 items-center text-gray-600 dark:text-gray-300 hover:text-gray-700 dark:hover:text-gray-200 rounded-lg self-center transition" aria-label="Available Tools" type="button"><!> <span class="text-sm"> </span></button>'),Jd=v('<div class="size-4 items-center flex justify-center"><img style="fill: currentColor;"/></div>'),qd=v('<button type="button"><!> <div class="hidden group-hover:block"><!></div></button>'),Zd=v('<button type="button"><!> <div class="hidden group-hover:block"><!></div></button>'),Yd=v('<button type="button"><!> <div class="hidden group-hover:block"><!></div></button>'),Kd=v('<button type="button"><!> <div class="hidden group-hover:block"><!></div></button>'),Qd=v('<button class="bg-white hover:bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-white dark:hover:bg-gray-800 transition rounded-full p-1.5"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="size-5"><path fill-rule="evenodd" d="M2.25 12c0-5.385 4.365-9.75 9.75-9.75s9.75 4.365 9.75 9.75-4.365 9.75-9.75 9.75S2.25 17.385 2.25 12zm6-2.438c0-.724.588-1.312 1.313-1.312h4.874c.725 0 1.313.588 1.313 1.313v4.874c0 .725-.588 1.313-1.313 1.313H9.564a1.312 1.312 0 01-1.313-1.313V9.564z" clip-rule="evenodd"></path></svg></button>'),Xd=v('<div class=" flex items-center"><!></div>'),ec=v('<button id="send-message-button" class=" text-gray-600 dark:text-gray-300 hover:text-gray-700 dark:hover:text-gray-200 transition rounded-full p-1.5 self-center" type="button"><!></button>'),tc=v('<button id="voice-input-button" class=" text-gray-600 dark:text-gray-300 hover:text-gray-700 dark:hover:text-gray-200 transition rounded-full p-1.5 self-center mr-0.5" type="button" aria-label="Voice Input"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="size-5 translate-y-[0.5px]"><path d="M7 4a3 3 0 016 0v6a3 3 0 11-6 0V4z"></path><path d="M5.5 9.643a.75.75 0 00-1.5 0V10c0 3.06 2.29 5.585 5.25 5.954V17.5h-1.5a.75.75 0 000 1.5h4.5a.75.75 0 000-1.5h-1.5v-1.546A6.001 6.001 0 0016 10v-.357a.75.75 0 00-1.5 0V10a4.5 4.5 0 01-9 0v-.357z"></path></svg></button>'),ac=v('<button class=" bg-black text-white hover:bg-gray-900 dark:bg-white dark:text-black dark:hover:bg-gray-100 transition rounded-full p-1.5 self-center" type="button"><!></button>'),rc=v('<div class=" flex items-center"><!></div>'),sc=v('<button id="send-message-button" type="submit"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" fill="currentColor" class="size-5"><path fill-rule="evenodd" d="M8 14a.75.75 0 0 1-.75-.75V4.56L4.03 7.78a.75.75 0 0 1-1.06-1.06l4.5-4.5a.75.75 0 0 1 1.06 0l4.5 4.5a.75.75 0 0 1-1.06 1.06L8.75 4.56v8.69A.75.75 0 0 1 8 14Z" clip-rule="evenodd"></path></svg></button>'),oc=v('<div class=" flex items-center"><!></div>'),nc=v("<!> <!> <!>",1),lc=v('<div class=" text-xs text-gray-500 text-center line-clamp-1 marked"><!></div>'),ic=v('<div class="mb-1"></div>'),dc=v('<div class="w-full font-primary"><div class=" mx-auto inset-x-0 bg-transparent flex justify-center"><div><div class="relative"><!></div></div></div> <div class="bg-transparent"><div><div><input type="file" hidden="" multiple/> <div><!></div> <form><button id="generate-message-pair-button" class="hidden"></button> <div id="message-input-container"><!> <!> <div class="px-2.5"><div id="chat-input-container"><!> <!></div></div> <div class=" flex justify-between mt-0.5 mb-2.5 mx-0.5 max-w-full" dir="ltr"><div class="ml-1 self-end flex items-center flex-1 max-w-[80%]"><!> <!> <!> <div class="ml-1 flex gap-1.5"><!> <!> <!> <!> <!></div></div> <div class="self-end flex space-x-1 mr-1 shrink-0 gap-[0.5px]"><!></div></div></div> <!></form></div></div></div></div>'),cc=v("<!> <!> <!> <!> <!> <!>",1);function vo(Y,n){Xt(n,!1);const r=()=>ze(ge,"$i18n",O),i=()=>ze(Lr,"$models",O),u=()=>ze(Za,"$tools",O),S=()=>ze(Kr,"$toolServers",O),w=()=>ze(xr,"$config",O),y=()=>ze(Ka,"$_user",O),pe=()=>ze(Pa,"$temporaryChatEnabled",O),h=()=>ze(Ra,"$settings",O),T=()=>ze(Qr,"$mobile",O),M=()=>ze(vs,"$TTSWorker",O),[O,C]=na();tr.extend(Vn),tr.extend(Hn);const X=ar(),ge=la("i18n");let ae=E(n,"onUpload",8,p=>{}),Re=E(n,"onChange",8,()=>{}),Pe=E(n,"createMessagePair",8),ve=E(n,"stopResponse",8),D=E(n,"autoScroll",12,!1),Ae=E(n,"generating",8,!1),_=E(n,"atSelectedModel",12,void 0),we=E(n,"selectedModels",8),ee=q([]),re=E(n,"history",8),Ye=E(n,"taskIds",8,null),J=E(n,"prompt",12,""),L=E(n,"files",28,()=>[]),k=E(n,"selectedToolIds",28,()=>[]),g=E(n,"selectedFilterIds",28,()=>[]),f=E(n,"imageGenerationEnabled",12,!1),$=E(n,"webSearchEnabled",12,!1),I=E(n,"codeInterpreterEnabled",12,!1),ye=q(null),Ce=q(!1),de=q(p=>{}),Me=q({}),xe={},Ge=q(!1),We=q("tool"),me=q(null),x=q(!0);const Ie=async p=>(s(Me,sn(p)),Object.keys(e(Me)).length===0?p:(s(Ce,!0),await new Promise(be=>{s(de,fe=>{xe={...xe,...fe},Se(xe),s(Ce,!1),be(p)})}))),He=async p=>{if(p.includes("{{CLIPBOARD}}")){const fe=await navigator.clipboard.readText().catch(Ke=>(at.error(r().t("Failed to read clipboard contents")),"{{CLIPBOARD}}")),et=await navigator.clipboard.read().catch(Ke=>[]);for(const Ke of et)for(const kt of Ke.types)if(kt.startsWith("image/")){const Zt=await Ke.getType(kt),Gt=new File([Zt],`clipboard-image.${kt.split("/")[1]}`,{type:kt});ma([Gt])}p=p.replaceAll("{{CLIPBOARD}}",fe.replaceAll(`\r
`,`
`))}if(p.includes("{{USER_LOCATION}}")){let fe;try{fe=await Ko()}catch{at.error(r().t("Location access not allowed")),fe="LOCATION_UNKNOWN"}p=p.replaceAll("{{USER_LOCATION}}",String(fe))}const be=await qn(localStorage.token);if(p.includes("{{USER_NAME}}")){const fe=(be==null?void 0:be.name)||"User";p=p.replaceAll("{{USER_NAME}}",fe)}if(p.includes("{{USER_BIO}}")){const fe=(be==null?void 0:be.bio)||"";fe&&(p=p.replaceAll("{{USER_BIO}}",fe))}if(p.includes("{{USER_GENDER}}")){const fe=(be==null?void 0:be.gender)||"";fe&&(p=p.replaceAll("{{USER_GENDER}}",fe))}if(p.includes("{{USER_BIRTH_DATE}}")){const fe=(be==null?void 0:be.date_of_birth)||"";fe&&(p=p.replaceAll("{{USER_BIRTH_DATE}}",fe))}if(p.includes("{{USER_AGE}}")){const fe=(be==null?void 0:be.date_of_birth)||"";if(fe){const et=Qo(fe);p=p.replaceAll("{{USER_AGE}}",et)}}if(p.includes("{{USER_LANGUAGE}}")){const fe=localStorage.getItem("locale")||"en-US";p=p.replaceAll("{{USER_LANGUAGE}}",fe)}if(p.includes("{{CURRENT_DATE}}")){const fe=Xo();p=p.replaceAll("{{CURRENT_DATE}}",fe)}if(p.includes("{{CURRENT_TIME}}")){const fe=en();p=p.replaceAll("{{CURRENT_TIME}}",fe)}if(p.includes("{{CURRENT_DATETIME}}")){const fe=tn();p=p.replaceAll("{{CURRENT_DATETIME}}",fe)}if(p.includes("{{CURRENT_TIMEZONE}}")){const fe=an();p=p.replaceAll("{{CURRENT_TIMEZONE}}",fe)}if(p.includes("{{CURRENT_WEEKDAY}}")){const fe=rn();p=p.replaceAll("{{CURRENT_WEEKDAY}}",fe)}return p},Se=p=>{document.getElementById("chat-input")&&(e(K).replaceVariables(p),e(K).focus())},he=async(p,be)=>{var et,Ke;document.getElementById("chat-input")&&(p!==""&&(p=await He(p||"")),(et=e(K))==null||et.setText(p),(Ke=e(K))==null||Ke.focus(),p!==""&&(p=await Ie(p)),await ot(),be&&await be(p))},U=()=>{var fe;const p=document.getElementById("chat-input");let be="";return p&&(be=(fe=e(K))==null?void 0:fe.getWordAtDocPos()),be},H=p=>{var fe;document.getElementById("chat-input")&&((fe=e(K))==null||fe.replaceCommandWithText(p))},De=async p=>{var et;const be=document.getElementById("chat-input");if(!be)return;p=await He(p),e(Te)?H(p):(et=e(K))==null||et.insertContent(p),await ot(),p=await Ie(p),await ot();const fe=document.getElementById("chat-input-container");if(fe&&(fe.scrollTop=fe.scrollHeight),await ot(),be){be.focus(),be.dispatchEvent(new Event("input"));const Ke=Yo(J());Ke.length>0?(Ke.at(0),await ot()):be.scrollTop=be.scrollHeight}};let Te=q(""),Je=E(n,"showCommands",12,!1),V=q(null),_e=q(!1),d=q(!1),A=q(!1),G=q(!1),j=q(-2e8);const z=/^((?!chrome|android).)*safari/i.test(navigator.userAgent);function R(p){return e(G)?!0:z&&Math.abs(p.timeStamp-e(j))<500?(s(j,-2e8),!0):!1}let K=q(),oe=q(),ue=q(),Ee=q(!1),Oe=q(!1),qe=q(!1),W=E(n,"placeholder",8,""),se=q([]),ne=q([]),Fe=q([]),Ze=q([]),Ue=q([]),Xe=q([]),lt=q(!1),vt=q(!1),bt=q(!1),Ft=q(!1);const Wt=()=>{const p=document.getElementById("messages-container");p.scrollTo({top:p.scrollHeight,behavior:"smooth"})},sa=async()=>{try{const p=await navigator.mediaDevices.getDisplayMedia({video:{cursor:"never"},audio:!1}),be=document.createElement("video");be.srcObject=p,await be.play();const fe=document.createElement("canvas");fe.width=be.videoWidth,fe.height=be.videoHeight,fe.getContext("2d").drawImage(be,0,0,fe.width,fe.height),p.getTracks().forEach(Gt=>Gt.stop()),window.focus();const Ke=fe.toDataURL("image/png"),kt=await(await fetch(Ke)).blob(),Zt=new File([kt],`screen-capture-${Date.now()}.png`,{type:"image/png"});ma([Zt]),be.srcObject=null}catch(p){}},Ht=async(p,be=!0,fe={})=>{var kt,Zt,Gt,Ea,Wa,Na,Aa,c,b,te,le,F,ce;if(((kt=y())==null?void 0:kt.role)!=="admin"&&!(((Ea=(Gt=(Zt=y())==null?void 0:Zt.permissions)==null?void 0:Gt.chat)==null?void 0:Ea.file_upload)??!0))return at.error(r().t("You do not have permission to upload files.")),null;if(e(ne).length!==we().length)return at.error(r().t("Model(s) do not support file upload")),null;const et=ja(),Ke={type:"file",file:"",id:null,url:"",name:p.name,collection_name:"",status:"uploading",size:p.size,error:"",itemId:et,...fe};if(Ke.size==0)return at.error(r().t("You cannot upload an empty file.")),null;if(L([...L(),Ke]),pe()){const P=await nn(p).catch(ie=>(at.error(r().t("Failed to extract content from the file: {{error}}",{error:ie})),null));if(P===null)return at.error(r().t("Failed to extract content from the file.")),L(L().filter(ie=>(ie==null?void 0:ie.itemId)!==et)),null;p.name,p.size,Ke.status="uploaded",Ke.type="text",Ke.content=P,Ke.id=ja(),L(L())}else try{let P=null;(p.type.startsWith("audio/")||p.type.startsWith("video/"))&&((Aa=(Na=(Wa=h())==null?void 0:Wa.audio)==null?void 0:Na.stt)!=null&&Aa.language)&&(P={language:(te=(b=(c=h())==null?void 0:c.audio)==null?void 0:b.stt)==null?void 0:te.language});const ie=await qs(localStorage.token,p,P,be);ie?(ie.id,Ke.name,(le=ie==null?void 0:ie.meta)==null||le.collection_name,ie.error&&(console.warn("File upload warning:",ie.error),at.warning(ie.error)),Ke.status="uploaded",Ke.file=ie,Ke.id=ie.id,Ke.collection_name=((F=ie==null?void 0:ie.meta)==null?void 0:F.collection_name)||(ie==null?void 0:ie.collection_name),Ke.content_type=((ce=ie.meta)==null?void 0:ce.content_type)||ie.content_type,Ke.url=`${ie.id}`,L(L())):L(L().filter(Ne=>(Ne==null?void 0:Ne.itemId)!==et))}catch(P){at.error(`${P}`),L(L().filter(ie=>(ie==null?void 0:ie.itemId)!==et))}},ma=async p=>{var be,fe,et,Ke,kt,Zt;if((((fe=(be=w())==null?void 0:be.file)==null?void 0:fe.max_count)??null)!==null&&L().length+p.length>((Ke=(et=w())==null?void 0:et.file)==null?void 0:Ke.max_count)){at.error(r().t("You can only chat with a maximum of {{maxCount}} file(s) at a time.",{maxCount:(Zt=(kt=w())==null?void 0:kt.file)==null?void 0:Zt.max_count}));return}p.forEach(async Gt=>{var Ea,Wa,Na,Aa,c,b,te,le;if(Gt.name,Gt.type,Gt.size,Gt.name.split(".").at(-1),(((Wa=(Ea=w())==null?void 0:Ea.file)==null?void 0:Wa.max_size)??null)!==null&&Gt.size>(((Aa=(Na=w())==null?void 0:Na.file)==null?void 0:Aa.max_size)??0)*1024*1024){Gt.size,(((b=(c=w())==null?void 0:c.file)==null?void 0:b.max_size)??0)*1024*1024,at.error(r().t("File size should not exceed {{maxSize}} MB.",{maxSize:(le=(te=w())==null?void 0:te.file)==null?void 0:le.max_size}));return}if(Gt.type.startsWith("image/")){if(e(se).length===0){at.error(r().t("Selected model(s) do not support image inputs"));return}const F=async(P,ie={},Ne={})=>{var yt,xt,Dt,dt,zt,Et;const ft=(ie==null?void 0:ie.imageCompression)??!1,pt=((xt=(yt=Ne==null?void 0:Ne.file)==null?void 0:yt.image_compression)==null?void 0:xt.width)??null,nt=((dt=(Dt=Ne==null?void 0:Ne.file)==null?void 0:Dt.image_compression)==null?void 0:dt.height)??null;if(!ft&&!pt&&!nt)return P;let it=null,rt=null;return ft&&(it=((zt=ie==null?void 0:ie.imageCompressionSize)==null?void 0:zt.width)??null,rt=((Et=ie==null?void 0:ie.imageCompressionSize)==null?void 0:Et.height)??null),pt&&(it===null||it>pt)&&(it=pt),nt&&(rt===null||rt>nt)&&(rt=nt),it||rt?await ln(P,it,rt):P};let ce=new FileReader;ce.onload=async P=>{var Ne,ft;let ie=P.target.result;if((Ne=h())!=null&&Ne.imageCompression&&((ft=h())!=null&&ft.imageCompressionInChannels)&&(ie=await F(ie,h(),w())),pe())L([...L(),{type:"image",url:ie}]);else{const pt=await(await fetch(ie)).blob(),nt=new File([pt],Gt.name,{type:Gt.type});Ht(nt,!1)}},ce.readAsDataURL(Gt.type==="image/heic"?await on(Gt):Gt)}else Ht(Gt)})},qt=async()=>{var be,fe,et,Ke;if(((be=e(ye))==null?void 0:be.md.trim())===""&&((fe=e(ye))==null?void 0:fe.html.trim())===""){at.error(r().t("Cannot create an empty note."));return}const p=await Zn(tr().format("YYYY-MM-DD"),(et=e(ye))==null?void 0:et.md,(Ke=e(ye))==null?void 0:Ke.html);p&&(sessionStorage.removeItem("chat-input"),Sr(`/notes/${p.id}`))},cr=p=>{var be,fe;p.preventDefault(),(fe=(be=p.dataTransfer)==null?void 0:be.types)!=null&&fe.includes("Files")?s(Oe,!0):s(Oe,!1)},ur=()=>{s(Oe,!1)},vr=async p=>{var be,fe;if(p.preventDefault(),(be=p.dataTransfer)!=null&&be.files){const et=Array.from((fe=p.dataTransfer)==null?void 0:fe.files);et&&et.length>0&&ma(et)}s(Oe,!1)},Qa=p=>{p.key==="Shift"&&s(qe,!0),p.key==="Escape"&&s(Oe,!1)},fr=p=>{p.key==="Shift"&&s(qe,!1)},Ot=()=>{},It=()=>{s(qe,!1)};Ya(async()=>{s(V,[{char:"@",render:os(ns,{i18n:ge,onSelect:be=>{var Ke;const{type:fe,data:et}=be;fe==="model"&&_(et),(Ke=document.getElementById("chat-input"))==null||Ke.focus()},insertTextHandler:De,onUpload:be=>{const{type:fe,data:et}=be;if(fe==="file"){if(L().find(Ke=>Ke.id===et.id))return;L([...L(),{...et,status:"processed"}])}else ae()(be)}})},{char:"/",render:os(ns,{i18n:ge,onSelect:be=>{var Ke;const{type:fe,data:et}=be;fe==="model"&&_(et),(Ke=document.getElementById("chat-input"))==null||Ke.focus()},insertTextHandler:De,onUpload:be=>{const{type:fe,data:et}=be;if(fe==="file"){if(L().find(Ke=>Ke.id===et.id))return;L([...L(),{...et,status:"processed"}])}else ae()(be)}})},{char:"#",render:os(ns,{i18n:ge,onSelect:be=>{var Ke;const{type:fe,data:et}=be;fe==="model"&&_(et),(Ke=document.getElementById("chat-input"))==null||Ke.focus()},insertTextHandler:De,onUpload:be=>{const{type:fe,data:et}=be;if(fe==="file"){if(L().find(Ke=>Ke.id===et.id))return;L([...L(),{...et,status:"processed"}])}else ae()(be)}})}]),s(d,!0),window.setTimeout(()=>{const be=document.getElementById("chat-input");be==null||be.focus()},0),window.addEventListener("keydown",Qa),window.addEventListener("keyup",fr),window.addEventListener("focus",Ot),window.addEventListener("blur",It),await ot();const p=document.getElementById("chat-container");p==null||p.addEventListener("dragover",cr),p==null||p.addEventListener("drop",vr),p==null||p.addEventListener("dragleave",ur),await Za.set(await Xr(localStorage.token))}),Yr(()=>{window.removeEventListener("keydown",Qa),window.removeEventListener("keyup",fr),window.removeEventListener("focus",Ot),window.removeEventListener("blur",It);const p=document.getElementById("chat-container");p&&(p==null||p.removeEventListener("dragover",cr),p==null||p.removeEventListener("drop",vr),p==null||p.removeEventListener("dragleave",ur))}),Tt(()=>(B(_()),B(we())),()=>{s(ee,_()!==void 0?[_().id]:we())}),Tt(()=>e(Ge),()=>{e(Ge)||s(x,!0)}),Tt(()=>(B(Re()),B(J()),B(L()),B(k()),B(g()),B(f()),B($()),B(I())),()=>{Re()({prompt:J(),files:L().filter(p=>p.type!=="image").map(p=>({...p,user:void 0,access_control:void 0})),selectedToolIds:k(),selectedFilterIds:g(),imageGenerationEnabled:f(),webSearchEnabled:$(),codeInterpreterEnabled:I()})}),Tt(()=>e(Te),()=>{var p,be;Je(["/","#","@"].includes((p=e(Te))==null?void 0:p.charAt(0))||((be=e(Te))==null?void 0:be.slice(0,2))==="\\#")}),Tt(()=>(B(_()),B(we()),i()),()=>{var p;s(se,((p=_())!=null&&p.id?[_().id]:we()).filter(be=>{var fe,et,Ke,kt;return((kt=(Ke=(et=(fe=i().find(Zt=>Zt.id===be))==null?void 0:fe.info)==null?void 0:et.meta)==null?void 0:Ke.capabilities)==null?void 0:kt.vision)??!0}))}),Tt(()=>(B(_()),B(we()),i()),()=>{var p;s(ne,((p=_())!=null&&p.id?[_().id]:we()).filter(be=>{var fe,et,Ke,kt;return((kt=(Ke=(et=(fe=i().find(Zt=>Zt.id===be))==null?void 0:fe.info)==null?void 0:et.meta)==null?void 0:Ke.capabilities)==null?void 0:kt.file_upload)??!0}))}),Tt(()=>(B(_()),B(we()),i()),()=>{var p;s(Fe,((p=_())!=null&&p.id?[_().id]:we()).filter(be=>{var fe,et,Ke,kt;return((kt=(Ke=(et=(fe=i().find(Zt=>Zt.id===be))==null?void 0:fe.info)==null?void 0:et.meta)==null?void 0:Ke.capabilities)==null?void 0:kt.web_search)??!0}))}),Tt(()=>(B(_()),B(we()),i()),()=>{var p;s(Ze,((p=_())!=null&&p.id?[_().id]:we()).filter(be=>{var fe,et,Ke,kt;return((kt=(Ke=(et=(fe=i().find(Zt=>Zt.id===be))==null?void 0:fe.info)==null?void 0:et.meta)==null?void 0:Ke.capabilities)==null?void 0:kt.image_generation)??!0}))}),Tt(()=>(B(_()),B(we()),i()),()=>{var p;s(Ue,((p=_())!=null&&p.id?[_().id]:we()).filter(be=>{var fe,et,Ke,kt;return((kt=(Ke=(et=(fe=i().find(Zt=>Zt.id===be))==null?void 0:fe.info)==null?void 0:et.meta)==null?void 0:Ke.capabilities)==null?void 0:kt.code_interpreter)??!0}))}),Tt(()=>(B(_()),B(we()),i()),()=>{var p;s(Xe,((p=_())!=null&&p.id?[_().id]:we()).map(be=>{var fe;return((fe=i().find(et=>et.id===be)||{})==null?void 0:fe.filters)??[]}).reduce((be,fe)=>be.filter(et=>fe.some(Ke=>Ke.id===et.id))))}),Tt(()=>(u(),S()),()=>{s(lt,(u()??[]).length>0||(S()??[]).length>0)}),Tt(()=>(B(_()),B(we()),e(Fe),w(),y()),()=>{var p,be,fe,et,Ke,kt;s(vt,((p=_())!=null&&p.id?[_().id]:we()).length===e(Fe).length&&((fe=(be=w())==null?void 0:be.features)==null?void 0:fe.enable_web_search)&&(y().role==="admin"||((kt=(Ke=(et=y())==null?void 0:et.permissions)==null?void 0:Ke.features)==null?void 0:kt.web_search)))}),Tt(()=>(B(_()),B(we()),e(Ze),w(),y()),()=>{var p,be,fe,et,Ke,kt;s(bt,((p=_())!=null&&p.id?[_().id]:we()).length===e(Ze).length&&((fe=(be=w())==null?void 0:be.features)==null?void 0:fe.enable_image_generation)&&(y().role==="admin"||((kt=(Ke=(et=y())==null?void 0:et.permissions)==null?void 0:Ke.features)==null?void 0:kt.image_generation)))}),Tt(()=>(B(_()),B(we()),e(Ue),w(),y()),()=>{var p,be,fe,et,Ke,kt;s(Ft,((p=_())!=null&&p.id?[_().id]:we()).length===e(Ue).length&&((fe=(be=w())==null?void 0:be.features)==null?void 0:fe.enable_code_interpreter)&&(y().role==="admin"||((kt=(Ke=(et=y())==null?void 0:et.permissions)==null?void 0:Ke.features)==null?void 0:kt.code_interpreter)))}),Da();var ia={setText:he};ta();var ka=cc(),Ia=ke(ka);tl(Ia,{get show(){return e(Oe)}});var Vt=m(Ia,2);td(Vt,{get selectedToolIds(){return k()},get show(){return e(_e)},set show(p){s(_e,p)},$$legacy:!0});var Rt=m(Vt,2);Bo(Rt,{get variables(){return e(Me)},get onSave(){return e(de)},get show(){return e(Ce)},set show(p){s(Ce,p)},$$legacy:!0});var ya=m(Rt,2);{let p=$e(()=>e(me)??null);il(ya,{userValves:!0,get type(){return e(We)},get id(){return e(p)},get show(){return e(Ge)},set show(be){s(Ge,be)},$$events:{save:async()=>{await ot()},close:()=>{s(x,!0)}},$$legacy:!0})}var Xa=m(ya,2);zd(Xa,{onChange:p=>{var be;(be=e(K))==null||be.setContent((p==null?void 0:p.json)??null)},onClose:async()=>{var p;await ot(),(p=e(K))==null||p.focus()},get show(){return e(Ee)},set show(p){s(Ee,p)},get value(){return J()},set value(p){J(p)},get inputContent(){return e(ye)},set inputContent(p){s(ye,p)},$$legacy:!0});var rr=m(Xa,2);{var pa=p=>{var be=dc(),fe=a(be),et=a(fe),Ke=a(et),kt=a(Ke);{var Zt=Ve=>{var Be=Ld(),st=a(Be);t(Be),Qe("click",st,()=>{D(!0),Wt()}),l(Ve,Be)};N(kt,Ve=>{B(D()),B(re()),o(()=>{var Be;return D()===!1&&((Be=re())==null?void 0:Be.currentId)})&&Ve(Zt)})}t(Ke),t(et),t(fe);var Gt=m(fe,2),Ea=a(Gt),Wa=a(Ea),Na=a(Wa);Ja(Na,Ve=>s(oe,Ve),()=>e(oe));var Aa=m(Na,2),c=a(Aa);el(c,{onCancel:async()=>{var Ve;s(A,!1),await ot(),(Ve=document.getElementById("chat-input"))==null||Ve.focus()},onConfirm:async Ve=>{var Q,je;const{text:Be,filename:st}=Ve;s(A,!1),await ot(),await De(`${Be}`),await ot(),(Q=document.getElementById("chat-input"))==null||Q.focus(),(((je=h())==null?void 0:je.speechAutoSend)??!1)&&X("submit",J())},get recording(){return e(A)},set recording(Ve){s(A,Ve)},$$legacy:!0}),t(Aa);var b=m(Aa,2),te=a(b),le=m(te,2),F=a(le);{var ce=Ve=>{var Be=Fd(),st=a(Be),Q=a(st),je=a(Q),Mt=m(je,2),_t=a(Mt),Yt=a(_t,!0);t(_t),t(Mt),t(Q);var Kt=m(Q,2),Ct=a(Kt),St=a(Ct);Ga(St,{}),t(Ct),t(Kt),t(st),t(Be),Z(Bt=>{$t(je,"src",Bt),Le(Yt,(B(_()),o(()=>_().name)))},[()=>(B(Fa),i(),B(_()),r(),o(()=>`${Fa}/models/model/profile/image?id=${i().find(Bt=>Bt.id===_().id).id}&lang=${r().language}`))]),Qe("click",Ct,()=>{_(void 0)}),l(Ve,Be)};N(F,Ve=>{_()!==void 0&&Ve(ce)})}var P=m(F,2);{var ie=Ve=>{var Be=Od();ua(Be,5,L,Ca,(st,Q,je)=>{var Mt=ct(),_t=ke(Mt);{var Yt=Ct=>{const St=$e(()=>(e(Q),B(Fa),o(()=>{var aa;return e(Q).url.startsWith("data")||e(Q).url.startsWith("http")?e(Q).url:`${Fa}/files/${e(Q).url}${(aa=e(Q))!=null&&aa.content_type?"/content":""}`})));var Bt=Bd(),Qt=a(Bt),At=a(Qt);rl(At,{get src(){return e(St)},alt:"",imageClassName:" size-10 rounded-xl object-cover"});var ca=m(At,2);{var tt=aa=>{{let fa=$e(()=>(r(),B(_()),B(we()),e(se),o(()=>r().t("{{ models }}",{models:[..._()?[_()]:we()].filter(La=>!e(se).includes(La)).join(", ")}))));mt(aa,{className:" absolute top-1 left-1",get content(){return e(fa)},children:(La,$r)=>{var gr=Dd();l(La,gr)},$$slots:{default:!0}})}};N(ca,aa=>{B(_()),e(se),B(we()),o(()=>_()?e(se).length===0:we().length!==e(se).length)&&aa(tt)})}t(Qt);var Lt=m(Qt,2),Jt=a(Lt);t(Lt),t(Bt),Z(aa=>{gt(Jt,1,` bg-white text-black border border-white rounded-full ${h(),o(()=>{var fa;return((fa=h())==null?void 0:fa.highContrastMode)??!1?"":"outline-hidden focus:outline-hidden group-hover:visible invisible transition"})??""}`),$t(Jt,"aria-label",aa)},[()=>(r(),o(()=>r().t("Remove file")))]),Qe("click",Jt,()=>{L().splice(je,1),L(L())}),l(Ct,Bt)},Kt=Ct=>{{let St=$e(()=>(e(Q),o(()=>{var At;return(At=e(Q))==null?void 0:At.size}))),Bt=$e(()=>(e(Q),o(()=>e(Q).status==="uploading"))),Qt=$e(()=>(e(Q),o(()=>{var At;return["file","collection"].includes((At=e(Q))==null?void 0:At.type)})));eo(Ct,{get item(){return e(Q)},get name(){return e(Q),o(()=>e(Q).name)},get type(){return e(Q),o(()=>e(Q).type)},get size(){return e(St)},get loading(){return e(Bt)},dismissible:!0,edit:!0,small:!0,get modal(){return e(Qt)},$$events:{dismiss:async()=>{L().splice(je,1),L(L())},click:()=>{e(Q)}}})}};N(_t,Ct=>{e(Q),o(()=>{var St;return e(Q).type==="image"||(((St=e(Q))==null?void 0:St.content_type)??"").startsWith("image/")})?Ct(Yt):Ct(Kt,!1)})}l(st,Mt)}),t(Be),Z(()=>{$t(Be,"dir",(h(),o(()=>{var st;return((st=h())==null?void 0:st.chatDirection)??"auto"}))),Be.dir=Be.dir}),l(Ve,Be)};N(P,Ve=>{B(L()),o(()=>L().length>0)&&Ve(ie)})}var Ne=m(P,2),ft=a(Ne),pt=a(ft);{var nt=Ve=>{var Be=jd(),st=a(Be),Q=a(st),je=a(Q);Ad(je,{}),t(Q),t(st),t(Be),Qe("click",Q,async()=>{s(Ee,!0)}),l(Ve,Be)};N(pt,Ve=>{B(J()),o(()=>J().split(`
`).length>2)&&Ve(nt)})}var it=m(pt,2);{var rt=Ve=>{var Be=ct(),st=ke(Be);Ls(st,()=>(h(),o(()=>{var Q;return((Q=h())==null?void 0:Q.richTextInput)??!0})),Q=>{var je=ct(),Mt=ke(je);Ls(Mt,()=>(h(),o(()=>{var _t;return((_t=h())==null?void 0:_t.showFormattingToolbar)??!1})),_t=>{{let Yt=$e(()=>!e(Ee)),Kt=$e(()=>(h(),o(()=>{var tt;return((tt=h())==null?void 0:tt.richTextInput)??!0}))),Ct=$e(()=>(h(),o(()=>{var tt;return((tt=h())==null?void 0:tt.showFormattingToolbar)??!1}))),St=$e(()=>(h(),o(()=>{var tt;return((tt=h())==null?void 0:tt.insertPromptAsRichText)??!1}))),Bt=$e(()=>(h(),T(),o(()=>{var tt;return!(((tt=h())==null?void 0:tt.ctrlEnterToSend)??!1)&&!T()&&!("ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0)}))),Qt=$e(()=>(B(W()),r(),o(()=>W()?W():r().t("Send a Message")))),At=$e(()=>(h(),e(qe),o(()=>{var tt;return(((tt=h())==null?void 0:tt.largeTextAsFile)??!1)&&!e(qe)}))),ca=$e(()=>(w(),h(),o(()=>{var tt,Lt,Jt;return((Lt=(tt=w())==null?void 0:tt.features)==null?void 0:Lt.enable_autocomplete_generation)&&(((Jt=h())==null?void 0:Jt.promptAutocomplete)??!1)})));Ja(to(_t,{id:"chat-input",get editable(){return e(Yt)},onChange:tt=>{J(tt.md),s(ye,tt),s(Te,U())},json:!0,get richText(){return e(Kt)},messageInput:!0,get showFormattingToolbar(){return e(Ct)},floatingMenuPlacement:"top-start",get insertPromptAsRichText(){return e(St)},get shiftEnter(){return e(Bt)},get placeholder(){return e(Qt)},get largeTextAsFile(){return e(At)},get autocomplete(){return e(ca)},generateAutoCompletion:async tt=>{var Jt;(e(ee).length===0||!e(ee).at(0))&&at.error(r().t("Please select a model first."));const Lt=await In(localStorage.token,e(ee).at(0),tt,(Jt=re())!=null&&Jt.currentId?xa(re(),re().currentId):null).catch(aa=>null);return Lt},get suggestions(){return e(V)},oncompositionstart:()=>s(G,!0),oncompositionend:tt=>{s(j,tt.timeStamp),s(G,!1)},$$events:{keydown:async tt=>{var aa;tt=tt.detail.event;const Lt=tt.ctrlKey||tt.metaKey,Jt=document.getElementById("suggestions-container");if(tt.key==="Escape"&&ve()(),J()===""&&tt.key=="ArrowUp"){tt.preventDefault();const fa=[...document.getElementsByClassName("user-message")].at(-1);if(fa){fa.scrollIntoView({block:"center"});const La=[...document.getElementsByClassName("edit-user-message-button")].at(-1);La==null||La.click()}}if(!Jt&&(!T()||!("ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0))){if(R(tt))return;(((aa=h())==null?void 0:aa.ctrlEnterToSend)??!1?(tt.key==="Enter"||tt.keyCode===13)&&Lt:(tt.key==="Enter"||tt.keyCode===13)&&!tt.shiftKey)&&(tt.preventDefault(),(J()!==""||L().length>0)&&X("submit",J()))}tt.key==="Escape"&&(_(void 0),k([]),g([]),$(!1),f(!1),I(!1))},paste:async tt=>{var Jt;tt=tt.detail.event;const Lt=tt.clipboardData||window.clipboardData;if(Lt&&Lt.items)for(const aa of Lt.items)if(aa.type==="text/plain"){if((((Jt=h())==null?void 0:Jt.largeTextAsFile)??!1)&&!e(qe)){const fa=Lt.getData("text/plain");if(fa.length>Uo){tt.preventDefault();const La=new Blob([fa],{type:"text/plain"}),$r=new File([La],`Pasted_Text_${Date.now()}.txt`,{type:"text/plain"});await Ht($r,!0,{context:"full"})}}}else{const fa=aa.getAsFile();fa&&(await ma([fa]),tt.preventDefault())}}},$$legacy:!0}),tt=>s(K,tt),()=>e(K))}}),l(Q,je)}),l(Ve,Be)};N(it,Ve=>{e(V)&&Ve(rt)})}t(ft),t(Ne);var yt=m(Ne,2),xt=a(yt),Dt=a(xt);{let Ve=$e(()=>(B(_()),B(we()),o(()=>_()?[_().id]:we())));Vi(Dt,{get selectedModels(){return e(Ve)},get fileUploadCapableModels(){return e(ne)},screenCaptureHandler:sa,inputFilesHandler:ma,uploadFilesHandler:()=>{e(oe).click()},uploadGoogleDriveHandler:async()=>{try{const Be=await Hl();if(Be){const st=new File([Be.blob],Be.name,{type:Be.blob.type});await Ht(st)}}catch(Be){at.error(r().t("Error accessing Google Drive: {{error}}",{error:Be.message}))}},uploadOneDriveHandler:async Be=>{try{const st=await ql(Be);if(st){const Q=new File([st.blob],st.name,{type:st.blob.type||"application/octet-stream"});await Ht(Q)}}catch(st){}},get onUpload(){return ae()},onClose:async()=>{await ot();const Be=document.getElementById("chat-input");Be==null||Be.focus()},get files(){return L()},set files(Be){L(Be)},children:(Be,st)=>{var Q=Ud(),je=a(Q);Pd(je,{className:"size-5.5"}),t(Q),l(Be,Q)},$$slots:{default:!0},$$legacy:!0})}var dt=m(Dt,2);{var zt=Ve=>{var Be=Wd(),st=m(ke(Be),2);{let Q=$e(()=>(B(_()),B(we()),o(()=>_()?[_().id]:we())));Id(st,{get selectedModels(){return e(Q)},get toggleFilters(){return e(Xe)},get showWebSearchButton(){return e(vt)},get showImageGenerationButton(){return e(bt)},get showCodeInterpreterButton(){return e(Ft)},get closeOnOutsideClick(){return e(x)},onShowValves:je=>{const{type:Mt,id:_t}=je;s(We,Mt),s(me,_t),s(Ge,!0),s(x,!1)},onClose:async()=>{await ot();const je=document.getElementById("chat-input");je==null||je.focus()},get selectedToolIds(){return k()},set selectedToolIds(je){k(je)},get selectedFilterIds(){return g()},set selectedFilterIds(je){g(je)},get webSearchEnabled(){return $()},set webSearchEnabled(je){$(je)},get imageGenerationEnabled(){return f()},set imageGenerationEnabled(je){f(je)},get codeInterpreterEnabled(){return I()},set codeInterpreterEnabled(je){I(je)},children:(je,Mt)=>{var _t=Rd(),Yt=a(_t);Ed(Yt,{className:"size-4.5",strokeWidth:"1.5"}),t(_t),l(je,_t)},$$slots:{default:!0},$$legacy:!0})}l(Ve,Be)};N(dt,Ve=>{e(vt),e(bt),e(Ft),e(lt),e(Xe),o(()=>e(vt)||e(bt)||e(Ft)||e(lt)||e(Xe)&&e(Xe).length>0)&&Ve(zt)})}var Et=m(dt,2);{var Nt=Ve=>{var Be=Vd(),st=a(Be);{let Q=$e(()=>(r(),o(()=>r().t("Valves"))));mt(st,{get content(){return e(Q)},placement:"top",children:(je,Mt)=>{var _t=Hd(),Yt=a(_t);Zr(Yt,{className:"size-4",strokeWidth:"1.5"}),t(_t),Qe("click",_t,()=>{var Kt;s(We,"function"),s(me,(Kt=e(ee)[0])==null?void 0:Kt.split(".")[0]),s(Ge,!0)}),l(je,_t)},$$slots:{default:!0}})}t(Be),l(Ve,Be)};N(Et,Ve=>{e(ee),i(),o(()=>{var Be;return e(ee).length===1&&((Be=i().find(st=>st.id===e(ee)[0]))==null?void 0:Be.has_user_valves)})&&Ve(Nt)})}var jt=m(Et,2),wt=a(jt);{var da=Ve=>{{let Be=$e(()=>(r(),B(k()),o(()=>r().t("{{COUNT}} Available Tools",{COUNT:k().length}))));mt(Ve,{get content(){return e(Be)},children:(st,Q)=>{var je=Gd(),Mt=a(je);ys(Mt,{className:"size-4",strokeWidth:"1.75"});var _t=m(Mt,2),Yt=a(_t,!0);t(_t),t(je),Z(()=>Le(Yt,(B(k()),o(()=>k().length)))),Qe("click",je,()=>{s(_e,!e(_e))}),l(st,je)},$$slots:{default:!0}})}};N(wt,Ve=>{B(k()),o(()=>(k()??[]).length>0)&&Ve(da)})}var ht=m(wt,2);ua(ht,1,g,Ca,(Ve,Be)=>{const st=$e(()=>(e(Xe),e(Be),o(()=>e(Xe).find(_t=>_t.id===e(Be)))));var Q=ct(),je=ke(Q);{var Mt=_t=>{{let Yt=$e(()=>(B(e(st)),o(()=>{var Kt;return(Kt=e(st))==null?void 0:Kt.name})));mt(_t,{get content(){return e(Yt)},placement:"top",children:(Kt,Ct)=>{var St=qd(),Bt=a(St);{var Qt=Lt=>{var Jt=Jd(),aa=a(Jt);t(Jt),Z(fa=>{$t(aa,"src",(B(e(st)),o(()=>e(st).icon))),gt(aa,1,`size-3.5 ${fa??""}`),$t(aa,"alt",(B(e(st)),o(()=>e(st).name)))},[()=>(B(e(st)),o(()=>e(st).icon.includes("svg")?"dark:invert-[80%]":""))]),l(Lt,Jt)},At=Lt=>{ao(Lt,{className:"size-4",strokeWidth:"1.75"})};N(Bt,Lt=>{B(e(st)),o(()=>{var Jt;return(Jt=e(st))==null?void 0:Jt.icon})?Lt(Qt):Lt(At,!1)})}var ca=m(Bt,2),tt=a(ca);Ga(tt,{className:"size-4",strokeWidth:"1.75"}),t(ca),t(St),Z(Lt=>gt(St,1,`group p-[7px] flex gap-1.5 items-center text-sm rounded-full transition-colors duration-300 focus:outline-hidden max-w-full overflow-hidden ${Lt??""} capitalize`),[()=>(B(g()),e(Be),o(()=>g().includes(e(Be))?"text-sky-500 dark:text-sky-300 bg-sky-50 hover:bg-sky-100 dark:bg-sky-400/10 dark:hover:bg-sky-600/10 border border-sky-200/40 dark:border-sky-500/20":"bg-transparent text-gray-600 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-800 "))]),Qe("click",St,pr(()=>{g(g().filter(Lt=>Lt!==e(Be)))})),l(Kt,St)},$$slots:{default:!0}})}};N(je,_t=>{e(st)&&_t(Mt)})}l(Ve,Q)});var Ut=m(ht,2);{var ut=Ve=>{{let Be=$e(()=>(r(),o(()=>r().t("Web Search"))));mt(Ve,{get content(){return e(Be)},placement:"top",children:(st,Q)=>{var je=Zd(),Mt=a(je);$s(Mt,{className:"size-4",strokeWidth:"1.75"});var _t=m(Mt,2),Yt=a(_t);Ga(Yt,{className:"size-4",strokeWidth:"1.75"}),t(_t),t(je),Z(()=>gt(je,1,`group p-[7px] flex gap-1.5 items-center text-sm rounded-full transition-colors duration-300 focus:outline-hidden max-w-full overflow-hidden ${B($()),h(),o(()=>{var Kt;return $()||(((Kt=h())==null?void 0:Kt.webSearch)??!1)==="always"?" text-sky-500 dark:text-sky-300 bg-sky-50 hover:bg-sky-100 dark:bg-sky-400/10 dark:hover:bg-sky-600/10 border border-sky-200/40 dark:border-sky-500/20":"bg-transparent text-gray-600 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-800 "})??""}`)),Qe("click",je,pr(()=>$(!$()))),l(st,je)},$$slots:{default:!0}})}};N(Ut,Ve=>{$()&&Ve(ut)})}var va=m(Ut,2);{var Ma=Ve=>{{let Be=$e(()=>(r(),o(()=>r().t("Image"))));mt(Ve,{get content(){return e(Be)},placement:"top",children:(st,Q)=>{var je=Yd(),Mt=a(je);co(Mt,{className:"size-4",strokeWidth:"1.75"});var _t=m(Mt,2),Yt=a(_t);Ga(Yt,{className:"size-4",strokeWidth:"1.75"}),t(_t),t(je),Z(()=>gt(je,1,`group p-[7px] flex gap-1.5 items-center text-sm rounded-full transition-colors duration-300 focus:outline-hidden max-w-full overflow-hidden ${f()?" text-sky-500 dark:text-sky-300 bg-sky-50 hover:bg-sky-100 dark:bg-sky-400/10 dark:hover:bg-sky-700/10 border border-sky-200/40 dark:border-sky-500/20":"bg-transparent text-gray-600 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-800 "}`)),Qe("click",je,pr(()=>f(!f()))),l(st,je)},$$slots:{default:!0}})}};N(va,Ve=>{f()&&Ve(Ma)})}var Ha=m(va,2);{var oa=Ve=>{{let Be=$e(()=>(r(),o(()=>r().t("Code Interpreter"))));mt(Ve,{get content(){return e(Be)},placement:"top",children:(st,Q)=>{var je=Kd(),Mt=a(je);uo(Mt,{className:"size-3.5",strokeWidth:"2"});var _t=m(Mt,2),Yt=a(_t);Ga(Yt,{className:"size-4",strokeWidth:"1.75"}),t(_t),t(je),Z(Kt=>{$t(je,"aria-label",Kt),$t(je,"aria-pressed",I()),gt(je,1,` group p-[7px] flex gap-1.5 items-center text-sm transition-colors duration-300 max-w-full overflow-hidden ${I()?" text-sky-500 dark:text-sky-300 bg-sky-50 hover:bg-sky-100 dark:bg-sky-400/10 dark:hover:bg-sky-700/10 border border-sky-200/40 dark:border-sky-500/20":"bg-transparent text-gray-600 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-800 "} ${h(),o(()=>{var Ct;return((Ct=h())==null?void 0:Ct.highContrastMode)??!1?"m-1":"focus:outline-hidden rounded-full"})??""}`)},[()=>(B(I()),r(),o(()=>I()?r().t("Disable Code Interpreter"):r().t("Enable Code Interpreter")))]),Qe("click",je,pr(()=>I(!I()))),l(st,je)},$$slots:{default:!0}})}};N(Ha,Ve=>{I()&&Ve(oa)})}t(jt),t(xt);var ba=m(xt,2),Fr=a(ba);{var Dr=Ve=>{var Be=Xd(),st=a(Be);{let Q=$e(()=>(r(),o(()=>r().t("Stop"))));mt(st,{get content(){return e(Q)},children:(je,Mt)=>{var _t=Qd();Qe("click",_t,()=>{ve()()}),l(je,_t)},$$slots:{default:!0}})}t(Be),l(Ve,Be)},Br=Ve=>{var Be=nc(),st=ke(Be);{var Q=Ct=>{{let St=$e(()=>(r(),o(()=>r().t("Create note"))));mt(Ct,{get content(){return e(St)},className:" flex items-center",children:(Bt,Qt)=>{var At=ec(),ca=a(At);xs(ca,{className:"size-4.5 translate-y-[0.5px]"}),t(At),Z(()=>At.disabled=(B(J()),B(L()),o(()=>J()===""&&L().length===0))),Qe("click",At,()=>{qt()}),l(Bt,At)},$$slots:{default:!0}})}};N(st,Ct=>{B(J()),B(re()),w(),y(),o(()=>{var St,Bt,Qt,At,ca,tt,Lt;return J()!==""&&!((St=re())!=null&&St.currentId)&&(((Qt=(Bt=w())==null?void 0:Bt.features)==null?void 0:Qt.enable_notes)??!1)&&(((At=y())==null?void 0:At.role)==="admin"||(((Lt=(tt=(ca=y())==null?void 0:ca.permissions)==null?void 0:tt.features)==null?void 0:Lt.notes)??!0))})&&Ct(Q)})}var je=m(st,2);{var Mt=Ct=>{{let St=$e(()=>(r(),o(()=>r().t("Dictate"))));mt(Ct,{get content(){return e(St)},children:(Bt,Qt)=>{var At=tc();Qe("click",At,async()=>{try{let ca=await navigator.mediaDevices.getUserMedia({audio:!0}).catch(function(tt){return at.error(r().t("Permission denied when accessing microphone: {{error}}",{error:tt})),null});ca&&(s(A,!0),ca.getTracks().forEach(Lt=>Lt.stop())),ca=null}catch{at.error(r().t("Permission denied when accessing microphone"))}}),l(Bt,At)},$$slots:{default:!0}})}};N(je,Ct=>{B(re()),y(),o(()=>{var St,Bt,Qt,At,ca,tt;return(!((St=re())!=null&&St.currentId)||((Bt=re().messages[re().currentId])==null?void 0:Bt.done)==!0)&&(((Qt=y())==null?void 0:Qt.role)==="admin"||(((tt=(ca=(At=y())==null?void 0:At.permissions)==null?void 0:ca.chat)==null?void 0:tt.stt)??!0))})&&Ct(Mt)})}var _t=m(je,2);{var Yt=Ct=>{var St=rc(),Bt=a(St);{let Qt=$e(()=>(r(),o(()=>r().t("Voice mode"))));mt(Bt,{get content(){return e(Qt)},children:(At,ca)=>{var tt=ac(),Lt=a(tt);od(Lt,{className:"size-5",strokeWidth:"2.5"}),t(tt),Z(Jt=>$t(tt,"aria-label",Jt),[()=>(r(),o(()=>r().t("Voice mode")))]),Qe("click",tt,async()=>{var Jt,aa,fa,La,$r;if(we().length>1){at.error(r().t("Select only one model to call"));return}if(w().audio.stt.engine==="web"){at.error(r().t("Call feature is not supported when using Web STT engine"));return}try{let gr=await navigator.mediaDevices.getUserMedia({audio:!0});gr&&gr.getTracks().forEach(fo=>fo.stop()),gr=null,((aa=(Jt=h().audio)==null?void 0:Jt.tts)==null?void 0:aa.engine)==="browser-kokoro"&&(M()||(await vs.set(new Gn({dtype:(($r=(La=(fa=h().audio)==null?void 0:fa.tts)==null?void 0:La.engineConfig)==null?void 0:$r.dtype)??"fp32"})),await M().init())),Ta.set(!0),ra.set(!0)}catch{at.error(r().t("Permission denied when accessing media devices"))}}),l(At,tt)},$$slots:{default:!0}})}t(St),l(Ct,St)},Kt=Ct=>{var St=oc(),Bt=a(St);{let Qt=$e(()=>(r(),o(()=>r().t("Send message"))));mt(Bt,{get content(){return e(Qt)},children:(At,ca)=>{var tt=sc();Z(()=>{gt(tt,1,`${B(J()),B(L()),o(()=>J()===""&&L().length===0?"text-white bg-gray-200 dark:text-gray-900 dark:bg-gray-700 disabled":"bg-black text-white hover:bg-gray-900 dark:bg-white dark:text-black dark:hover:bg-gray-100 ")??""} transition rounded-full p-1.5 self-center`),tt.disabled=(B(J()),B(L()),o(()=>J()===""&&L().length===0))}),l(At,tt)},$$slots:{default:!0}})}t(St),l(Ct,St)};N(_t,Ct=>{B(J()),B(L()),y(),o(()=>{var St,Bt,Qt,At;return J()===""&&L().length===0&&(((St=y())==null?void 0:St.role)==="admin"||(((At=(Qt=(Bt=y())==null?void 0:Bt.permissions)==null?void 0:Qt.chat)==null?void 0:At.call)??!0))})?Ct(Yt):Ct(Kt,!1)})}l(Ve,Be)};N(Fr,Ve=>{B(Ye()),B(re()),B(Ae()),o(()=>{var Be;return Ye()&&Ye().length>0||re().currentId&&((Be=re().messages[re().currentId])==null?void 0:Be.done)!=!0||Ae()})?Ve(Dr):Ve(Br,!1)})}t(ba),t(yt),t(le);var Or=m(le,2);{var jr=Ve=>{var Be=lc(),st=a(Be);Ys(st,()=>(B(As),B(_r),w(),o(()=>{var Q,je;return As.sanitize(_r((je=(Q=w())==null?void 0:Q.license_metadata)==null?void 0:je.input_footer))}))),t(Be),l(Ve,Be)},Ur=Ve=>{var Be=ic();l(Ve,Be)};N(Or,Ve=>{w(),o(()=>{var Be,st;return(st=(Be=w())==null?void 0:Be.license_metadata)==null?void 0:st.input_footer})?Ve(jr):Ve(Ur,!1)})}t(b),t(Wa),t(Ea),t(Gt),t(be),Z(()=>{gt(et,1,`flex flex-col px-3 ${h(),o(()=>{var Ve;return((Ve=h())==null?void 0:Ve.widescreenMode)??null?"max-w-full":"max-w-6xl"})??""} w-full`),gt(Ea,1,`${h(),o(()=>{var Ve;return((Ve=h())==null?void 0:Ve.widescreenMode)??null?"max-w-full":"max-w-6xl"})??""} px-2.5 mx-auto inset-x-0`),gt(Aa,1,wa(e(A)?"":"hidden")),gt(b,1,`w-full flex flex-col gap-1.5 ${e(A)?"hidden":""}`),gt(le,1,`flex-1 flex flex-col relative w-full shadow-lg rounded-3xl border ${pe()?"border-dashed border-gray-100 dark:border-gray-800 hover:border-gray-200 focus-within:border-gray-200 hover:dark:border-gray-700 focus-within:dark:border-gray-700":" border-gray-100/30 dark:border-gray-850/30 hover:border-gray-200 focus-within:border-gray-100 hover:dark:border-gray-800 focus-within:dark:border-gray-800"}  transition px-1 bg-white/5 dark:bg-gray-500/5 backdrop-blur-sm dark:text-gray-100`),$t(le,"dir",(h(),o(()=>{var Ve;return((Ve=h())==null?void 0:Ve.chatDirection)??"auto"}))),gt(ft,1,`scrollbar-hidden rtl:text-right ltr:text-left bg-transparent dark:text-gray-100 outline-hidden w-full pb-1 px-1 resize-none h-fit max-h-96 overflow-auto ${B(L()),B(_()),o(()=>L().length===0?_()!==void 0?"pt-1.5":"pt-2.5":"")??""}`),yt.dir=yt.dir,le.dir=le.dir}),Un(Na,()=>e(ue),Ve=>s(ue,Ve)),Qe("change",Na,async()=>{if(e(ue)&&e(ue).length>0){const Ve=Array.from(e(ue));ma(Ve)}else at.error(r().t("File not found."));Pt(oe,e(oe).value="")}),Qe("click",te,()=>Pe()(J())),Qe("submit",b,pr(()=>{X("submit",J())})),l(p,be)};N(rr,p=>{e(d)&&p(pa)})}l(Y,ka),Ks(n,"setText",he);var ha=ea(ia);return C(),ha}var uc=v('<button class=" " aria-label="Add Model"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="size-3.5"><path stroke-linecap="round" stroke-linejoin="round" d="M12 6v12m6-6H6"></path></svg></button>'),vc=v('<div class="  self-center mx-1 disabled:text-gray-600 disabled:hover:text-gray-600 -translate-y-[0.5px]"><!></div>'),fc=v('<button aria-label="Remove Model"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="size-3"><path stroke-linecap="round" stroke-linejoin="round" d="M19.5 12h-15"></path></svg></button>'),gc=v('<div class="  self-center mx-1 disabled:text-gray-600 disabled:hover:text-gray-600 -translate-y-[0.5px]"><!></div>'),mc=v('<div class="flex w-full max-w-fit"><div class="overflow-hidden w-full"><div><!></div></div> <!></div>'),pc=v('<div class="relative text-left mt-[1px] ml-1 text-[0.7rem] text-gray-600 dark:text-gray-400 font-primary"><button> </button></div>'),hc=v('<div class="flex flex-col w-full items-start"></div> <!>',1);function _c(Y,n){Xt(n,!1);const r=()=>ze(pe,"$i18n",w),i=()=>ze(Ra,"$settings",w),u=()=>ze(Lr,"$models",w),S=()=>ze(Ka,"$user",w),[w,y]=na(),pe=la("i18n");let h=E(n,"selectedModels",28,()=>[""]),T=E(n,"disabled",8,!1),M=E(n,"showSetDefault",8,!0);const O=async()=>{if(h().filter(ve=>ve==="").length){at.error(r().t("Choose a model before saving..."));return}Ra.set({...i(),models:h()}),await zs(localStorage.token,{ui:i()}),at.success(r().t("Default model updated"))},C=async Pe=>{var D;let ve=((D=i())==null?void 0:D.pinnedModels)??[];ve.includes(Pe)?ve=ve.filter(Ae=>Ae!==Pe):ve=[...new Set([...ve,Pe])],Ra.set({...i(),pinnedModels:ve}),await zs(localStorage.token,{ui:i()})};Tt(()=>(B(h()),u()),()=>{if(h().length>0&&u().length>0){const Pe=h().map(ve=>u().map(D=>D.id).includes(ve)?ve:"");JSON.stringify(Pe)!==JSON.stringify(h())&&h(Pe)}}),Da(),ta();var X=hc(),ge=ke(X);ua(ge,5,h,Ca,(Pe,ve,D)=>{var Ae=mc(),_=a(Ae),we=a(_),ee=a(we);{let J=$e(()=>(r(),o(()=>r().t("Select a model")))),L=$e(()=>(u(),o(()=>u().map(k=>({value:k.id,label:k.name,model:k})))));fl(ee,{id:`${D}`,get placeholder(){return e(J)},get items(){return e(L)},pinModelHandler:C,get value(){return h()[D]},set value(k){h()[D]=k,us(()=>h())},$$legacy:!0})}t(we),t(_);var re=m(_,2);{var Ye=J=>{var L=ct(),k=ke(L);{var g=$=>{var I=vc(),ye=a(I);{let Ce=$e(()=>(r(),o(()=>r().t("Add Model"))));mt(ye,{get content(){return e(Ce)},children:(de,Me)=>{var xe=uc();Z(()=>xe.disabled=T()),Qe("click",xe,()=>{h([...h(),""])}),l(de,xe)},$$slots:{default:!0}})}t(I),l($,I)},f=$=>{var I=gc(),ye=a(I);{let Ce=$e(()=>(r(),o(()=>r().t("Remove Model"))));mt(ye,{get content(){return e(Ce)},children:(de,Me)=>{var xe=fc();Z(()=>xe.disabled=T()),Qe("click",xe,()=>{h().splice(D,1),h(h())}),l(de,xe)},$$slots:{default:!0}})}t(I),l($,I)};N(k,$=>{D===0?$(g):$(f,!1)})}l(J,L)};N(re,J=>{S(),o(()=>{var L,k,g,f;return((L=S())==null?void 0:L.role)==="admin"||(((f=(g=(k=S())==null?void 0:k.permissions)==null?void 0:g.chat)==null?void 0:f.multiple_models)??!0)})&&J(Ye)})}t(Ae),Z(()=>gt(we,1,`max-w-full ${i(),o(()=>{var J;return((J=i())==null?void 0:J.highContrastMode)??!1?"m-1":"mr-1"})??""}`)),l(Pe,Ae)}),t(ge);var ae=m(ge,2);{var Re=Pe=>{var ve=pc(),D=a(ve),Ae=a(D,!0);t(D),t(ve),Z(_=>Le(Ae,_),[()=>(r(),o(()=>r().t("Set as default")))]),Qe("click",D,O),l(Pe,ve)};N(ae,Pe=>{M()&&Pe(Re)})}l(Y,X),ea(),y()}var wc=ga('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" stroke="currentColor" fill="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M10.5 6h9.75M10.5 6a1.5 1.5 0 1 1-3 0m3 0a1.5 1.5 0 1 0-3 0M3.75 6H7.5m3 12h9.75m-9.75 0a1.5 1.5 0 0 1-3 0m3 0a1.5 1.5 0 0 0-3 0m-3.75 0H7.5m9-6h3.75m-3.75 0a1.5 1.5 0 0 1-3 0m3 0a1.5 1.5 0 0 0-3 0m-9.75 0h9.75"></path></svg>');function yc(Y,n){let r=E(n,"className",8,"w-4 h-4"),i=E(n,"strokeWidth",8,"1.5");var u=wc();Z(()=>{gt(u,0,wa(r())),$t(u,"stroke-width",i())}),l(Y,u)}var bc=v('<div class="hidden w-full h-full flex-col"><div id="full-messages-container"><!></div></div>'),xc=v('<!> <div class="flex items-center"> </div>',1),$c=v('<!> <div class="flex items-center"> </div>',1),kc=v('<!> <div class="flex items-center"> </div>',1),Cc=v('<!> <div class="flex items-center"> </div>',1),Ic=v('<!> <div class="flex items-center"> </div>',1),Sc=v('<div class="flex items-center line-clamp-1"> </div>'),Ec=v('<div class="flex items-center line-clamp-1"> </div>'),Mc=v('<div class="flex items-center line-clamp-1"> </div>'),Pc=v("<!> <!> <!>",1),Tc=v("<!> <!>",1),zc=v('<!> <div class="flex items-center"> </div>',1),Nc=v('<!> <div class="flex items-center"> </div>',1),Ac=v('<!> <div class="flex items-center"> </div>',1),Lc=v("<!> <!>",1),Fc=v('<!> <div class="flex items-center"> </div>',1),Dc=v('<hr class="border-gray-50/30 dark:border-gray-800/30 my-1"/> <!> <!> <hr class="border-gray-50/30 dark:border-gray-800/30 my-1"/> <div class="flex p-1"><!></div>',1),Bc=v('<!> <!> <!> <hr class="border-gray-50/30 dark:border-gray-800/30 my-1"/> <!> <!> <!> <!>',1),Oc=v('<div slot="content"><!></div>'),jc=v("<!> <!>",1);function Uc(Y,n){Xt(n,!1);const r=()=>ze(Ra,"$settings",h),i=()=>ze(Pa,"$temporaryChatEnabled",h),u=()=>ze(Ka,"$user",h),S=()=>ze(Qr,"$mobile",h),w=()=>ze(O,"$i18n",h),y=()=>ze(Er,"$artifactContents",h),pe=()=>ze(Wo,"$folders",h),[h,T]=na(),{saveAs:M}=so,O=la("i18n");E(n,"shareEnabled",8,!1);let C=E(n,"shareHandler",8),X=E(n,"moveChatHandler",8),ge=E(n,"archiveChatHandler",8),ae=E(n,"chat",8),Re=E(n,"onClose",8,()=>{}),Pe=q(!1);const ve=async()=>{const J=ae().chat.history;return xa(J,J.currentId).reduce((g,f,$,I)=>`${g}### ${f.role.toUpperCase()}
${f.content}

`,"").trim()},D=async()=>{const J=await ve();let L=new Blob([J],{type:"text/plain"});M(L,`chat-${ae().chat.title}.txt`)},Ae=async()=>{var k;const[{default:J},{default:L}]=await Promise.all([Pr(()=>import("./twlQqEV6.js"),__vite__mapDeps([0,1,2]),import.meta.url),Pr(()=>import("./Dxr8Uf4l.js"),[],import.meta.url)]);if(((k=r())==null?void 0:k.stylizedPdfExport)??!0){s(Pe,!0),await ot();const g=document.getElementById("full-messages-container");if(g)try{const f=document.documentElement.classList.contains("dark"),$=800,I=g.cloneNode(!0);I.classList.add("text-black"),I.classList.add("dark:text-white"),I.style.width=`${$}px`,I.style.position="absolute",I.style.left="-9999px",I.style.height="auto",document.body.appendChild(I),await new Promise(Ie=>setTimeout(Ie,100));const ye=await L(I,{backgroundColor:f?"#000":"#fff",useCORS:!0,scale:2,width:$});document.body.removeChild(I);const Ce=new J("p","mm","a4"),de=210,Me=297,xe=ye.width/$,Ge=ye.width/de,We=Math.floor(Ge*Me);let me=0,x=0;for(;me<ye.height;){const Ie=Math.min(We,ye.height-me),He=document.createElement("canvas");He.width=ye.width,He.height=Ie,He.getContext("2d").drawImage(ye,0,me,ye.width,Ie,0,0,ye.width,Ie);const he=He.toDataURL("image/jpeg",.7),U=Ie*de/ye.width;x>0&&Ce.addPage(),f&&(Ce.setFillColor(0,0,0),Ce.rect(0,0,de,Me,"F")),Ce.addImage(he,"JPEG",0,0,de,U),me+=Ie,x++}Ce.save(`chat-${ae().chat.title}.pdf`),s(Pe,!1)}catch(f){}}else{const g=await ve(),f=new J,$=15,I=20,ye=15,Ce=20,de=f.internal.pageSize.getWidth(),Me=f.internal.pageSize.getHeight(),xe=de-$-ye,Ge=8;f.setFontSize(Ge);const We=Ge*1,me=g.split(`
`);let x=I;for(let Ie of me){const He=f.splitTextToSize(Ie,xe);for(let Se of He)x+We>Me-Ce&&(f.addPage(),x=I),f.text(Se,$,x),x+=We*.5;x+=We*.1}f.save(`chat-${ae().chat.title}.pdf`)}},_=async()=>{var J;if(ae().id){let L=null;(((J=ae())==null?void 0:J.id)??"").startsWith("local")||i()?L=ae():L=await ms(localStorage.token,ae().id);let k=new Blob([JSON.stringify([L])],{type:"application/json"});M(k,`chat-export-${Date.now()}.json`)}};ta();var we=jc(),ee=ke(we);{var re=J=>{var L=bc(),k=a(L),g=a(k);{let f=$e(()=>(B(ae()),o(()=>{var $;return`chat-preview-${(($=ae())==null?void 0:$.id)??""}`})));Qs(g,{className:"h-full flex pt-4 pb-8 w-full",get chatId(){return e(f)},get user(){return u()},readOnly:!0,get history(){return B(ae()),o(()=>ae().chat.history)},get messages(){return B(ae()),o(()=>ae().chat.messages)},autoScroll:!0,sendMessage:()=>{},continueResponse:()=>{},regenerateResponse:()=>{},messagesCount:null,editCodeBlock:!1})}t(k),t(L),l(J,L)};N(ee,J=>{e(Pe)&&J(re)})}var Ye=m(ee,2);as(Ye,{$$events:{change:J=>{J.detail===!1&&Re()()}},children:(J,L)=>{var k=ct(),g=ke(k);es(g,n,"default",{},null),l(J,k)},$$slots:{default:!0,content:(J,L)=>{var k=Oc(),g=a(k);ts(g,{class:"w-full max-w-[200px] rounded-2xl px-1 py-1  border border-gray-100  dark:border-gray-800 z-50 bg-white dark:bg-gray-850 dark:text-white shadow-lg transition",sideOffset:8,side:"bottom",align:"end",get transition(){return br},children:(f,$)=>{var I=Bc(),ye=ke(I);{var Ce=Se=>{_a(Se,{class:"flex gap-2 items-center px-3 py-1.5 text-sm cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 rounded-xl select-none w-full",id:"chat-controls-button",$$events:{click:async()=>{await ra.set(!0),await lr.set(!1),await qa.set(!1),await ir.set(!1)}},children:(he,U)=>{var H=xc(),De=ke(H);yc(De,{className:" size-4",strokeWidth:"1.5"});var Te=m(De,2),Je=a(Te,!0);t(Te),Z(V=>Le(Je,V),[()=>(w(),o(()=>w().t("Controls")))]),l(he,H)},$$slots:{default:!0}})};N(ye,Se=>{S(),u(),o(()=>{var he,U,H;return S()&&(((he=u())==null?void 0:he.role)==="admin"||(((H=(U=u())==null?void 0:U.permissions.chat)==null?void 0:H.controls)??!0))})&&Se(Ce)})}var de=m(ye,2);_a(de,{class:"flex gap-2 items-center px-3 py-1.5 text-sm cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 rounded-xl select-none w-full",id:"chat-overview-button",$$events:{click:async()=>{await ra.set(!0),await lr.set(!0),await qa.set(!1),await ir.set(!1)}},children:(Se,he)=>{var U=$c(),H=ke(U);ml(H,{className:" size-4",strokeWidth:"1.5"});var De=m(H,2),Te=a(De,!0);t(De),Z(Je=>Le(Te,Je),[()=>(w(),o(()=>w().t("Overview")))]),l(Se,U)},$$slots:{default:!0}});var Me=m(de,2);{var xe=Se=>{_a(Se,{class:"flex gap-2 items-center px-3 py-1.5 text-sm cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 rounded-xl select-none w-full",id:"chat-overview-button",$$events:{click:async()=>{await ra.set(!0),await qa.set(!0),await lr.set(!1),await ir.set(!1)}},children:(he,U)=>{var H=kc(),De=ke(H);Ll(De,{className:" size-4",strokeWidth:"1.5"});var Te=m(De,2),Je=a(Te,!0);t(Te),Z(V=>Le(Je,V),[()=>(w(),o(()=>w().t("Artifacts")))]),l(he,H)},$$slots:{default:!0}})};N(Me,Se=>{y(),o(()=>(y()??[]).length>0)&&Se(xe)})}var Ge=m(Me,4);{var We=Se=>{_a(Se,{class:"flex gap-2 items-center px-3 py-1.5 text-sm cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 rounded-xl select-none w-full",id:"chat-share-button",$$events:{click:()=>{C()()}},children:(he,U)=>{var H=Cc(),De=ke(H);wl(De,{strokeWidth:"1.5"});var Te=m(De,2),Je=a(Te,!0);t(Te),Z(V=>Le(Je,V),[()=>(w(),o(()=>w().t("Share")))]),l(he,H)},$$slots:{default:!0}})};N(Ge,Se=>{i(),u(),o(()=>{var he,U,H;return!i()&&(((he=u())==null?void 0:he.role)==="admin"||(((H=(U=u().permissions)==null?void 0:U.chat)==null?void 0:H.share)??!0))})&&Se(We)})}var me=m(Ge,2);Fs(me,{children:(Se,he)=>{var U=Tc(),H=ke(U);Ds(H,{class:"flex gap-2 items-center px-3 py-1.5 text-sm cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 rounded-xl select-none w-full",children:(Te,Je)=>{var V=Ic(),_e=ke(V);oo(_e,{strokeWidth:"1.5"});var d=m(_e,2),A=a(d,!0);t(d),Z(G=>Le(A,G),[()=>(w(),o(()=>w().t("Download")))]),l(Te,V)},$$slots:{default:!0}});var De=m(H,2);Bs(De,{class:"w-full rounded-2xl p-1 z-50 bg-white dark:bg-gray-850 dark:text-white border border-gray-100  dark:border-gray-800 shadow-lg max-h-52 overflow-y-auto scrollbar-hidden",get transition(){return br},sideOffset:8,children:(Te,Je)=>{var V=Pc(),_e=ke(V);{var d=j=>{_a(j,{class:"flex gap-2 items-center px-3 py-1.5 text-sm cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 rounded-xl select-none w-full",$$events:{click:()=>{_()}},children:(z,R)=>{var K=Sc(),oe=a(K,!0);t(K),Z(ue=>Le(oe,ue),[()=>(w(),o(()=>w().t("Export chat (.json)")))]),l(z,K)},$$slots:{default:!0}})};N(_e,j=>{u(),o(()=>{var z,R,K;return((z=u())==null?void 0:z.role)==="admin"||(((K=(R=u().permissions)==null?void 0:R.chat)==null?void 0:K.export)??!0)})&&j(d)})}var A=m(_e,2);_a(A,{class:"flex gap-2 items-center px-3 py-1.5 text-sm cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 rounded-xl select-none w-full",$$events:{click:()=>{D()}},children:(j,z)=>{var R=Ec(),K=a(R,!0);t(R),Z(oe=>Le(K,oe),[()=>(w(),o(()=>w().t("Plain text (.txt)")))]),l(j,R)},$$slots:{default:!0}});var G=m(A,2);_a(G,{class:"flex gap-2 items-center px-3 py-1.5 text-sm cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 rounded-xl select-none w-full",$$events:{click:()=>{Ae()}},children:(j,z)=>{var R=Mc(),K=a(R,!0);t(R),Z(oe=>Le(K,oe),[()=>(w(),o(()=>w().t("PDF document (.pdf)")))]),l(j,R)},$$slots:{default:!0}}),l(Te,V)},$$slots:{default:!0}}),l(Se,U)},$$slots:{default:!0}});var x=m(me,2);_a(x,{class:"flex gap-2 items-center px-3 py-1.5 text-sm cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 rounded-xl select-none w-full",id:"chat-copy-button",$$events:{click:async()=>{await bs(await ve()).catch(he=>{})&&at.success(w().t("Copied to clipboard"))}},children:(Se,he)=>{var U=zc(),H=ke(U);sl(H,{className:" size-4",strokeWidth:"1.5"});var De=m(H,2),Te=a(De,!0);t(De),Z(Je=>Le(Te,Je),[()=>(w(),o(()=>w().t("Copy")))]),l(Se,U)},$$slots:{default:!0}});var Ie=m(x,2);{var He=Se=>{var he=Dc(),U=m(ke(he),2);{var H=V=>{Fs(V,{children:(_e,d)=>{var A=Lc(),G=ke(A);Ds(G,{class:"flex gap-2 items-center px-3 py-1.5 text-sm cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 rounded-xl select-none w-full",children:(z,R)=>{var K=Nc(),oe=ke(K);_s(oe,{strokeWidth:"1.5"});var ue=m(oe,2),Ee=a(ue,!0);t(ue),Z(Oe=>Le(Ee,Oe),[()=>(w(),o(()=>w().t("Move")))]),l(z,K)},$$slots:{default:!0}});var j=m(G,2);Bs(j,{class:"w-full rounded-2xl p-1 z-50 bg-white dark:bg-gray-850 dark:text-white border border-gray-100  dark:border-gray-800 shadow-lg max-h-52 overflow-y-auto scrollbar-hidden",get transition(){return br},sideOffset:8,children:(z,R)=>{var K=ct(),oe=ke(K);ua(oe,1,()=>(pe(),o(()=>pe().sort((ue,Ee)=>Ee.updated_at-ue.updated_at))),Ca,(ue,Ee)=>{var Oe=ct(),qe=ke(Oe);{var W=se=>{_a(se,{class:"flex gap-2 items-center px-3 py-1.5 text-sm cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 rounded-xl",$$events:{click:()=>{X()(ae().id,e(Ee).id)}},children:(ne,Fe)=>{var Ze=Ac(),Ue=ke(Ze);_s(Ue,{strokeWidth:"1.5"});var Xe=m(Ue,2),lt=a(Xe,!0);t(Xe),Z(()=>Le(lt,(e(Ee),o(()=>e(Ee).name??"Folder")))),l(ne,Ze)},$$slots:{default:!0}})};N(qe,se=>{e(Ee),o(()=>{var ne;return(ne=e(Ee))==null?void 0:ne.id})&&se(W)})}l(ue,Oe)}),l(z,K)},$$slots:{default:!0}}),l(_e,A)},$$slots:{default:!0}})};N(U,V=>{pe(),o(()=>pe().length>0)&&V(H)})}var De=m(U,2);_a(De,{class:"flex gap-2 items-center px-3 py-1.5 text-sm  cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 rounded-xl",$$events:{click:()=>{ge()()}},children:(V,_e)=>{var d=Fc(),A=ke(d);pl(A,{className:"size-4",strokeWidth:"1.5"});var G=m(A,2),j=a(G,!0);t(G),Z(z=>Le(j,z),[()=>(w(),o(()=>w().t("Archive")))]),l(V,d)},$$slots:{default:!0}});var Te=m(De,4),Je=a(Te);Il(Je,{get chatId(){return B(ae()),o(()=>ae().id)}}),t(Te),l(Se,he)};N(Ie,Se=>{i(),B(ae()),o(()=>{var he;return!i()&&((he=ae())==null?void 0:he.id)})&&Se(He)})}l(f,I)},$$slots:{default:!0}}),t(k),l(J,k)}}}),l(Y,we),ea(),T()}var Rc=ga('<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path d="M12 22C17.5228 22 22 17.5228 22 12C22 6.47715 17.5228 2 12 2C6.47715 2 2 6.47715 2 12C2 13.8214 2.48697 15.5291 3.33782 17L2.5 21.5L7 20.6622C8.47087 21.513 10.1786 22 12 22Z" stroke-linecap="round" stroke-linejoin="round" stroke-dasharray="2.5 3.5"></path></svg>');function Wc(Y,n){let r=E(n,"className",8,"size-4"),i=E(n,"strokeWidth",8,"1.5");var u=Rc();Z(()=>{$t(u,"stroke-width",i()),gt(u,0,wa(r()))}),l(Y,u)}var Hc=ga('<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path d="M8 12L11 15L16 10" stroke-linecap="round" stroke-linejoin="round"></path><path d="M12 22C17.5228 22 22 17.5228 22 12C22 6.47715 17.5228 2 12 2C6.47715 2 2 6.47715 2 12C2 13.8214 2.48697 15.5291 3.33782 17L2.5 21.5L7 20.6622C8.47087 21.513 10.1786 22 12 22Z" stroke-linecap="round" stroke-linejoin="round" stroke-dasharray="2.5 3.5"></path></svg>');function Vc(Y,n){let r=E(n,"className",8,"size-4"),i=E(n,"strokeWidth",8,"1.5");var u=Hc();Z(()=>{$t(u,"stroke-width",i()),gt(u,0,wa(r()))}),l(Y,u)}var Gc=ga('<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path d="M9 12H12M15 12H12M12 12V9M12 12V15" stroke-linecap="round" stroke-linejoin="round"></path><path d="M12 22C17.5228 22 22 17.5228 22 12C22 6.47715 17.5228 2 12 2C6.47715 2 2 6.47715 2 12C2 13.8214 2.48697 15.5291 3.33782 17L2.5 21.5L7 20.6622C8.47087 21.513 10.1786 22 12 22Z" stroke-linecap="round" stroke-linejoin="round"></path></svg>');function Jc(Y,n){let r=E(n,"className",8,"w-4 h-4"),i=E(n,"strokeWidth",8,"1.5");var u=Gc();Z(()=>{$t(u,"stroke-width",i()),gt(u,0,wa(r()))}),l(Y,u)}var qc=ga('<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path d="M8 12L11 15L16 10" stroke-linecap="round" stroke-linejoin="round"></path><path d="M12 22C17.5228 22 22 17.5228 22 12C22 6.47715 17.5228 2 12 2C6.47715 2 2 6.47715 2 12C2 13.8214 2.48697 15.5291 3.33782 17L2.5 21.5L7 20.6622C8.47087 21.513 10.1786 22 12 22Z" stroke-linecap="round" stroke-linejoin="round"></path></svg>');function Zc(Y,n){let r=E(n,"className",8,"w-4 h-4"),i=E(n,"strokeWidth",8,"1.5");var u=qc();Z(()=>{$t(u,"stroke-width",i()),gt(u,0,wa(r()))}),l(Y,u)}var Yc=v('<button class=" cursor-pointer flex rounded-lg hover:bg-gray-100 dark:hover:bg-gray-850 transition"><div class=" self-center p-1.5"><!></div></button>'),Kc=v('<div class="-translate-x-0.5 mr-1 mt-1 self-start flex flex-none items-center text-gray-600 dark:text-gray-400"><!></div>'),Qc=v('<button class="flex cursor-pointer px-2 py-2 rounded-xl hover:bg-gray-50 dark:hover:bg-gray-850 transition" id="temporary-chat-button"><div class=" m-auto self-center"><!></div></button>'),Xc=v('<button class="flex cursor-pointer px-2 py-2 rounded-xl hover:bg-gray-50 dark:hover:bg-gray-850 transition" id="save-temporary-chat-button"><div class=" m-auto self-center"><!></div></button>'),eu=v('<button aria-label="New Chat"><div class=" m-auto self-center"><!></div></button>'),tu=v('<button class="flex cursor-pointer px-2 py-2 rounded-xl hover:bg-gray-50 dark:hover:bg-gray-850 transition" id="chat-context-menu-button"><div class=" m-auto self-center"><!></div></button>'),au=v('<button class=" flex cursor-pointer px-2 py-2 rounded-xl hover:bg-gray-50 dark:hover:bg-gray-850 transition" aria-label="Controls"><div class=" m-auto self-center"><!></div></button>'),ru=v('<div class="select-none flex rounded-xl p-1.5 w-full hover:bg-gray-50 dark:hover:bg-gray-850 transition"><div class=" self-center"><span class="sr-only"> </span> <img class="size-6 object-cover rounded-full" alt="" draggable="false"/></div></div>'),su=v('<div class=" w-full z-30 text-center"><div class="text-xs text-gray-500"> </div></div>'),ou=v('<div class=" w-full z-30"><div class=" flex flex-col gap-1 w-full"><!> <!> <!></div></div>'),nu=v('<!> <button id="new-chat-button" class="hidden" aria-label="New Chat"></button> <nav><div class="flex items-center w-full pl-1.5 pr-1"><div id="navbar-bg-gradient-to-b"></div> <div class=" flex max-w-full w-full mx-auto px-1.5 md:px-2 pt-0.5 bg-transparent"><div class="flex items-center w-full max-w-full"><!> <div><!></div> <div class="self-start flex flex-none items-center text-gray-600 dark:text-gray-400"><!> <!> <!> <!> <!></div></div></div></div> <!> <div class="absolute top-[100%] left-0 right-0 h-fit"><!></div></nav>',1);function lu(Y,n){Xt(n,!1);const r=()=>ze(Va,"$chatId",O),i=()=>ze(Qr,"$mobile",O),u=()=>ze(fs,"$showSidebar",O),S=()=>ze(X,"$i18n",O),w=()=>ze(Ka,"$user",O),y=()=>ze(Ra,"$settings",O),pe=()=>ze(Pa,"$temporaryChatEnabled",O),h=()=>ze(ra,"$showControls",O),T=()=>ze(Ho,"$banners",O),M=()=>ze(xr,"$config",O),[O,C]=na(),X=la("i18n");let ge=E(n,"initNewChat",8),ae=E(n,"shareEnabled",8,!1);E(n,"scrollTop",8,0);let Re=E(n,"chat",8),Pe=E(n,"history",8),ve=E(n,"selectedModels",12),D=E(n,"showModelSelector",8,!0),Ae=E(n,"onSaveTempChat",8),_=E(n,"archiveChatHandler",8),we=E(n,"moveChatHandler",8),ee=q([]),re=q(!1);ta();var Ye=nu(),J=ke(Ye);cl(J,{get chatId(){return r()},get show(){return e(re)},set show(A){s(re,A)},$$legacy:!0});var L=m(J,2),k=m(L,2),g=a(k),f=a(g),$=m(f,2),I=a($),ye=a(I);{var Ce=A=>{var G=Kc(),j=a(G);{let z=$e(()=>(u(),S(),o(()=>u()?S().t("Close Sidebar"):S().t("Open Sidebar"))));mt(j,{get content(){return e(z)},children:(R,K)=>{var oe=Yc(),ue=a(oe),Ee=a(ue);yl(Ee,{}),t(ue),t(oe),Qe("click",oe,()=>{fs.set(!u())}),l(R,oe)},$$slots:{default:!0}})}t(G),l(A,G)};N(ye,A=>{i()&&!u()&&A(Ce)})}var de=m(ye,2),Me=a(de);{var xe=A=>{{let G=$e(()=>!ae());_c(A,{get showSetDefault(){return e(G)},get selectedModels(){return ve()},set selectedModels(j){ve(j)},$$legacy:!0})}};N(Me,A=>{D()&&A(xe)})}t(de);var Ge=m(de,2),We=a(Ge);{var me=A=>{var G=ct(),j=ke(G);{var z=K=>{{let oe=$e(()=>(S(),o(()=>S().t("Temporary Chat"))));mt(K,{get content(){return e(oe)},children:(ue,Ee)=>{var Oe=Qc(),qe=a(Oe),W=a(qe);{var se=Fe=>{Vc(Fe,{className:" size-4.5",strokeWidth:"1.5"})},ne=Fe=>{Wc(Fe,{className:" size-4.5",strokeWidth:"1.5"})};N(W,Fe=>{pe()?Fe(se):Fe(ne,!1)})}t(qe),t(Oe),Qe("click",Oe,async()=>{var Fe;(((Fe=y())==null?void 0:Fe.temporaryChatByDefault)??!1)&&pe()?await Pa.set(null):await Pa.set(!pe()),await Sr("/"),pe()?window.history.replaceState(null,"","?temporary-chat=true"):window.history.replaceState(null,"",location.pathname)}),l(ue,Oe)},$$slots:{default:!0}})}},R=K=>{var oe=ct(),ue=ke(oe);{var Ee=Oe=>{{let qe=$e(()=>(S(),o(()=>S().t("Save Chat"))));mt(Oe,{get content(){return e(qe)},children:(W,se)=>{var ne=Xc(),Fe=a(ne),Ze=a(Fe);Zc(Ze,{className:" size-4.5",strokeWidth:"1.5"}),t(Fe),t(ne),Qe("click",ne,async()=>{Ae()()}),l(W,ne)},$$slots:{default:!0}})}};N(ue,Oe=>{pe()&&Oe(Ee)},!0)}l(K,oe)};N(j,K=>{B(Re()),o(()=>{var oe;return!((oe=Re())!=null&&oe.id)})?K(z):K(R,!1)})}l(A,G)};N(We,A=>{w(),o(()=>{var G,j,z,R,K,oe,ue;return((G=w())==null?void 0:G.role)==="user"?(((R=(z=(j=w())==null?void 0:j.permissions)==null?void 0:z.chat)==null?void 0:R.temporary)??!0)&&!(((ue=(oe=(K=w())==null?void 0:K.permissions)==null?void 0:oe.chat)==null?void 0:ue.temporary_enforced)??!1):!0})&&A(me)})}var x=m(We,2);{var Ie=A=>{{let G=$e(()=>(S(),o(()=>S().t("New Chat"))));mt(A,{get content(){return e(G)},children:(j,z)=>{var R=eu(),K=a(R),oe=a(K);Jc(oe,{className:" size-4.5",strokeWidth:"1.5"}),t(K),t(R),Z(()=>gt(R,1,` flex ${u()?"md:hidden":""} cursor-pointer px-2 py-2 rounded-xl text-gray-600 dark:text-gray-400 hover:bg-gray-50 dark:hover:bg-gray-850 transition`)),Qe("click",R,()=>{ge()()}),l(j,R)},$$slots:{default:!0}})}};N(x,A=>{i(),pe(),B(Re()),o(()=>i()&&!pe()&&Re()&&Re().id)&&A(Ie)})}var He=m(x,2);{var Se=A=>{Uc(A,{get chat(){return Re()},get shareEnabled(){return ae()},shareHandler:()=>{s(re,!e(re))},archiveChatHandler:()=>{_()(Re().id)},get moveChatHandler(){return we()},children:(G,j)=>{var z=tu(),R=a(z),K=a(R);no(K,{className:" size-5",strokeWidth:"1.5"}),t(R),t(z),l(G,z)},$$slots:{default:!0}})};N(He,A=>{B(ae()),B(Re()),pe(),o(()=>ae()&&Re()&&(Re().id||pe()))&&A(Se)})}var he=m(He,2);{var U=A=>{{let G=$e(()=>(S(),o(()=>S().t("Controls"))));mt(A,{get content(){return e(G)},children:(j,z)=>{var R=au(),K=a(R),oe=a(K);Zr(oe,{className:" size-5",strokeWidth:"1"}),t(K),t(R),Qe("click",R,async()=>{await ra.set(!h())}),l(j,R)},$$slots:{default:!0}})}};N(he,A=>{w(),o(()=>{var G,j,z;return((G=w())==null?void 0:G.role)==="admin"||(((z=(j=w())==null?void 0:j.permissions.chat)==null?void 0:z.controls)??!0)})&&A(U)})}var H=m(he,2);{var De=A=>{{let G=$e(()=>(w(),o(()=>{var j;return(j=w())==null?void 0:j.role})));hl(A,{className:"max-w-[240px]",get role(){return e(G)},help:!0,$$events:{show:j=>{j.detail==="archived-chat"&&Vo.set(!0)}},children:(j,z)=>{var R=ru(),K=a(R),oe=a(K),ue=a(oe,!0);t(oe);var Ee=m(oe,2);t(K),t(R),Z(Oe=>{Le(ue,Oe),$t(Ee,"src",(B(Fa),w(),o(()=>{var qe;return`${Fa}/users/${(qe=w())==null?void 0:qe.id}/profile/image`})))},[()=>(S(),o(()=>S().t("User menu")))]),l(j,R)},$$slots:{default:!0}})}};N(H,A=>{w()!==void 0&&w()!==null&&A(De)})}t(Ge),t(I),t($),t(g);var Te=m(g,2);{var Je=A=>{var G=su(),j=a(G),z=a(j,!0);t(j),t(G),Z(R=>Le(z,R),[()=>(S(),o(()=>S().t("Temporary Chat")))]),l(A,G)};N(Te,A=>{pe(),r(),o(()=>pe()&&(r()??"").startsWith("local:"))&&A(Je)})}var V=m(Te,2),_e=a(V);{var d=A=>{var G=ou(),j=a(G),z=a(j);{var R=Ee=>{{let Oe=$e(()=>(S(),o(()=>({type:"info",title:"Trial License",content:S().t("You are currently using a trial license. Please contact support to upgrade your license.")}))));ds(Ee,{get banner(){return e(Oe)}})}};N(z,Ee=>{M(),o(()=>{var Oe,qe;return(((qe=(Oe=M())==null?void 0:Oe.license_metadata)==null?void 0:qe.type)??null)==="trial"})&&Ee(R)})}var K=m(z,2);{var oe=Ee=>{{let Oe=$e(()=>(S(),o(()=>({type:"error",title:"License Error",content:S().t("Exceeded the number of seats in your license. Please contact support to increase the number of seats.")}))));ds(Ee,{get banner(){return e(Oe)}})}};N(K,Ee=>{M(),o(()=>{var Oe,qe,W,se,ne;return(((qe=(Oe=M())==null?void 0:Oe.license_metadata)==null?void 0:qe.seats)??null)!==null&&((W=M())==null?void 0:W.user_count)>((ne=(se=M())==null?void 0:se.license_metadata)==null?void 0:ne.seats)})&&Ee(oe)})}var ue=m(K,2);ua(ue,1,()=>(T(),e(ee),o(()=>T().filter(Ee=>![...JSON.parse(localStorage.getItem("dismissedBannerIds")??"[]"),...e(ee)].includes(Ee.id)))),Ee=>Ee.id,(Ee,Oe)=>{ds(Ee,{get banner(){return e(Oe)},$$events:{dismiss:qe=>{const W=qe.detail;e(Oe).dismissible?localStorage.setItem("dismissedBannerIds",JSON.stringify([W,...JSON.parse(localStorage.getItem("dismissedBannerIds")??"[]")].filter(se=>T().find(ne=>ne.id===se)))):s(ee,[...e(ee),W])}}})}),t(j),t(G),l(A,G)};N(_e,A=>{B(Pe()),r(),T(),M(),o(()=>{var G,j,z,R,K,oe,ue;return!Pe().currentId&&!r()&&(T().length>0||(((j=(G=M())==null?void 0:G.license_metadata)==null?void 0:j.type)??null)==="trial"||(((R=(z=M())==null?void 0:z.license_metadata)==null?void 0:R.seats)??null)!==null&&((K=M())==null?void 0:K.user_count)>((ue=(oe=M())==null?void 0:oe.license_metadata)==null?void 0:ue.seats))})&&A(d)})}t(V),t(k),Z(()=>{gt(k,1,`sticky top-0 z-30 w-full ${B(Re()),o(()=>{var A;return(A=Re())!=null&&A.id?"pt-0.5 pb-1":"pt-1 pb-1"})??""} -mb-12 flex flex-col items-center drag-region`),gt(f,1,`${B(Re()),o(()=>{var A;return(A=Re())!=null&&A.id?"visible":"invisible"})??""} bg-linear-to-b via-40% to-97% from-white/90 via-white/50 to-transparent dark:from-gray-900/90 dark:via-gray-900/50 dark:to-transparent pointer-events-none absolute inset-0 -bottom-10 z-[-1]`),gt(de,1,`flex-1 overflow-hidden max-w-full py-0.5
			${u()?"ml-1":""}
			`)}),Qe("click",L,()=>{ge()()}),l(Y,Ye),ea(),C()}var iu=v('<option class="bg-gray-100 dark:bg-gray-800"> </option>'),du=v('<option selected disabled class="bg-gray-100 dark:bg-gray-800"> </option> <!>',1),cu=v('<option class="bg-gray-100 dark:bg-gray-800"> </option>'),uu=v('<option selected disabled class="bg-gray-100 dark:bg-gray-800"> </option> <!>',1),vu=v('<hr class="border-gray-50/30 dark:border-gray-800/30 my-1 w-full"/> <div class="my-2 text-xs"><!></div>',1),fu=v('<form class="flex flex-col h-full justify-between space-y-3 text-sm"><div class="flex flex-col"><div class="space-y-1"><div class="flex gap-2"><div class="flex-1"><select class="  w-full rounded-sm text-xs py-2 px-1 bg-transparent outline-hidden"><option class="bg-gray-100 dark:bg-gray-800"> </option><option class="bg-gray-100 dark:bg-gray-800"> </option></select></div> <div class="flex-1"><select class="w-full rounded-sm py-2 px-1 text-xs bg-transparent outline-hidden"><!></select></div></div></div> <!></div></form>');function gu(Y,n){Xt(n,!1);const r=()=>ze(pe,"$i18n",S),i=()=>ze(qr,"$functions",S),u=()=>ze(Za,"$tools",S),[S,w]=na(),y=ar(),pe=la("i18n");let h=E(n,"show",8,!1),T=q("tools"),M=q(""),O=q(!1),C=q(null),X=q({}),ge;const ae=async()=>{ge&&clearTimeout(ge),ge=setTimeout(()=>{Pe()},500)},Re=async()=>{var ee;if(s(O,!0),e(T)==="tools"?(s(X,await Nn(localStorage.token,e(M))),s(C,await An(localStorage.token,e(M)))):e(T)==="functions"&&(s(X,await Dn(localStorage.token,e(M))),s(C,await Bn(localStorage.token,e(M)))),e(C))for(const re in e(C).properties)((ee=e(C).properties[re])==null?void 0:ee.type)==="array"&&Pt(X,e(X)[re]=(e(X)[re]??[]).join(","));s(O,!1)},Pe=async()=>{var ee;if(e(C)){for(const re in e(C).properties)((ee=e(C).properties[re])==null?void 0:ee.type)==="array"&&Pt(X,e(X)[re]=(e(X)[re]??"").split(",").map(Ye=>Ye.trim()));if(e(T)==="tools"){const re=await Ln(localStorage.token,e(M),e(X)).catch(Ye=>(at.error(`${Ye}`),null));re&&(at.success(r().t("Valves updated")),s(X,re))}else if(e(T)==="functions"){const re=await On(localStorage.token,e(M),e(X)).catch(Ye=>(at.error(`${Ye}`),null));re&&(at.success(r().t("Valves updated")),s(X,re))}}},ve=async()=>{s(O,!0),i()===null&&qr.set(await Zs(localStorage.token)),u()===null&&Za.set(await Xr(localStorage.token)),s(O,!1)};Tt(()=>e(T),()=>{e(T)&&s(M,"")}),Tt(()=>e(M),()=>{e(M)&&Re()}),Tt(()=>B(h()),()=>{h()&&ve()}),Da(),ta();var D=ct(),Ae=ke(D);{var _=ee=>{var re=fu(),Ye=a(re),J=a(Ye),L=a(J),k=a(L),g=a(k);Z(()=>{e(T),us(()=>{r()})});var f=a(g),$=a(f,!0);t(f),f.value=f.__value="tools";var I=m(f),ye=a(I,!0);t(I),I.value=I.__value="functions",t(g),t(k);var Ce=m(k,2),de=a(Ce);Z(()=>{e(M),us(()=>{e(T),r(),u(),i()})});var Me=a(de);{var xe=x=>{var Ie=du(),He=ke(Ie),Se=a(He,!0);t(He),He.value=He.__value="";var he=m(He,2);ua(he,1,()=>(u(),o(()=>u().filter(U=>{var H;return!((H=U==null?void 0:U.id)!=null&&H.startsWith("server:"))}))),Ca,(U,H)=>{var De=iu(),Te=a(De,!0);t(De);var Je={};Z(()=>{Le(Te,(e(H),o(()=>e(H).name))),Je!==(Je=(e(H),o(()=>e(H).id)))&&(De.value=(De.__value=(e(H),o(()=>e(H).id)))??"")}),l(U,De)}),Z(U=>Le(Se,U),[()=>(r(),o(()=>r().t("Select a tool")))]),l(x,Ie)},Ge=x=>{var Ie=ct(),He=ke(Ie);{var Se=he=>{var U=uu(),H=ke(U),De=a(H,!0);t(H),H.value=H.__value="";var Te=m(H,2);ua(Te,1,i,Ca,(Je,V)=>{var _e=cu(),d=a(_e,!0);t(_e);var A={};Z(()=>{Le(d,(e(V),o(()=>e(V).name))),A!==(A=(e(V),o(()=>e(V).id)))&&(_e.value=(_e.__value=(e(V),o(()=>e(V).id)))??"")}),l(Je,_e)}),Z(Je=>Le(De,Je),[()=>(r(),o(()=>r().t("Select a function")))]),l(he,U)};N(He,he=>{e(T)==="functions"&&he(Se)},!0)}l(x,Ie)};N(Me,x=>{e(T)==="tools"?x(xe):x(Ge,!1)})}t(de),t(Ce),t(L),t(J);var We=m(J,2);{var me=x=>{var Ie=vu(),He=m(ke(Ie),2),Se=a(He);{var he=H=>{dl(H,{get valvesSpec(){return e(C)},get valves(){return e(X)},set valves(De){s(X,De)},$$events:{change:()=>{ae()}},$$legacy:!0})},U=H=>{Sa(H,{className:"size-5"})};N(Se,H=>{e(O)?H(U,!1):H(he)})}t(He),l(x,Ie)};N(We,x=>{e(M)&&x(me)})}t(Ye),t(re),Z((x,Ie,He)=>{$t(g,"placeholder",x),Le($,Ie),Le(ye,He)},[()=>(r(),o(()=>r().t("Select"))),()=>(r(),o(()=>r().t("Tools"))),()=>(r(),o(()=>r().t("Functions")))]),Is(g,()=>e(T),x=>s(T,x)),Is(de,()=>e(M),x=>s(M,x)),Qe("change",de,async()=>{await ot()}),Qe("submit",re,pr(()=>{Pe(),y("save")})),l(ee,re)},we=ee=>{Sa(ee,{className:"size-4"})};N(Ae,ee=>{h()&&!e(O)?ee(_):ee(we,!1)})}l(Y,D),ea(),w()}var mu=v('<div class="flex flex-col gap-1 mt-1.5" slot="content"></div>'),pu=v('<!> <hr class="my-2 border-gray-50 dark:border-gray-700/10"/>',1),hu=v('<div class="text-sm" slot="content"><!></div>'),_u=v('<!> <hr class="my-2 border-gray-50 dark:border-gray-700/10"/>',1),wu=v('<div slot="content"><textarea rows="4"></textarea></div>'),yu=v('<!> <hr class="my-2 border-gray-50 dark:border-gray-700/10"/>',1),bu=v('<div class="text-sm mt-1.5" slot="content"><div><!></div></div>'),xu=v('<div class=" dark:text-gray-200 text-sm font-primary py-0.5 px-0.5"><!> <!> <!> <!></div>'),$u=v('<div class=" dark:text-white"><div class=" flex items-center justify-between dark:text-gray-100 mb-2"><div class=" text-lg font-medium self-center font-primary"> </div> <button class="self-center"><!></button></div> <!></div>');function Rs(Y,n){Xt(n,!1);const r=()=>ze(pe,"$i18n",S),i=()=>ze(Ka,"$user",S),u=()=>ze(Ra,"$settings",S),[S,w]=na(),y=ar(),pe=la("i18n");E(n,"models",24,()=>[]);let h=E(n,"chatFiles",28,()=>[]),T=E(n,"params",28,()=>({})),M=q(!1);ta();var O=$u(),C=a(O),X=a(C),ge=a(X,!0);t(X);var ae=m(X,2),Re=a(ae);Ga(Re,{className:"size-3.5"}),t(ae),t(C);var Pe=m(C,2);{var ve=D=>{var Ae=xu(),_=a(Ae);{var we=g=>{var f=pu(),$=ke(f);{let I=$e(()=>(r(),o(()=>r().t("Files"))));yr($,{get title(){return e(I)},open:!0,buttonClassName:"w-full",$$slots:{content:(ye,Ce)=>{var de=mu();ua(de,5,h,Ca,(Me,xe,Ge)=>{{let We=$e(()=>(e(xe),o(()=>{var x;return(x=e(xe))!=null&&x.url?e(xe).url:null}))),me=$e(()=>(e(xe),o(()=>{var x;return(x=e(xe))==null?void 0:x.size})));eo(Me,{className:"w-full",get item(){return e(xe)},edit:!0,get url(){return e(We)},get name(){return e(xe),o(()=>e(xe).name)},get type(){return e(xe),o(()=>e(xe).type)},get size(){return e(me)},dismissible:!0,small:!0,$$events:{dismiss:()=>{h().splice(Ge,1),h(h())},click:()=>{e(xe)}}})}}),t(de),l(ye,de)}}})}nr(2),l(g,f)};N(_,g=>{B(h()),o(()=>h().length>0)&&g(we)})}var ee=m(_,2);{var re=g=>{var f=_u(),$=ke(f);{let I=$e(()=>(r(),o(()=>r().t("Valves"))));yr($,{get title(){return e(I)},buttonClassName:"w-full",get open(){return e(M)},set open(ye){s(M,ye)},$$slots:{content:(ye,Ce)=>{var de=hu(),Me=a(de);gu(Me,{get show(){return e(M)}}),t(de),l(ye,de)}},$$legacy:!0})}nr(2),l(g,f)};N(ee,g=>{i(),o(()=>{var f,$,I;return((f=i())==null?void 0:f.role)==="admin"||(((I=($=i())==null?void 0:$.permissions.chat)==null?void 0:I.valves)??!0)})&&g(re)})}var Ye=m(ee,2);{var J=g=>{var f=yu(),$=ke(f);{let I=$e(()=>(r(),o(()=>r().t("System Prompt"))));yr($,{get title(){return e(I)},open:!0,buttonClassName:"w-full",$$slots:{content:(ye,Ce)=>{var de=wu(),Me=a(de);Po(Me),t(de),Z(xe=>{gt(Me,1,`w-full text-xs outline-hidden resize-vertical ${u(),o(()=>u().highContrastMode?"border-2 border-gray-300 dark:border-gray-700 rounded-lg bg-gray-50 dark:bg-gray-800 p-2.5":"py-1.5 bg-transparent")??""}`),$t(Me,"placeholder",xe)},[()=>(r(),o(()=>r().t("Enter system prompt")))]),Rn(Me,()=>T().system,xe=>T(T().system=xe,!0)),l(ye,de)}}})}nr(2),l(g,f)};N(Ye,g=>{i(),o(()=>{var f,$,I;return((f=i())==null?void 0:f.role)==="admin"||(((I=($=i())==null?void 0:$.permissions.chat)==null?void 0:I.system_prompt)??!0)})&&g(J)})}var L=m(Ye,2);{var k=g=>{{let f=$e(()=>(r(),o(()=>r().t("Advanced Params"))));yr(g,{get title(){return e(f)},open:!0,buttonClassName:"w-full",$$slots:{content:($,I)=>{var ye=bu(),Ce=a(ye),de=a(Ce);{let Me=$e(()=>(i(),o(()=>{var xe;return((xe=i())==null?void 0:xe.role)==="admin"})));bl(de,{get admin(){return e(Me)},custom:!0,get params(){return T()},set params(xe){T(xe)},$$legacy:!0})}t(Ce),t(ye),l($,ye)}}})}};N(L,g=>{i(),o(()=>{var f,$,I;return((f=i())==null?void 0:f.role)==="admin"||(((I=($=i())==null?void 0:$.permissions.chat)==null?void 0:I.params)??!0)})&&g(k)})}t(Ae),l(D,Ae)};N(Pe,D=>{i(),o(()=>{var Ae,_,we;return((Ae=i())==null?void 0:Ae.role)==="admin"||(((we=(_=i())==null?void 0:_.permissions.chat)==null?void 0:we.controls)??!0)})&&D(ve)})}t(O),Z(D=>Le(ge,D),[()=>(r(),o(()=>r().t("Chat Controls")))]),Qe("click",ae,()=>{y("close")}),l(Y,O),ea(),w()}var ku=v('<div class="flex items-center"><div class=" line-clamp-1"> </div></div>'),Cu=v('<div slot="content"><!></div>');function Iu(Y,n){Xt(n,!1),la("i18n");const r=ar();let i=E(n,"onClose",8,()=>{}),u=E(n,"devices",8),S=q(!1);ta(),as(Y,{get show(){return e(S)},set show(w){s(S,w)},$$events:{change:w=>{w.detail===!1&&i()()}},children:(w,y)=>{var pe=ct(),h=ke(pe);es(h,n,"default",{},null),l(w,pe)},$$slots:{default:!0,content:(w,y)=>{var pe=Cu(),h=a(pe);ts(h,{class:"w-full max-w-[180px] rounded-lg p-1 border border-gray-100  dark:border-gray-800 z-9999 bg-white dark:bg-gray-900 dark:text-white shadow-xs",sideOffset:6,side:"top",align:"start",get transition(){return br},children:(T,M)=>{var O=ct(),C=ke(O);ua(C,1,u,Ca,(X,ge)=>{_a(X,{class:"flex gap-2 items-center px-3 py-1.5 text-sm  cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 rounded-md",$$events:{click:()=>{r("change",e(ge).deviceId)}},children:(ae,Re)=>{var Pe=ku(),ve=a(Pe),D=a(ve,!0);t(ve),t(Pe),Z(()=>Le(D,(e(ge),o(()=>{var Ae;return((Ae=e(ge))==null?void 0:Ae.label)??"Camera"})))),l(ae,Pe)},$$slots:{default:!0}})}),l(T,O)},$$slots:{default:!0}}),t(pe),l(w,pe)}},$$legacy:!0}),ea()}var Su=v('<div class="  transition-all rounded-full"> </div>'),Eu=ga(`<svg class="size-12 text-gray-900 dark:text-gray-400" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><style>.spinner_qM83 {
								animation: spinner_8HQG 1.05s infinite;
							}
							.spinner_oXPr {
								animation-delay: 0.1s;
							}
							.spinner_ZTLf {
								animation-delay: 0.2s;
							}
							@keyframes spinner_8HQG {
								0%,
								57.14% {
									animation-timing-function: cubic-bezier(0.33, 0.66, 0.66, 1);
									transform: translate(0);
								}
								28.57% {
									animation-timing-function: cubic-bezier(0.33, 0, 0.66, 0.33);
									transform: translateY(-6px);
								}
								100% {
									transform: translate(0);
								}
							}</style><circle class="spinner_qM83" cx="4" cy="12" r="3"></circle><circle class="spinner_qM83 spinner_oXPr" cx="12" cy="12" r="3"></circle><circle class="spinner_qM83 spinner_ZTLf" cx="20" cy="12" r="3"></circle></svg>`),Mu=v("<div></div>"),Pu=v('<button type="button" class="flex justify-center items-center w-full h-20 min-h-20"><!></button>'),Tu=v('<div class="  transition-all rounded-full"> </div>'),zu=ga(`<svg class="size-44 text-gray-900 dark:text-gray-400" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><style>.spinner_qM83 {
									animation: spinner_8HQG 1.05s infinite;
								}
								.spinner_oXPr {
									animation-delay: 0.1s;
								}
								.spinner_ZTLf {
									animation-delay: 0.2s;
								}
								@keyframes spinner_8HQG {
									0%,
									57.14% {
										animation-timing-function: cubic-bezier(0.33, 0.66, 0.66, 1);
										transform: translate(0);
									}
									28.57% {
										animation-timing-function: cubic-bezier(0.33, 0, 0.66, 0.33);
										transform: translateY(-6px);
									}
									100% {
										transform: translate(0);
									}
								}</style><circle class="spinner_qM83" cx="4" cy="12" r="3"></circle><circle class="spinner_qM83 spinner_oXPr" cx="12" cy="12" r="3"></circle><circle class="spinner_qM83 spinner_ZTLf" cx="20" cy="12" r="3"></circle></svg>`),Nu=v("<div></div>"),Au=v('<button type="button"><!></button>'),Lu=v('<div class="relative flex video-container w-full max-h-full pt-2 pb-4 md:py-6 px-2 h-full"><video id="camera-feed" autoplay class="rounded-2xl h-full min-w-full object-cover object-center" playsinline=""></video> <canvas id="camera-canvas" style="display:none;"></canvas> <div class=" absolute top-4 md:top-8 left-4"><button type="button" class="p-1.5 text-white cursor-pointer backdrop-blur-xl bg-black/10 rounded-full"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" fill="currentColor" class="size-6"><path d="M5.28 4.22a.75.75 0 0 0-1.06 1.06L6.94 8l-2.72 2.72a.75.75 0 1 0 1.06 1.06L8 9.06l2.72 2.72a.75.75 0 1 0 1.06-1.06L9.06 8l2.72-2.72a.75.75 0 0 0-1.06-1.06L8 6.94 5.28 4.22Z"></path></svg></button></div></div>',2),Fu=v('<button class=" p-3 rounded-full bg-gray-50 dark:bg-gray-900" type="button"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="size-5"><path fill-rule="evenodd" d="M15.312 11.424a5.5 5.5 0 0 1-9.201 2.466l-.312-.311h2.433a.75.75 0 0 0 0-1.5H3.989a.75.75 0 0 0-.75.75v4.242a.75.75 0 0 0 1.5 0v-2.43l.31.31a7 7 0 0 0 11.712-3.138.75.75 0 0 0-1.449-.39Zm1.23-3.723a.75.75 0 0 0 .219-.53V2.929a.75.75 0 0 0-1.5 0V5.36l-.31-.31A7 7 0 0 0 3.239 8.188a.75.75 0 1 0 1.448.389A5.5 5.5 0 0 1 13.89 6.11l.311.31h-2.432a.75.75 0 0 0 0 1.5h4.243a.75.75 0 0 0 .53-.219Z" clip-rule="evenodd"></path></svg></button>'),Du=v('<button class=" p-3 rounded-full bg-gray-50 dark:bg-gray-900" type="button"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-5"><path stroke-linecap="round" stroke-linejoin="round" d="M6.827 6.175A2.31 2.31 0 0 1 5.186 7.23c-.38.054-.757.112-1.134.175C2.999 7.58 2.25 8.507 2.25 9.574V18a2.25 2.25 0 0 0 2.25 2.25h15A2.25 2.25 0 0 0 21.75 18V9.574c0-1.067-.75-1.994-1.802-2.169a47.865 47.865 0 0 0-1.134-.175 2.31 2.31 0 0 1-1.64-1.055l-.822-1.316a2.192 2.192 0 0 0-1.736-1.039 48.774 48.774 0 0 0-5.232 0 2.192 2.192 0 0 0-1.736 1.039l-.821 1.316Z"></path><path stroke-linecap="round" stroke-linejoin="round" d="M16.5 12.75a4.5 4.5 0 1 1-9 0 4.5 4.5 0 0 1 9 0ZM18.75 10.5h.008v.008h-.008V10.5Z"></path></svg></button>'),Bu=v('<div class="max-w-lg w-full h-full max-h-[100dvh] flex flex-col justify-between p-3 md:p-6"><!> <div class="flex justify-center items-center flex-1 h-full w-full max-h-full"><!></div> <div class="flex justify-between items-center pb-2 w-full"><div><!></div> <div><button type="button"><div class=" line-clamp-1 text-sm font-medium"><!></div></button></div> <div><button class=" p-3 rounded-full bg-gray-50 dark:bg-gray-900" type="button"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="size-5"><path d="M6.28 5.22a.75.75 0 0 0-1.06 1.06L8.94 10l-3.72 3.72a.75.75 0 1 0 1.06 1.06L10 11.06l3.72 3.72a.75.75 0 1 0 1.06-1.06L11.06 10l3.72-3.72a.75.75 0 0 0-1.06-1.06L10 8.94 6.28 5.22Z"></path></svg></button></div></div></div>');function Ws(Y,n){Xt(n,!1);const r=()=>ze(Ra,"$settings",pe),i=()=>ze(Ta,"$showCallOverlay",pe),u=()=>ze(xr,"$config",pe),S=()=>ze(vs,"$TTSWorker",pe),w=()=>ze(Lr,"$models",pe),y=()=>ze(M,"$i18n",pe),[pe,h]=na(),T=ar(),M=la("i18n");let O=E(n,"eventTarget",8),C=E(n,"submitPrompt",8),X=E(n,"stopResponse",8),ge=E(n,"files",12),ae=E(n,"chatId",8),Re=E(n,"modelId",8),Pe=null,ve=q(null),D=q(!1),Ae=!1,_=q(!1),we=q(null),ee=q(!1),re=q(null),Ye=!1,J=q(0),L=!1,k,g=q(null),f=[],$=q([]),I=q(null);const ye=async()=>{const W=await navigator.mediaDevices.enumerateDevices();s($,W.filter(se=>se.kind==="videoinput")),navigator.mediaDevices.getDisplayMedia&&s($,[...e($),{deviceId:"screen",label:"Screen Share"}]),e($),e(I)===null&&e($).length>0&&s(I,e($)[0].deviceId)},Ce=async()=>{if(await ye(),e(re)===null){s(ee,!0),await ot();try{await de()}catch(W){}}},de=async()=>{const W=document.getElementById("camera-feed");W&&(e(I)==="screen"?s(re,await navigator.mediaDevices.getDisplayMedia({video:{cursor:"always"},audio:!1})):s(re,await navigator.mediaDevices.getUserMedia({video:{deviceId:e(I)?{exact:e(I)}:void 0}})),e(re)&&(await ye(),W.srcObject=e(re),await W.play()))},Me=async()=>{e(re)&&e(re).getTracks().forEach(se=>se.stop()),s(re,null)},xe=()=>{const W=document.getElementById("camera-feed"),se=document.getElementById("camera-canvas");if(!se)return;const ne=se.getContext("2d");se.width=W.videoWidth,se.height=W.videoHeight,ne.drawImage(W,0,0,W.videoWidth,W.videoHeight);const Fe=se.toDataURL("image/png");return Fe},Ge=async()=>{await Me(),s(ee,!1)},We=-55,me=async W=>{var Fe,Ze,Ue;await ot();const se=dn(W,"recording.wav"),ne=await $l(localStorage.token,se,(Ue=(Ze=(Fe=r())==null?void 0:Fe.audio)==null?void 0:Ze.stt)==null?void 0:Ue.language).catch(Xe=>(at.error(`${Xe}`),null));if(ne&&(ne.text,ne.text!=="")){const Xe=await C()(ne.text,{_raw:!0})}},x=async(W=!0)=>{if(i()){const se=f.slice(0);if(f=[],k=!1,W&&Ie(),Ae){if(s(D,!0),s(we,null),e(re)){const Fe=xe();ge([{type:"image",url:Fe}])}const ne=new Blob(se,{type:"audio/wav"});await me(ne),Ae=!1,s(D,!1)}}else f=[],k=!1,e(g)&&e(g).getTracks().forEach(ne=>ne.stop()),s(g,null)},Ie=async()=>{i()&&(e(g)||s(g,await navigator.mediaDevices.getUserMedia({audio:{echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0}})),k=new MediaRecorder(e(g)),k.onstart=()=>{f=[]},k.ondataavailable=W=>{L&&f.push(W.data)},k.onstop=W=>{e(g),x()},he(e(g)))},He=async()=>{try{k&&k.stop()}catch(W){}e(g)&&(e(g).getAudioTracks().forEach(function(W){W.stop()}),s(g,null))},Se=W=>{let se=0;for(let ne=0;ne<W.length;ne++){const Fe=(W[ne]-128)/128;se+=Fe*Fe}return Math.sqrt(se/W.length)},he=W=>{const se=new AudioContext,ne=se.createMediaStreamSource(W),Fe=se.createAnalyser();Fe.minDecibels=We,ne.connect(Fe);const Ze=Fe.frequencyBinCount,Ue=new Uint8Array(Ze),Xe=new Uint8Array(Fe.fftSize);let lt=Date.now();L=!1,(()=>{const bt=()=>{var Wt;if(!k||!i())return;if(e(_)&&!(((Wt=r())==null?void 0:Wt.voiceInterruption)??!1)?(Fe.maxDecibels=0,Fe.minDecibels=-1):(Fe.minDecibels=We,Fe.maxDecibels=-30),Fe.getByteTimeDomainData(Xe),Fe.getByteFrequencyData(Ue),s(J,Se(Xe)),Ue.some(sa=>sa>0)&&(k&&k.state!=="recording"&&k.start(),L||(L=!0,_e()),lt=Date.now()),L&&Date.now()-lt>2e3&&(Ae=!0,k)){k.stop();return}window.requestAnimationFrame(bt)};window.requestAnimationFrame(bt)})()};let U={},H=null,De=null;const Te=()=>{var W,se,ne,Fe,Ze,Ue,Xe,lt,vt,bt,Ft,Wt,sa,Ht,ma,qt;return(Fe=(ne=(se=(W=e(ve))==null?void 0:W.info)==null?void 0:se.meta)==null?void 0:ne.tts)!=null&&Fe.voice?e(ve).info.meta.tts.voice:((Xe=(Ue=(Ze=r())==null?void 0:Ze.audio)==null?void 0:Ue.tts)==null?void 0:Xe.defaultVoice)===u().audio.tts.voice?((bt=(vt=(lt=r())==null?void 0:lt.audio)==null?void 0:vt.tts)==null?void 0:bt.voice)??((sa=(Wt=(Ft=u())==null?void 0:Ft.audio)==null?void 0:Wt.tts)==null?void 0:sa.voice):(qt=(ma=(Ht=u())==null?void 0:Ht.audio)==null?void 0:ma.tts)==null?void 0:qt.voice},Je=W=>i()?new Promise(se=>{let ne=[];const Fe=setInterval(async()=>{var Ze,Ue,Xe;if(ne=await speechSynthesis.getVoices(),ne.length>0){clearInterval(Fe);const lt=Te(),vt=((Ze=ne==null?void 0:ne.filter(bt=>bt.voiceURI===lt))==null?void 0:Ze.at(0))??void 0;De=new SpeechSynthesisUtterance(W),De.rate=((Xe=(Ue=r().audio)==null?void 0:Ue.tts)==null?void 0:Xe.playbackRate)??1,vt&&(De.voice=vt),speechSynthesis.speak(De),De.onend=async bt=>{await new Promise(Ft=>setTimeout(Ft,200)),se(bt)}}},100)}):Promise.resolve(),V=W=>i()?new Promise(se=>{var Fe,Ze;const ne=document.getElementById("audioElement");ne&&(ne.src=W.src,ne.muted=!0,ne.playbackRate=((Ze=(Fe=r().audio)==null?void 0:Fe.tts)==null?void 0:Ze.playbackRate)??1,ne.play().then(()=>{ne.muted=!1}).catch(Ue=>{}),ne.onended=async Ue=>{await new Promise(Xe=>setTimeout(Xe,100)),se(Ue)})}):Promise.resolve(),_e=async()=>{s(_,!1),Ye&&X()(),De&&(speechSynthesis.cancel(),De=null);const W=document.getElementById("audioElement");W&&(W.muted=!0,W.pause(),W.currentTime=0)};let d=new AbortController;const A=new Map,G=new Map,j=async W=>{var se,ne,Fe;if(!A.has(W))try{if(((se=r())==null?void 0:se.showEmojiInCall)??!1){const Ze=await Sn(localStorage.token,Re(),W,ae());Ze&&G.set(W,Ze)}if(((Fe=(ne=r().audio)==null?void 0:ne.tts)==null?void 0:Fe.engine)==="browser-kokoro"){const Ze=await S().generate({text:W,voice:Te()}).catch(Ue=>{at.error(`${Ue}`)});Ze&&A.set(W,new Audio(Ze))}else if(u().audio.tts.engine!==""){const Ze=await xl(localStorage.token,Te(),W).catch(Ue=>null);if(Ze){const Ue=await Ze.blob(),Xe=URL.createObjectURL(Ue);A.set(W,new Audio(Xe))}}else A.set(W,!0)}catch(Ze){}return A.get(W)};let z={};const R=async(W,se)=>{var ne;for(;!se.aborted;)if(z[W]&&z[W].length>0){const Fe=z[W].shift();if(A.has(Fe))if((((ne=r())==null?void 0:ne.showEmojiInCall)??!1)&&G.has(Fe)?s(we,G.get(Fe)):s(we,null),u().audio.tts.engine!=="")try{`${Fe}`;const Ze=A.get(Fe);await V(Ze),`${Fe}`,await new Promise(Ue=>setTimeout(Ue,200))}catch(Ze){}else await Je(Fe);else z[W].unshift(Fe),`${Fe}`,await new Promise(Ze=>setTimeout(Ze,200))}else if(U[W]&&z[W]&&z[W].length===0){s(_,!1);break}else await new Promise(Fe=>setTimeout(Fe,200));`${W}`},K=async W=>{const{id:se}=W.detail;Ye=!0,H!==se&&(`${se}`,H=se,d&&d.abort(),d=new AbortController,s(_,!0),R(se,d.signal))},oe=async W=>{const{id:se,content:ne}=W.detail;if(H===se){`${se}${ne}`;try{z[se]===void 0?z[se]=[ne]:z[se].push(ne),j(ne)}catch(Fe){}}},ue=async W=>{const{id:se,content:ne}=W.detail;U[se]=!0,Ye=!1};Ya(async()=>{const W=async()=>{try{Pe=await navigator.wakeLock.request("screen")}catch(se){}Pe&&Pe.addEventListener("release",()=>{})};return"wakeLock"in navigator&&(await W(),document.addEventListener("visibilitychange",async()=>{Pe!==null&&document.visibilityState==="visible"&&await W()})),s(ve,w().find(se=>se.id===Re())),Ie(),O().addEventListener("chat:start",K),O().addEventListener("chat",oe),O().addEventListener("chat:finish",ue),async()=>{await _e(),He(),O().removeEventListener("chat:start",K),O().removeEventListener("chat",oe),O().removeEventListener("chat:finish",ue),d.abort(),await ot(),await _e(),await x(!1),await Ge()}}),Yr(async()=>{await _e(),await x(!1),await Ge(),await He(),O().removeEventListener("chat:start",K),O().removeEventListener("chat",oe),O().removeEventListener("chat:finish",ue),d.abort(),await ot(),await _e()}),ta();var Ee=ct(),Oe=ke(Ee);{var qe=W=>{var se=Bu(),ne=a(se);{var Fe=Ot=>{var It=Pu(),ia=a(It);{var ka=Vt=>{var Rt=Su(),ya=a(Rt,!0);t(Rt),Z(()=>{hr(Rt,`font-size:${e(J)*100>4?"4.5":e(J)*100>2?"4.25":e(J)*100>1?"3.75":"3.5"}rem;width: 100%; text-align:center;`),Le(ya,e(we))}),l(Vt,Rt)},Ia=Vt=>{var Rt=ct(),ya=ke(Rt);{var Xa=pa=>{var ha=Eu();l(pa,ha)},rr=pa=>{var ha=Mu();Z(()=>{gt(ha,1,` ${e(J)*100>4?" size-[4.5rem]":e(J)*100>2?" size-16":e(J)*100>1?"size-14":"size-12"}  transition-all rounded-full bg-cover bg-center bg-no-repeat`),hr(ha,(B(Fa),e(ve),y(),o(()=>{var p;return`background-image: url('${Fa}/models/model/profile/image?id=${(p=e(ve))==null?void 0:p.id}&lang=${y().language}&voice=true');`})))}),l(pa,ha)};N(ya,pa=>{e(D)||e(_)?pa(Xa):pa(rr,!1)},!0)}l(Vt,Rt)};N(ia,Vt=>{e(we)?Vt(ka):Vt(Ia,!1)})}t(It),Qe("click",It,()=>{e(_)&&_e()}),l(Ot,It)};N(ne,Ot=>{e(ee)&&Ot(Fe)})}var Ze=m(ne,2),Ue=a(Ze);{var Xe=Ot=>{var It=Au(),ia=a(It);{var ka=Vt=>{var Rt=Tu(),ya=a(Rt,!0);t(Rt),Z(()=>{hr(Rt,`font-size:${e(J)*100>4?"13":e(J)*100>2?"12":e(J)*100>1?"11.5":"11"}rem;width:100%;text-align:center;`),Le(ya,e(we))}),l(Vt,Rt)},Ia=Vt=>{var Rt=ct(),ya=ke(Rt);{var Xa=pa=>{var ha=zu();l(pa,ha)},rr=pa=>{var ha=Nu();Z(()=>{gt(ha,1,` ${e(J)*100>4?" size-52":e(J)*100>2?"size-48":e(J)*100>1?"size-44":"size-40"} transition-all rounded-full bg-cover bg-center bg-no-repeat`),hr(ha,(B(Fa),e(ve),y(),o(()=>{var p;return`background-image: url('${Fa}/models/model/profile/image?id=${(p=e(ve))==null?void 0:p.id}&lang=${y().language}&voice=true');`})))}),l(pa,ha)};N(ya,pa=>{e(D)||e(_)?pa(Xa):pa(rr,!1)},!0)}l(Vt,Rt)};N(ia,Vt=>{e(we)?Vt(ka):Vt(Ia,!1)})}t(It),Qe("click",It,()=>{e(_)&&_e()}),l(Ot,It)},lt=Ot=>{var It=Lu(),ia=m(a(It),4),ka=a(ia);t(ia),t(It),Qe("click",ka,()=>{Ge()}),l(Ot,It)};N(Ue,Ot=>{e(ee)?Ot(lt,!1):Ot(Xe)})}t(Ze);var vt=m(Ze,2),bt=a(vt),Ft=a(bt);{var Wt=Ot=>{Iu(Ot,{get devices(){return e($)},$$events:{change:async It=>{It.detail,s(I,It.detail),await Me(),await de()}},children:(It,ia)=>{var ka=Fu();l(It,ka)},$$slots:{default:!0}})},sa=Ot=>{{let It=$e(()=>(y(),o(()=>y().t("Camera"))));mt(Ot,{get content(){return e(It)},children:(ia,ka)=>{var Ia=Du();Qe("click",Ia,async()=>{await navigator.mediaDevices.getUserMedia({video:!0}),Ce()}),l(ia,Ia)},$$slots:{default:!0}})}};N(Ft,Ot=>{e(ee)?Ot(Wt):Ot(sa,!1)})}t(bt);var Ht=m(bt,2),ma=a(Ht),qt=a(ma),cr=a(qt);{var ur=Ot=>{var It=Ir();Z(ia=>Le(It,ia),[()=>(y(),o(()=>y().t("Thinking...")))]),l(Ot,It)},vr=Ot=>{var It=ct(),ia=ke(It);{var ka=Vt=>{var Rt=Ir();Z(ya=>Le(Rt,ya),[()=>(y(),o(()=>y().t("Tap to interrupt")))]),l(Vt,Rt)},Ia=Vt=>{var Rt=Ir();Z(ya=>Le(Rt,ya),[()=>(y(),o(()=>y().t("Listening...")))]),l(Vt,Rt)};N(ia,Vt=>{e(_)?Vt(ka):Vt(Ia,!1)},!0)}l(Ot,It)};N(cr,Ot=>{e(D)?Ot(ur):Ot(vr,!1)})}t(qt),t(ma),t(Ht);var Qa=m(Ht,2),fr=a(Qa);t(Qa),t(vt),t(se),Qe("click",ma,()=>{e(_)&&_e()}),Qe("click",fr,async()=>{await He(),await Me(),e(g),e(re),Ta.set(!1),T("close")}),l(W,se)};N(Oe,W=>{i()&&W(qe)})}l(Y,Ee),ea(),h()}var Ou=ga('<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M3.75 3.75v4.5m0-4.5h4.5m-4.5 0L9 9M3.75 20.25v-4.5m0 4.5h4.5m-4.5 0L9 15M20.25 3.75h-4.5m4.5 0v4.5m0-4.5L15 9m5.25 11.25h-4.5m4.5 0v-4.5m0 4.5L15 15"></path></svg>');function ju(Y,n){let r=E(n,"className",8,"size-4"),i=E(n,"strokeWidth",8,"1.5");var u=Ou();Z(()=>{$t(u,"stroke-width",i()),gt(u,0,wa(r()))}),l(Y,u)}var Uu=v('<button class=" bg-none border-none text-xs bg-gray-50 hover:bg-gray-100 dark:bg-gray-850 dark:hover:bg-gray-800 transition rounded-md p-0.5"><!></button>'),Ru=v('<button class=" bg-none border-none text-xs bg-gray-50 hover:bg-gray-100 dark:bg-gray-850 dark:hover:bg-gray-800 transition rounded-md p-0.5"><!></button>'),Wu=v('<div class="pointer-events-auto z-20 flex justify-between items-center p-2.5 font-primar text-gray-900 dark:text-white"><div class="flex-1 flex items-center justify-between pr-1"><div class="flex items-center space-x-2"><div class="flex items-center gap-0.5 self-center min-w-fit" dir="ltr"><button class="self-center p-1 hover:bg-black/5 dark:hover:bg-white/5 dark:hover:text-white hover:text-black rounded-md transition disabled:cursor-not-allowed"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5" class="size-3.5"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 19.5 8.25 12l7.5-7.5"></path></svg></button> <div class="text-xs self-center dark:text-gray-100 min-w-fit"> </div> <button class="self-center p-1 hover:bg-black/5 dark:hover:bg-white/5 dark:hover:text-white hover:text-black rounded-md transition disabled:cursor-not-allowed"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5" class="size-3.5"><path stroke-linecap="round" stroke-linejoin="round" d="m8.25 4.5 7.5 7.5-7.5 7.5"></path></svg></button></div></div> <div class="flex items-center gap-1.5"><button class="copy-code-button bg-none border-none text-xs bg-gray-50 hover:bg-gray-100 dark:bg-gray-850 dark:hover:bg-gray-800 transition rounded-md px-1.5 py-0.5"> </button> <!> <!></div></div> <button class="self-center pointer-events-auto p-1 rounded-full bg-white dark:bg-gray-850"><!></button></div>'),Hu=v('<div class=" absolute top-0 left-0 right-0 bottom-0 z-10"></div>'),Vu=v('<iframe title="Content" class="w-full border-0 h-full rounded-none"></iframe>'),Gu=v('<div class="max-w-full w-full h-full"><!></div>'),Ju=v('<div class="m-auto font-medium text-xs text-gray-900 dark:text-white"> </div>'),qu=v('<div class=" w-full h-full relative flex flex-col bg-white dark:bg-gray-850" id="artifacts-container"><div class="w-full h-full flex flex-col flex-1 relative"><!> <!> <div class="flex-1 w-full h-full"><div class=" h-full flex flex-col"><!></div></div></div></div>');function Hs(Y,n){Xt(n,!1);const r=()=>ze(Va,"$chatId",S),i=()=>ze(y,"$i18n",S),u=()=>ze(Ra,"$settings",S),[S,w]=na(),y=la("i18n"),pe=ar();let h=E(n,"overlay",8,!1),T=q([]),M=q(0),O=q(!1),C=q();function X(k){s(M,k==="prev"?Math.max(e(M)-1,0):Math.min(e(M)+1,e(T).length-1))}const ge=()=>{e(C).contentWindow.addEventListener("click",function(k){const g=k.target.closest("a");if(g&&g.href){k.preventDefault();const f=new URL(g.href,e(C).baseURI);f.origin===window.location.origin?e(C).contentWindow.history.pushState(null,"",f.pathname+f.search+f.hash):console.info("External navigation blocked:",f.href)}},!0),e(C).contentWindow.addEventListener("mouseenter",function(k){k.preventDefault(),e(C).contentWindow.addEventListener("dragstart",g=>{g.preventDefault()})})},ae=()=>{e(C).requestFullscreen?e(C).requestFullscreen():e(C).webkitRequestFullscreen?e(C).webkitRequestFullscreen():e(C).msRequestFullscreen&&e(C).msRequestFullscreen()},Re=()=>{const k=new Blob([e(T)[e(M)].content],{type:"text/html"}),g=URL.createObjectURL(k),f=document.createElement("a");f.href=g,f.download=`artifact-${r()}-${e(M)}.html`,document.body.appendChild(f),f.click(),document.body.removeChild(f),URL.revokeObjectURL(g)};Ya(()=>{Go.subscribe(k=>{if(e(T)){const g=e(T).findIndex(f=>f.content.includes(k));s(M,g!==-1?g:0)}}),Er.subscribe(k=>{s(T,k),e(T),e(T).length===0&&(ra.set(!1),qa.set(!1)),s(M,e(T)?e(T).length-1:0)})}),ta();var Pe=qu(),ve=a(Pe),D=a(ve);{var Ae=k=>{var g=Wu(),f=a(g),$=a(f),I=a($),ye=a(I),Ce=m(ye,2),de=a(Ce,!0);t(Ce);var Me=m(Ce,2);t(I),t($);var xe=m($,2),Ge=a(xe),We=a(Ge,!0);t(Ge);var me=m(Ge,2);{let he=$e(()=>(i(),o(()=>i().t("Download"))));mt(me,{get content(){return e(he)},children:(U,H)=>{var De=Uu(),Te=a(De);oo(Te,{className:"size-3.5"}),t(De),Qe("click",De,Re),l(U,De)},$$slots:{default:!0}})}var x=m(me,2);{var Ie=he=>{{let U=$e(()=>(i(),o(()=>i().t("Open in full screen"))));mt(he,{get content(){return e(U)},children:(H,De)=>{var Te=Ru(),Je=a(Te);ju(Je,{className:"size-3.5"}),t(Te),Qe("click",Te,ae),l(H,Te)},$$slots:{default:!0}})}};N(x,he=>{e(T),e(M),o(()=>e(T)[e(M)].type==="iframe")&&he(Ie)})}t(xe),t(f);var He=m(f,2),Se=a(He);Ga(Se,{className:"size-3.5 text-gray-900 dark:text-white"}),t(He),t(g),Z((he,U)=>{ye.disabled=(e(T),o(()=>e(T).length<=1)),Le(de,he),Me.disabled=(e(T),o(()=>e(T).length<=1)),I.dir=I.dir,Le(We,U)},[()=>(i(),e(M),e(T),o(()=>i().t("Version {{selectedVersion}} of {{totalVersions}}",{selectedVersion:e(M)+1,totalVersions:e(T).length}))),()=>(e(O),i(),o(()=>e(O)?i().t("Copied"):i().t("Copy")))]),Qe("click",ye,()=>X("prev")),Qe("click",Me,()=>X("next")),Qe("click",Ge,()=>{bs(e(T)[e(M)].content),s(O,!0),setTimeout(()=>{s(O,!1)},2e3)}),Qe("click",He,()=>{pe("close"),ra.set(!1),qa.set(!1)}),l(k,g)};N(D,k=>{e(T),o(()=>e(T).length>0)&&k(Ae)})}var _=m(D,2);{var we=k=>{var g=Hu();l(k,g)};N(_,k=>{h()&&k(we)})}var ee=m(_,2),re=a(ee),Ye=a(re);{var J=k=>{var g=Gu(),f=a(g);{var $=ye=>{var Ce=Vu();Ja(Ce,de=>s(C,de),()=>e(C)),Z(()=>{$t(Ce,"srcdoc",(e(T),e(M),o(()=>e(T)[e(M)].content))),$t(Ce,"sandbox",`allow-scripts allow-downloads${u(),o(()=>{var de;return((de=u())==null?void 0:de.iframeSandboxAllowForms)??!1?" allow-forms":""})??""}${u(),o(()=>{var de;return((de=u())==null?void 0:de.iframeSandboxAllowSameOrigin)??!1?" allow-same-origin":""})??""}`)}),Qe("load",Ce,ge),l(ye,Ce)},I=ye=>{var Ce=ct(),de=ke(Ce);{var Me=xe=>{ol(xe,{className:" w-full h-full max-h-full overflow-hidden",get svg(){return e(T),e(M),o(()=>e(T)[e(M)].content)}})};N(de,xe=>{e(T),e(M),o(()=>e(T)[e(M)].type==="svg")&&xe(Me)},!0)}l(ye,Ce)};N(f,ye=>{e(T),e(M),o(()=>e(T)[e(M)].type==="iframe")?ye($):ye(I,!1)})}t(g),l(k,g)},L=k=>{var g=Ju(),f=a(g,!0);t(g),Z($=>Le(f,$),[()=>(i(),o(()=>i().t("No HTML, CSS, or JavaScript content found.")))]),l(k,g)};N(Ye,k=>{e(T),o(()=>e(T).length>0)?k(J):k(L,!1)})}t(re),t(ee),t(ve),t(Pe),l(Y,Pe),ea(),w()}var Zu=v('<div class=" absolute top-0 left-0 right-0 bottom-0 z-10"></div>'),Yu=v('<div class="h-full w-full"><div class="pointer-events-auto z-20 flex justify-between items-center py-3 px-2 font-primar text-gray-900 dark:text-white"><div class="flex-1 flex items-center justify-between pl-2"><a class="flex items-center space-x-2 hover:underline" target="_blank" rel="noopener noreferrer"> </a></div> <button class="self-center pointer-events-auto p-1 rounded-full bg-white dark:bg-gray-850"><!></button></div> <div class=" w-full h-full relative"><!> <!></div></div>');function Vs(Y,n){Xt(n,!1);const r=()=>ze(Es,"$embed",i),[i,u]=na();let S=E(n,"overlay",8,!1);const w=(T,M,O,C)=>{try{const X=new URL(T);return M&&X.searchParams.set("chat_id",M),O&&X.searchParams.set("message_id",O),C&&X.searchParams.set("source_id",C),X.toString()}catch{const X=T.includes("?"),ge=[];return M&&ge.push(`chat_id=${encodeURIComponent(M)}`),O&&ge.push(`message_id=${encodeURIComponent(O)}`),C&&ge.push(`source_id=${encodeURIComponent(C)}`),ge.length===0?T:T+(X?"&":"?")+ge.join("&")}};ta();var y=ct(),pe=ke(y);{var h=T=>{var M=Yu(),O=a(M),C=a(O),X=a(C),ge=a(X,!0);t(X),t(C);var ae=m(C,2),Re=a(ae);Ga(Re,{className:"size-3.5 text-gray-900 dark:text-white"}),t(ae),t(O);var Pe=m(O,2),ve=a(Pe);{var D=_=>{var we=Zu();l(_,we)};N(ve,_=>{S()&&_(D)})}var Ae=m(ve,2);{let _=$e(()=>(r(),o(()=>{var ee,re,Ye,J;return w(((ee=r())==null?void 0:ee.url)??"",(re=r())==null?void 0:re.chatId,(Ye=r())==null?void 0:Ye.messageId,(J=r())==null?void 0:J.sourceId)}))),we=$e(()=>(r(),o(()=>{var ee;return((ee=r())==null?void 0:ee.source)??null})));nl(Ae,{get src(){return e(_)},get payload(){return e(we)},iframeClassName:"w-full h-full"})}t(Pe),t(M),Z(()=>{$t(X,"href",(r(),o(()=>{var _;return(_=r())==null?void 0:_.url}))),Le(ge,(r(),o(()=>{var _;return((_=r())==null?void 0:_.title)??"Embedded Content"})))}),Qe("click",ae,()=>{ra.set(!1),ir.set(!1),Es.set(null)}),l(T,M)};N(pe,T=>{r()&&T(h)})}l(Y,y),ea(),u()}var Ku=v('<div class=" h-full max-h-[100dvh] bg-white text-gray-700 dark:bg-black dark:text-gray-300 flex justify-center"><!></div>'),Qu=v("<div><!></div>"),Xu=v('<div class=" absolute -left-1.5 -right-1.5 -top-0 -bottom-0 z-20 cursor-col-resize bg-transparent"></div>'),ev=v('<div class="w-full h-full flex justify-center"><!></div>'),tv=v('<div class="flex max-h-full min-h-full"><div id="controls-container"><!></div></div>'),av=v("<!> <!>",1);function rv(Y,n){Xt(n,!1);const r=()=>ze(Ta,"$showCallOverlay",y),i=()=>ze(ra,"$showControls",y),u=()=>ze(lr,"$showOverview",y),S=()=>ze(qa,"$showArtifacts",y),w=()=>ze(ir,"$showEmbeds",y),[y,pe]=na();let h=E(n,"history",12),T=E(n,"models",24,()=>[]),M=E(n,"chatId",8,null),O=E(n,"chatFiles",28,()=>[]),C=E(n,"params",28,()=>({})),X=E(n,"eventTarget",8),ge=E(n,"submitPrompt",8),ae=E(n,"stopResponse",8),Re=E(n,"showMessage",8),Pe=E(n,"files",12),ve=E(n,"modelId",8),D=E(n,"pane",12),Ae,_=q(!1),we=q(!1),ee=q(0);const re=()=>{if(parseInt(localStorage==null?void 0:localStorage.chatControlsSize)){const de=document.getElementById("chat-container");let Me=Math.floor(parseInt(localStorage==null?void 0:localStorage.chatControlsSize)/de.clientWidth*100);D().resize(Me)}else D().resize(e(ee))},Ye=async de=>{de.matches?(s(_,!0),r()&&(Ta.set(!1),await ot(),Ta.set(!0))):(s(_,!1),r()&&(Ta.set(!1),await ot(),Ta.set(!0)),D(null))},J=de=>{s(we,!0)},L=de=>{s(we,!1)};Ya(()=>{Ae=window.matchMedia("(min-width: 1024px)"),Ae.addEventListener("change",Ye),Ye(Ae);const de=document.getElementById("chat-container");s(ee,Math.floor(350/de.clientWidth*100)),new ResizeObserver(xe=>{for(let Ge of xe){const me=350/Ge.contentRect.width*100;s(ee,Math.floor(me)),i()&&(D()&&D().isExpanded()&&D().getSize()<e(ee)?D().resize(e(ee)):Math.floor(parseInt(localStorage==null?void 0:localStorage.chatControlsSize)/de.clientWidth*100)<e(ee)&&D().resize(e(ee)))}}).observe(de),document.addEventListener("mousedown",J),document.addEventListener("mouseup",L)}),Yr(()=>{ra.set(!1),Ae.removeEventListener("change",Ye),document.removeEventListener("mousedown",J),document.removeEventListener("mouseup",L)});const k=()=>{ra.set(!1),lr.set(!1),qa.set(!1),ir.set(!1),r()&&Ta.set(!1)};Tt(()=>B(M()),()=>{M()||k()}),Da();var g={openPane:re};ta();var f=ct(),$=ke(f);{var I=de=>{var Me=ct(),xe=ke(Me);{var Ge=We=>{ro(We,{get show(){return i()},onClose:()=>{ra.set(!1)},children:(me,x)=>{var Ie=Qu(),He=a(Ie);{var Se=U=>{var H=Ku(),De=a(H);Ws(De,{get submitPrompt(){return ge()},get stopResponse(){return ae()},get modelId(){return ve()},get chatId(){return M()},get eventTarget(){return X()},get files(){return Pe()},set files(Te){Pe(Te)},$$events:{close:()=>{ra.set(!1)}},$$legacy:!0}),t(H),l(U,H)},he=U=>{var H=ct(),De=ke(H);{var Te=V=>{Vs(V,{})},Je=V=>{var _e=ct(),d=ke(_e);{var A=j=>{Hs(j,{get history(){return h()}})},G=j=>{var z=ct(),R=ke(z);{var K=ue=>{var Ee=ct(),Oe=ke(Ee);js(Oe,()=>Pr(()=>import("./B4oLWPTI.js"),__vite__mapDeps([3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31]),import.meta.url),null,(qe,W)=>{var se=$e(()=>{var{default:Fe}=e(W);return{Overview:Fe}}),ne=$e(()=>e(se).Overview);e(ne)(qe,{get history(){return h()},onNodeClick:Fe=>{const Ze=Fe.node;Re()(Ze.data.message,!0)},onClose:()=>{ra.set(!1)}})}),l(ue,Ee)},oe=ue=>{Rs(ue,{get models(){return T()},get chatFiles(){return O()},set chatFiles(Ee){O(Ee)},get params(){return C()},set params(Ee){C(Ee)},$$events:{close:()=>{ra.set(!1)}},$$legacy:!0})};N(R,ue=>{u()?ue(K):ue(oe,!1)},!0)}l(j,z)};N(d,j=>{S()?j(A):j(G,!1)},!0)}l(V,_e)};N(De,V=>{w()?V(Te):V(Je,!1)},!0)}l(U,H)};N(He,U=>{r()?U(Se):U(he,!1)})}t(Ie),Z(()=>gt(Ie,1,` ${r()||u()||S()||w()?" h-screen  w-full":"px-4 py-3"} h-full`)),l(me,Ie)},$$slots:{default:!0}})};N(xe,We=>{i()&&We(Ge)})}l(de,Me)},ye=de=>{var Me=av(),xe=ke(Me);{var Ge=me=>{Oo(me,{class:"relative flex items-center justify-center group border-l border-gray-50 dark:border-gray-850/30 hover:border-gray-200 dark:hover:border-gray-800  transition z-20",id:"controls-resizer",children:(x,Ie)=>{var He=Xu();l(x,He)},$$slots:{default:!0}})};N(xe,me=>{i()&&me(Ge)})}var We=m(xe,2);Gs(We,{defaultSize:0,onResize:me=>{if(i()&&D().isExpanded())if(me<e(ee)&&D().resize(e(ee)),me<e(ee))localStorage.chatControlsSize=0;else{const x=document.getElementById("chat-container");localStorage.chatControlsSize=Math.floor(me/100*x.clientWidth)}},onCollapse:()=>{ra.set(!1)},collapsible:!0,class:" z-10 bg-white dark:bg-gray-850",get pane(){return D()},set pane(me){D(me)},children:(me,x)=>{var Ie=ct(),He=ke(Ie);{var Se=he=>{var U=tv(),H=a(U),De=a(H);{var Te=V=>{var _e=ev(),d=a(_e);Ws(d,{get submitPrompt(){return ge()},get stopResponse(){return ae()},get modelId(){return ve()},get chatId(){return M()},get eventTarget(){return X()},get files(){return Pe()},set files(A){Pe(A)},$$events:{close:()=>{ra.set(!1)}},$$legacy:!0}),t(_e),l(V,_e)},Je=V=>{var _e=ct(),d=ke(_e);{var A=j=>{Vs(j,{get overlay(){return e(we)}})},G=j=>{var z=ct(),R=ke(z);{var K=ue=>{Hs(ue,{get history(){return h()},get overlay(){return e(we)}})},oe=ue=>{var Ee=ct(),Oe=ke(Ee);{var qe=se=>{var ne=ct(),Fe=ke(ne);js(Fe,()=>Pr(()=>import("./B4oLWPTI.js"),__vite__mapDeps([3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31]),import.meta.url),null,(Ze,Ue)=>{var Xe=$e(()=>{var{default:vt}=e(Ue);return{Overview:vt}}),lt=$e(()=>e(Xe).Overview);e(lt)(Ze,{get history(){return h()},onNodeClick:vt=>{var Ft,Wt;const bt=vt.node;(Wt=(Ft=bt==null?void 0:bt.data)==null?void 0:Ft.message)!=null&&Wt.favorite?h(h().messages[bt.data.message.id].favorite=!0,!0):h(h().messages[bt.data.message.id].favorite=null,!0),Re()(bt.data.message,!0)},onClose:()=>{ra.set(!1)}})}),l(se,ne)},W=se=>{Rs(se,{get models(){return T()},get chatFiles(){return O()},set chatFiles(ne){O(ne)},get params(){return C()},set params(ne){C(ne)},$$events:{close:()=>{ra.set(!1)}},$$legacy:!0})};N(Oe,se=>{u()?se(qe):se(W,!1)},!0)}l(ue,Ee)};N(R,ue=>{S()?ue(K):ue(oe,!1)},!0)}l(j,z)};N(d,j=>{w()?j(A):j(G,!1)},!0)}l(V,_e)};N(De,V=>{r()?V(Te):V(Je,!1)})}t(H),t(U),Z(()=>gt(H,1,`w-full ${(u()||S()||w())&&!r()?" ":"px-4 py-3 bg-white dark:shadow-lg dark:bg-gray-850 "} z-40 pointer-events-auto overflow-y-auto scrollbar-hidden`)),l(he,U)};N(He,he=>{i()&&he(Se)})}l(me,Ie)},$$slots:{default:!0},$$legacy:!0}),l(de,Me)};N($,de=>{e(_)?de(ye,!1):de(I)})}l(Y,f),Ks(n,"openPane",re);var Ce=ea(g);return pe(),Ce}var sv=v('<span class="font-normal"><!></span>'),ov=v('<span class="invisible"><!></span>'),nv=v('<span class="font-normal"><!></span>'),lv=v('<span class="invisible"><!></span>'),iv=v('<div class="flex text-xs font-medium mb-1 items-center -mr-0.5"><button class="px-1.5 py-1 cursor-pointer select-none basis-3/5"><div class="flex gap-1.5 items-center"> <!></div></button> <button class="px-1.5 py-1 cursor-pointer select-none hidden sm:flex sm:basis-2/5 justify-end"><div class="flex gap-1.5 items-center"> <!></div></button></div>'),dv=v('<div class="text-xs text-gray-500 dark:text-gray-400 text-center px-5 min-h-20 w-full h-full flex justify-center items-center"> </div>'),cv=v("<div> </div>"),uv=v('<!> <a class=" w-full flex justify-between items-center rounded-lg text-sm py-2 px-3 hover:bg-gray-50 dark:hover:bg-gray-850" draggable="false"><div class="text-ellipsis line-clamp-1 w-full sm:basis-3/5"> </div> <div class="hidden sm:flex sm:basis-2/5 items-center justify-end"><div class=" text-gray-500 dark:text-gray-400 text-xs"> </div></div></a>',1),vv=v('<div class="w-full flex justify-center py-1 text-xs animate-pulse items-center gap-2"><!> <div class=" ">Loading...</div></div>'),fv=v('<!> <div class="text-left text-sm w-full mb-3"><!> <!> <!></div>',1);function gv(Y,n){Xt(n,!1);const r=()=>ze(S,"$i18n",i),[i,u]=na(),S=la("i18n");tr.extend(cn);let w=E(n,"chats",24,()=>[]),y=E(n,"chatListLoading",8,!1),pe=E(n,"allChatsLoaded",8,!1),h=E(n,"loadHandler",8,null),T=q(null);const M=async()=>{w().length===0?s(T,[]):(s(T,w().map(Pe=>({...Pe,time_range:un(Pe.updated_at)}))),e(T).sort((Pe,ve)=>e(X)==="asc"?Pe[e(C)]>ve[e(C)]?1:-1:Pe[e(C)]<ve[e(C)]?1:-1))},O=Pe=>{e(C)===Pe?s(X,e(X)==="asc"?"desc":"asc"):(s(C,Pe),s(X,"asc")),M()};let C=q("updated_at"),X=q("desc");Tt(()=>B(w()),()=>{w()&&M()}),Da(),ta();var ge=ct(),ae=ke(ge);{var Re=Pe=>{var ve=fv(),D=ke(ve);{var Ae=L=>{var k=iv(),g=a(k),f=a(g),$=a(f),I=m($);{var ye=x=>{var Ie=sv(),He=a(Ie);{var Se=U=>{Vr(U,{className:"size-2"})},he=U=>{hs(U,{className:"size-2"})};N(He,U=>{e(X)==="asc"?U(Se):U(he,!1)})}t(Ie),l(x,Ie)},Ce=x=>{var Ie=ov(),He=a(Ie);Vr(He,{className:"size-2"}),t(Ie),l(x,Ie)};N(I,x=>{e(C)==="title"?x(ye):x(Ce,!1)})}t(f),t(g);var de=m(g,2),Me=a(de),xe=a(Me),Ge=m(xe);{var We=x=>{var Ie=nv(),He=a(Ie);{var Se=U=>{Vr(U,{className:"size-2"})},he=U=>{hs(U,{className:"size-2"})};N(He,U=>{e(X)==="asc"?U(Se):U(he,!1)})}t(Ie),l(x,Ie)},me=x=>{var Ie=lv(),He=a(Ie);Vr(He,{className:"size-2"}),t(Ie),l(x,Ie)};N(Ge,x=>{e(C)==="updated_at"?x(We):x(me,!1)})}t(Me),t(de),t(k),Z((x,Ie)=>{Le($,`${x??""} `),Le(xe,`${Ie??""} `)},[()=>(r(),o(()=>r().t("Title"))),()=>(r(),o(()=>r().t("Updated at")))]),Qe("click",g,()=>O("title")),Qe("click",de,()=>O("updated_at")),l(L,k)};N(D,L=>{e(T),o(()=>e(T).length>0)&&L(Ae)})}var _=m(D,2),we=a(_);{var ee=L=>{var k=dv(),g=a(k,!0);t(k),Z(f=>Le(g,f),[()=>(r(),o(()=>r().t("No chats found")))]),l(L,k)};N(we,L=>{e(T),o(()=>e(T).length===0)&&L(ee)})}var re=m(we,2);ua(re,3,()=>e(T),L=>L.id,(L,k,g)=>{var f=uv(),$=ke(f);{var I=We=>{var me=cv(),x=a(me,!0);t(me),Z(Ie=>{gt(me,1,`w-full text-xs text-gray-500 dark:text-gray-500 font-medium ${e(g)===0?"":"pt-5"} pb-2 px-2`),Le(x,Ie)},[()=>(r(),e(k),o(()=>r().t(e(k).time_range)))]),l(We,me)};N($,We=>{B(e(g)),e(k),e(T),o(()=>{var me;return(e(g)===0||e(g)>0&&e(k).time_range!==e(T)[e(g)-1].time_range)&&((me=e(k))==null?void 0:me.time_range)})&&We(I)})}var ye=m($,2),Ce=a(ye),de=a(Ce,!0);t(Ce);var Me=m(Ce,2),xe=a(Me),Ge=a(xe,!0);t(xe),t(Me),t(ye),Z(We=>{$t(ye,"href",(e(k),o(()=>`/c/${e(k).id}`))),Le(de,(e(k),o(()=>{var me;return(me=e(k))==null?void 0:me.title}))),Le(Ge,We)},[()=>(B(tr),e(k),o(()=>{var We;return tr(((We=e(k))==null?void 0:We.updated_at)*1e3).calendar()}))]),Qe("click",ye,()=>show=!1),l(L,f)});var Ye=m(re,2);{var J=L=>{Tr(L,{$$events:{visible:k=>{y()||h()()}},children:(k,g)=>{var f=vv(),$=a(f);Sa($,{className:" size-4"}),nr(2),t(f),l(k,f)},$$slots:{default:!0}})};N(Ye,L=>{!pe()&&h()&&L(J)})}t(_),l(Pe,ve)};N(ae,Pe=>{e(T)&&Pe(Re)})}l(Y,ge),ea(),u()}var mv=v('<div class="py-10"><!></div>'),pv=v("<div><div><!></div></div>");function hv(Y,n){Xt(n,!1),la("i18n");let r=E(n,"folder",8,null),i=1,u=q(null),S=q(!1),w=q(!1);const y=async()=>{s(S,!0),i+=1;let C=[];C=await Ps(localStorage.token,r().id,i).catch(X=>[]),s(w,C.length===0),s(u,[...e(u)||[],...C||[]]),s(S,!1)},pe=async()=>{if(s(u,null),i=1,s(w,!1),s(S,!1),r()&&r().id){const C=await Ps(localStorage.token,r().id,i);C?s(u,C):s(u,[])}else s(u,[])};Tt(()=>B(r()),()=>{r()&&pe()}),Da(),ta();var h=pv(),T=a(h),M=a(T);{var O=C=>{var X=ct(),ge=ke(X);{var ae=Re=>{var Pe=ct(),ve=ke(Pe);{var D=_=>{gv(_,{get chats(){return e(u)},get chatListLoading(){return e(S)},get allChatsLoaded(){return e(w)},loadHandler:y})},Ae=_=>{var we=mv(),ee=a(we);Sa(ee,{}),t(we),l(_,we)};N(ve,_=>{e(u)!==null?_(D):_(Ae,!1)})}l(Re,Pe)};N(ge,Re=>{Re(ae)},!0)}l(C,X)};N(M,C=>{C(O,!1)})}t(T),t(h),l(Y,h),ea()}var _v=v('<div class=" text-sm text-gray-700 dark:text-gray-300 flex-1 line-clamp-3 mb-2"> </div> <div class="flex items-center gap-1.5"><input type="checkbox"/> <div class="text-xs text-gray-500"> </div></div>',1),wv=v('<button class=" rounded-full bg-gray-50 dark:bg-gray-800 size-11 flex justify-center items-center"><!></button>'),yv=v('<button class="p-1.5 dark:hover:bg-gray-850 rounded-full touch-auto"><!></button>'),bv=v('<!> <!> <div class="mb-3 px-6 @md:max-w-3xl justify-between w-full flex relative group items-center"><div class="text-center flex gap-3.5 items-center"><!> <div class="text-3xl line-clamp-1"> </div></div> <div class="flex items-center translate-x-2.5"><!></div></div>',1);function xv(Y,n){Xt(n,!1);const r=()=>ze(S,"$i18n",i),[i,u]=na(),S=la("i18n"),{saveAs:w}=so;let y=E(n,"folder",12,null),pe=E(n,"onUpdate",8,D=>{}),h=E(n,"onDelete",8,D=>{}),T=q(!1),M=q(!1),O=q(!0);const C=async({name:D,meta:Ae,data:_})=>{if(D===""){at.error(r().t("Folder name cannot be empty."));return}const we=y().name;if(D=D.trim(),y(y().name=D,!0),await ps(localStorage.token,y().id,{name:D,...Ae?{meta:Ae}:{},..._?{data:_}:{}}).catch(re=>(at.error(`${re}`),y(y().name=we,!0),null))){y(y().name=D,!0),_&&y(y().data=_,!0),at.success(r().t("Folder updated successfully"));const re=await Ns(localStorage.token,y().id).catch(Ye=>(at.error(`${Ye}`),null));await dr.set(re),pe()(re)}},X=async D=>{if(await ps(localStorage.token,y().id,{meta:{icon:D}}).catch(_=>(at.error(`${_}`),null))){y(y().meta={...y().meta,icon:D},!0),at.success(r().t("Folder updated successfully"));const _=await Ns(localStorage.token,y().id).catch(we=>(at.error(`${we}`),null));await dr.set(_),pe()(_)}},ge=async()=>{await jn(localStorage.token,y().id,e(O)).catch(Ae=>(at.error(`${Ae}`),null))&&(at.success(r().t("Folder deleted successfully")),h()(y()))},ae=async()=>{const D=await wn(localStorage.token,y().id).catch(_=>(at.error(`${_}`),null));if(!D)return;const Ae=new Blob([JSON.stringify(D)],{type:"application/json"});w(Ae,`folder-${y().name}-export-${Date.now()}.json`)};ta();var Re=ct(),Pe=ke(Re);{var ve=D=>{var Ae=bv(),_=ke(Ae);ul(_,{edit:!0,get folderId(){return B(y()),o(()=>y().id)},onSubmit:C,get show(){return e(T)},set show(f){s(T,f)},$$legacy:!0});var we=m(_,2);{let f=$e(()=>(r(),o(()=>r().t("Delete folder?"))));lo(we,{get title(){return e(f)},get show(){return e(M)},set show($){s(M,$)},$$events:{confirm:()=>{ge()}},children:($,I)=>{var ye=_v(),Ce=ke(ye),de=a(Ce,!0);t(Ce);var Me=m(Ce,2),xe=a(Me);Lo(xe);var Ge=m(xe,2),We=a(Ge,!0);t(Ge),t(Me),Z((me,x)=>{Le(de,me),Le(We,x)},[()=>(r(),o(()=>r().t('Are you sure you want to delete "{{NAME}}"?',{NAME:folders[folderId].name}))),()=>(r(),o(()=>r().t("Delete all contents inside this folder")))]),Wn(xe,()=>e(O),me=>s(O,me)),l($,ye)},$$slots:{default:!0},$$legacy:!0})}var ee=m(we,2),re=a(ee),Ye=a(re);_l(Ye,{onClose:()=>{},onSubmit:f=>{X(f)},children:(f,$)=>{var I=wv(),ye=a(I);{var Ce=Me=>{Cl(Me,{className:"size-6",get shortCode(){return B(y()),o(()=>y().meta.icon)}})},de=Me=>{_s(Me,{className:"size-4.5",strokeWidth:"2"})};N(ye,Me=>{B(y()),o(()=>{var xe,Ge;return(Ge=(xe=y())==null?void 0:xe.meta)==null?void 0:Ge.icon})?Me(Ce):Me(de,!1)})}t(I),l(f,I)},$$slots:{default:!0}});var J=m(Ye,2),L=a(J,!0);t(J),t(re);var k=m(re,2),g=a(k);vl(g,{align:"end",onEdit:()=>{s(T,!0)},onDelete:()=>{s(M,!0)},onExport:()=>{ae()},children:(f,$)=>{var I=yv(),ye=a(I);no(ye,{className:"size-4",strokeWidth:"2.5"}),t(I),Qe("click",I,Ce=>{}),l(f,I)},$$slots:{default:!0}}),t(k),t(ee),Z(()=>Le(L,(B(y()),o(()=>y().name)))),l(D,Ae)};N(Pe,D=>{y()&&D(ve)})}l(Y,Re),ea(),u()}var $v=v('<div class="flex items-center gap-2 text-gray-500 text-base my-2 w-fit"><!> </div>'),kv=v('<button><img class=" size-9 @sm:size-10 rounded-full border-[1px] border-gray-100 dark:border-none" aria-hidden="true" draggable="false"/></button>'),Cv=v('<span class="line-clamp-1"> </span>'),Iv=v('<div class="mt-0.5 px-2 text-sm font-normal text-gray-500 dark:text-gray-400 line-clamp-2 max-w-xl markdown"><!></div>'),Sv=v("<a> </a>"),Ev=v('<div class="mt-0.5 text-sm font-normal text-gray-400 dark:text-gray-500">By <!></div>'),Mv=v("<!> <!>",1),Pv=v('<div class="flex flex-row justify-center gap-3 @sm:gap-3.5 w-fit px-5 max-w-xl"><div class="flex shrink-0 justify-center"><div class="flex -space-x-4 mb-0.5"></div></div> <div class=" text-3xl @sm:text-3xl line-clamp-1 flex items-center"><!></div></div> <div class="flex mt-1 mb-2"><div><!></div></div>',1),Tv=v('<div class="mx-auto px-4 md:max-w-3xl md:px-6 font-primary min-h-62"><!></div>'),zv=v('<div class="mx-auto max-w-2xl font-primary mt-2"><div class="mx-5"><!></div></div>'),Nv=v('<div class="m-auto w-full max-w-6xl px-2 @2xl:px-20 translate-y-6 py-24 text-center"><!> <div class="w-full text-3xl text-gray-800 dark:text-gray-100 text-center flex items-center gap-4 font-primary"><div class="w-full flex flex-col justify-center items-center"><!> <div><!></div></div></div> <!></div>');function Av(Y,n){Xt(n,!1);const r=()=>ze(Lr,"$_models",h),i=()=>ze(Pa,"$temporaryChatEnabled",h),u=()=>ze(O,"$i18n",h),S=()=>ze(dr,"$selectedFolder",h),w=()=>ze(Oa,"$currentChatPage",h),y=()=>ze(Ka,"$user",h),pe=()=>ze(xr,"$config",h),[h,T]=na(),M=ar(),O=la("i18n");let C=E(n,"createMessagePair",8),X=E(n,"stopResponse",8),ge=E(n,"autoScroll",12,!1),ae=E(n,"atSelectedModel",12),Re=E(n,"selectedModels",8),Pe=E(n,"history",8),ve=E(n,"prompt",12,""),D=E(n,"files",28,()=>[]),Ae=E(n,"messageInput",12,null),_=E(n,"selectedToolIds",28,()=>[]),we=E(n,"selectedFilterIds",28,()=>[]),ee=E(n,"showCommands",12,!1),re=E(n,"imageGenerationEnabled",12,!1),Ye=E(n,"codeInterpreterEnabled",12,!1),J=E(n,"webSearchEnabled",12,!1),L=E(n,"onUpload",8,U=>{}),k=E(n,"onSelect",8,U=>{}),g=E(n,"onChange",8,U=>{}),f=E(n,"toolServers",24,()=>[]),$=q([]),I=q(0);Tt(()=>(B(Re()),r()),()=>{s($,Re().map(U=>r().find(H=>H.id===U)))}),Tt(()=>(B(Re()),e($)),()=>{Re().length>0&&s(I,e($).length-1)}),Da(),ta();var ye=Nv(),Ce=a(ye);{var de=U=>{{let H=$e(()=>(u(),o(()=>u().t("This chat won't appear in history and your messages will not be saved."))));mt(U,{get content(){return e(H)},className:"w-full flex justify-center mb-0.5",placement:"top",children:(De,Te)=>{var Je=$v(),V=a(Je);kl(V,{strokeWidth:"2.5",className:"size-4"});var _e=m(V,1,!0);t(Je),Z(d=>Le(_e,d),[()=>(u(),o(()=>u().t("Temporary Chat")))]),l(De,Je)},$$slots:{default:!0}})}};N(Ce,U=>{i()&&U(de)})}var Me=m(Ce,2),xe=a(Me),Ge=a(xe);{var We=U=>{xv(U,{get folder(){return S()},onUpdate:async H=>{await Ba.set(await Ua(localStorage.token,w())),Oa.set(1)},onDelete:async()=>{await Ba.set(await Ua(localStorage.token,w())),Oa.set(1),dr.set(null)}})},me=U=>{var H=Pv(),De=ke(H),Te=a(De),Je=a(Te);ua(Je,5,()=>e($),Ca,(K,oe,ue)=>{{let Ee=$e(()=>(e($),o(()=>{var Oe,qe,W;return(((W=(qe=(Oe=e($)[ue])==null?void 0:Oe.info)==null?void 0:qe.meta)==null?void 0:W.tags)??[]).map(se=>se.name.toUpperCase()).join(", ")})));mt(K,{get content(){return e(Ee)},placement:"top",children:(Oe,qe)=>{var W=kv(),se=a(W);t(W),Z(ne=>{$t(W,"aria-hidden",(e($),o(()=>e($).length<=1))),$t(W,"aria-label",ne),$t(se,"src",(B(Fa),e(oe),u(),o(()=>{var Fe;return`${Fa}/models/model/profile/image?id=${(Fe=e(oe))==null?void 0:Fe.id}&lang=${u().language}`})))},[()=>(u(),e($),o(()=>{var ne;return u().t("Get information on {{name}} in the UI",{name:(ne=e($)[ue])==null?void 0:ne.name})}))]),Qe("click",W,()=>{s(I,ue)}),l(Oe,W)},$$slots:{default:!0}})}}),t(Je),t(Te);var V=m(Te,2),_e=a(V);{var d=K=>{{let oe=$e(()=>(e($),e(I),o(()=>{var ue;return(ue=e($)[e(I)])==null?void 0:ue.name})));mt(K,{get content(){return e(oe)},placement:"top",className:" flex items-center ",children:(ue,Ee)=>{var Oe=Cv(),qe=a(Oe,!0);t(Oe),Z(()=>Le(qe,(e($),e(I),o(()=>{var W;return(W=e($)[e(I)])==null?void 0:W.name})))),l(ue,Oe)},$$slots:{default:!0}})}},A=K=>{var oe=Ir();Z(ue=>Le(oe,ue),[()=>(u(),y(),o(()=>{var ue;return u().t("Hello, {{name}}",{name:(ue=y())==null?void 0:ue.name})}))]),l(K,oe)};N(_e,K=>{e($),e(I),o(()=>{var oe;return(oe=e($)[e(I)])==null?void 0:oe.name})?K(d):K(A,!1)})}t(V),t(De);var G=m(De,2),j=a(G),z=a(j);{var R=K=>{var oe=Mv(),ue=ke(oe);{let qe=$e(()=>(B(_r),B(Hr),e($),e(I),o(()=>{var W,se,ne;return _r.parse(Hr(((ne=(se=(W=e($)[e(I)])==null?void 0:W.info)==null?void 0:se.meta)==null?void 0:ne.description)??"").replaceAll(`
`,"<br>"))})));mt(ue,{className:" w-fit",get content(){return e(qe)},placement:"top",children:(W,se)=>{var ne=Iv(),Fe=a(ne);Ys(Fe,()=>(B(_r),B(Hr),e($),e(I),o(()=>{var Ze,Ue,Xe;return _r.parse(Hr(((Xe=(Ue=(Ze=e($)[e(I)])==null?void 0:Ze.info)==null?void 0:Ue.meta)==null?void 0:Xe.description)??"").replaceAll(`
`,"<br>"))}))),t(ne),l(W,ne)},$$slots:{default:!0}})}var Ee=m(ue,2);{var Oe=qe=>{var W=Ev(),se=m(a(W));{var ne=Ze=>{var Ue=Sv(),Xe=a(Ue,!0);t(Ue),Z(()=>{$t(Ue,"href",`https://openwebui.com/m/${e($),e(I),o(()=>{var lt,vt,bt;return(bt=(vt=(lt=e($)[e(I)])==null?void 0:lt.info)==null?void 0:vt.meta)==null?void 0:bt.user.username})??""}`),Le(Xe,(e($),e(I),o(()=>{var lt,vt,bt,Ft,Wt,sa,Ht,ma,qt;return(bt=(vt=(lt=e($)[e(I)])==null?void 0:lt.info)==null?void 0:vt.meta)!=null&&bt.user.name?(sa=(Wt=(Ft=e($)[e(I)])==null?void 0:Ft.info)==null?void 0:Wt.meta)==null?void 0:sa.user.name:`@${(qt=(ma=(Ht=e($)[e(I)])==null?void 0:Ht.info)==null?void 0:ma.meta)==null?void 0:qt.user.username}`})))}),l(Ze,Ue)},Fe=Ze=>{var Ue=Ir();Z(()=>Le(Ue,(e($),e(I),o(()=>{var Xe,lt,vt;return(vt=(lt=(Xe=e($)[e(I)])==null?void 0:Xe.info)==null?void 0:lt.meta)==null?void 0:vt.user.name})))),l(Ze,Ue)};N(se,Ze=>{e($),e(I),o(()=>{var Ue,Xe,lt;return(lt=(Xe=(Ue=e($)[e(I)])==null?void 0:Ue.info)==null?void 0:Xe.meta)==null?void 0:lt.user.community})?Ze(ne):Ze(Fe,!1)})}t(W),l(qe,W)};N(Ee,qe=>{e($),e(I),o(()=>{var W,se,ne;return(ne=(se=(W=e($)[e(I)])==null?void 0:W.info)==null?void 0:se.meta)==null?void 0:ne.user})&&qe(Oe)})}l(K,oe)};N(z,K=>{e($),e(I),o(()=>{var oe,ue,Ee;return((Ee=(ue=(oe=e($)[e(I)])==null?void 0:oe.info)==null?void 0:ue.meta)==null?void 0:Ee.description)??null})&&K(R)})}t(j),t(G),za(1,Je,()=>mr,()=>({duration:100})),za(1,V,()=>mr,()=>({duration:100})),za(1,j,()=>mr,()=>({duration:100,delay:50})),l(U,H)};N(Ge,U=>{S()?U(We):U(me,!1)})}var x=m(Ge,2),Ie=a(x);{let U=$e(()=>(u(),o(()=>u().t("How can I help you today?"))));Ja(vo(Ie,{get history(){return Pe()},get selectedModels(){return Re()},get toolServers(){return f()},get stopResponse(){return X()},get createMessagePair(){return C()},get placeholder(){return e(U)},get onChange(){return g()},get onUpload(){return L()},get files(){return D()},set files(H){D(H)},get prompt(){return ve()},set prompt(H){ve(H)},get autoScroll(){return ge()},set autoScroll(H){ge(H)},get selectedToolIds(){return _()},set selectedToolIds(H){_(H)},get selectedFilterIds(){return we()},set selectedFilterIds(H){we(H)},get imageGenerationEnabled(){return re()},set imageGenerationEnabled(H){re(H)},get codeInterpreterEnabled(){return Ye()},set codeInterpreterEnabled(H){Ye(H)},get webSearchEnabled(){return J()},set webSearchEnabled(H){J(H)},get atSelectedModel(){return ae()},set atSelectedModel(H){ae(H)},get showCommands(){return ee()},set showCommands(H){ee(H)},$$events:{submit:H=>{M("submit",H.detail)}},$$legacy:!0}),H=>Ae(H),()=>Ae())}t(x),t(xe),t(Me);var He=m(Me,2);{var Se=U=>{var H=Tv(),De=a(H);hv(De,{get folder(){return S()}}),t(H),za(1,H,()=>mr,()=>({duration:200,delay:200})),l(U,H)},he=U=>{var H=zv(),De=a(H),Te=a(De);{let Je=$e(()=>(B(ae()),e($),e(I),pe(),o(()=>{var V,_e,d,A,G,j,z;return((d=(_e=(V=ae())==null?void 0:V.info)==null?void 0:_e.meta)==null?void 0:d.suggestion_prompts)??((j=(G=(A=e($)[e(I)])==null?void 0:A.info)==null?void 0:G.meta)==null?void 0:j.suggestion_prompts)??((z=pe())==null?void 0:z.default_prompt_suggestions)??[]})));Jn(Te,{get suggestionPrompts(){return e(Je)},get inputValue(){return ve()},get onSelect(){return k()}})}t(De),t(H),za(1,H,()=>mr,()=>({duration:200,delay:200})),l(U,H)};N(He,U=>{S()?U(Se):U(he,!1)})}t(ye),Z(()=>gt(x,1,`text-base font-normal @md:max-w-3xl w-full py-3 ${ae()?"mt-2":""}`)),l(Y,ye),ea(),T()}var Lv=v('<div class="absolute top-0 left-0 w-full h-full bg-cover bg-center bg-no-repeat svelte-vhdo11"></div> <div class="absolute top-0 left-0 w-full h-full bg-linear-to-t from-white to-white/85 dark:from-gray-900 dark:to-gray-900/90 z-0 svelte-vhdo11"></div>',1),Fv=v('<div class="absolute top-0 left-0 w-full h-full bg-cover bg-center bg-no-repeat svelte-vhdo11"></div> <div class="absolute top-0 left-0 w-full h-full bg-linear-to-t from-white to-white/85 dark:from-gray-900 dark:to-gray-900/90 z-0 svelte-vhdo11"></div>',1),Dv=v('<div class=" pb-2.5 flex flex-col justify-between w-full flex-auto overflow-auto h-0 max-w-full z-10 scrollbar-hidden svelte-vhdo11" id="messages-container"><div class=" h-full w-full flex flex-col svelte-vhdo11"><!></div></div> <div class=" pb-2 z-10 svelte-vhdo11"><!> <div class="absolute bottom-1 text-xs text-gray-500 text-center line-clamp-1 right-0 left-0 svelte-vhdo11"></div></div>',1),Bv=v('<div class="flex items-center h-full svelte-vhdo11"><!></div>'),Ov=v('<!> <div class="flex flex-col flex-auto z-10 w-full @container overflow-auto svelte-vhdo11"><!></div>',1),jv=v("<!> <!>",1),Uv=v('<div class="w-full h-full flex flex-col svelte-vhdo11"><!> <!></div>'),Rv=v('<div class=" flex items-center justify-center h-full w-full svelte-vhdo11"><div class="m-auto svelte-vhdo11"><!></div></div>'),Wv=v('<audio id="audioElement" src="" style="display: none;" class="svelte-vhdo11"></audio> <!> <div id="chat-container"><!></div>',1);function $g(Y,n){Xt(n,!1);const r=()=>ze(Pa,"$temporaryChatEnabled",_),i=()=>ze(Ra,"$settings",_),u=()=>ze(Za,"$tools",_),S=()=>ze(qr,"$functions",_),w=()=>ze(Lr,"$models",_),y=()=>ze(Va,"$chatId",_),pe=()=>ze(Oa,"$currentChatPage",_),h=()=>ze(dr,"$selectedFolder",_),T=()=>ze(Ms,"$audioQueue",_),M=()=>ze(Jo,"$socket",_),O=()=>ze(Qr,"$mobile",_),C=()=>ze(ee,"$i18n",_),X=()=>ze(Ka,"$user",_),ge=()=>ze(xr,"$config",_),ae=()=>ze(Ss,"$page",_),Re=()=>ze(Ta,"$showCallOverlay",_),Pe=()=>ze(Kr,"$toolServers",_),ve=()=>ze(Wr,"$chatTitle",_),D=()=>ze(qo,"$WEBUI_NAME",_),Ae=()=>ze(fs,"$showSidebar",_),[_,we]=na(),ee=la("i18n");let re=E(n,"chatIdProp",8,""),Ye=q(!0);const J=new EventTarget;let L=q(),k=q(),g=q(),f=q(!0),$=q(),I=q(),ye=q(!1),Ce=q(""),de=q(""),Me=q(!1),xe=q(""),Ge=q(""),We=q(null),me,x=q([""]),Ie=q(),He=q([]),Se=q([]),he=q([]),U=q(!1),H=q(!1),De=q(!1),Te=q(!1),Je=q(!1),V=null,_e=null,d=q({messages:{},currentId:null}),A=q(null),G=q(""),j=q([]),z=q([]),R=q({});const K=async()=>{var b,te;s(Ye,!0),s(G,""),(b=e(g))==null||b.setText(""),s(z,[]),s(Se,[]),s(he,[]),s(H,!1),s(U,!1);const c=sessionStorage.getItem(`chat-input${re()?`-${re()}`:""}`);if(re()&&await ma()){if(await ot(),s(Ye,!1),window.setTimeout(()=>qt(),0),await ot(),c)try{const F=JSON.parse(c);r()||((te=e(g))==null||te.setText(F.prompt),s(z,F.files),s(Se,F.selectedToolIds),s(he,F.selectedFilterIds),s(H,F.webSearchEnabled),s(U,F.imageGenerationEnabled),s(De,F.codeInterpreterEnabled))}catch{}else await W();const le=document.getElementById("chat-input");le==null||le.focus()}else await Sr("/")},oe=async c=>{var le;const{type:b,data:te}=c;b==="prompt"&&((le=e(g))==null||le.setText(te,async()=>{var F;(((F=i())==null?void 0:F.insertSuggestionPrompt)??!1)||(await ot(),It(e(G)))}))},ue=()=>{const c=JSON.stringify(e(x));e(x).length===0||e(x).length===1&&e(x)[0]===""||sessionStorage.selectedModels===c||(sessionStorage.selectedModels=c,e(x),sessionStorage.selectedModels)};let Ee=q([""]);const Oe=()=>{qe(),s(Ee,JSON.parse(JSON.stringify(e(He))))},qe=()=>{s(Se,[]),s(he,[]),s(H,!1),s(U,!1),s(De,!1),e(He).filter(c=>c).length>0&&W()},W=async()=>{var b,te,le,F,ce,P,ie,Ne,ft,pt,nt,it,rt,yt,xt,Dt,dt;if(u()||Za.set(await Xr(localStorage.token)),S()||qr.set(await Zs(localStorage.token)),e(x).length!==1&&!e(Ie))return;const c=e(Ie)??w().find(zt=>zt.id===e(x)[0]);c&&((te=(b=c==null?void 0:c.info)==null?void 0:b.meta)!=null&&te.toolIds&&s(Se,[...new Set([...((F=(le=c==null?void 0:c.info)==null?void 0:le.meta)==null?void 0:F.toolIds)??[]].filter(zt=>u().find(Et=>Et.id===zt)))]),(P=(ce=c==null?void 0:c.info)==null?void 0:ce.meta)!=null&&P.defaultFilterIds&&s(he,c.info.meta.defaultFilterIds.filter(zt=>{var Et;return(Et=c==null?void 0:c.filters)==null?void 0:Et.find(Nt=>Nt.id===zt)})),(Ne=(ie=c==null?void 0:c.info)==null?void 0:ie.meta)!=null&&Ne.defaultFeatureIds&&((nt=(pt=(ft=c.info)==null?void 0:ft.meta)==null?void 0:pt.capabilities)!=null&&nt.image_generation&&s(U,c.info.meta.defaultFeatureIds.includes("image_generation")),(yt=(rt=(it=c.info)==null?void 0:it.meta)==null?void 0:rt.capabilities)!=null&&yt.web_search&&s(H,c.info.meta.defaultFeatureIds.includes("web_search")),(dt=(Dt=(xt=c.info)==null?void 0:xt.meta)==null?void 0:Dt.capabilities)!=null&&dt.code_interpreter&&s(De,c.info.meta.defaultFeatureIds.includes("code_interpreter"))))},se=async(c,b=!1)=>{var ce;await ot();const te=JSON.parse(JSON.stringify(y()));let le=JSON.parse(JSON.stringify(c.id)),F=[];for(le===null?F=Object.keys(e(d).messages).filter(P=>e(d).messages[P].parentId===null):F=e(d).messages[le].childrenIds;F.length!==0;)le=F.at(-1),F=e(d).messages[le].childrenIds;if(Pt(d,e(d).currentId=le),await ot(),await ot(),await ot(),(((ce=i())==null?void 0:ce.scrollOnBranchChange)??!0)||b){const P=document.getElementById(`message-${c.id}`);P&&P.scrollIntoView({behavior:"smooth"})}await ot(),p(te,e(d))},ne=async(c,b)=>{var te,le;if(c.chat_id===y()){await ot();let F=e(d).messages[c.message_id];if(F){const ce=((te=c==null?void 0:c.data)==null?void 0:te.type)??null,P=((le=c==null?void 0:c.data)==null?void 0:le.data)??null;if(ce==="status")F!=null&&F.statusHistory?F.statusHistory.push(P):F.statusHistory=[P];else if(ce==="chat:completion")Ot(P,F,c.chat_id);else if(ce==="chat:tasks:cancel"){s(A,null);const ie=e(d).messages[e(d).currentId];for(const Ne of e(d).messages[ie.parentId].childrenIds)Pt(d,e(d).messages[Ne].done=!0)}else if(ce==="chat:message:delta"||ce==="message")F.content+=P.content;else if(ce==="chat:message"||ce==="replace")F.content=P.content;else if(ce==="chat:message:files"||ce==="files")F.files=P.files;else if(ce==="chat:message:embeds"||ce==="embeds")F.embeds=P.embeds;else if(ce==="chat:message:error")F.error=P.error;else if(ce==="chat:message:follow_ups")F.followUps=P.follow_ups,e(f)&&qt("smooth");else if(ce==="chat:message:favorite")F.favorite=P.favorite;else if(ce==="chat:title")Wr.set(P),Oa.set(1),await Ba.set(await Ua(localStorage.token,pe()));else if(ce==="chat:tags")_e=await ms(localStorage.token,y()),Jr.set(await gs(localStorage.token));else if(ce==="source"||ce==="citation")if((P==null?void 0:P.type)==="code_execution"){F!=null&&F.code_executions||(F.code_executions=[]);const ie=F.code_executions.findIndex(Ne=>Ne.id===P.id);ie!==-1?F.code_executions[ie]=P:F.code_executions.push(P),F.code_executions=F.code_executions}else F!=null&&F.sources?F.sources.push(P):F.sources=[P];else if(ce==="notification"){const ie=(P==null?void 0:P.type)??"info",Ne=(P==null?void 0:P.content)??"";ie==="success"?at.success(Ne):ie==="error"?at.error(Ne):ie==="warning"?at.warning(Ne):at.info(Ne)}else if(ce==="confirmation")s(We,b),s(Me,!1),s(ye,!0),s(Ce,P.title),s(de,P.message);else if(ce==="execute"){s(We,b);try{const Ne=await new Function(`return (async () => { ${P.code} })()`)();b&&b(Ne)}catch(ie){}}else ce==="input"&&(s(We,b),s(Me,!0),s(ye,!0),s(Ce,P.title),s(de,P.message),s(xe,P.placeholder),s(Ge,(P==null?void 0:P.value)??""));Pt(d,e(d).messages[c.message_id]=F)}}},Fe=async c=>{var b;if(c.origin===window.origin){if(c.data.type==="action:submit"&&(c.data.text,e(G)!==""&&(await ot(),It(e(G)))),c.data.type==="input:prompt"){c.data.text;const te=document.getElementById("chat-input");te&&((b=e(g))==null||b.setText(c.data.text),te.focus())}c.data.type==="input:prompt:submit"&&(c.data.text,c.data.text!==""&&(await ot(),It(c.data.text)))}},Ze=async()=>{var c,b;h()&&e(x).filter(te=>te!=="").length>0&&JSON.stringify((b=(c=h())==null?void 0:c.data)==null?void 0:b.model_ids)!==JSON.stringify(e(x))&&await ps(localStorage.token,h().id,{data:{model_ids:e(x)}})};let Ue=null,Xe=null,lt=null;const vt=()=>{try{speechSynthesis.cancel(),T().stop()}catch{}};Ya(async()=>{var te,le,F;s(Ye,!0),window.addEventListener("message",Fe),(te=M())==null||te.on("events",ne),Ms.set(new Fl(document.getElementById("audioElement"))),Ue=Ss.subscribe(async ce=>{ce.url.pathname==="/"&&(await ot(),Ht()),vt()});const c=sessionStorage.getItem(`chat-input${re()?`-${re()}`:""}`);if(re()||(s(Ye,!1),await ot()),c){s(G,""),(le=e(g))==null||le.setText(""),s(z,[]),s(Se,[]),s(he,[]),s(H,!1),s(U,!1),s(De,!1);try{const ce=JSON.parse(c);r()||((F=e(g))==null||F.setText(ce.prompt),s(z,ce.files),s(Se,ce.selectedToolIds),s(he,ce.selectedFilterIds),s(H,ce.webSearchEnabled),s(U,ce.imageGenerationEnabled),s(De,ce.codeInterpreterEnabled))}catch{}}Xe=ra.subscribe(async ce=>{if(e(L)&&!O())try{ce?e(k).openPane():e(L).collapse()}catch{}ce||(Ta.set(!1),lr.set(!1),qa.set(!1),ir.set(!1))}),lt=dr.subscribe(async ce=>{var P;(P=ce==null?void 0:ce.data)!=null&&P.model_ids&&JSON.stringify(e(x))!==JSON.stringify(ce.data.model_ids)&&(s(x,ce.data.model_ids),e(x))});const b=document.getElementById("chat-input");b==null||b.focus()}),Yr(()=>{var c,b;try{Ue(),Xe(),lt(),me==null||me(),window.removeEventListener("message",Fe),(c=M())==null||c.off("events",ne),(b=T())==null||b.destroy()}catch(te){}});const bt=async c=>{var le,F,ce,P,ie,Ne,ft,pt;if(c.id,c.name,c.url,`${token}`,!(c!=null&&c.id)||!(c!=null&&c.name)||!(c!=null&&c.url)||!((le=c==null?void 0:c.headers)!=null&&le.Authorization))throw new Error("Invalid file data provided");const b=ja(),te={type:"file",file:"",id:null,url:c.url,name:c.name,collection_name:"",status:"uploading",error:"",itemId:b,size:0};try{s(z,[...e(z),te]),c.url;const nt={headers:{Authorization:c.headers.Authorization,Accept:"*/*"},method:"GET"},it=await fetch(c.url,nt);if(!it.ok){const zt=await it.text();throw new Error(`Failed to fetch file (${it.status}): ${zt}`)}const rt=it.headers.get("content-type")||"application/octet-stream",yt=await it.blob();if(yt.size===0)throw new Error("Retrieved file is empty");yt.size,yt.type;const xt=new File([yt],c.name,{type:yt.type||rt});if(xt.name,xt.size,xt.type,xt.size===0)throw new Error("Created file is empty");let Dt=null;(xt.type.startsWith("audio/")||xt.type.startsWith("video/"))&&((P=(ce=(F=i())==null?void 0:F.audio)==null?void 0:ce.stt)!=null&&P.language)&&(Dt={language:(ft=(Ne=(ie=i())==null?void 0:ie.audio)==null?void 0:Ne.stt)==null?void 0:ft.language});const dt=await qs(localStorage.token,xt,Dt);if(!dt)throw new Error("Server returned null response for file upload");te.status="uploaded",te.file=dt,te.id=dt.id,te.size=xt.size,te.collection_name=(pt=dt==null?void 0:dt.meta)==null?void 0:pt.collection_name,te.url=`${dt.id}`,s(z,e(z)),at.success(C().t("File uploaded successfully"))}catch(nt){s(z,e(z).filter(it=>it.itemId!==b)),at.error(C().t("Error uploading file: {{error}}",{error:nt.message||"Unknown error"}))}},Ft=async c=>{Array.isArray(c)||(c=[c]);const b=c.map(te=>({type:"text",name:te,collection_name:"",status:"uploading",context:"full",url:te,error:""}));s(z,[...e(z),...b]);for(const te of b)try{const le=gn(te.url)?await $n(localStorage.token,te.url):await kn(localStorage.token,"",te.url);le&&(te.status="uploaded",te.collection_name=le.collection_name,te.file={...le.file,...te.file}),s(z,[...e(z)])}catch(le){s(z,e(z).filter(F=>F.name!==url)),at.error(`${le}`)}},Wt=async c=>{const{type:b,data:te}=c;b==="google-drive"?await bt(te):b==="web"&&await Ft(te)},sa=()=>{const c=e(d)?xa(e(d),e(d).currentId):[];let b=[];c.forEach(te=>{if((te==null?void 0:te.role)!=="user"&&(te!=null&&te.content)){const{codeBlocks:le,html:F,css:ce,js:P}=mn(te.content);if(F||ce||P){const ie=`
                        <!DOCTYPE html>
                        <html lang="en">
                        <head>
                            <meta charset="UTF-8">
                            <meta name="viewport" content="width=device-width, initial-scale=1.0">
							<style>
								body {
									background-color: white; /* Ensure the iframe has a white background */
								}

								${ce}
							</style>
                        </head>
                        <body>
                            ${F}

							<script>
                            	${P}
							<\/script>
                        </body>
                        </html>
                    `;b=[...b,{type:"iframe",content:ie}]}else for(const ie of le)(ie.lang==="svg"||ie.lang==="xml"&&ie.code.includes("<svg"))&&(b=[...b,{type:"svg",content:ie.code}])}}),Er.set(b)},Ht=async()=>{var le,F,ce,P,ie,Ne,ft,pt,nt,it,rt,yt,xt,Dt,dt,zt,Et,Nt,jt,wt,da;((le=X())==null?void 0:le.role)!=="admin"&&((P=(ce=(F=X())==null?void 0:F.permissions)==null?void 0:ce.chat)!=null&&P.temporary_enforced)&&await Pa.set(!0),(((ie=i())==null?void 0:ie.temporaryChatByDefault)??!1)&&(r()===!1?await Pa.set(!0):r()===null&&await Pa.set(!1)),((Ne=X())==null?void 0:Ne.role)!=="admin"&&!((nt=(pt=(ft=X())==null?void 0:ft.permissions)==null?void 0:pt.chat)!=null&&nt.temporary)&&await Pa.set(!1);const c=w().filter(ht=>{var Ut,ut;return!(((ut=(Ut=ht==null?void 0:ht.info)==null?void 0:Ut.meta)==null?void 0:ut.hidden)??!1)}).map(ht=>ht.id),b=(it=ge())!=null&&it.default_models?(rt=ge())==null?void 0:rt.default_models.split(","):[];if(ae().url.searchParams.get("models")||ae().url.searchParams.get("model")){const ht=(yt=ae().url.searchParams.get("models")||ae().url.searchParams.get("model")||"")==null?void 0:yt.split(",");if(ht.length===1)if(w().find(Ut=>Ut.id===ht[0]))s(x,ht);else{const Ut=document.getElementById("model-selector-0-button");if(Ut){Ut.click(),await ot();const ut=document.getElementById("model-search-input");ut&&(ut.focus(),ut.value=ht[0],ut.dispatchEvent(new Event("input")))}}else s(x,ht);s(x,e(x).filter(Ut=>w().map(ut=>ut.id).includes(Ut)))}else(Dt=(xt=h())==null?void 0:xt.data)!=null&&Dt.model_ids?s(x,(zt=(dt=h())==null?void 0:dt.data)==null?void 0:zt.model_ids):sessionStorage.selectedModels?(s(x,JSON.parse(sessionStorage.selectedModels)),sessionStorage.removeItem("selectedModels")):(Et=i())!=null&&Et.models?s(x,(Nt=i())==null?void 0:Nt.models):b&&b.length>0&&s(x,b),s(x,e(x).filter(ht=>c.includes(ht)));if((e(x).length===0||e(x).length===1&&e(x)[0]==="")&&(c.length>0?(b&&b.length>0&&s(x,b.filter(ht=>c.includes(ht))),s(x,[(c==null?void 0:c.at(0))??""])):s(x,[""])),await ra.set(!1),await Ta.set(!1),await lr.set(!1),await qa.set(!1),ae().url.pathname.includes("/c/")&&window.history.replaceState(e(d).state,"","/"),s(f,!0),qe(),await Va.set(""),await Wr.set(""),s(d,{messages:{},currentId:null}),s(j,[]),s(R,{}),ae().url.searchParams.get("youtube")&&await Ft(`https://www.youtube.com/watch?v=${ae().url.searchParams.get("youtube")}`),ae().url.searchParams.get("load-url")&&await Ft(ae().url.searchParams.get("load-url")),ae().url.searchParams.get("web-search")==="true"&&s(H,!0),ae().url.searchParams.get("image-generation")==="true"&&s(U,!0),ae().url.searchParams.get("code-interpreter")==="true"&&s(De,!0),ae().url.searchParams.get("tools")?s(Se,(jt=ae().url.searchParams.get("tools"))==null?void 0:jt.split(",").map(ht=>ht.trim()).filter(ht=>ht)):ae().url.searchParams.get("tool-ids")&&s(Se,(wt=ae().url.searchParams.get("tool-ids"))==null?void 0:wt.split(",").map(ht=>ht.trim()).filter(ht=>ht)),ae().url.searchParams.get("call")==="true"&&(Ta.set(!0),ra.set(!0)),ae().url.searchParams.get("q")){const ht=ae().url.searchParams.get("q")??"";(da=e(g))==null||da.setText(ht),ht&&(ae().url.searchParams.get("submit")??"true")==="true"&&(await ot(),It(ht))}s(x,e(x).map(ht=>w().map(Ut=>Ut.id).includes(ht)?ht:""));const te=document.getElementById("chat-input");setTimeout(()=>te==null?void 0:te.focus(),0)},ma=async()=>{var c,b,te,le;if(Va.set(re()),r()&&Pa.set(!1),_e=await ms(localStorage.token,y()).catch(async F=>(await Sr("/"),null)),_e){await Js(localStorage.token,y()).catch(async ce=>[]);const F=_e.chat;if(F){if(s(x,((F==null?void 0:F.models)??void 0)!==void 0?F.models:[F.models??""]),((c=X())==null?void 0:c.role)==="admin"||(((le=(te=(b=X())==null?void 0:b.permissions)==null?void 0:te.chat)==null?void 0:le.multiple_models)??!0)||s(x,e(x).length>0?[e(x)[0]]:[""]),s(Ee,JSON.parse(JSON.stringify(e(x)))),s(d,((F==null?void 0:F.history)??void 0)!==void 0?F.history:pn(F.messages)),Wr.set(F.title),s(R,(F==null?void 0:F.params)??{}),s(j,(F==null?void 0:F.files)??[]),s(f,!0),await ot(),e(d).currentId)for(const P of Object.values(e(d).messages))P&&P.role==="assistant"&&(P.done=!0);const ce=await En(localStorage.token,y()).catch(P=>null);return ce&&s(A,ce.task_ids),await ot(),!0}else return null}},qt=async(c="auto")=>{await ot(),e($)&&e($).scrollTo({top:e($).scrollHeight,behavior:c})},cr=async(c,b,te,le)=>{var ce;const F=await Mn(localStorage.token,{model:b,messages:le.map(P=>({id:P.id,role:P.role,content:P.content,info:P.info?P.info:void 0,timestamp:P.timestamp,...P.usage?{usage:P.usage}:{},...P.sources?{sources:P.sources}:{}})),filter_ids:e(he).length>0?e(he):void 0,model_item:w().find(P=>P.id===b),chat_id:c,session_id:(ce=M())==null?void 0:ce.id,id:te}).catch(P=>(at.error(`${P}`),le.at(-1).error={content:P},null));if(F!==null&&F.messages)for(const P of F.messages)P!=null&&P.id&&Pt(d,e(d).messages[P.id]={...e(d).messages[P.id],...e(d).messages[P.id].content!==P.content?{originalContent:e(d).messages[P.id].content}:{},...P});await ot(),y()==c&&(r()||(_e=await Mr(localStorage.token,c,{models:e(x),messages:le,history:e(d),params:e(R),files:e(j)}),Oa.set(1),await Ba.set(await Ua(localStorage.token,pe())))),s(A,null)},ur=async(c,b,te,le,F=null)=>{var ie;const ce=xa(e(d),le),P=await Pn(localStorage.token,b,{model:te,messages:ce.map(Ne=>({id:Ne.id,role:Ne.role,content:Ne.content,info:Ne.info?Ne.info:void 0,timestamp:Ne.timestamp,...Ne.sources?{sources:Ne.sources}:{}})),...F?{event:F}:{},model_item:w().find(Ne=>Ne.id===te),chat_id:c,session_id:(ie=M())==null?void 0:ie.id,id:le}).catch(Ne=>(at.error(`${Ne}`),ce.at(-1).error={content:Ne},null));if(P!==null&&P.messages)for(const Ne of P.messages)Pt(d,e(d).messages[Ne.id]={...e(d).messages[Ne.id],...e(d).messages[Ne.id].content!==Ne.content?{originalContent:e(d).messages[Ne.id].content}:{},...Ne});y()==c&&(r()||(_e=await Mr(localStorage.token,c,{models:e(x),messages:ce,history:e(d),params:e(R),files:e(j)}),Oa.set(1),await Ba.set(await Ua(localStorage.token,pe()))))},vr=async(c,b="")=>setInterval(()=>{var te;(te=M())==null||te.emit("usage",{action:"chat",model:c,chat_id:b})},1e3),Qa=async c=>{var b;if((b=e(g))==null||b.setText(""),e(x).length===0)at.error(C().t("Model not selected"));else{const te=e(x)[0],le=w().filter(pt=>pt.id===te).at(0),F=xa(e(d),e(d).currentId),ce=F.length!==0?F.at(-1):null,P=ja(),ie=ja(),Ne={id:P,parentId:ce?ce.id:null,childrenIds:[ie],role:"user",content:c||`[PROMPT] ${P}`,timestamp:Math.floor(Date.now()/1e3)},ft={id:ie,parentId:P,childrenIds:[],role:"assistant",content:`[RESPONSE] ${ie}`,done:!0,model:te,modelName:le.name??le.id,modelIdx:0,timestamp:Math.floor(Date.now()/1e3)};ce&&(ce.childrenIds.push(P),Pt(d,e(d).messages[ce.id]=ce)),Pt(d,e(d).messages[P]=Ne),Pt(d,e(d).messages[ie]=ft),Pt(d,e(d).currentId=ie),await ot(),e(f)&&qt(),F.length===0?await ha(e(d)):await p(y(),e(d))}},fr=async({modelId:c,parentId:b,messages:te})=>{const le=w().filter(P=>P.id===c).at(0);let F=e(d).messages[b],ce=F?F.id:null;for(const P of te){let ie=ja();if(P.role==="user"){const Ne={id:ie,parentId:ce,childrenIds:[],timestamp:Math.floor(Date.now()/1e3),...P};F&&(F.childrenIds.push(ie),Pt(d,e(d).messages[F.id]=F)),Pt(d,e(d).messages[ie]=Ne),F=Ne,ce=ie}else{const Ne={id:ie,parentId:ce,childrenIds:[],done:!0,model:le.id,modelName:le.name??le.id,modelIdx:0,timestamp:Math.floor(Date.now()/1e3),...P};F&&(F.childrenIds.push(ie),Pt(d,e(d).messages[F.id]=F)),Pt(d,e(d).messages[ie]=Ne),F=Ne,ce=ie}}Pt(d,e(d).currentId=ce),await ot(),e(f)&&qt(),te.length===0?await ha(e(d)):await p(y(),e(d))},Ot=async(c,b,te)=>{var nt,it,rt,yt,xt,Dt,dt,zt,Et,Nt,jt,wt,da,ht,Ut,ut,va,Ma,Ha;const{id:le,done:F,choices:ce,content:P,sources:ie,selected_model_id:Ne,error:ft,usage:pt}=c;if(ft&&await Vt(ft,b),ie&&!(b!=null&&b.sources)&&(b.sources=ie),ce)if((it=(nt=ce[0])==null?void 0:nt.message)!=null&&it.content)b.content+=(yt=(rt=ce[0])==null?void 0:rt.message)==null?void 0:yt.content;else{let oa=((Dt=(xt=ce[0])==null?void 0:xt.delta)==null?void 0:Dt.content)??"";if(!(b.content==""&&oa==`
`)){b.content+=oa,navigator.vibrate&&(((dt=i())==null?void 0:dt.hapticFeedback)??!1)&&navigator.vibrate(5);const ba=ls(is(b.content),((Nt=(Et=(zt=ge())==null?void 0:zt.audio)==null?void 0:Et.tts)==null?void 0:Nt.split_on)??"punctuation");ba.pop(),ba.length>0&&ba[ba.length-1]!==b.lastSentence&&(b.lastSentence=ba[ba.length-1],J.dispatchEvent(new CustomEvent("chat",{detail:{id:b.id,content:ba[ba.length-1]}})))}}if(P){b.content=P,navigator.vibrate&&(((jt=i())==null?void 0:jt.hapticFeedback)??!1)&&navigator.vibrate(5);const oa=ls(is(b.content),((ht=(da=(wt=ge())==null?void 0:wt.audio)==null?void 0:da.tts)==null?void 0:ht.split_on)??"punctuation");oa.pop(),oa.length>0&&oa[oa.length-1]!==b.lastSentence&&(b.lastSentence=oa[oa.length-1],J.dispatchEvent(new CustomEvent("chat",{detail:{id:b.id,content:oa[oa.length-1]}})))}if(Ne&&(b.selectedModelId=Ne,b.arena=!0),pt&&(b.usage=pt),Pt(d,e(d).messages[b.id]=b),F){b.done=!0,i().responseAutoCopy&&bs(b.content),i().responseAutoPlayback&&!Re()&&(await ot(),(Ut=document.getElementById(`speak-button-${b.id}`))==null||Ut.click());let oa=((Ha=ls(is(b.content),((Ma=(va=(ut=ge())==null?void 0:ut.audio)==null?void 0:va.tts)==null?void 0:Ma.split_on)??"punctuation"))==null?void 0:Ha.at(-1))??"";oa&&J.dispatchEvent(new CustomEvent("chat",{detail:{id:b.id,content:oa}})),J.dispatchEvent(new CustomEvent("chat:finish",{detail:{id:b.id,content:b.content}})),Pt(d,e(d).messages[b.id]=b),await ot(),e(f)&&qt(),await cr(te,b.model,b.id,xa(e(d),b.id))}await ot(),e(f)&&qt()},It=async(c,{_raw:b=!1}={})=>{var Ne,ft,pt,nt,it,rt,yt,xt,Dt;y();const te=e(x).map(dt=>w().map(zt=>zt.id).includes(dt)?dt:"");if(JSON.stringify(e(x))!==JSON.stringify(te)&&s(x,te),c===""&&e(z).length===0){at.error(C().t("Please enter a prompt"));return}if(e(x).includes("")){at.error(C().t("Model not selected"));return}if(e(z).length>0&&e(z).filter(dt=>dt.type!=="image"&&dt.status==="uploading").length>0){at.error(C().t("Oops! There are files still uploading. Please wait for the upload to complete."));return}if((((ft=(Ne=ge())==null?void 0:Ne.file)==null?void 0:ft.max_count)??null)!==null&&e(z).length+e(j).length>((nt=(pt=ge())==null?void 0:pt.file)==null?void 0:nt.max_count)){at.error(C().t("You can only chat with a maximum of {{maxCount}} file(s) at a time.",{maxCount:(rt=(it=ge())==null?void 0:it.file)==null?void 0:rt.max_count}));return}if((yt=e(d))!=null&&yt.currentId){const dt=e(d).messages[e(d).currentId];if(dt.done!=!0)return;if(dt.error&&!dt.content){at.error(C().t("Oops! There was an error in the previous response."));return}}(xt=e(g))==null||xt.setText(""),s(G,"");const le=xa(e(d),e(d).currentId),F=JSON.parse(JSON.stringify(e(z)));e(j).push(...F.filter(dt=>["doc","text","note","chat","folder","collection"].includes(dt.type)||dt.type==="file"&&!((dt==null?void 0:dt.content_type)??"").startsWith("image/"))),s(j,e(j).filter((dt,zt,Et)=>Et.findIndex(Nt=>JSON.stringify(Nt)===JSON.stringify(dt))===zt)),s(z,[]),(Dt=e(g))==null||Dt.setText("");let ce=ja(),P={id:ce,parentId:le.length!==0?le.at(-1).id:null,childrenIds:[],role:"user",content:c,files:F.length>0?F:void 0,timestamp:Math.floor(Date.now()/1e3),models:e(x)};Pt(d,e(d).messages[ce]=P),Pt(d,e(d).currentId=ce),le.length!==0&&e(d).messages[le.at(-1).id].childrenIds.push(ce);const ie=document.getElementById("chat-input");ie==null||ie.focus(),ue(),await ia(e(d),ce,{newChat:!0})},ia=async(c,b,{messages:te=null,modelId:le=null,modelIdx:F=null,newChat:ce=!1}={})=>{e(f)&&qt();let P=JSON.parse(JSON.stringify(y()));c=JSON.parse(JSON.stringify(c));const ie={};let Ne=le?[le]:e(Ie)!==void 0?[e(Ie).id]:e(x);for(const[ft,pt]of Ne.entries()){const nt=w().filter(it=>it.id===pt).at(0);if(nt){let it=ja(),rt={parentId:b,id:it,childrenIds:[],role:"assistant",content:"",model:nt.id,modelName:nt.name??nt.id,modelIdx:F||ft,timestamp:Math.floor(Date.now()/1e3)};Pt(d,e(d).messages[it]=rt),Pt(d,e(d).currentId=it),b!==null&&e(d).messages[b]&&Pt(d,e(d).messages[b].childrenIds=[...e(d).messages[b].childrenIds,it]),ie[`${pt}-${F||ft}`]=it}}s(d,e(d)),ce&&c.messages[c.currentId].parentId===null&&(P=await ha(c)),await ot(),c=JSON.parse(JSON.stringify(e(d))),await p(P,c),await Promise.all(Ne.map(async(ft,pt)=>{var it,rt,yt;const nt=w().filter(xt=>xt.id===ft).at(0);if(nt){xa(c,b).some(zt=>{var Et;return(Et=zt.files)==null?void 0:Et.some(Nt=>Nt.type==="image"||((Nt==null?void 0:Nt.content_type)??"").startsWith("image/"))})&&!(((yt=(rt=(it=nt.info)==null?void 0:it.meta)==null?void 0:rt.capabilities)==null?void 0:yt.vision)??!0)&&!e(U)&&at.error(C().t("Model {{modelName}} is not vision capable",{modelName:nt.name??nt.id}));let Dt=ie[`${ft}-${F||pt}`];const dt=await vr(nt.id,P);qt(),await Ia(nt,te&&te.length>0?te:xa(c,Dt),c,Dt),dt&&clearInterval(dt)}else at.error(C().t("Model {{modelId}} not found",{modelId:ft}))})),Oa.set(1),Ba.set(await Ua(localStorage.token,pe()))},ka=()=>{var te,le,F,ce,P,ie,Ne,ft,pt,nt,it,rt,yt,xt,Dt,dt,zt,Et,Nt,jt,wt,da,ht,Ut;let c={};(te=ge())!=null&&te.features&&(c={voice:Re(),image_generation:(F=(le=ge())==null?void 0:le.features)!=null&&F.enable_image_generation&&(((ce=X())==null?void 0:ce.role)==="admin"||(Ne=(ie=(P=X())==null?void 0:P.permissions)==null?void 0:ie.features)!=null&&Ne.image_generation)?e(U):!1,code_interpreter:(pt=(ft=ge())==null?void 0:ft.features)!=null&&pt.enable_code_interpreter&&(((nt=X())==null?void 0:nt.role)==="admin"||(yt=(rt=(it=X())==null?void 0:it.permissions)==null?void 0:rt.features)!=null&&yt.code_interpreter)?e(De):!1,web_search:(Dt=(xt=ge())==null?void 0:xt.features)!=null&&Dt.enable_web_search&&(((dt=X())==null?void 0:dt.role)==="admin"||(Nt=(Et=(zt=X())==null?void 0:zt.permissions)==null?void 0:Et.features)!=null&&Nt.web_search)?e(H):!1});const b=(jt=e(Ie))!=null&&jt.id?[e(Ie).id]:e(x);return b.filter(ut=>{var va,Ma,Ha,oa;return((oa=(Ha=(Ma=(va=w().find(ba=>ba.id===ut))==null?void 0:va.info)==null?void 0:Ma.meta)==null?void 0:Ha.capabilities)==null?void 0:oa.web_search)??!0}).length===b.length&&(da=(wt=ge())==null?void 0:wt.features)!=null&&da.enable_web_search&&(((ht=i())==null?void 0:ht.webSearch)??!1)==="always"&&(c={...c,web_search:!0}),(((Ut=i())==null?void 0:Ut.memory)??!1)&&(c={...c,memory:!0}),c},Ia=async(c,b,te,le,F)=>{var xt,Dt,dt,zt,Et,Nt,jt,wt,da,ht,Ut,ut,va,Ma,Ha,oa,ba,Fr,Dr,Br,Or,jr,Ur,Ve,Be,st;const ce=te.messages[le],P=te.messages[ce.parentId],ie=b.filter(Q=>Q.files).flatMap(Q=>Q.files);s(j,e(j).filter(Q=>ie.some(Mt=>Mt.id===Q.id)));let Ne=JSON.parse(JSON.stringify(e(j)));Ne.push(...((P==null?void 0:P.files)??[]).filter(Q=>["doc","text","note","chat","collection"].includes(Q.type)||Q.type==="file"&&!((Q==null?void 0:Q.content_type)??"").startsWith("image/"))),Ne=Ne.filter((Q,je,Mt)=>Mt.findIndex(_t=>JSON.stringify(_t)===JSON.stringify(Q))===je),qt(),J.dispatchEvent(new CustomEvent("chat:start",{detail:{id:le}})),await ot();let ft;(xt=i())!=null&&xt.userLocation&&(ft=await Cn(localStorage.token).catch(Q=>{}));const pt=((dt=(Dt=c==null?void 0:c.info)==null?void 0:Dt.params)==null?void 0:dt.stream_response)??((Et=(zt=i())==null?void 0:zt.params)==null?void 0:Et.stream_response)??((Nt=e(R))==null?void 0:Nt.stream_response)??!0;let nt=[(jt=e(R))!=null&&jt.system||i().system?{role:"system",content:`${((wt=e(R))==null?void 0:wt.system)??((da=i())==null?void 0:da.system)??""}`}:void 0,...b.map(Q=>({...Q,content:vn(Q.content)}))].filter(Q=>Q);nt=nt.map((Q,je,Mt)=>{var Yt,Kt;const _t=((Q==null?void 0:Q.files)??[]).filter(Ct=>Ct.type==="image"||((Ct==null?void 0:Ct.content_type)??"").startsWith("image/"));return{role:Q.role,...Q.role==="user"&&_t.length>0?{content:[{type:"text",text:((Yt=Q==null?void 0:Q.merged)==null?void 0:Yt.content)??Q.content},..._t.map(Ct=>({type:"image_url",image_url:{url:Ct.url}}))]}:{content:((Kt=Q==null?void 0:Q.merged)==null?void 0:Kt.content)??Q.content}}}).filter(Q=>{var je;return(Q==null?void 0:Q.role)==="user"||((je=Q==null?void 0:Q.content)==null?void 0:je.trim())});const it=[],rt=[];for(const Q of e(Se))if(Q.startsWith("direct_server:")){let je=Q.replace("direct_server:","");isNaN(parseInt(je))?rt.push(je):rt.push(parseInt(je))}else it.push(Q);const yt=await xn(localStorage.token,{stream:pt,model:c.id,messages:nt,params:{...(ht=i())==null?void 0:ht.params,...e(R),stop:((Ut=e(R))==null?void 0:Ut.stop)??((va=(ut=i())==null?void 0:ut.params)==null?void 0:va.stop)??void 0?(((Ma=e(R))==null?void 0:Ma.stop.split(",").map(Q=>Q.trim()))??i().params.stop).map(Q=>decodeURIComponent(JSON.parse('"'+Q.replace(/\"/g,'\\"')+'"'))):void 0},files:((Ne==null?void 0:Ne.length)??0)>0?Ne:void 0,filter_ids:e(he).length>0?e(he):void 0,tool_ids:it.length>0?it:void 0,tool_servers:(Pe()??[]).filter((Q,je)=>rt.includes(je)||rt.includes(Q==null?void 0:Q.id)),features:ka(),variables:{...fn((Ha=X())==null?void 0:Ha.name,(oa=i())!=null&&oa.userLocation?ft:void 0)},model_item:w().find(Q=>Q.id===c.id),session_id:(ba=M())==null?void 0:ba.id,chat_id:y(),id:le,parent_id:(P==null?void 0:P.id)??null,parent_message:P,background_tasks:{...!r()&&(nt.length==1||nt.length==2&&((Fr=nt.at(0))==null?void 0:Fr.role)==="system"&&((Dr=nt.at(1))==null?void 0:Dr.role)==="user")&&(e(x)[0]===c.id||e(Ie)!==void 0)?{title_generation:((Or=(Br=i())==null?void 0:Br.title)==null?void 0:Or.auto)??!0,tags_generation:((jr=i())==null?void 0:jr.autoTags)??!0}:{},follow_up_generation:((Ur=i())==null?void 0:Ur.autoFollowUps)??!0},...pt&&(((st=(Be=(Ve=c.info)==null?void 0:Ve.meta)==null?void 0:Be.capabilities)==null?void 0:st.usage)??!1)?{stream_options:{include_usage:!0}}:{}},`${Ro}/api`).catch(async Q=>{var Mt;let je=Q;return(Mt=Q==null?void 0:Q.error)!=null&&Mt.message?je=Q.error.message:Q!=null&&Q.message&&(je=Q.message),typeof je=="object"&&(je=C().t("Uh-oh! There was an issue with the response.")),at.error(`${je}`),ce.error={content:Q},ce.done=!0,Pt(d,e(d).messages[le]=ce),Pt(d,e(d).currentId=le),null});yt&&(yt.error?await Vt(yt.error,ce):e(A)?e(A).push(yt.task_id):s(A,[yt.task_id])),await ot(),qt()},Vt=async(c,b)=>{let te="",le;c&&(le=c),"detail"in le?(at.error(le.detail),te=le.detail):"error"in le?"message"in le.error?(at.error(le.error.message),te=le.error.message):(at.error(le.error),te=le.error):"message"in le&&(at.error(le.message),te=le.message),b.error={content:C().t("Uh-oh! There was an issue with the response.")+`
`+te},b.done=!0,b.statusHistory&&(b.statusHistory=b.statusHistory.filter(F=>F.action!=="knowledge_search")),Pt(d,e(d).messages[b.id]=b)},Rt=async()=>{if(e(A)){for(const b of e(A))await zn(localStorage.token,b).catch(te=>(at.error(`${te}`),null));s(A,null);const c=e(d).messages[e(d).currentId];if(c.parentId&&e(d).messages[c.parentId])for(const b of e(d).messages[c.parentId].childrenIds)Pt(d,e(d).messages[b].done=!0);Pt(d,e(d).messages[e(d).currentId]=c),e(f)&&qt()}e(Je)&&(s(Je,!1),V==null||V.abort(),V=null)},ya=async(c,b)=>{let te=b,le=ja(),F={id:le,parentId:c,childrenIds:[],role:"user",content:te,models:e(x),timestamp:Math.floor(Date.now()/1e3)};c!==null&&Pt(d,e(d).messages[c].childrenIds=[...e(d).messages[c].childrenIds,le]),Pt(d,e(d).messages[le]=F),Pt(d,e(d).currentId=le),await ot(),e(f)&&qt(),await ia(e(d),le)},Xa=async(c,b=null)=>{if(e(d).currentId){let te=e(d).messages[c.parentId];if(!te){at.error(C().t("Parent message not found"));return}e(f)&&qt(),await ia(e(d),te.id,{...b?{messages:[...xa(e(d),c.id),{role:"user",content:b}]}:{},...((te==null?void 0:te.models)??[...e(x)]).length>1?{modelId:c.model,modelIdx:c.modelIdx}:{}})}},rr=async()=>{if(JSON.parse(JSON.stringify(y())),e(d).currentId&&e(d).messages[e(d).currentId].done==!0){const c=e(d).messages[e(d).currentId];c.done=!1,await ot();const b=w().filter(te=>te.id===((c==null?void 0:c.selectedModelId)??c.model)).at(0);b&&await Ia(b,xa(e(d),c.id),e(d),c.id)}},pa=async(c,b,te)=>{var ce;const le=e(d).messages[c],F={status:!0,content:""};le.merged=F,Pt(d,e(d).messages[c]=le);try{s(Je,!0);const[P,ie]=await Tn(localStorage.token,le.model??"",le.parentId?e(d).messages[le.parentId].content:"",b);if(P&&P.ok&&P.body&&e(Je)){V=ie;const Ne=await Pl(P.body,!!(((ce=i())==null?void 0:ce.splitLargeChunks)??!1));for await(const ft of Ne){const{value:pt,done:nt,sources:it,error:rt,usage:yt}=ft;if(rt||nt){s(Je,!1),V=null;break}F.content==""&&pt==`
`||(F.content+=pt,Pt(d,e(d).messages[c]=le),e(f)&&qt())}await p(te,e(d))}}catch(P){}},ha=async c=>{var te,le;let b=y();return r()?(b=`local:${(le=M())==null?void 0:le.id}`,await Va.set(b)):(_e=await Ts(localStorage.token,{id:b,title:C().t("New Chat"),models:e(x),system:i().system??void 0,params:e(R),history:c,messages:xa(c,c.currentId),tags:[],timestamp:Date.now()},(te=h())==null?void 0:te.id),b=_e.id,await Va.set(b),window.history.replaceState(c.state,"",`/c/${b}`),await ot(),await Ba.set(await Ua(localStorage.token,pe())),Oa.set(1),dr.set(null)),await ot(),b},p=async(c,b)=>{y()==c&&(r()||(_e=await Mr(localStorage.token,c,{models:e(x),history:b,messages:xa(b,b.currentId),params:e(R),files:e(j)}),Oa.set(1),await Ba.set(await Ua(localStorage.token,pe()))))},be=5e3;let fe=null;const et=async(c,b=null)=>{fe&&clearTimeout(fe),c.prompt!==null&&c.prompt.length<be?fe=setTimeout(async()=>{await sessionStorage.setItem(`chat-input${b?`-${b}`:""}`,JSON.stringify(c))},500):sessionStorage.removeItem(`chat-input${b?`-${b}`:""}`)},Ke=async(c=null)=>{fe&&clearTimeout(fe),await sessionStorage.removeItem(`chat-input${c?`-${c}`:""}`)},kt=async(c,b)=>{c&&b?await yn(localStorage.token,c,b).catch(le=>(at.error(`${le}`),null))&&(Oa.set(1),await Ba.set(await Ua(localStorage.token,pe())),await Zo.set(await bn(localStorage.token)),at.success(C().t("Chat moved successfully"))):at.error(C().t("Failed to move chat"))};Tt(()=>(e(Ie),e(x)),()=>{e(Ie)!==void 0?s(He,[e(Ie).id]):s(He,e(x))}),Tt(()=>B(re()),()=>{re()&&K()}),Tt(()=>(e(x),B(re())),()=>{e(x)&&re()!==""&&ue()}),Tt(()=>(e(He),e(Ee)),()=>{JSON.stringify(e(He))!==JSON.stringify(e(Ee))&&Oe()}),Tt(()=>e(x),()=>{e(x)!==null&&Ze()}),Tt(()=>(e(d),Er),()=>{e(d)?sa():Er.set([])}),Da(),ta();var Zt=Wv();Ao("vhdo11",c=>{To(b=>{zo.title=`
		${b??""}
	`},[()=>(i(),ve(),D(),o(()=>i().showChatTitleInTab!==!1&&ve()?`${ve().length>30?`${ve().slice(0,30)}...`:ve()}  ${D()}`:`${D()}`))])});var Gt=m(ke(Zt),2);lo(Gt,{get title(){return e(Ce)},get message(){return e(de)},get input(){return e(Me)},get inputPlaceholder(){return e(xe)},get inputValue(){return e(Ge)},get show(){return e(ye)},set show(c){s(ye,c)},$$events:{confirm:c=>{c.detail?e(We)(c.detail):e(We)(!0)},cancel:()=>{e(We)(!1)}},$$legacy:!0});var Ea=m(Gt,2),Wa=a(Ea);{var Na=c=>{var b=Uv(),te=a(b);{var le=P=>{var ie=Lv(),Ne=ke(ie);nr(2),Z(()=>hr(Ne,`background-image: url(${h(),o(()=>{var ft,pt;return(pt=(ft=h())==null?void 0:ft.meta)==null?void 0:pt.background_image_url})??""})  `)),l(P,ie)},F=P=>{var ie=ct(),Ne=ke(ie);{var ft=pt=>{var nt=Fv(),it=ke(nt);nr(2),Z(()=>hr(it,`background-image: url(${i(),ge(),o(()=>{var rt,yt,xt;return((rt=i())==null?void 0:rt.backgroundImageUrl)??((xt=(yt=ge())==null?void 0:yt.license_metadata)==null?void 0:xt.background_image_url)})??""})  `)),l(pt,nt)};N(Ne,pt=>{i(),ge(),o(()=>{var nt,it,rt;return((nt=i())==null?void 0:nt.backgroundImageUrl)??((rt=(it=ge())==null?void 0:it.license_metadata)==null?void 0:rt.background_image_url)??null})&&pt(ft)},!0)}l(P,ie)};N(te,P=>{h(),o(()=>{var ie,Ne;return h()&&((Ne=(ie=h())==null?void 0:ie.meta)==null?void 0:Ne.background_image_url)})?P(le):P(F,!1)})}var ce=m(te,2);jo(ce,{direction:"horizontal",class:"w-full h-full",children:(P,ie)=>{var Ne=jv(),ft=ke(Ne);Gs(ft,{defaultSize:50,minSize:30,class:"h-full flex relative max-w-full flex-col",children:(nt,it)=>{var rt=Ov(),yt=ke(rt);{let Et=$e(()=>(y(),ve(),e(x),i(),e(R),e(d),o(()=>({id:y(),chat:{title:ve(),models:e(x),system:i().system??void 0,params:e(R),history:e(d),timestamp:Date.now()}})))),Nt=$e(()=>(e(d),o(()=>!!e(d).currentId)));Ja(lu(yt,{get chat(){return e(Et)},get history(){return e(d)},get title(){return ve()},get shareEnabled(){return e(Nt)},initNewChat:Ht,archiveChatHandler:()=>{},moveChatHandler:kt,onSaveTempChat:async()=>{var jt,wt;try{if(!((jt=e(d))!=null&&jt.currentId)||!Object.keys(e(d).messages).length){at.error(C().t("No conversation to save"));return}const da=xa(e(d),e(d).currentId),ht=((wt=da.find(ut=>ut.role==="user"))==null?void 0:wt.content)??C().t("New Chat"),Ut=await Ts(localStorage.token,{id:ja(),title:ht.length>50?`${ht.slice(0,50)}...`:ht,models:e(x),history:e(d),messages:da,timestamp:Date.now()},null);Ut&&(Pa.set(!1),Va.set(Ut.id),Ba.set(await Ua(localStorage.token,pe())),await Sr(`/c/${Ut.id}`),at.success(C().t("Conversation saved successfully")))}catch(da){at.error(C().t("Failed to save conversation"))}},get selectedModels(){return e(x)},set selectedModels(jt){s(x,jt)},$$legacy:!0}),jt=>s(I,jt),()=>e(I))}var xt=m(yt,2),Dt=a(xt);{var dt=Et=>{var Nt=Dv(),jt=ke(Nt),wt=a(jt),da=a(wt);{let ut=$e(()=>(e(z),o(()=>e(z).length>0)));Qs(da,{get chatId(){return y()},setInputText:va=>{var Ma;(Ma=e(g))==null||Ma.setText(va)},get selectedModels(){return e(x)},get atSelectedModel(){return e(Ie)},sendMessage:ia,showMessage:se,submitMessage:ya,continueResponse:rr,regenerateResponse:Xa,mergeResponses:pa,chatActionHandler:ur,addMessages:fr,topPadding:!0,get bottomPadding(){return e(ut)},onSelect:oe,get history(){return e(d)},set history(va){s(d,va)},get autoScroll(){return e(f)},set autoScroll(va){s(f,va)},get prompt(){return e(G)},set prompt(va){s(G,va)},$$legacy:!0})}t(wt),t(jt),Ja(jt,ut=>s($,ut),()=>e($));var ht=m(jt,2),Ut=a(ht);Ja(vo(Ut,{get history(){return e(d)},get taskIds(){return e(A)},get selectedModels(){return e(x)},get toolServers(){return Pe()},get generating(){return e(Je)},stopResponse:Rt,createMessagePair:Qa,onUpload:Wt,onChange:ut=>{r()||et(ut,y())},get files(){return e(z)},set files(ut){s(z,ut)},get prompt(){return e(G)},set prompt(ut){s(G,ut)},get autoScroll(){return e(f)},set autoScroll(ut){s(f,ut)},get selectedToolIds(){return e(Se)},set selectedToolIds(ut){s(Se,ut)},get selectedFilterIds(){return e(he)},set selectedFilterIds(ut){s(he,ut)},get imageGenerationEnabled(){return e(U)},set imageGenerationEnabled(ut){s(U,ut)},get codeInterpreterEnabled(){return e(De)},set codeInterpreterEnabled(ut){s(De,ut)},get webSearchEnabled(){return e(H)},set webSearchEnabled(ut){s(H,ut)},get atSelectedModel(){return e(Ie)},set atSelectedModel(ut){s(Ie,ut)},get showCommands(){return e(Te)},set showCommands(ut){s(Te,ut)},$$events:{submit:async ut=>{Ke(),(ut.detail||e(z).length>0)&&(await ot(),It(ut.detail.replaceAll(`

`,`
`)))}},$$legacy:!0}),ut=>s(g,ut),()=>e(g)),nr(2),t(ht),Qe("scroll",jt,ut=>{s(f,e($).scrollHeight-e($).scrollTop<=e($).clientHeight+5)}),l(Et,Nt)},zt=Et=>{var Nt=Bv(),jt=a(Nt);Av(jt,{get history(){return e(d)},get selectedModels(){return e(x)},get toolServers(){return Pe()},stopResponse:Rt,createMessagePair:Qa,onSelect:oe,onUpload:Wt,onChange:wt=>{r()||et(wt)},get messageInput(){return e(g)},set messageInput(wt){s(g,wt)},get files(){return e(z)},set files(wt){s(z,wt)},get prompt(){return e(G)},set prompt(wt){s(G,wt)},get autoScroll(){return e(f)},set autoScroll(wt){s(f,wt)},get selectedToolIds(){return e(Se)},set selectedToolIds(wt){s(Se,wt)},get selectedFilterIds(){return e(he)},set selectedFilterIds(wt){s(he,wt)},get imageGenerationEnabled(){return e(U)},set imageGenerationEnabled(wt){s(U,wt)},get codeInterpreterEnabled(){return e(De)},set codeInterpreterEnabled(wt){s(De,wt)},get webSearchEnabled(){return e(H)},set webSearchEnabled(wt){s(H,wt)},get atSelectedModel(){return e(Ie)},set atSelectedModel(wt){s(Ie,wt)},get showCommands(){return e(Te)},set showCommands(wt){s(Te,wt)},$$events:{submit:async wt=>{Ke(),(wt.detail||e(z).length>0)&&(await ot(),It(wt.detail.replaceAll(`

`,`
`)))}},$$legacy:!0}),t(Nt),l(Et,Nt)};N(Dt,Et=>{i(),h(),B(xa),e(d),o(()=>{var Nt;return((Nt=i())==null?void 0:Nt.landingPageMode)==="chat"&&!h()||xa(e(d),e(d).currentId).length>0})?Et(dt):Et(zt,!1)})}t(xt),l(nt,rt)},$$slots:{default:!0}});var pt=m(ft,2);{let nt=$e(()=>(e(He),o(()=>{var rt;return((rt=e(He))==null?void 0:rt.at(0))??null}))),it=$e(()=>(e(He),w(),o(()=>e(He).reduce((rt,yt,xt,Dt)=>{const dt=w().find(zt=>zt.id===yt);return dt?[...rt,dt]:rt},[]))));Ja(rv(pt,{get chatId(){return y()},get modelId(){return e(nt)},get models(){return e(it)},submitPrompt:It,stopResponse:Rt,showMessage:se,get eventTarget(){return J},get history(){return e(d)},set history(rt){s(d,rt)},get chatFiles(){return e(j)},set chatFiles(rt){s(j,rt)},get params(){return e(R)},set params(rt){s(R,rt)},get files(){return e(z)},set files(rt){s(z,rt)},get pane(){return e(L)},set pane(rt){s(L,rt)},$$legacy:!0}),rt=>s(k,rt),()=>e(k))}l(P,Ne)},$$slots:{default:!0}}),t(b),za(1,b,()=>mr,()=>({duration:50})),l(c,b)},Aa=c=>{var b=ct(),te=ke(b);{var le=F=>{var ce=Rv(),P=a(ce),ie=a(P);Sa(ie,{className:"size-5"}),t(P),t(ce),l(F,ce)};N(te,F=>{e(Ye)&&F(le)},!0)}l(c,b)};N(Wa,c=>{e(Ye)?c(Aa,!1):c(Na)})}t(Ea),Z(()=>gt(Ea,1,`h-screen max-h-[100dvh] transition-width duration-200 ease-in-out ${Ae()?"  md:max-w-[calc(100%-var(--sidebar-width))]":" "} w-full max-w-full flex flex-col`,"svelte-vhdo11")),l(Y,Zt),ea(),we()}export{$g as C};
//# sourceMappingURL=Ck-74lEN.js.map
