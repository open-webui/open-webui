{"version":3,"mappings":"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","names":["PENDING","THEN","await_block","node","get_input","pending_fn","then_fn","catch_fn","hydrating","hydrate_next","runes","is_runes","v","UNINITIALIZED","value","source","mutable_source","error","branches","BranchManager","block","input","destroyed","mismatch","is_promise","HYDRATION_START_ELSE","set_hydrate_node","skip_nodes","set_hydrating","restore","capture","resolved","resolve","fn","Batch","unset_context","is_flushing_sync","flushSync","internal_set","target","e","queue_micro_task","dispatch","createEventDispatcher","chatId","tags","$.mutable_source","getTags","getTagsById","addTag","tagName","addTagById","toast","$.set","updateChatById","$.get","_tags","getAllTags","deleteTag","deleteTagById","onMount","$_tags","Tags","$$anchor","createParser","onParse","isFirstChunk","buffer","startingPosition","startingFieldLength","eventId","eventName","data","reset","feed","chunk","hasBom","BOM","length","position","discardTrailingNewline","lineLength","fieldLength","character","index","parseEventStreamLine","lineBuffer","noValue","field","step","valueLength","retry","charCode","EventSourceParserStream","parser","controller","event","createOpenAITextStream","responseBody","splitLargeDeltas","eventStream","iterator","openAIStreamToIterator","streamLargeDeltasAsRandomChunks","reader","done","parsedData","_c","_b","_a","textStreamUpdate","content","chunkSize","sleep","ms","className","strokeWidth","svg","root","$.set_attribute","$.set_class","$.clsx","$.append","AudioQueue","audioElement","newId","rate","url","API_KEY","CLIENT_ID","getCredentials","response","config","SCOPE","validateCredentials","oauthToken","initialized","loadGoogleDriveApi","reject","script","loadGoogleAuthApi","getAuthToken","initialize","createPicker","token","doc","fileId","fileName","fileUrl","mimeType","downloadUrl","exportFormat","errorText","blob","result","_OneDriveConfig","__publicField","authorityType","_d","authorityEndpoint","clientId","msalParams","PublicClientApplication","__vitePreload","sharePointBaseUrl","OneDriveConfig","getToken","resource","authParams","accessToken","msalInstance","resp","popupError","getPickerParams","channelId","uuidv4","params","downloadOneDriveFile","fileInfo","fileInfoUrl","downloadResponse","openOneDrivePicker","pickerWindow","channelPort","baseUrl","handleWindowMessage","message","handlePortMessage","portEvent","portData","command","newToken","cleanup","authToken","queryString","form","err","pickAndDownloadFile","pickerResult","selectedFile","i18n","getContext","onSelect","$.prop","$$props","loaded","items","selectedIdx","page","itemsLoading","allItemsLoaded","loadMoreItems","getItemsPage","res","getChatList","item","$chatId","dayjs","tick","div","root_2","$i18n","div_1","root_3","$.each","node_2","idx","button","root_4","div_2","$.child","decodeString","$.untrack","Tooltip","node_3","div_3","root_5","$.reset","Loader","div_4","root_7","Spinner","node_5","div_5","$.sibling","$$render","consequent_1","consequent","alternate","div_6","root_8","node_6","consequent_2","alternate_1","getNoteList","note","PageEdit","node_4","root_6","root_9","node_7","selectedItem","selectedFileItemsPage","selectedFileItems","selectedFileItemsTotal","selectedFileItemsLoading","selectedFileAllItemsLoaded","initSelectedFileItems","getSelectedFileItemsPage","loadMoreSelectedFileItems","searchKnowledgeFilesById","pageItems","init","getKnowledgeBases","root_1","$.first_child","fragment_2","Database","button_1","ChevronDown","ChevronRight","root_10","root_11","node_9","div_7","root_13","node_11","file","button_2","root_15","div_8","node_12","DocumentPage","node_13","div_9","root_17","div_10","root_19","node_15","div_11","consequent_4","consequent_3","alternate_2","div_12","root_21","node_17","div_13","consequent_6","alternate_3","div_14","root_22","node_18","consequent_7","alternate_4","files","selectedModels","fileUploadCapableModels","screenCaptureHandler","uploadFilesHandler","inputFilesHandler","uploadGoogleDriveHandler","uploadOneDriveHandler","onUpload","onClose","show","tab","showAttachWebpageModal","fileUploadEnabled","detectMobile","userAgent","handleFileChange","inputFiles","$user","AttachWebpageModal","$$value","node_1","Dropdown","flyAndScale","Clip","cameraInputElement","Camera","node_8","GlobeAlt","node_10","$config","node_14","root_14","node_16","root_16","ClockRotateRight","node_19","$chats","fragment_14","button_3","root_20","div_15","div_16","div_17","node_23","_f","_e","$.transition","div_18","button_4","node_25","ChevronLeft","div_19","div_20","node_26","Knowledge","div_21","root_24","button_5","node_28","div_22","div_23","node_29","Notes","div_24","root_26","button_6","node_31","div_25","div_26","node_32","Chats","div_27","root_28","button_7","node_34","div_28","div_29","node_35","div_30","root_30","div_31","div_32","root_32","div_33","div_34","consequent_11","consequent_8","consequent_5","$.event","selectedToolIds","selectedTools","$tools","tool","Modal","XMark","$toolServers","$.index","Collapsible","$.template_effect","$.set_text","text_3","fragment_3","a","text_5","text_6","toolServer","tool_spec","toggleFilters","selectedFilterIds","showWebSearchButton","webSearchEnabled","showImageGenerationButton","imageGenerationEnabled","showCodeInterpreterButton","codeInterpreterEnabled","onShowValves","tools","$_tools","_tools","getTools","i","arr","serverIdx","server","id","Wrench","span","text","b","filter","root_12","img","$0","Sparkles","Knobs","Switch","Photo","node_20","Terminal","node_22","root_23","span_1","toolId","node_27","root_25","node_30","div_35","root_27","div_36","button_8","root_29","node_33","div_37","state","parts","serverId","authUrl","getOAuthClientAuthorizationUrl","inputContent","autocomplete","generateAutoCompletion","onChange","inputElement","Drawer","$settings","RichTextInput","duration","relativeTime","createMessagePair","stopResponse","autoScroll","generating","atSelectedModel","selectedModelIds","history","taskIds","prompt","showInputVariablesModal","inputVariablesModalCallback","variableValues","inputVariables","inputVariableValues","showValvesModal","selectedValvesType","selectedValvesItemId","integrationsMenuCloseOnOutsideClick","inputVariableHandler","extractInputVariables","replaceVariables","textVariableHandler","clipboardText","clipboardItems","type","location","getUserPosition","sessionUser","getSessionUser","name","bio","gender","birthDate","age","getAge","language","date","getFormattedDate","time","getFormattedTime","dateTime","getCurrentDateTime","timezone","getUserTimezone","weekday","getWeekday","variables","chatInputElement","setText","cb","getCommand","chatInput","word","replaceCommandWithText","insertTextAtCursor","chatInputContainer","words","extractCurlyBraceWords","showCommands","suggestions","showTools","recording","isComposing","compositionEndedAt","isSafari","inOrNearComposition","filesInputElement","showInputModal","dragged","shiftKey","placeholder","visionCapableModels","webSearchCapableModels","imageGenerationCapableModels","codeInterpreterCapableModels","showToolsButton","scrollToBottom","element","mediaStream","video","canvas","track","imageUrl","uploadFileHandler","process","itemData","$_user","tempItemId","fileItem","$temporaryChatEnabled","extractContentFromFile","metadata","_g","_j","_i","_h","uploadedFile","uploadFile","_k","_l","_m","compressImageHandler","settings","settingsCompression","configWidth","configHeight","width","height","compressImage","compressedFile","convertHeicToJpeg","createNote","createNoteHandler","goto","onDragOver","onDragLeave","onDrop","onKeyDown","onKeyUp","onFocus","onBlur","getSuggestionRenderer","CommandSuggestionList","f","dropzoneElement","onDestroy","model","$models","m","acc","filters","f1","f2","FilesOverlay","ToolServersModal","InputVariablesModal","$.derived_safe_equal","ValvesModal","InputModal","VoiceRecording","filename","WEBUI_API_BASE_URL","fileIdx","Image","FileItem","Expand","$mobile","createMessagesList","isCtrlPressed","suggestionsContainerElement","userMessageElement","editButton","clipboardData","PASTED_TEXT_CHARACTER_LIMIT","InputMenu","fileData","PlusAlt","IntegrationsMenu","Component","root_18","node_24","filterId","img_1","$.preventDefault","consequent_12","button_9","node_37","node_38","consequent_13","button_10","root_31","node_40","node_41","consequent_14","node_43","button_11","root_33","button_12","root_36","node_45","button_13","root_38","stream","root_39","node_48","button_14","root_40","node_49","Voice","$TTSWorker","TTSWorker","KokoroWorker","showCallOverlay","showControls","root_41","node_50","button_15","root_42","node_51","div_38","root_43","DOMPurify","marked","div_39","root_44","_inputFiles","$.mutate","consequent_20","disabled","showSetDefault","saveDefaultModel","it","updateUserSettings","pinModelHandler","modelId","pinnedModels","_selectedModels","fragment","selectedModel","selectedModelIdx","Selector","saveAs","fileSaver","shareHandler","moveChatHandler","archiveChatHandler","chat","showFullMessages","getChatAsText","downloadTxt","chatText","downloadPdf","jsPDF","html2canvas","containerElement","isDarkMode","virtualWidth","clonedElement","r","pdf","pageWidthMM","pageHeightMM","pxPerMM","pxPerPDFMM","pagePixelHeight","offsetY","sliceHeight","pageCanvas","imgData","imgHeightMM","left","top","right","bottom","pageWidth","pageHeight","usableWidth","fontSize","lineHeight","paragraphs","y","paragraph","lines","line","downloadJSONExport","chatObj","getChatById","Messages","showOverview","showArtifacts","showEmbeds","AdjustmentsHorizontal","Map","Cube","$artifactContents","Share","Download","copyToClipboard","Clipboard","node_21","Folder","$folders","folder","ArchiveBox","initNewChat","shareEnabled","showModelSelector","onSaveTempChat","closedBannerIds","showShareChatModal","ShareChatModal","nav","$showSidebar","Sidebar","showSidebar","ModelSelector","ChatBubbleDottedChecked","ChatBubbleDotted","temporaryChatEnabled","ChatCheck","ChatPlus","Menu","EllipsisHorizontal","$showControls","UserMenu","showArchivedChats","consequent_9","Banner","$banners","banner","bannerId","selectedId","loading","valvesSpec","valves","debounceTimer","debounceSubmitHandler","submitHandler","getUserValves","getToolUserValvesById","getToolUserValvesSpecById","getFunctionUserValvesById","getFunctionUserValvesSpecById","property","updateToolUserValvesById","updateFunctionUserValvesById","$functions","functions","getFunctions","select","option","option_1","select_1","option_2","fragment_1","option_3","option_4","func","option_5","fragment_4","Valves","chatFiles","showValves","textarea","$.remove_textarea_child","AdvancedParams","devices","device","eventTarget","submitPrompt","wakeLock","confirmed","assistantSpeaking","emoji","camera","cameraStream","chatStreaming","rmsLevel","hasStartedSpeaking","mediaRecorder","audioStream","audioChunks","videoInputDevices","selectedVideoInputDeviceId","getVideoInputDevices","startCamera","startVideoStream","stopVideoStream","takeScreenshot","context","dataURL","stopCamera","MIN_DECIBELS","transcribeHandler","audioBlob","blobToFile","transcribeAudio","_responses","stopRecordingCallback","_continue","$showCallOverlay","_audioChunks","startRecording","analyseAudio","stopAudioStream","calculateRMS","sumSquares","normalizedValue","audioContext","audioStreamSource","analyser","bufferLength","domainData","timeDomainData","lastSoundTime","processFrame","stopAllAudio","finishedMessages","currentMessageId","currentUtterance","getVoiceId","_p","_o","_n","speakSpeechSynthesisHandler","voices","getVoicesLoop","voiceId","voice","playAudio","audio","audioAbortController","audioCache","emojiCache","fetchAudio","generateEmoji","synthesizeOpenAISpeech","blobUrl","messages","monitorAndPlayAudio","signal","chatStartHandler","chatEventHandler","chatFinishHandler","setWakeLock","$.set_style","text_1","svg_1","VideoInputMenu","alternate_5","alternate_6","alternate_7","overlay","contents","selectedContentIdx","copied","iframeElement","navigateContent","direction","iframeLoadHandler","showFullScreen","downloadArtifact","artifactCode","codeIdx","artifactContents","ArrowsPointingOut","iframe","SvgPanZoom","getSrcUrl","messageId","sourceId","parsed","hasQuery","$embed","FullHeightIframe","embed","models","showMessage","pane","mediaQuery","largeScreen","minSize","openPane","container","size","handleMediaQuery","onMouseDown","onMouseUp","entries","entry","percentage","closeHandler","CallOverlay","Embeds","Artifacts","$$source","Overview","Controls","$showOverview","$showArtifacts","$showEmbeds","PaneResizer","Pane","consequent_10","alternate_8","localizedFormat","chats","chatListLoading","allChatsLoaded","loadHandler","chatList","getTimeRange","orderBy","setSortKey","key","ChevronUp","span_2","span_3","text_2","a_1","loadChats","newChatList","getChatListByFolderId","setChatList","ChatList","onUpdate","folderId","onDelete","showFolderModal","showDeleteConfirm","deleteFolderContents","updateHandler","meta","currentName","updateFolderById","_folder","getFolderById","selectedFolder","updateIconHandler","iconName","deleteHandler","deleteFolderById","exportHandler","getChatsByFolderId","FolderModal","DeleteConfirmDialog","EmojiPicker","Emoji","FolderMenu","messageInput","toolServers","$_models","EyeSlash","FolderTitle","$selectedFolder","$currentChatPage","currentChatPage","modelIdx","tag","sanitizeResponseContent","fade","MessageInput","FolderPlaceholder","Suggestions","chatIdProp","controlPane","controlPaneComponent","messagesContainerElement","navbarElement","showEventConfirmation","eventConfirmationTitle","eventConfirmationMessage","eventConfirmationInput","eventConfirmationInputPlaceholder","eventConfirmationInputValue","eventCallback","chatIdUnsubscriber","generationController","navigateHandler","storageChatInput","loadChat","setDefaults","saveSessionSelectedModels","selectedModelsString","oldSelectedModelIds","onSelectedModelIdsChange","resetInput","t","_q","ignoreSettings","_chatId","_messageId","messageChildrenIds","messageElement","saveChatHandler","chatCompletionEventHandler","responseMessage","chatTitle","allTags","existingCodeExecutionIndex","execution","toastType","toastContent","onMessageHandler","savedModelIds","pageSubscribe","showControlsSubscribe","selectedFolderSubscribe","stopAudio","$audioQueue","$socket","audioQueue","p","uploadGoogleDriveFile","fetchOptions","fileResponse","contentType","fileBlob","uploadWeb","urls","fileItems","isYoutubeUrl","processYoutubeVideo","processWeb","getContents","codeBlocks","htmlContent","cssContent","jsContent","getCodeBlockContents","renderedContent","availableModels","defaultModels","$page","urlModels","modelSelectorButton","modelSelectorInput","_r","_s","_t","q","chatContent","convertMessagesToHistory","taskRes","getTaskIdsByChatId","behavior","chatCompletedHandler","responseMessageId","chatCompleted","chatActionHandler","actionId","chatAction","getChatEventEmitter","userPrompt","parentMessage","userMessageId","userMessage","initChatHandler","addMessages","parentId","currentParentId","choices","sources","selected_model_id","usage","handleOpenAIError","messageContentParts","getMessageContentParts","removeAllDetails","lastMessageContentPart","_raw","lastMessage","_files","array","sendMessage","_history","newChat","responseMessageIds","_modelIdx","chatEventEmitter","sendMessageSocket","getFeatures","features","currentModels","_v","_u","_w","_x","_messages","chatMessageFiles","messageFile","userLocation","getAndUpdateUserLocation","processDetails","imageFiles","toolIds","toolServerIds","generateOpenAIChatCompletion","str","getPromptVariables","_z","_y","WEBUI_BASE_URL","errorMessage","innerError","status","taskId","stopTask","submitMessage","regenerateResponse","suggestionPrompt","continueResponse","mergeResponses","responses","mergedResponse","generateMoACompletion","textStream","update","createNewChat","MAX_DRAFT_LENGTH","saveDraftTimeout","saveDraft","draft","clearDraft","updateChatFolderIdById","pinnedChats","getPinnedChatList","$.head","$chatTitle","$WEBUI_NAME","EventConfirmDialog","PaneGroup","Navbar","title","savedChat","fragment_6","Placeholder","ChatControls"],"ignoreList":[0,2,3],"sources":["../../../../../../node_modules/svelte/src/internal/client/dom/blocks/await.js","../../../../../../src/lib/components/chat/Tags.svelte","../../../../../../node_modules/eventsource-parser/dist/index.js","../../../../../../node_modules/eventsource-parser/dist/stream.js","../../../../../../src/lib/apis/streaming/index.ts","../../../../../../src/lib/components/icons/Cube.svelte","../../../../../../src/lib/utils/audio.ts","../../../../../../src/lib/utils/google-drive-picker.ts","../../../../../../src/lib/utils/onedrive-file-picker.ts","../../../../../../src/lib/components/icons/ClockRotateRight.svelte","../../../../../../src/lib/components/chat/MessageInput/InputMenu/Chats.svelte","../../../../../../src/lib/components/chat/MessageInput/InputMenu/Notes.svelte","../../../../../../src/lib/components/chat/MessageInput/InputMenu/Knowledge.svelte","../../../../../../src/lib/components/chat/MessageInput/InputMenu.svelte","../../../../../../src/lib/components/chat/ToolServersModal.svelte","../../../../../../src/lib/components/icons/Photo.svelte","../../../../../../src/lib/components/icons/Wrench.svelte","../../../../../../src/lib/components/icons/Voice.svelte","../../../../../../src/lib/components/icons/Terminal.svelte","../../../../../../src/lib/components/icons/Knobs.svelte","../../../../../../src/lib/components/chat/MessageInput/IntegrationsMenu.svelte","../../../../../../src/lib/components/icons/Component.svelte","../../../../../../src/lib/components/icons/PlusAlt.svelte","../../../../../../src/lib/components/common/InputModal.svelte","../../../../../../src/lib/components/icons/Expand.svelte","../../../../../../src/lib/components/chat/MessageInput.svelte","../../../../../../src/lib/components/chat/ModelSelector.svelte","../../../../../../src/lib/components/icons/AdjustmentsHorizontal.svelte","../../../../../../src/lib/components/layout/Navbar/Menu.svelte","../../../../../../src/lib/components/icons/ChatBubbleDotted.svelte","../../../../../../src/lib/components/icons/ChatBubbleDottedChecked.svelte","../../../../../../src/lib/components/icons/ChatPlus.svelte","../../../../../../src/lib/components/icons/ChatCheck.svelte","../../../../../../src/lib/components/chat/Navbar.svelte","../../../../../../src/lib/components/chat/Controls/Valves.svelte","../../../../../../src/lib/components/chat/Controls/Controls.svelte","../../../../../../src/lib/components/chat/MessageInput/CallOverlay/VideoInputMenu.svelte","../../../../../../src/lib/components/chat/MessageInput/CallOverlay.svelte","../../../../../../src/lib/components/icons/ArrowsPointingOut.svelte","../../../../../../src/lib/components/chat/Artifacts.svelte","../../../../../../src/lib/components/chat/ChatControls/Embeds.svelte","../../../../../../src/lib/components/chat/ChatControls.svelte","../../../../../../src/lib/components/chat/Placeholder/ChatList.svelte","../../../../../../src/lib/components/chat/Placeholder/FolderPlaceholder.svelte","../../../../../../src/lib/components/chat/Placeholder/FolderTitle.svelte","../../../../../../src/lib/components/chat/Placeholder.svelte","../../../../../../src/lib/components/chat/Chat.svelte"],"sourcesContent":["/** @import { Source, TemplateNode } from '#client' */\nimport { is_promise } from '../../../shared/utils.js';\nimport { block } from '../../reactivity/effects.js';\nimport { internal_set, mutable_source, source } from '../../reactivity/sources.js';\nimport {\n\thydrate_next,\n\thydrating,\n\tskip_nodes,\n\tset_hydrate_node,\n\tset_hydrating\n} from '../hydration.js';\nimport { queue_micro_task } from '../task.js';\nimport { HYDRATION_START_ELSE, UNINITIALIZED } from '../../../../constants.js';\nimport { is_runes } from '../../context.js';\nimport { Batch, flushSync, is_flushing_sync } from '../../reactivity/batch.js';\nimport { BranchManager } from './branches.js';\nimport { capture, unset_context } from '../../reactivity/async.js';\n\nconst PENDING = 0;\nconst THEN = 1;\nconst CATCH = 2;\n\n/** @typedef {typeof PENDING | typeof THEN | typeof CATCH} AwaitState */\n\n/**\n * @template V\n * @param {TemplateNode} node\n * @param {(() => any)} get_input\n * @param {null | ((anchor: Node) => void)} pending_fn\n * @param {null | ((anchor: Node, value: Source<V>) => void)} then_fn\n * @param {null | ((anchor: Node, error: unknown) => void)} catch_fn\n * @returns {void}\n */\nexport function await_block(node, get_input, pending_fn, then_fn, catch_fn) {\n\tif (hydrating) {\n\t\thydrate_next();\n\t}\n\n\tvar runes = is_runes();\n\n\tvar v = /** @type {V} */ (UNINITIALIZED);\n\tvar value = runes ? source(v) : mutable_source(v, false, false);\n\tvar error = runes ? source(v) : mutable_source(v, false, false);\n\n\tvar branches = new BranchManager(node);\n\n\tblock(() => {\n\t\tvar input = get_input();\n\t\tvar destroyed = false;\n\n\t\t/** Whether or not there was a hydration mismatch. Needs to be a `let` or else it isn't treeshaken out */\n\t\t// @ts-ignore coercing `node` to a `Comment` causes TypeScript and Prettier to fight\n\t\tlet mismatch = hydrating && is_promise(input) === (node.data === HYDRATION_START_ELSE);\n\n\t\tif (mismatch) {\n\t\t\t// Hydration mismatch: remove everything inside the anchor and start fresh\n\t\t\tset_hydrate_node(skip_nodes());\n\t\t\tset_hydrating(false);\n\t\t}\n\n\t\tif (is_promise(input)) {\n\t\t\tvar restore = capture();\n\t\t\tvar resolved = false;\n\n\t\t\t/**\n\t\t\t * @param {() => void} fn\n\t\t\t */\n\t\t\tconst resolve = (fn) => {\n\t\t\t\tif (destroyed) return;\n\n\t\t\t\tresolved = true;\n\t\t\t\t// We don't want to restore the previous batch here; {#await} blocks don't follow the async logic\n\t\t\t\t// we have elsewhere, instead pending/resolve/fail states are each their own batch so to speak.\n\t\t\t\trestore(false);\n\t\t\t\t// Make sure we have a batch, since the branch manager expects one to exist\n\t\t\t\tBatch.ensure();\n\n\t\t\t\tif (hydrating) {\n\t\t\t\t\t// `restore()` could set `hydrating` to `true`, which we very much\n\t\t\t\t\t// don't want  we want to restore everything _except_ this\n\t\t\t\t\tset_hydrating(false);\n\t\t\t\t}\n\n\t\t\t\ttry {\n\t\t\t\t\tfn();\n\t\t\t\t} finally {\n\t\t\t\t\tunset_context();\n\n\t\t\t\t\t// without this, the DOM does not update until two ticks after the promise\n\t\t\t\t\t// resolves, which is unexpected behaviour (and somewhat irksome to test)\n\t\t\t\t\tif (!is_flushing_sync) flushSync();\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tinput.then(\n\t\t\t\t(v) => {\n\t\t\t\t\tresolve(() => {\n\t\t\t\t\t\tinternal_set(value, v);\n\t\t\t\t\t\tbranches.ensure(THEN, then_fn && ((target) => then_fn(target, value)));\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t\t(e) => {\n\t\t\t\t\tresolve(() => {\n\t\t\t\t\t\tinternal_set(error, e);\n\t\t\t\t\t\tbranches.ensure(THEN, catch_fn && ((target) => catch_fn(target, error)));\n\n\t\t\t\t\t\tif (!catch_fn) {\n\t\t\t\t\t\t\t// Rethrow the error if no catch block exists\n\t\t\t\t\t\t\tthrow error.v;\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t);\n\n\t\t\tif (hydrating) {\n\t\t\t\tbranches.ensure(PENDING, pending_fn);\n\t\t\t} else {\n\t\t\t\t// Wait a microtask before checking if we should show the pending state as\n\t\t\t\t// the promise might have resolved by then\n\t\t\t\tqueue_micro_task(() => {\n\t\t\t\t\tif (!resolved) {\n\t\t\t\t\t\tresolve(() => {\n\t\t\t\t\t\t\tbranches.ensure(PENDING, pending_fn);\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t} else {\n\t\t\tinternal_set(value, input);\n\t\t\tbranches.ensure(THEN, then_fn && ((target) => then_fn(target, value)));\n\t\t}\n\n\t\tif (mismatch) {\n\t\t\t// continue in hydration mode\n\t\t\tset_hydrating(true);\n\t\t}\n\n\t\treturn () => {\n\t\t\tdestroyed = true;\n\t\t};\n\t});\n}\n","<script>\n\timport {\n\t\taddTagById,\n\t\tdeleteTagById,\n\t\tgetAllTags,\n\t\tgetChatList,\n\t\tgetChatListByTagName,\n\t\tgetTagsById,\n\t\tupdateChatById\n\t} from '$lib/apis/chats';\n\timport {\n\t\ttags as _tags,\n\t\tchats,\n\t\tpinnedChats,\n\t\tcurrentChatPage,\n\t\tscrollPaginationEnabled\n\t} from '$lib/stores';\n\timport { createEventDispatcher, onMount } from 'svelte';\n\n\tconst dispatch = createEventDispatcher();\n\n\timport Tags from '../common/Tags.svelte';\n\timport { toast } from 'svelte-sonner';\n\n\texport let chatId = '';\n\tlet tags = [];\n\n\tconst getTags = async () => {\n\t\treturn await getTagsById(localStorage.token, chatId).catch(async (error) => {\n\t\t\treturn [];\n\t\t});\n\t};\n\n\tconst addTag = async (tagName) => {\n\t\tconst res = await addTagById(localStorage.token, chatId, tagName).catch(async (error) => {\n\t\t\ttoast.error(`${error}`);\n\t\t\treturn null;\n\t\t});\n\t\tif (!res) {\n\t\t\treturn;\n\t\t}\n\n\t\ttags = await getTags();\n\t\tawait updateChatById(localStorage.token, chatId, {\n\t\t\ttags: tags\n\t\t});\n\n\t\tawait _tags.set(await getAllTags(localStorage.token));\n\t\tdispatch('add', {\n\t\t\tname: tagName\n\t\t});\n\t};\n\n\tconst deleteTag = async (tagName) => {\n\t\tconst res = await deleteTagById(localStorage.token, chatId, tagName);\n\t\ttags = await getTags();\n\t\tawait updateChatById(localStorage.token, chatId, {\n\t\t\ttags: tags\n\t\t});\n\n\t\tawait _tags.set(await getAllTags(localStorage.token));\n\t\tdispatch('delete', {\n\t\t\tname: tagName\n\t\t});\n\t};\n\n\tonMount(async () => {\n\t\tif (chatId) {\n\t\t\ttags = await getTags();\n\t\t}\n\t});\n</script>\n\n<Tags\n\t{tags}\n\tsuggestionTags={$_tags ?? []}\n\ton:delete={(e) => {\n\t\tdeleteTag(e.detail);\n\t}}\n\ton:add={(e) => {\n\t\taddTag(e.detail);\n\t}}\n/>\n","function createParser(onParse) {\n  let isFirstChunk;\n  let buffer;\n  let startingPosition;\n  let startingFieldLength;\n  let eventId;\n  let eventName;\n  let data;\n  reset();\n  return {\n    feed,\n    reset\n  };\n  function reset() {\n    isFirstChunk = true;\n    buffer = \"\";\n    startingPosition = 0;\n    startingFieldLength = -1;\n    eventId = void 0;\n    eventName = void 0;\n    data = \"\";\n  }\n  function feed(chunk) {\n    buffer = buffer ? buffer + chunk : chunk;\n    if (isFirstChunk && hasBom(buffer)) {\n      buffer = buffer.slice(BOM.length);\n    }\n    isFirstChunk = false;\n    const length = buffer.length;\n    let position = 0;\n    let discardTrailingNewline = false;\n    while (position < length) {\n      if (discardTrailingNewline) {\n        if (buffer[position] === \"\\n\") {\n          ++position;\n        }\n        discardTrailingNewline = false;\n      }\n      let lineLength = -1;\n      let fieldLength = startingFieldLength;\n      let character;\n      for (let index = startingPosition; lineLength < 0 && index < length; ++index) {\n        character = buffer[index];\n        if (character === \":\" && fieldLength < 0) {\n          fieldLength = index - position;\n        } else if (character === \"\\r\") {\n          discardTrailingNewline = true;\n          lineLength = index - position;\n        } else if (character === \"\\n\") {\n          lineLength = index - position;\n        }\n      }\n      if (lineLength < 0) {\n        startingPosition = length - position;\n        startingFieldLength = fieldLength;\n        break;\n      } else {\n        startingPosition = 0;\n        startingFieldLength = -1;\n      }\n      parseEventStreamLine(buffer, position, fieldLength, lineLength);\n      position += lineLength + 1;\n    }\n    if (position === length) {\n      buffer = \"\";\n    } else if (position > 0) {\n      buffer = buffer.slice(position);\n    }\n  }\n  function parseEventStreamLine(lineBuffer, index, fieldLength, lineLength) {\n    if (lineLength === 0) {\n      if (data.length > 0) {\n        onParse({\n          type: \"event\",\n          id: eventId,\n          event: eventName || void 0,\n          data: data.slice(0, -1)\n          // remove trailing newline\n        });\n\n        data = \"\";\n        eventId = void 0;\n      }\n      eventName = void 0;\n      return;\n    }\n    const noValue = fieldLength < 0;\n    const field = lineBuffer.slice(index, index + (noValue ? lineLength : fieldLength));\n    let step = 0;\n    if (noValue) {\n      step = lineLength;\n    } else if (lineBuffer[index + fieldLength + 1] === \" \") {\n      step = fieldLength + 2;\n    } else {\n      step = fieldLength + 1;\n    }\n    const position = index + step;\n    const valueLength = lineLength - step;\n    const value = lineBuffer.slice(position, position + valueLength).toString();\n    if (field === \"data\") {\n      data += value ? \"\".concat(value, \"\\n\") : \"\\n\";\n    } else if (field === \"event\") {\n      eventName = value;\n    } else if (field === \"id\" && !value.includes(\"\\0\")) {\n      eventId = value;\n    } else if (field === \"retry\") {\n      const retry = parseInt(value, 10);\n      if (!Number.isNaN(retry)) {\n        onParse({\n          type: \"reconnect-interval\",\n          value: retry\n        });\n      }\n    }\n  }\n}\nconst BOM = [239, 187, 191];\nfunction hasBom(buffer) {\n  return BOM.every((charCode, index) => buffer.charCodeAt(index) === charCode);\n}\nexport { createParser };\n//# sourceMappingURL=index.js.map\n","import { createParser } from './index.js';\nclass EventSourceParserStream extends TransformStream {\n  constructor() {\n    let parser;\n    super({\n      start(controller) {\n        parser = createParser(event => {\n          if (event.type === \"event\") {\n            controller.enqueue(event);\n          }\n        });\n      },\n      transform(chunk) {\n        parser.feed(chunk);\n      }\n    });\n  }\n}\nexport { EventSourceParserStream };\n//# sourceMappingURL=stream.js.map\n","import { EventSourceParserStream } from 'eventsource-parser/stream';\nimport type { ParsedEvent } from 'eventsource-parser';\n\ntype TextStreamUpdate = {\n\tdone: boolean;\n\tvalue: string;\n\t// eslint-disable-next-line @typescript-eslint/no-explicit-any\n\tsources?: any;\n\t// eslint-disable-next-line @typescript-eslint/no-explicit-any\n\tselectedModelId?: any;\n\terror?: any;\n\tusage?: ResponseUsage;\n};\n\ntype ResponseUsage = {\n\t/** Including images and tools if any */\n\tprompt_tokens: number;\n\t/** The tokens generated */\n\tcompletion_tokens: number;\n\t/** Sum of the above two fields */\n\ttotal_tokens: number;\n\t/** Any other fields that aren't part of the base OpenAI spec */\n\t[other: string]: unknown;\n};\n\n// createOpenAITextStream takes a responseBody with a SSE response,\n// and returns an async generator that emits delta updates with large deltas chunked into random sized chunks\nexport async function createOpenAITextStream(\n\tresponseBody: ReadableStream<Uint8Array>,\n\tsplitLargeDeltas: boolean\n): Promise<AsyncGenerator<TextStreamUpdate>> {\n\tconst eventStream = responseBody\n\t\t.pipeThrough(new TextDecoderStream())\n\t\t.pipeThrough(new EventSourceParserStream())\n\t\t.getReader();\n\tlet iterator = openAIStreamToIterator(eventStream);\n\tif (splitLargeDeltas) {\n\t\titerator = streamLargeDeltasAsRandomChunks(iterator);\n\t}\n\treturn iterator;\n}\n\nasync function* openAIStreamToIterator(\n\treader: ReadableStreamDefaultReader<ParsedEvent>\n): AsyncGenerator<TextStreamUpdate> {\n\twhile (true) {\n\t\tconst { value, done } = await reader.read();\n\t\tif (done) {\n\t\t\tyield { done: true, value: '' };\n\t\t\tbreak;\n\t\t}\n\t\tif (!value) {\n\t\t\tcontinue;\n\t\t}\n\t\tconst data = value.data;\n\t\tif (data.startsWith('[DONE]')) {\n\t\t\tyield { done: true, value: '' };\n\t\t\tbreak;\n\t\t}\n\n\t\ttry {\n\t\t\tconst parsedData = JSON.parse(data);\n\t\t\tconsole.log(parsedData);\n\n\t\t\tif (parsedData.error) {\n\t\t\t\tyield { done: true, value: '', error: parsedData.error };\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tif (parsedData.sources) {\n\t\t\t\tyield { done: false, value: '', sources: parsedData.sources };\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif (parsedData.selected_model_id) {\n\t\t\t\tyield { done: false, value: '', selectedModelId: parsedData.selected_model_id };\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif (parsedData.usage) {\n\t\t\t\tyield { done: false, value: '', usage: parsedData.usage };\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tyield {\n\t\t\t\tdone: false,\n\t\t\t\tvalue: parsedData.choices?.[0]?.delta?.content ?? ''\n\t\t\t};\n\t\t} catch (e) {\n\t\t\tconsole.error('Error extracting delta from SSE event:', e);\n\t\t}\n\t}\n}\n\n// streamLargeDeltasAsRandomChunks will chunk large deltas (length > 5) into random sized chunks between 1-3 characters\n// This is to simulate a more fluid streaming, even though some providers may send large chunks of text at once\nasync function* streamLargeDeltasAsRandomChunks(\n\titerator: AsyncGenerator<TextStreamUpdate>\n): AsyncGenerator<TextStreamUpdate> {\n\tfor await (const textStreamUpdate of iterator) {\n\t\tif (textStreamUpdate.done) {\n\t\t\tyield textStreamUpdate;\n\t\t\treturn;\n\t\t}\n\n\t\tif (textStreamUpdate.error) {\n\t\t\tyield textStreamUpdate;\n\t\t\tcontinue;\n\t\t}\n\t\tif (textStreamUpdate.sources) {\n\t\t\tyield textStreamUpdate;\n\t\t\tcontinue;\n\t\t}\n\t\tif (textStreamUpdate.selectedModelId) {\n\t\t\tyield textStreamUpdate;\n\t\t\tcontinue;\n\t\t}\n\t\tif (textStreamUpdate.usage) {\n\t\t\tyield textStreamUpdate;\n\t\t\tcontinue;\n\t\t}\n\n\t\tlet content = textStreamUpdate.value;\n\t\tif (content.length < 5) {\n\t\t\tyield { done: false, value: content };\n\t\t\tcontinue;\n\t\t}\n\t\twhile (content != '') {\n\t\t\tconst chunkSize = Math.min(Math.floor(Math.random() * 3) + 1, content.length);\n\t\t\tconst chunk = content.slice(0, chunkSize);\n\t\t\tyield { done: false, value: chunk };\n\t\t\t// Do not sleep if the tab is hidden\n\t\t\t// Timers are throttled to 1s in hidden tabs\n\t\t\tif (document?.visibilityState !== 'hidden') {\n\t\t\t\tawait sleep(5);\n\t\t\t}\n\t\t\tcontent = content.slice(chunkSize);\n\t\t}\n\t}\n}\n\nconst sleep = (ms: number) => new Promise((resolve) => setTimeout(resolve, ms));\n","<script lang=\"ts\">\n\texport let className = 'size-4';\n\texport let strokeWidth = '2';\n</script>\n\n<svg\n\txmlns=\"http://www.w3.org/2000/svg\"\n\tfill=\"none\"\n\tviewBox=\"0 0 24 24\"\n\tstroke-width={strokeWidth}\n\tstroke=\"currentColor\"\n\tclass={className}\n>\n\t<path\n\t\tstroke-linecap=\"round\"\n\t\tstroke-linejoin=\"round\"\n\t\td=\"m21 7.5-9-5.25L3 7.5m18 0-9 5.25m9-5.25v9l-9 5.25M3 7.5l9 5.25M3 7.5v9l9 5.25m0-9v9\"\n\t/>\n</svg>\n","export class AudioQueue {\n\tconstructor(audioElement) {\n\t\tthis.audio = audioElement;\n\t\tthis.queue = [];\n\t\tthis.current = null;\n\t\tthis.id = null;\n\n\t\tthis._onEnded = () => this.next();\n\t\tthis.audio.addEventListener('ended', this._onEnded);\n\n\t\tthis.onStopped = null; // optional callback\n\t}\n\n\tsetId(newId) {\n\t\tconsole.log('Setting audio queue ID to:', newId);\n\t\tif (this.id !== newId) {\n\t\t\tthis.stop();\n\t\t\tthis.id = newId;\n\t\t\tif (this.onStopped) this.onStopped({ event: 'id-change', id: newId });\n\t\t}\n\t}\n\n\tsetPlaybackRate(rate) {\n\t\tconsole.log('Setting audio playback rate to:', rate);\n\t\tthis.audio.playbackRate = rate;\n\t}\n\n\tenqueue(url) {\n\t\tconsole.log('Enqueuing audio URL:', url);\n\t\tthis.queue.push(url);\n\n\t\t// Auto-play if nothing is currently playing or loaded\n\t\tif (this.audio.paused && !this.current) {\n\t\t\tthis.next();\n\t\t}\n\t}\n\n\tplay() {\n\t\tif (!this.current && this.queue.length > 0) {\n\t\t\tthis.next();\n\t\t} else {\n\t\t\tthis.audio.play();\n\t\t}\n\t}\n\n\tnext() {\n\t\tthis.current = this.queue.shift();\n\t\tif (this.current) {\n\t\t\tthis.audio.src = this.current;\n\t\t\tthis.audio.play();\n\t\t\tconsole.log('Playing audio URL:', this.current);\n\t\t} else {\n\t\t\tthis.stop();\n\t\t\tif (this.onStopped) this.onStopped({ event: 'empty-queue', id: this.id });\n\t\t}\n\t}\n\n\tstop() {\n\t\tthis.audio.pause();\n\t\tthis.audio.currentTime = 0;\n\t\tthis.audio.src = '';\n\t\tthis.queue = [];\n\t\tthis.current = null;\n\t\tif (this.onStopped) this.onStopped({ event: 'stop', id: this.id });\n\t}\n\n\tdestroy() {\n\t\tthis.audio.removeEventListener('ended', this._onEnded);\n\t\tthis.stop();\n\t\tthis.onStopped = null;\n\t\tthis.audio = null;\n\t}\n}\n","// Google Drive Picker API configuration\nlet API_KEY = '';\nlet CLIENT_ID = '';\n\n// Function to fetch credentials from backend config\nasync function getCredentials() {\n\tconst response = await fetch('/api/config');\n\tif (!response.ok) {\n\t\tthrow new Error('Failed to fetch Google Drive credentials');\n\t}\n\tconst config = await response.json();\n\tAPI_KEY = config.google_drive?.api_key;\n\tCLIENT_ID = config.google_drive?.client_id;\n\n\tif (!API_KEY || !CLIENT_ID) {\n\t\tthrow new Error('Google Drive API credentials not configured');\n\t}\n}\nconst SCOPE = [\n\t'https://www.googleapis.com/auth/drive.readonly',\n\t'https://www.googleapis.com/auth/drive.file'\n];\n\n// Validate required credentials\nconst validateCredentials = () => {\n\tif (!API_KEY || !CLIENT_ID) {\n\t\tthrow new Error('Google Drive API credentials not configured');\n\t}\n\tif (API_KEY === '' || CLIENT_ID === '') {\n\t\tthrow new Error('Please configure valid Google Drive API credentials');\n\t}\n};\n\nlet pickerApiLoaded = false;\nlet oauthToken: string | null = null;\nlet initialized = false;\n\nexport const loadGoogleDriveApi = () => {\n\treturn new Promise((resolve, reject) => {\n\t\tif (typeof gapi === 'undefined') {\n\t\t\tconst script = document.createElement('script');\n\t\t\tscript.src = 'https://apis.google.com/js/api.js';\n\t\t\tscript.onload = () => {\n\t\t\t\tgapi.load('picker', () => {\n\t\t\t\t\tpickerApiLoaded = true;\n\t\t\t\t\tresolve(true);\n\t\t\t\t});\n\t\t\t};\n\t\t\tscript.onerror = reject;\n\t\t\tdocument.body.appendChild(script);\n\t\t} else {\n\t\t\tgapi.load('picker', () => {\n\t\t\t\tpickerApiLoaded = true;\n\t\t\t\tresolve(true);\n\t\t\t});\n\t\t}\n\t});\n};\n\nexport const loadGoogleAuthApi = () => {\n\treturn new Promise((resolve, reject) => {\n\t\tif (typeof google === 'undefined') {\n\t\t\tconst script = document.createElement('script');\n\t\t\tscript.src = 'https://accounts.google.com/gsi/client';\n\t\t\tscript.onload = resolve;\n\t\t\tscript.onerror = reject;\n\t\t\tdocument.body.appendChild(script);\n\t\t} else {\n\t\t\tresolve(true);\n\t\t}\n\t});\n};\n\nexport const getAuthToken = async () => {\n\tif (!oauthToken) {\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tconst tokenClient = google.accounts.oauth2.initTokenClient({\n\t\t\t\tclient_id: CLIENT_ID,\n\t\t\t\tscope: SCOPE.join(' '),\n\t\t\t\tcallback: (response: any) => {\n\t\t\t\t\tif (response.access_token) {\n\t\t\t\t\t\toauthToken = response.access_token;\n\t\t\t\t\t\tresolve(oauthToken);\n\t\t\t\t\t} else {\n\t\t\t\t\t\treject(new Error('Failed to get access token'));\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\terror_callback: (error: any) => {\n\t\t\t\t\treject(new Error(error.message || 'OAuth error occurred'));\n\t\t\t\t}\n\t\t\t});\n\t\t\ttokenClient.requestAccessToken();\n\t\t});\n\t}\n\treturn oauthToken;\n};\n\nconst initialize = async () => {\n\tif (!initialized) {\n\t\tawait getCredentials();\n\t\tvalidateCredentials();\n\t\tawait Promise.all([loadGoogleDriveApi(), loadGoogleAuthApi()]);\n\t\tinitialized = true;\n\t}\n};\n\nexport const createPicker = () => {\n\treturn new Promise(async (resolve, reject) => {\n\t\ttry {\n\t\t\tconsole.log('Initializing Google Drive Picker...');\n\t\t\tawait initialize();\n\t\t\tconsole.log('Getting auth token...');\n\t\t\tconst token = await getAuthToken();\n\t\t\tif (!token) {\n\t\t\t\tconsole.error('Failed to get OAuth token');\n\t\t\t\tthrow new Error('Unable to get OAuth token');\n\t\t\t}\n\t\t\tconsole.log('Auth token obtained successfully');\n\n\t\t\tconst picker = new google.picker.PickerBuilder()\n\t\t\t\t.enableFeature(google.picker.Feature.NAV_HIDDEN)\n\t\t\t\t.enableFeature(google.picker.Feature.MULTISELECT_ENABLED)\n\t\t\t\t.addView(\n\t\t\t\t\tnew google.picker.DocsView()\n\t\t\t\t\t\t.setIncludeFolders(false)\n\t\t\t\t\t\t.setSelectFolderEnabled(false)\n\t\t\t\t\t\t.setMimeTypes(\n\t\t\t\t\t\t\t'application/pdf,text/plain,application/vnd.openxmlformats-officedocument.wordprocessingml.document,application/vnd.google-apps.document,application/vnd.google-apps.spreadsheet,application/vnd.google-apps.presentation'\n\t\t\t\t\t\t)\n\t\t\t\t)\n\t\t\t\t.setOAuthToken(token)\n\t\t\t\t.setDeveloperKey(API_KEY)\n\t\t\t\t// Remove app ID setting as it's not needed and can cause 404 errors\n\t\t\t\t.setCallback(async (data: any) => {\n\t\t\t\t\tif (data[google.picker.Response.ACTION] === google.picker.Action.PICKED) {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tconst doc = data[google.picker.Response.DOCUMENTS][0];\n\t\t\t\t\t\t\tconst fileId = doc[google.picker.Document.ID];\n\t\t\t\t\t\t\tconst fileName = doc[google.picker.Document.NAME];\n\t\t\t\t\t\t\tconst fileUrl = doc[google.picker.Document.URL];\n\n\t\t\t\t\t\t\tif (!fileId || !fileName) {\n\t\t\t\t\t\t\t\tthrow new Error('Required file details missing');\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t// Construct download URL based on MIME type\n\t\t\t\t\t\t\tconst mimeType = doc[google.picker.Document.MIME_TYPE];\n\n\t\t\t\t\t\t\tlet downloadUrl;\n\t\t\t\t\t\t\tlet exportFormat;\n\n\t\t\t\t\t\t\tif (mimeType.includes('google-apps')) {\n\t\t\t\t\t\t\t\t// Handle Google Workspace files\n\t\t\t\t\t\t\t\tif (mimeType.includes('document')) {\n\t\t\t\t\t\t\t\t\texportFormat = 'text/plain';\n\t\t\t\t\t\t\t\t} else if (mimeType.includes('spreadsheet')) {\n\t\t\t\t\t\t\t\t\texportFormat = 'text/csv';\n\t\t\t\t\t\t\t\t} else if (mimeType.includes('presentation')) {\n\t\t\t\t\t\t\t\t\texportFormat = 'text/plain';\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\texportFormat = 'application/pdf';\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tdownloadUrl = `https://www.googleapis.com/drive/v3/files/${fileId}/export?mimeType=${encodeURIComponent(exportFormat)}`;\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t// Regular files use direct download URL\n\t\t\t\t\t\t\t\tdownloadUrl = `https://www.googleapis.com/drive/v3/files/${fileId}?alt=media`;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t// Create a Blob from the file download\n\t\t\t\t\t\t\tconst response = await fetch(downloadUrl, {\n\t\t\t\t\t\t\t\theaders: {\n\t\t\t\t\t\t\t\t\tAuthorization: `Bearer ${token}`,\n\t\t\t\t\t\t\t\t\tAccept: '*/*'\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\tif (!response.ok) {\n\t\t\t\t\t\t\t\tconst errorText = await response.text();\n\t\t\t\t\t\t\t\tconsole.error('Download failed:', {\n\t\t\t\t\t\t\t\t\tstatus: response.status,\n\t\t\t\t\t\t\t\t\tstatusText: response.statusText,\n\t\t\t\t\t\t\t\t\terror: errorText\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\tthrow new Error(`Failed to download file (${response.status}): ${errorText}`);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tconst blob = await response.blob();\n\t\t\t\t\t\t\tconst result = {\n\t\t\t\t\t\t\t\tid: fileId,\n\t\t\t\t\t\t\t\tname: fileName,\n\t\t\t\t\t\t\t\turl: downloadUrl,\n\t\t\t\t\t\t\t\tblob: blob,\n\t\t\t\t\t\t\t\theaders: {\n\t\t\t\t\t\t\t\t\tAuthorization: `Bearer ${token}`,\n\t\t\t\t\t\t\t\t\tAccept: '*/*'\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\tresolve(result);\n\t\t\t\t\t\t} catch (error) {\n\t\t\t\t\t\t\treject(error);\n\t\t\t\t\t\t}\n\t\t\t\t\t} else if (data[google.picker.Response.ACTION] === google.picker.Action.CANCEL) {\n\t\t\t\t\t\tresolve(null);\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\t.build();\n\t\t\tpicker.setVisible(true);\n\t\t} catch (error) {\n\t\t\tconsole.error('Google Drive Picker error:', error);\n\t\t\treject(error);\n\t\t}\n\t});\n};\n","import type { PopupRequest, PublicClientApplication } from '@azure/msal-browser';\nimport { v4 as uuidv4 } from 'uuid';\n\nclass OneDriveConfig {\n\tprivate static instance: OneDriveConfig;\n\tprivate clientIdPersonal: string = '';\n\tprivate clientIdBusiness: string = '';\n\tprivate sharepointUrl: string = '';\n\tprivate sharepointTenantId: string = '';\n\tprivate msalInstance: PublicClientApplication | null = null;\n\tprivate currentAuthorityType: 'personal' | 'organizations' = 'personal';\n\n\tprivate constructor() {}\n\n\tpublic static getInstance(): OneDriveConfig {\n\t\tif (!OneDriveConfig.instance) {\n\t\t\tOneDriveConfig.instance = new OneDriveConfig();\n\t\t}\n\t\treturn OneDriveConfig.instance;\n\t}\n\n\tpublic async initialize(authorityType?: 'personal' | 'organizations'): Promise<void> {\n\t\tif (authorityType && this.currentAuthorityType !== authorityType) {\n\t\t\tthis.currentAuthorityType = authorityType;\n\t\t\tthis.msalInstance = null;\n\t\t}\n\t\tawait this.getCredentials();\n\t}\n\n\tpublic async ensureInitialized(authorityType?: 'personal' | 'organizations'): Promise<void> {\n\t\tawait this.initialize(authorityType);\n\t}\n\n\tprivate async getCredentials(): Promise<void> {\n\t\tconst response = await fetch('/api/config', {\n\t\t\theaders: {\n\t\t\t\t'Content-Type': 'application/json'\n\t\t\t},\n\t\t\tcredentials: 'include'\n\t\t});\n\n\t\tif (!response.ok) {\n\t\t\tthrow new Error('Failed to fetch OneDrive credentials');\n\t\t}\n\n\t\tconst config = await response.json();\n\n\t\tthis.clientIdPersonal = config.onedrive?.client_id_personal;\n\t\tthis.clientIdBusiness = config.onedrive?.client_id_business;\n\t\tthis.sharepointUrl = config.onedrive?.sharepoint_url;\n\t\tthis.sharepointTenantId = config.onedrive?.sharepoint_tenant_id;\n\n\t\tif (!this.clientIdPersonal && !this.clientIdBusiness) {\n\t\t\tthrow new Error('OneDrive personal or business client ID not configured');\n\t\t}\n\t}\n\n\tpublic async getMsalInstance(\n\t\tauthorityType?: 'personal' | 'organizations'\n\t): Promise<PublicClientApplication> {\n\t\tawait this.ensureInitialized(authorityType);\n\n\t\tif (!this.msalInstance) {\n\t\t\tconst authorityEndpoint =\n\t\t\t\tthis.currentAuthorityType === 'organizations'\n\t\t\t\t\t? this.sharepointTenantId || 'common'\n\t\t\t\t\t: 'consumers';\n\n\t\t\tconst clientId =\n\t\t\t\tthis.currentAuthorityType === 'organizations'\n\t\t\t\t\t? this.clientIdBusiness\n\t\t\t\t\t: this.clientIdPersonal;\n\n\t\t\tif (!clientId) {\n\t\t\t\tthrow new Error('OneDrive client ID not configured');\n\t\t\t}\n\n\t\t\tconst msalParams = {\n\t\t\t\tauth: {\n\t\t\t\t\tauthority: `https://login.microsoftonline.com/${authorityEndpoint}`,\n\t\t\t\t\tclientId: clientId\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tconst { PublicClientApplication } = await import('@azure/msal-browser');\n\t\t\tthis.msalInstance = new PublicClientApplication(msalParams);\n\t\t\tif (this.msalInstance.initialize) {\n\t\t\t\tawait this.msalInstance.initialize();\n\t\t\t}\n\t\t}\n\n\t\treturn this.msalInstance;\n\t}\n\n\tpublic getAuthorityType(): 'personal' | 'organizations' {\n\t\treturn this.currentAuthorityType;\n\t}\n\n\tpublic getSharepointUrl(): string {\n\t\treturn this.sharepointUrl;\n\t}\n\n\tpublic getSharepointTenantId(): string {\n\t\treturn this.sharepointTenantId;\n\t}\n\n\tpublic getBaseUrl(): string {\n\t\tif (this.currentAuthorityType === 'organizations') {\n\t\t\tif (!this.sharepointUrl || this.sharepointUrl === '') {\n\t\t\t\tthrow new Error('Sharepoint URL not configured');\n\t\t\t}\n\n\t\t\tlet sharePointBaseUrl = this.sharepointUrl.replace(/^https?:\\/\\//, '');\n\t\t\tsharePointBaseUrl = sharePointBaseUrl.replace(/\\/$/, '');\n\n\t\t\treturn `https://${sharePointBaseUrl}`;\n\t\t} else {\n\t\t\treturn 'https://onedrive.live.com/picker';\n\t\t}\n\t}\n}\n\n// Retrieve OneDrive access token\nasync function getToken(\n\tresource?: string,\n\tauthorityType?: 'personal' | 'organizations'\n): Promise<string> {\n\tconst config = OneDriveConfig.getInstance();\n\tawait config.ensureInitialized(authorityType);\n\n\tconst currentAuthorityType = config.getAuthorityType();\n\n\tconst scopes =\n\t\tcurrentAuthorityType === 'organizations'\n\t\t\t? [`${resource || config.getBaseUrl()}/.default`]\n\t\t\t: ['OneDrive.ReadWrite'];\n\n\tconst authParams: PopupRequest = { scopes };\n\tlet accessToken = '';\n\n\ttry {\n\t\tconst msalInstance = await config.getMsalInstance(authorityType);\n\t\tconst resp = await msalInstance.acquireTokenSilent(authParams);\n\t\taccessToken = resp.accessToken;\n\t} catch {\n\t\tconst msalInstance = await config.getMsalInstance(authorityType);\n\t\ttry {\n\t\t\tconst resp = await msalInstance.loginPopup(authParams);\n\t\t\tmsalInstance.setActiveAccount(resp.account);\n\t\t\tif (resp.idToken) {\n\t\t\t\tconst resp2 = await msalInstance.acquireTokenSilent(authParams);\n\t\t\t\taccessToken = resp2.accessToken;\n\t\t\t}\n\t\t} catch (popupError) {\n\t\t\tthrow new Error(\n\t\t\t\t'Failed to login: ' +\n\t\t\t\t\t(popupError instanceof Error ? popupError.message : String(popupError))\n\t\t\t);\n\t\t}\n\t}\n\n\tif (!accessToken) {\n\t\tthrow new Error('Failed to acquire access token');\n\t}\n\n\treturn accessToken;\n}\n\ninterface PickerParams {\n\tsdk: string;\n\tentry: {\n\t\toneDrive: Record<string, unknown>;\n\t};\n\tauthentication: Record<string, unknown>;\n\tmessaging: {\n\t\torigin: string;\n\t\tchannelId: string;\n\t};\n\tsearch: {\n\t\tenabled: boolean;\n\t};\n\ttypesAndSources: {\n\t\tmode: string;\n\t\tpivots: Record<string, boolean>;\n\t};\n}\n\ninterface PickerResult {\n\tcommand?: string;\n\titems?: OneDriveFileInfo[];\n\t// eslint-disable-next-line @typescript-eslint/no-explicit-any\n\t[key: string]: any;\n}\n\n// Get picker parameters based on account type\nfunction getPickerParams(): PickerParams {\n\tconst channelId = uuidv4();\n\tconst config = OneDriveConfig.getInstance();\n\n\tconst params: PickerParams = {\n\t\tsdk: '8.0',\n\t\tentry: {\n\t\t\toneDrive: {}\n\t\t},\n\t\tauthentication: {},\n\t\tmessaging: {\n\t\t\torigin: window?.location?.origin || '',\n\t\t\tchannelId\n\t\t},\n\t\tsearch: {\n\t\t\tenabled: true\n\t\t},\n\t\ttypesAndSources: {\n\t\t\tmode: 'files',\n\t\t\tpivots: {\n\t\t\t\toneDrive: true,\n\t\t\t\trecent: true,\n\t\t\t\tmyOrganization: config.getAuthorityType() === 'organizations'\n\t\t\t}\n\t\t}\n\t};\n\n\t// For personal accounts, set files object in oneDrive\n\tif (config.getAuthorityType() !== 'organizations') {\n\t\tparams.entry.oneDrive = { files: {} };\n\t}\n\n\treturn params;\n}\n\ninterface OneDriveFileInfo {\n\tid: string;\n\tname: string;\n\tparentReference: {\n\t\tdriveId: string;\n\t};\n\t'@sharePoint.endpoint': string;\n\t// eslint-disable-next-line @typescript-eslint/no-explicit-any\n\t[key: string]: any;\n}\n\n// Download file from OneDrive\nasync function downloadOneDriveFile(\n\tfileInfo: OneDriveFileInfo,\n\tauthorityType?: 'personal' | 'organizations'\n): Promise<Blob> {\n\tconst accessToken = await getToken(undefined, authorityType);\n\tif (!accessToken) {\n\t\tthrow new Error('Unable to retrieve OneDrive access token.');\n\t}\n\n\t// The endpoint URL is provided in the file info\n\tconst fileInfoUrl = `${fileInfo['@sharePoint.endpoint']}/drives/${fileInfo.parentReference.driveId}/items/${fileInfo.id}`;\n\n\tconst response = await fetch(fileInfoUrl, {\n\t\theaders: {\n\t\t\tAuthorization: `Bearer ${accessToken}`\n\t\t}\n\t});\n\n\tif (!response.ok) {\n\t\tthrow new Error(`Failed to fetch file information: ${response.status} ${response.statusText}`);\n\t}\n\n\tconst fileData = await response.json();\n\tconst downloadUrl = fileData['@content.downloadUrl'];\n\n\tif (!downloadUrl) {\n\t\tthrow new Error('Download URL not found in file data');\n\t}\n\n\tconst downloadResponse = await fetch(downloadUrl);\n\n\tif (!downloadResponse.ok) {\n\t\tthrow new Error(\n\t\t\t`Failed to download file: ${downloadResponse.status} ${downloadResponse.statusText}`\n\t\t);\n\t}\n\n\treturn await downloadResponse.blob();\n}\n\n// Open OneDrive file picker and return selected file metadata\nexport async function openOneDrivePicker(\n\tauthorityType?: 'personal' | 'organizations'\n): Promise<PickerResult | null> {\n\tif (typeof window === 'undefined') {\n\t\tthrow new Error('Not in browser environment');\n\t}\n\n\t// Initialize OneDrive config with the specified authority type\n\tconst config = OneDriveConfig.getInstance();\n\tawait config.initialize(authorityType);\n\n\treturn new Promise((resolve, reject) => {\n\t\tlet pickerWindow: Window | null = null;\n\t\tlet channelPort: MessagePort | null = null;\n\t\tconst params = getPickerParams();\n\t\tconst baseUrl = config.getBaseUrl();\n\n\t\tconst handleWindowMessage = (event: MessageEvent) => {\n\t\t\tif (event.source !== pickerWindow) return;\n\t\t\tconst message = event.data;\n\t\t\tif (message?.type === 'initialize' && message?.channelId === params.messaging.channelId) {\n\t\t\t\tchannelPort = event.ports?.[0];\n\t\t\t\tif (!channelPort) return;\n\t\t\t\tchannelPort.addEventListener('message', handlePortMessage);\n\t\t\t\tchannelPort.start();\n\t\t\t\tchannelPort.postMessage({ type: 'activate' });\n\t\t\t}\n\t\t};\n\n\t\tconst handlePortMessage = async (portEvent: MessageEvent) => {\n\t\t\tconst portData = portEvent.data;\n\t\t\tswitch (portData.type) {\n\t\t\t\tcase 'notification':\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'command': {\n\t\t\t\t\tchannelPort?.postMessage({ type: 'acknowledge', id: portData.id });\n\t\t\t\t\tconst command = portData.data;\n\t\t\t\t\tswitch (command.command) {\n\t\t\t\t\t\tcase 'authenticate': {\n\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\t// Pass the resource from the command for org accounts\n\t\t\t\t\t\t\t\tconst resource =\n\t\t\t\t\t\t\t\t\tconfig.getAuthorityType() === 'organizations' ? command.resource : undefined;\n\t\t\t\t\t\t\t\tconst newToken = await getToken(resource, authorityType);\n\t\t\t\t\t\t\t\tif (newToken) {\n\t\t\t\t\t\t\t\t\tchannelPort?.postMessage({\n\t\t\t\t\t\t\t\t\t\ttype: 'result',\n\t\t\t\t\t\t\t\t\t\tid: portData.id,\n\t\t\t\t\t\t\t\t\t\tdata: { result: 'token', token: newToken }\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tthrow new Error('Could not retrieve auth token');\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t} catch {\n\t\t\t\t\t\t\t\tchannelPort?.postMessage({\n\t\t\t\t\t\t\t\t\ttype: 'result',\n\t\t\t\t\t\t\t\t\tid: portData.id,\n\t\t\t\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\t\t\t\tresult: 'error',\n\t\t\t\t\t\t\t\t\t\terror: { code: 'tokenError', message: 'Failed to get token' }\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tcase 'close': {\n\t\t\t\t\t\t\tcleanup();\n\t\t\t\t\t\t\tresolve(null);\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tcase 'pick': {\n\t\t\t\t\t\t\tchannelPort?.postMessage({\n\t\t\t\t\t\t\t\ttype: 'result',\n\t\t\t\t\t\t\t\tid: portData.id,\n\t\t\t\t\t\t\t\tdata: { result: 'success' }\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tcleanup();\n\t\t\t\t\t\t\tresolve(command);\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tdefault: {\n\t\t\t\t\t\t\tchannelPort?.postMessage({\n\t\t\t\t\t\t\t\tresult: 'error',\n\t\t\t\t\t\t\t\terror: { code: 'unsupportedCommand', message: command.command },\n\t\t\t\t\t\t\t\tisExpected: true\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\tfunction cleanup() {\n\t\t\twindow.removeEventListener('message', handleWindowMessage);\n\t\t\tif (channelPort) {\n\t\t\t\tchannelPort.removeEventListener('message', handlePortMessage);\n\t\t\t}\n\t\t\tif (pickerWindow) {\n\t\t\t\tpickerWindow.close();\n\t\t\t\tpickerWindow = null;\n\t\t\t}\n\t\t}\n\n\t\tconst initializePicker = async () => {\n\t\t\ttry {\n\t\t\t\tconst authToken = await getToken(undefined, authorityType);\n\t\t\t\tif (!authToken) {\n\t\t\t\t\treturn reject(new Error('Failed to acquire access token'));\n\t\t\t\t}\n\n\t\t\t\tpickerWindow = window.open('', 'OneDrivePicker', 'width=800,height=600');\n\t\t\t\tif (!pickerWindow) {\n\t\t\t\t\treturn reject(new Error('Failed to open OneDrive picker window'));\n\t\t\t\t}\n\n\t\t\t\tconst queryString = new URLSearchParams({\n\t\t\t\t\tfilePicker: JSON.stringify(params)\n\t\t\t\t});\n\n\t\t\t\tlet url = '';\n\t\t\t\tif (config.getAuthorityType() === 'organizations') {\n\t\t\t\t\turl = baseUrl + `/_layouts/15/FilePicker.aspx?${queryString}`;\n\t\t\t\t} else {\n\t\t\t\t\turl = baseUrl + `?${queryString}`;\n\t\t\t\t}\n\n\t\t\t\tconst form = pickerWindow.document.createElement('form');\n\t\t\t\tform.setAttribute('action', url);\n\t\t\t\tform.setAttribute('method', 'POST');\n\t\t\t\tconst input = pickerWindow.document.createElement('input');\n\t\t\t\tinput.setAttribute('type', 'hidden');\n\t\t\t\tinput.setAttribute('name', 'access_token');\n\t\t\t\tinput.setAttribute('value', authToken);\n\t\t\t\tform.appendChild(input);\n\n\t\t\t\tpickerWindow.document.body.appendChild(form);\n\t\t\t\tform.submit();\n\n\t\t\t\twindow.addEventListener('message', handleWindowMessage);\n\t\t\t} catch (err) {\n\t\t\t\tif (pickerWindow) {\n\t\t\t\t\tpickerWindow.close();\n\t\t\t\t}\n\t\t\t\treject(err);\n\t\t\t}\n\t\t};\n\n\t\tinitializePicker();\n\t});\n}\n\n// Pick and download file from OneDrive\nexport async function pickAndDownloadFile(\n\tauthorityType?: 'personal' | 'organizations'\n): Promise<{ blob: Blob; name: string } | null> {\n\tconst pickerResult = await openOneDrivePicker(authorityType);\n\n\tif (!pickerResult || !pickerResult.items || pickerResult.items.length === 0) {\n\t\treturn null;\n\t}\n\n\tconst selectedFile = pickerResult.items[0];\n\tconst blob = await downloadOneDriveFile(selectedFile, authorityType);\n\n\treturn { blob, name: selectedFile.name };\n}\n\nexport { downloadOneDriveFile };\n","<script lang=\"ts\">\n\texport let className = 'w-4 h-4';\n\texport let strokeWidth = '1.5';\n</script>\n\n<svg\n\tclass={className}\n\taria-hidden=\"true\"\n\txmlns=\"http://www.w3.org/2000/svg\"\n\tstroke-width={strokeWidth}\n\tstroke=\"currentColor\"\n\tfill=\"none\"\n\tviewBox=\"0 0 24 24\"\n\t><path d=\"M12 6L12 12L18 12\" stroke-linecap=\"round\" stroke-linejoin=\"round\"></path><path\n\t\td=\"M21.8883 10.5C21.1645 5.68874 17.013 2 12 2C6.47715 2 2 6.47715 2 12C2 17.5228 6.47715 22 12 22C16.1006 22 19.6248 19.5318 21.1679 16\"\n\t\tstroke-linecap=\"round\"\n\t\tstroke-linejoin=\"round\"\n\t></path><path\n\t\td=\"M17 16H21.4C21.7314 16 22 16.2686 22 16.6V21\"\n\t\tstroke-linecap=\"round\"\n\t\tstroke-linejoin=\"round\"\n\t></path></svg\n>\n","<script lang=\"ts\">\n\timport dayjs from 'dayjs';\n\timport { onMount, tick, getContext } from 'svelte';\n\n\timport { decodeString } from '$lib/utils';\n\timport { getChatList } from '$lib/apis/chats';\n\n\timport Tooltip from '$lib/components/common/Tooltip.svelte';\n\timport Spinner from '$lib/components/common/Spinner.svelte';\n\timport Loader from '$lib/components/common/Loader.svelte';\n\timport { chatId } from '$lib/stores';\n\n\tconst i18n = getContext('i18n');\n\n\texport let onSelect = (e) => {};\n\n\tlet loaded = false;\n\n\tlet items = [];\n\tlet selectedIdx = 0;\n\n\tlet page = 1;\n\tlet itemsLoading = false;\n\tlet allItemsLoaded = false;\n\n\tconst loadMoreItems = async () => {\n\t\tif (allItemsLoaded) return;\n\t\tpage += 1;\n\t\tawait getItemsPage();\n\t};\n\n\tconst getItemsPage = async () => {\n\t\titemsLoading = true;\n\t\tlet res = await getChatList(localStorage.token, page, true, true).catch(() => {\n\t\t\treturn [];\n\t\t});\n\n\t\tif ((res ?? []).length === 0) {\n\t\t\tallItemsLoaded = true;\n\t\t} else {\n\t\t\tallItemsLoaded = false;\n\t\t}\n\n\t\titems = [\n\t\t\t...items,\n\t\t\t...res\n\t\t\t\t.filter((item) => item?.id !== $chatId)\n\t\t\t\t.map((item) => {\n\t\t\t\t\treturn {\n\t\t\t\t\t\t...item,\n\t\t\t\t\t\ttype: 'chat',\n\t\t\t\t\t\tname: item.title,\n\t\t\t\t\t\tdescription: dayjs(item.updated_at * 1000).fromNow()\n\t\t\t\t\t};\n\t\t\t\t})\n\t\t];\n\n\t\titemsLoading = false;\n\t\treturn res;\n\t};\n\n\tonMount(async () => {\n\t\tawait getItemsPage();\n\t\tawait tick();\n\n\t\tloaded = true;\n\t});\n</script>\n\n{#if loaded}\n\t{#if items.length === 0}\n\t\t<div class=\"text-center text-xs text-gray-500 py-3\">{$i18n.t('No chats found')}</div>\n\t{:else}\n\t\t<div class=\"flex flex-col gap-0.5\">\n\t\t\t{#each items as item, idx}\n\t\t\t\t<button\n\t\t\t\t\tclass=\" px-2.5 py-1 rounded-xl w-full text-left flex justify-between items-center text-sm {idx ===\n\t\t\t\t\tselectedIdx\n\t\t\t\t\t\t? ' bg-gray-50 dark:bg-gray-800 dark:text-gray-100 selected-command-option-button'\n\t\t\t\t\t\t: ''}\"\n\t\t\t\t\ttype=\"button\"\n\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\tonSelect(item);\n\t\t\t\t\t}}\n\t\t\t\t\ton:mousemove={() => {\n\t\t\t\t\t\tselectedIdx = idx;\n\t\t\t\t\t}}\n\t\t\t\t\ton:mouseleave={() => {\n\t\t\t\t\t\tif (idx === 0) {\n\t\t\t\t\t\t\tselectedIdx = -1;\n\t\t\t\t\t\t}\n\t\t\t\t\t}}\n\t\t\t\t\tdata-selected={idx === selectedIdx}\n\t\t\t\t>\n\t\t\t\t\t<div class=\"text-black dark:text-gray-100 flex items-center gap-1.5\">\n\t\t\t\t\t\t<Tooltip content={item.description || decodeString(item?.name)} placement=\"top-start\">\n\t\t\t\t\t\t\t<div class=\"line-clamp-1 flex-1\">\n\t\t\t\t\t\t\t\t{decodeString(item?.name)}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</Tooltip>\n\t\t\t\t\t</div>\n\t\t\t\t</button>\n\t\t\t{/each}\n\n\t\t\t{#if !allItemsLoaded}\n\t\t\t\t<Loader\n\t\t\t\t\ton:visible={(e) => {\n\t\t\t\t\t\tif (!itemsLoading) {\n\t\t\t\t\t\t\tloadMoreItems();\n\t\t\t\t\t\t}\n\t\t\t\t\t}}\n\t\t\t\t>\n\t\t\t\t\t<div class=\"w-full flex justify-center py-4 text-xs animate-pulse items-center gap-2\">\n\t\t\t\t\t\t<Spinner className=\" size-4\" />\n\t\t\t\t\t\t<div class=\" \">{$i18n.t('Loading...')}</div>\n\t\t\t\t\t</div>\n\t\t\t\t</Loader>\n\t\t\t{/if}\n\t\t</div>\n\t{/if}\n{:else}\n\t<div class=\"py-4.5\">\n\t\t<Spinner />\n\t</div>\n{/if}\n","<script lang=\"ts\">\n\timport dayjs from 'dayjs';\n\timport { onMount, tick, getContext } from 'svelte';\n\n\timport { decodeString } from '$lib/utils';\n\timport { getNoteList } from '$lib/apis/notes';\n\n\timport Tooltip from '$lib/components/common/Tooltip.svelte';\n\timport PageEdit from '$lib/components/icons/PageEdit.svelte';\n\timport Spinner from '$lib/components/common/Spinner.svelte';\n\timport Loader from '$lib/components/common/Loader.svelte';\n\n\tconst i18n = getContext('i18n');\n\n\texport let onSelect = (e) => {};\n\n\tlet loaded = false;\n\n\tlet items = [];\n\tlet selectedIdx = 0;\n\n\tlet page = 1;\n\tlet itemsLoading = false;\n\tlet allItemsLoaded = false;\n\n\tconst loadMoreItems = async () => {\n\t\tif (allItemsLoaded) return;\n\t\tpage += 1;\n\t\tawait getItemsPage();\n\t};\n\n\tconst getItemsPage = async () => {\n\t\titemsLoading = true;\n\t\tlet res = await getNoteList(localStorage.token, page).catch(() => {\n\t\t\treturn [];\n\t\t});\n\n\t\tif ((res ?? []).length === 0) {\n\t\t\tallItemsLoaded = true;\n\t\t} else {\n\t\t\tallItemsLoaded = false;\n\t\t}\n\n\t\titems = [\n\t\t\t...items,\n\t\t\t...res.map((note) => {\n\t\t\t\treturn {\n\t\t\t\t\t...note,\n\t\t\t\t\ttype: 'note',\n\t\t\t\t\tname: note.title,\n\t\t\t\t\tdescription: dayjs(note.updated_at / 1000000).fromNow()\n\t\t\t\t};\n\t\t\t})\n\t\t];\n\n\t\titemsLoading = false;\n\n\t\treturn res;\n\t};\n\n\tonMount(async () => {\n\t\tawait getItemsPage();\n\t\tawait tick();\n\n\t\tloaded = true;\n\t});\n</script>\n\n{#if loaded}\n\t{#if items.length === 0}\n\t\t<div class=\"text-center text-xs text-gray-500 py-3\">{$i18n.t('No notes found')}</div>\n\t{:else}\n\t\t<div class=\"flex flex-col gap-0.5\">\n\t\t\t{#each items as item, idx}\n\t\t\t\t<button\n\t\t\t\t\tclass=\" px-2.5 py-1 rounded-xl w-full text-left flex justify-between items-center text-sm {idx ===\n\t\t\t\t\tselectedIdx\n\t\t\t\t\t\t? ' bg-gray-50 dark:bg-gray-800 dark:text-gray-100 selected-command-option-button'\n\t\t\t\t\t\t: ''}\"\n\t\t\t\t\ttype=\"button\"\n\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\tonSelect(item);\n\t\t\t\t\t}}\n\t\t\t\t\ton:mousemove={() => {\n\t\t\t\t\t\tselectedIdx = idx;\n\t\t\t\t\t}}\n\t\t\t\t\ton:mouseleave={() => {\n\t\t\t\t\t\tif (idx === 0) {\n\t\t\t\t\t\t\tselectedIdx = -1;\n\t\t\t\t\t\t}\n\t\t\t\t\t}}\n\t\t\t\t\tdata-selected={idx === selectedIdx}\n\t\t\t\t>\n\t\t\t\t\t<div class=\"text-black dark:text-gray-100 flex items-center gap-1.5\">\n\t\t\t\t\t\t<Tooltip content={$i18n.t('Note')} placement=\"top\">\n\t\t\t\t\t\t\t<PageEdit className=\"size-4\" />\n\t\t\t\t\t\t</Tooltip>\n\n\t\t\t\t\t\t<Tooltip content={item.description || decodeString(item?.name)} placement=\"top-start\">\n\t\t\t\t\t\t\t<div class=\"line-clamp-1 flex-1\">\n\t\t\t\t\t\t\t\t{decodeString(item?.name)}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</Tooltip>\n\t\t\t\t\t</div>\n\t\t\t\t</button>\n\t\t\t{/each}\n\n\t\t\t{#if !allItemsLoaded}\n\t\t\t\t<Loader\n\t\t\t\t\ton:visible={(e) => {\n\t\t\t\t\t\tif (!itemsLoading) {\n\t\t\t\t\t\t\tloadMoreItems();\n\t\t\t\t\t\t}\n\t\t\t\t\t}}\n\t\t\t\t>\n\t\t\t\t\t<div class=\"w-full flex justify-center py-4 text-xs animate-pulse items-center gap-2\">\n\t\t\t\t\t\t<Spinner className=\" size-4\" />\n\t\t\t\t\t\t<div class=\" \">{$i18n.t('Loading...')}</div>\n\t\t\t\t\t</div>\n\t\t\t\t</Loader>\n\t\t\t{/if}\n\t\t</div>\n\t{/if}\n{:else}\n\t<div class=\"py-4.5\">\n\t\t<Spinner />\n\t</div>\n{/if}\n","<script lang=\"ts\">\n\timport { onMount, tick, getContext } from 'svelte';\n\n\timport { decodeString } from '$lib/utils';\n\timport { knowledge } from '$lib/stores';\n\n\timport { getKnowledgeBases, searchKnowledgeFilesById } from '$lib/apis/knowledge';\n\n\timport Tooltip from '$lib/components/common/Tooltip.svelte';\n\timport Database from '$lib/components/icons/Database.svelte';\n\timport DocumentPage from '$lib/components/icons/DocumentPage.svelte';\n\timport Spinner from '$lib/components/common/Spinner.svelte';\n\timport Loader from '$lib/components/common/Loader.svelte';\n\timport ChevronDown from '$lib/components/icons/ChevronDown.svelte';\n\timport ChevronRight from '$lib/components/icons/ChevronRight.svelte';\n\n\tconst i18n = getContext('i18n');\n\n\texport let onSelect = (e) => {};\n\n\tlet loaded = false;\n\tlet selectedIdx = 0;\n\n\tlet selectedItem = null;\n\n\tlet selectedFileItemsPage = 1;\n\n\tlet selectedFileItems = null;\n\tlet selectedFileItemsTotal = null;\n\n\tlet selectedFileItemsLoading = false;\n\tlet selectedFileAllItemsLoaded = false;\n\n\t$: if (selectedItem) {\n\t\tinitSelectedFileItems();\n\t}\n\n\tconst initSelectedFileItems = async () => {\n\t\tselectedFileItemsPage = 1;\n\t\tselectedFileItems = null;\n\t\tselectedFileItemsTotal = null;\n\t\tselectedFileAllItemsLoaded = false;\n\t\tselectedFileItemsLoading = false;\n\t\tawait tick();\n\t\tawait getSelectedFileItemsPage();\n\t};\n\n\tconst loadMoreSelectedFileItems = async () => {\n\t\tif (selectedFileAllItemsLoaded) return;\n\t\tselectedFileItemsPage += 1;\n\t\tawait getSelectedFileItemsPage();\n\t};\n\n\tconst getSelectedFileItemsPage = async () => {\n\t\tif (!selectedItem) return;\n\t\tselectedFileItemsLoading = true;\n\n\t\tconst res = await searchKnowledgeFilesById(\n\t\t\tlocalStorage.token,\n\t\t\tselectedItem.id,\n\t\t\tnull,\n\t\t\tnull,\n\t\t\tnull,\n\t\t\tnull,\n\t\t\tselectedFileItemsPage\n\t\t).catch(() => {\n\t\t\treturn null;\n\t\t});\n\n\t\tif (res) {\n\t\t\tselectedFileItemsTotal = res.total;\n\t\t\tconst pageItems = res.items;\n\n\t\t\tif ((pageItems ?? []).length === 0) {\n\t\t\t\tselectedFileAllItemsLoaded = true;\n\t\t\t} else {\n\t\t\t\tselectedFileAllItemsLoaded = false;\n\t\t\t}\n\n\t\t\tif (selectedFileItems) {\n\t\t\t\tselectedFileItems = [...selectedFileItems, ...pageItems];\n\t\t\t} else {\n\t\t\t\tselectedFileItems = pageItems;\n\t\t\t}\n\t\t}\n\n\t\tselectedFileItemsLoading = false;\n\t\treturn res;\n\t};\n\n\tlet page = 1;\n\tlet items = null;\n\tlet total = null;\n\n\tlet itemsLoading = false;\n\tlet allItemsLoaded = false;\n\n\t$: if (loaded) {\n\t\tinit();\n\t}\n\n\tconst init = async () => {\n\t\treset();\n\t\tawait tick();\n\t\tawait getItemsPage();\n\t};\n\n\tconst reset = () => {\n\t\tpage = 1;\n\t\titems = null;\n\t\ttotal = null;\n\t\tallItemsLoaded = false;\n\t\titemsLoading = false;\n\t};\n\n\tconst loadMoreItems = async () => {\n\t\tif (allItemsLoaded) return;\n\t\tpage += 1;\n\t\tawait getItemsPage();\n\t};\n\n\tconst getItemsPage = async () => {\n\t\titemsLoading = true;\n\t\tconst res = await getKnowledgeBases(localStorage.token, page).catch(() => {\n\t\t\treturn null;\n\t\t});\n\n\t\tif (res) {\n\t\t\tconsole.log(res);\n\t\t\ttotal = res.total;\n\t\t\tconst pageItems = res.items;\n\n\t\t\tif ((pageItems ?? []).length === 0) {\n\t\t\t\tallItemsLoaded = true;\n\t\t\t} else {\n\t\t\t\tallItemsLoaded = false;\n\t\t\t}\n\n\t\t\tif (items) {\n\t\t\t\titems = [...items, ...pageItems];\n\t\t\t} else {\n\t\t\t\titems = pageItems;\n\t\t\t}\n\t\t}\n\n\t\titemsLoading = false;\n\t\treturn res;\n\t};\n\n\tonMount(async () => {\n\t\tawait tick();\n\t\tloaded = true;\n\t});\n</script>\n\n{#if loaded && items !== null}\n\t<div class=\"flex flex-col gap-0.5\">\n\t\t{#if items.length === 0}\n\t\t\t<div class=\"py-4 text-center text-sm text-gray-500 dark:text-gray-400\">\n\t\t\t\t{$i18n.t('No knowledge bases found.')}\n\t\t\t</div>\n\t\t{:else}\n\t\t\t{#each items as item, idx (item.id)}\n\t\t\t\t<div\n\t\t\t\t\tclass=\" px-2.5 py-1 rounded-xl w-full text-left flex justify-between items-center text-sm {idx ===\n\t\t\t\t\tselectedIdx\n\t\t\t\t\t\t? ' bg-gray-50 dark:bg-gray-800 dark:text-gray-100 selected-command-option-button'\n\t\t\t\t\t\t: ''}\"\n\t\t\t\t>\n\t\t\t\t\t<button\n\t\t\t\t\t\tclass=\"w-full flex-1\"\n\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\tonSelect({\n\t\t\t\t\t\t\t\ttype: 'collection',\n\t\t\t\t\t\t\t\t...item\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}}\n\t\t\t\t\t\ton:mousemove={() => {\n\t\t\t\t\t\t\tselectedIdx = idx;\n\t\t\t\t\t\t}}\n\t\t\t\t\t\ton:mouseleave={() => {\n\t\t\t\t\t\t\tif (idx === 0) {\n\t\t\t\t\t\t\t\tselectedIdx = -1;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}}\n\t\t\t\t\t\tdata-selected={idx === selectedIdx}\n\t\t\t\t\t>\n\t\t\t\t\t\t<div class=\"  text-black dark:text-gray-100 flex items-center gap-1 shrink-0\">\n\t\t\t\t\t\t\t<Tooltip content={$i18n.t('Collection')} placement=\"top\">\n\t\t\t\t\t\t\t\t<Database className=\"size-4\" />\n\t\t\t\t\t\t\t</Tooltip>\n\n\t\t\t\t\t\t\t<Tooltip content={item.description || decodeString(item?.name)} placement=\"top-start\">\n\t\t\t\t\t\t\t\t<div class=\"line-clamp-1 flex-1 text-sm\">\n\t\t\t\t\t\t\t\t\t{decodeString(item?.name)}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</Tooltip>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</button>\n\n\t\t\t\t\t<Tooltip content={$i18n.t('Show Files')} placement=\"top\">\n\t\t\t\t\t\t<button\n\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t\tclass=\" ml-2 opacity-50 hover:opacity-100 transition\"\n\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\tif (selectedItem && selectedItem.id === item.id) {\n\t\t\t\t\t\t\t\t\tselectedItem = null;\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tselectedItem = item;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{#if selectedItem && selectedItem.id === item.id}\n\t\t\t\t\t\t\t\t<ChevronDown className=\"size-3\" />\n\t\t\t\t\t\t\t{:else}\n\t\t\t\t\t\t\t\t<ChevronRight className=\"size-3\" />\n\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</Tooltip>\n\t\t\t\t</div>\n\n\t\t\t\t{#if selectedItem && selectedItem.id === item.id}\n\t\t\t\t\t<div class=\"pl-3 mb-1 flex flex-col gap-0.5\">\n\t\t\t\t\t\t{#if selectedFileItems === null && selectedFileItemsTotal === null}\n\t\t\t\t\t\t\t<div class=\" py-1 flex justify-center\">\n\t\t\t\t\t\t\t\t<Spinner className=\"size-3\" />\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t{:else if selectedFileItemsTotal === 0}\n\t\t\t\t\t\t\t<div class=\" text-xs text-gray-500 dark:text-gray-400 italic py-0.5 px-2\">\n\t\t\t\t\t\t\t\t{$i18n.t('No files in this knowledge base.')}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t{:else}\n\t\t\t\t\t\t\t{#each selectedFileItems as file, fileIdx (file.id)}\n\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\tclass=\" px-2.5 py-1 rounded-xl w-full text-left flex justify-between items-center text-sm hover:bg-gray-50 hover:dark:bg-gray-800 hover:dark:text-gray-100\"\n\t\t\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\t\t\tconsole.log(file);\n\t\t\t\t\t\t\t\t\t\tonSelect({\n\t\t\t\t\t\t\t\t\t\t\ttype: 'file',\n\t\t\t\t\t\t\t\t\t\t\tname: file?.meta?.name,\n\t\t\t\t\t\t\t\t\t\t\t...file\n\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<div class=\" flex items-center gap-1.5\">\n\t\t\t\t\t\t\t\t\t\t<Tooltip content={$i18n.t('Collection')} placement=\"top\">\n\t\t\t\t\t\t\t\t\t\t\t<DocumentPage className=\"size-4\" />\n\t\t\t\t\t\t\t\t\t\t</Tooltip>\n\n\t\t\t\t\t\t\t\t\t\t<Tooltip content={decodeString(file?.meta?.name)} placement=\"top-start\">\n\t\t\t\t\t\t\t\t\t\t\t<div class=\"line-clamp-1 flex-1 text-sm\">\n\t\t\t\t\t\t\t\t\t\t\t\t{decodeString(file?.meta?.name)}\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t</Tooltip>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t{/each}\n\n\t\t\t\t\t\t\t{#if !selectedFileAllItemsLoaded && !selectedFileItemsLoading}\n\t\t\t\t\t\t\t\t<Loader\n\t\t\t\t\t\t\t\t\ton:visible={async (e) => {\n\t\t\t\t\t\t\t\t\t\tif (!selectedFileItemsLoading) {\n\t\t\t\t\t\t\t\t\t\t\tawait loadMoreSelectedFileItems();\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\t\tclass=\"w-full flex justify-center py-4 text-xs animate-pulse items-center gap-2\"\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t<Spinner className=\" size-3\" />\n\t\t\t\t\t\t\t\t\t\t<div class=\" \">{$i18n.t('Loading...')}</div>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</Loader>\n\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t{/if}\n\t\t\t\t\t</div>\n\t\t\t\t{/if}\n\t\t\t{/each}\n\n\t\t\t{#if !allItemsLoaded}\n\t\t\t\t<Loader\n\t\t\t\t\ton:visible={(e) => {\n\t\t\t\t\t\tif (!itemsLoading) {\n\t\t\t\t\t\t\tloadMoreItems();\n\t\t\t\t\t\t}\n\t\t\t\t\t}}\n\t\t\t\t>\n\t\t\t\t\t<div class=\"w-full flex justify-center py-4 text-xs animate-pulse items-center gap-2\">\n\t\t\t\t\t\t<Spinner className=\" size-4\" />\n\t\t\t\t\t\t<div class=\" \">{$i18n.t('Loading...')}</div>\n\t\t\t\t\t</div>\n\t\t\t\t</Loader>\n\t\t\t{/if}\n\t\t{/if}\n\t</div>\n{:else}\n\t<div class=\"py-4.5\">\n\t\t<Spinner />\n\t</div>\n{/if}\n","<script lang=\"ts\">\n\timport { DropdownMenu } from 'bits-ui';\n\timport { getContext, onMount, tick } from 'svelte';\n\timport { fly } from 'svelte/transition';\n\timport { flyAndScale } from '$lib/utils/transitions';\n\n\timport { config, user, tools as _tools, mobile, knowledge, chats } from '$lib/stores';\n\timport { getKnowledgeBases } from '$lib/apis/knowledge';\n\n\timport { createPicker } from '$lib/utils/google-drive-picker';\n\n\timport Dropdown from '$lib/components/common/Dropdown.svelte';\n\timport Tooltip from '$lib/components/common/Tooltip.svelte';\n\timport DocumentArrowUp from '$lib/components/icons/DocumentArrowUp.svelte';\n\timport Camera from '$lib/components/icons/Camera.svelte';\n\timport Note from '$lib/components/icons/Note.svelte';\n\timport Clip from '$lib/components/icons/Clip.svelte';\n\timport ChatBubbleOval from '$lib/components/icons/ChatBubbleOval.svelte';\n\timport Refresh from '$lib/components/icons/Refresh.svelte';\n\timport Agile from '$lib/components/icons/Agile.svelte';\n\timport ClockRotateRight from '$lib/components/icons/ClockRotateRight.svelte';\n\timport Database from '$lib/components/icons/Database.svelte';\n\timport ChevronRight from '$lib/components/icons/ChevronRight.svelte';\n\timport ChevronLeft from '$lib/components/icons/ChevronLeft.svelte';\n\timport PageEdit from '$lib/components/icons/PageEdit.svelte';\n\timport Chats from './InputMenu/Chats.svelte';\n\timport Notes from './InputMenu/Notes.svelte';\n\timport Knowledge from './InputMenu/Knowledge.svelte';\n\timport AttachWebpageModal from './AttachWebpageModal.svelte';\n\timport GlobeAlt from '$lib/components/icons/GlobeAlt.svelte';\n\n\tconst i18n = getContext('i18n');\n\n\texport let files = [];\n\n\texport let selectedModels: string[] = [];\n\texport let fileUploadCapableModels: string[] = [];\n\n\texport let screenCaptureHandler: Function;\n\texport let uploadFilesHandler: Function;\n\texport let inputFilesHandler: Function;\n\n\texport let uploadGoogleDriveHandler: Function;\n\texport let uploadOneDriveHandler: Function;\n\n\texport let onUpload: Function;\n\texport let onClose: Function;\n\n\tlet show = false;\n\tlet tab = '';\n\n\tlet showAttachWebpageModal = false;\n\n\tlet fileUploadEnabled = true;\n\t$: fileUploadEnabled =\n\t\tfileUploadCapableModels.length === selectedModels.length &&\n\t\t($user?.role === 'admin' || $user?.permissions?.chat?.file_upload);\n\n\t$: if (!fileUploadEnabled && files.length > 0) {\n\t\tfiles = [];\n\t}\n\n\tconst detectMobile = () => {\n\t\tconst userAgent = navigator.userAgent || navigator.vendor || window.opera;\n\t\treturn /android|iphone|ipad|ipod|windows phone/i.test(userAgent);\n\t};\n\n\tconst handleFileChange = (event) => {\n\t\tconst inputFiles = Array.from(event.target?.files);\n\t\tif (inputFiles && inputFiles.length > 0) {\n\t\t\tconsole.log(inputFiles);\n\t\t\tinputFilesHandler(inputFiles);\n\t\t}\n\t};\n\n\tconst onSelect = (item) => {\n\t\tif (files.find((f) => f.id === item.id)) {\n\t\t\treturn;\n\t\t}\n\t\tfiles = [\n\t\t\t...files,\n\t\t\t{\n\t\t\t\t...item,\n\t\t\t\tstatus: 'processed'\n\t\t\t}\n\t\t];\n\n\t\tshow = false;\n\t};\n</script>\n\n<AttachWebpageModal\n\tbind:show={showAttachWebpageModal}\n\tonSubmit={(e) => {\n\t\tonUpload(e);\n\t}}\n/>\n\n<!-- Hidden file input used to open the camera on mobile -->\n<input\n\tid=\"camera-input\"\n\ttype=\"file\"\n\taccept=\"image/*\"\n\tcapture=\"environment\"\n\ton:change={handleFileChange}\n\tstyle=\"display: none;\"\n/>\n\n<Dropdown\n\tbind:show\n\ton:change={(e) => {\n\t\tif (e.detail === false) {\n\t\t\tonClose();\n\t\t}\n\t}}\n>\n\t<Tooltip content={$i18n.t('More')}>\n\t\t<slot />\n\t</Tooltip>\n\n\t<div slot=\"content\">\n\t\t<DropdownMenu.Content\n\t\t\tclass=\"w-full max-w-70 rounded-2xl px-1 py-1  border border-gray-100  dark:border-gray-800 z-50 bg-white dark:bg-gray-850 dark:text-white shadow-lg max-h-72 overflow-y-auto overflow-x-hidden scrollbar-thin transition\"\n\t\t\tsideOffset={4}\n\t\t\talignOffset={-6}\n\t\t\tside=\"bottom\"\n\t\t\talign=\"start\"\n\t\t\ttransition={flyAndScale}\n\t\t>\n\t\t\t{#if tab === ''}\n\t\t\t\t<div in:fly={{ x: -20, duration: 150 }}>\n\t\t\t\t\t<Tooltip\n\t\t\t\t\t\tcontent={fileUploadCapableModels.length !== selectedModels.length\n\t\t\t\t\t\t\t? $i18n.t('Model(s) do not support file upload')\n\t\t\t\t\t\t\t: !fileUploadEnabled\n\t\t\t\t\t\t\t\t? $i18n.t('You do not have permission to upload files.')\n\t\t\t\t\t\t\t\t: ''}\n\t\t\t\t\t\tclassName=\"w-full\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<DropdownMenu.Item\n\t\t\t\t\t\t\tclass=\"flex gap-2 items-center px-3 py-1.5 text-sm cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800/50 rounded-xl {!fileUploadEnabled\n\t\t\t\t\t\t\t\t? 'opacity-50'\n\t\t\t\t\t\t\t\t: ''}\"\n\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\tif (fileUploadEnabled) {\n\t\t\t\t\t\t\t\t\tuploadFilesHandler();\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<Clip />\n\n\t\t\t\t\t\t\t<div class=\"line-clamp-1\">{$i18n.t('Upload Files')}</div>\n\t\t\t\t\t\t</DropdownMenu.Item>\n\t\t\t\t\t</Tooltip>\n\n\t\t\t\t\t<Tooltip\n\t\t\t\t\t\tcontent={fileUploadCapableModels.length !== selectedModels.length\n\t\t\t\t\t\t\t? $i18n.t('Model(s) do not support file upload')\n\t\t\t\t\t\t\t: !fileUploadEnabled\n\t\t\t\t\t\t\t\t? $i18n.t('You do not have permission to upload files.')\n\t\t\t\t\t\t\t\t: ''}\n\t\t\t\t\t\tclassName=\"w-full\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<DropdownMenu.Item\n\t\t\t\t\t\t\tclass=\"flex gap-2 items-center px-3 py-1.5 text-sm  cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800/50  rounded-xl {!fileUploadEnabled\n\t\t\t\t\t\t\t\t? 'opacity-50'\n\t\t\t\t\t\t\t\t: ''}\"\n\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\tif (fileUploadEnabled) {\n\t\t\t\t\t\t\t\t\tif (!detectMobile()) {\n\t\t\t\t\t\t\t\t\t\tscreenCaptureHandler();\n\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\tconst cameraInputElement = document.getElementById('camera-input');\n\n\t\t\t\t\t\t\t\t\t\tif (cameraInputElement) {\n\t\t\t\t\t\t\t\t\t\t\tcameraInputElement.click();\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<Camera />\n\t\t\t\t\t\t\t<div class=\" line-clamp-1\">{$i18n.t('Capture')}</div>\n\t\t\t\t\t\t</DropdownMenu.Item>\n\t\t\t\t\t</Tooltip>\n\n\t\t\t\t\t<Tooltip\n\t\t\t\t\t\tcontent={fileUploadCapableModels.length !== selectedModels.length\n\t\t\t\t\t\t\t? $i18n.t('Model(s) do not support file upload')\n\t\t\t\t\t\t\t: !fileUploadEnabled\n\t\t\t\t\t\t\t\t? $i18n.t('You do not have permission to upload files.')\n\t\t\t\t\t\t\t\t: ''}\n\t\t\t\t\t\tclassName=\"w-full\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<DropdownMenu.Item\n\t\t\t\t\t\t\tclass=\"flex gap-2 items-center px-3 py-1.5 text-sm cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 rounded-xl {!fileUploadEnabled\n\t\t\t\t\t\t\t\t? 'opacity-50'\n\t\t\t\t\t\t\t\t: ''}\"\n\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\tif (fileUploadEnabled) {\n\t\t\t\t\t\t\t\t\tshowAttachWebpageModal = true;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<GlobeAlt />\n\t\t\t\t\t\t\t<div class=\"line-clamp-1\">{$i18n.t('Attach Webpage')}</div>\n\t\t\t\t\t\t</DropdownMenu.Item>\n\t\t\t\t\t</Tooltip>\n\n\t\t\t\t\t{#if $config?.features?.enable_notes ?? false}\n\t\t\t\t\t\t<Tooltip\n\t\t\t\t\t\t\tcontent={fileUploadCapableModels.length !== selectedModels.length\n\t\t\t\t\t\t\t\t? $i18n.t('Model(s) do not support file upload')\n\t\t\t\t\t\t\t\t: !fileUploadEnabled\n\t\t\t\t\t\t\t\t\t? $i18n.t('You do not have permission to upload files.')\n\t\t\t\t\t\t\t\t\t: ''}\n\t\t\t\t\t\t\tclassName=\"w-full\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\tclass=\"flex gap-2 w-full items-center px-3 py-1.5 text-sm cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800/50 rounded-xl {!fileUploadEnabled\n\t\t\t\t\t\t\t\t\t? 'opacity-50'\n\t\t\t\t\t\t\t\t\t: ''}\"\n\t\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\t\ttab = 'notes';\n\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<PageEdit />\n\n\t\t\t\t\t\t\t\t<div class=\"flex items-center w-full justify-between\">\n\t\t\t\t\t\t\t\t\t<div class=\" line-clamp-1\">\n\t\t\t\t\t\t\t\t\t\t{$i18n.t('Attach Notes')}\n\t\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t\t<div class=\"text-gray-500\">\n\t\t\t\t\t\t\t\t\t\t<ChevronRight />\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t</Tooltip>\n\t\t\t\t\t{/if}\n\n\t\t\t\t\t<Tooltip\n\t\t\t\t\t\tcontent={fileUploadCapableModels.length !== selectedModels.length\n\t\t\t\t\t\t\t? $i18n.t('Model(s) do not support file upload')\n\t\t\t\t\t\t\t: !fileUploadEnabled\n\t\t\t\t\t\t\t\t? $i18n.t('You do not have permission to upload files.')\n\t\t\t\t\t\t\t\t: ''}\n\t\t\t\t\t\tclassName=\"w-full\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<button\n\t\t\t\t\t\t\tclass=\"flex gap-2 w-full items-center px-3 py-1.5 text-sm cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800/50 rounded-xl {!fileUploadEnabled\n\t\t\t\t\t\t\t\t? 'opacity-50'\n\t\t\t\t\t\t\t\t: ''}\"\n\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\ttab = 'knowledge';\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<Database />\n\n\t\t\t\t\t\t\t<div class=\"flex items-center w-full justify-between\">\n\t\t\t\t\t\t\t\t<div class=\" line-clamp-1\">\n\t\t\t\t\t\t\t\t\t{$i18n.t('Attach Knowledge')}\n\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t<div class=\"text-gray-500\">\n\t\t\t\t\t\t\t\t\t<ChevronRight />\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</Tooltip>\n\n\t\t\t\t\t{#if ($chats ?? []).length > 0}\n\t\t\t\t\t\t<Tooltip\n\t\t\t\t\t\t\tcontent={fileUploadCapableModels.length !== selectedModels.length\n\t\t\t\t\t\t\t\t? $i18n.t('Model(s) do not support file upload')\n\t\t\t\t\t\t\t\t: !fileUploadEnabled\n\t\t\t\t\t\t\t\t\t? $i18n.t('You do not have permission to upload files.')\n\t\t\t\t\t\t\t\t\t: ''}\n\t\t\t\t\t\t\tclassName=\"w-full\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\tclass=\"flex gap-2 w-full items-center px-3 py-1.5 text-sm cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800/50 rounded-xl {!fileUploadEnabled\n\t\t\t\t\t\t\t\t\t? 'opacity-50'\n\t\t\t\t\t\t\t\t\t: ''}\"\n\t\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\t\ttab = 'chats';\n\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<ClockRotateRight />\n\n\t\t\t\t\t\t\t\t<div class=\"flex items-center w-full justify-between\">\n\t\t\t\t\t\t\t\t\t<div class=\" line-clamp-1\">\n\t\t\t\t\t\t\t\t\t\t{$i18n.t('Reference Chats')}\n\t\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t\t<div class=\"text-gray-500\">\n\t\t\t\t\t\t\t\t\t\t<ChevronRight />\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t</Tooltip>\n\t\t\t\t\t{/if}\n\n\t\t\t\t\t{#if fileUploadEnabled}\n\t\t\t\t\t\t{#if $config?.features?.enable_google_drive_integration}\n\t\t\t\t\t\t\t<DropdownMenu.Item\n\t\t\t\t\t\t\t\tclass=\"flex gap-2 items-center px-3 py-1.5 text-sm cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800/50 rounded-xl\"\n\t\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\t\tuploadGoogleDriveHandler();\n\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 87.3 78\" class=\"w-4\">\n\t\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\t\td=\"m6.6 66.85 3.85 6.65c.8 1.4 1.95 2.5 3.3 3.3l13.75-23.8h-27.5c0 1.55.4 3.1 1.2 4.5z\"\n\t\t\t\t\t\t\t\t\t\tfill=\"#0066da\"\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\t\td=\"m43.65 25-13.75-23.8c-1.35.8-2.5 1.9-3.3 3.3l-25.4 44a9.06 9.06 0 0 0 -1.2 4.5h27.5z\"\n\t\t\t\t\t\t\t\t\t\tfill=\"#00ac47\"\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\t\td=\"m73.55 76.8c1.35-.8 2.5-1.9 3.3-3.3l1.6-2.75 7.65-13.25c.8-1.4 1.2-2.95 1.2-4.5h-27.502l5.852 11.5z\"\n\t\t\t\t\t\t\t\t\t\tfill=\"#ea4335\"\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\t\td=\"m43.65 25 13.75-23.8c-1.35-.8-2.9-1.2-4.5-1.2h-18.5c-1.6 0-3.15.45-4.5 1.2z\"\n\t\t\t\t\t\t\t\t\t\tfill=\"#00832d\"\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\t\td=\"m59.8 53h-32.3l-13.75 23.8c1.35.8 2.9 1.2 4.5 1.2h50.8c1.6 0 3.15-.45 4.5-1.2z\"\n\t\t\t\t\t\t\t\t\t\tfill=\"#2684fc\"\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\t\td=\"m73.4 26.5-12.7-22c-.8-1.4-1.95-2.5-3.3-3.3l-13.75 23.8 16.15 28h27.45c0-1.55-.4-3.1-1.2-4.5z\"\n\t\t\t\t\t\t\t\t\t\tfill=\"#ffba00\"\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t\t<div class=\"line-clamp-1\">{$i18n.t('Google Drive')}</div>\n\t\t\t\t\t\t\t</DropdownMenu.Item>\n\t\t\t\t\t\t{/if}\n\n\t\t\t\t\t\t{#if $config?.features?.enable_onedrive_integration && ($config?.features?.enable_onedrive_personal || $config?.features?.enable_onedrive_business)}\n\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\tclass=\"flex gap-2 w-full items-center px-3 py-1.5 text-sm cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800/50 rounded-xl {!fileUploadEnabled\n\t\t\t\t\t\t\t\t\t? 'opacity-50'\n\t\t\t\t\t\t\t\t\t: ''}\"\n\t\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\t\ttab = 'microsoft_onedrive';\n\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<svg\n\t\t\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\t\t\t\t\tviewBox=\"0 0 32 32\"\n\t\t\t\t\t\t\t\t\tclass=\"size-4\"\n\t\t\t\t\t\t\t\t\tfill=\"none\"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<mask\n\t\t\t\t\t\t\t\t\t\tid=\"mask0_87_7796\"\n\t\t\t\t\t\t\t\t\t\tstyle=\"mask-type:alpha\"\n\t\t\t\t\t\t\t\t\t\tmaskUnits=\"userSpaceOnUse\"\n\t\t\t\t\t\t\t\t\t\tx=\"0\"\n\t\t\t\t\t\t\t\t\t\ty=\"6\"\n\t\t\t\t\t\t\t\t\t\twidth=\"32\"\n\t\t\t\t\t\t\t\t\t\theight=\"20\"\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\t\t\td=\"M7.82979 26C3.50549 26 0 22.5675 0 18.3333C0 14.1921 3.35322 10.8179 7.54613 10.6716C9.27535 7.87166 12.4144 6 16 6C20.6308 6 24.5169 9.12183 25.5829 13.3335C29.1316 13.3603 32 16.1855 32 19.6667C32 23.0527 29 26 25.8723 25.9914L7.82979 26Z\"\n\t\t\t\t\t\t\t\t\t\t\tfill=\"#C4C4C4\"\n\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t</mask>\n\t\t\t\t\t\t\t\t\t<g mask=\"url(#mask0_87_7796)\">\n\t\t\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\t\t\td=\"M7.83017 26.0001C5.37824 26.0001 3.18957 24.8966 1.75391 23.1691L18.0429 16.3335L30.7089 23.4647C29.5926 24.9211 27.9066 26.0001 26.0004 25.9915C23.1254 26.0001 12.0629 26.0001 7.83017 26.0001Z\"\n\t\t\t\t\t\t\t\t\t\t\tfill=\"url(#paint0_linear_87_7796)\"\n\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\t\t\td=\"M25.5785 13.3149L18.043 16.3334L30.709 23.4647C31.5199 22.4065 32.0004 21.0916 32.0004 19.6669C32.0004 16.1857 29.1321 13.3605 25.5833 13.3337C25.5817 13.3274 25.5801 13.3212 25.5785 13.3149Z\"\n\t\t\t\t\t\t\t\t\t\t\tfill=\"url(#paint1_linear_87_7796)\"\n\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\t\t\td=\"M7.06445 10.7028L18.0423 16.3333L25.5779 13.3148C24.5051 9.11261 20.6237 6 15.9997 6C12.4141 6 9.27508 7.87166 7.54586 10.6716C7.3841 10.6773 7.22358 10.6877 7.06445 10.7028Z\"\n\t\t\t\t\t\t\t\t\t\t\tfill=\"url(#paint2_linear_87_7796)\"\n\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\t\t\td=\"M1.7535 23.1687L18.0425 16.3331L7.06471 10.7026C3.09947 11.0792 0 14.3517 0 18.3331C0 20.1665 0.657197 21.8495 1.7535 23.1687Z\"\n\t\t\t\t\t\t\t\t\t\t\tfill=\"url(#paint3_linear_87_7796)\"\n\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t</g>\n\t\t\t\t\t\t\t\t\t<defs>\n\t\t\t\t\t\t\t\t\t\t<linearGradient\n\t\t\t\t\t\t\t\t\t\t\tid=\"paint0_linear_87_7796\"\n\t\t\t\t\t\t\t\t\t\t\tx1=\"4.42591\"\n\t\t\t\t\t\t\t\t\t\t\ty1=\"24.6668\"\n\t\t\t\t\t\t\t\t\t\t\tx2=\"27.2309\"\n\t\t\t\t\t\t\t\t\t\t\ty2=\"23.2764\"\n\t\t\t\t\t\t\t\t\t\t\tgradientUnits=\"userSpaceOnUse\"\n\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t<stop stop-color=\"#2086B8\" />\n\t\t\t\t\t\t\t\t\t\t\t<stop offset=\"1\" stop-color=\"#46D3F6\" />\n\t\t\t\t\t\t\t\t\t\t</linearGradient>\n\t\t\t\t\t\t\t\t\t\t<linearGradient\n\t\t\t\t\t\t\t\t\t\t\tid=\"paint1_linear_87_7796\"\n\t\t\t\t\t\t\t\t\t\t\tx1=\"23.8302\"\n\t\t\t\t\t\t\t\t\t\t\ty1=\"19.6668\"\n\t\t\t\t\t\t\t\t\t\t\tx2=\"30.2108\"\n\t\t\t\t\t\t\t\t\t\t\ty2=\"15.2082\"\n\t\t\t\t\t\t\t\t\t\t\tgradientUnits=\"userSpaceOnUse\"\n\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t<stop stop-color=\"#1694DB\" />\n\t\t\t\t\t\t\t\t\t\t\t<stop offset=\"1\" stop-color=\"#62C3FE\" />\n\t\t\t\t\t\t\t\t\t\t</linearGradient>\n\t\t\t\t\t\t\t\t\t\t<linearGradient\n\t\t\t\t\t\t\t\t\t\t\tid=\"paint2_linear_87_7796\"\n\t\t\t\t\t\t\t\t\t\t\tx1=\"8.51037\"\n\t\t\t\t\t\t\t\t\t\t\ty1=\"7.33333\"\n\t\t\t\t\t\t\t\t\t\t\tx2=\"23.3335\"\n\t\t\t\t\t\t\t\t\t\t\ty2=\"15.9348\"\n\t\t\t\t\t\t\t\t\t\t\tgradientUnits=\"userSpaceOnUse\"\n\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t<stop stop-color=\"#0D3D78\" />\n\t\t\t\t\t\t\t\t\t\t\t<stop offset=\"1\" stop-color=\"#063B83\" />\n\t\t\t\t\t\t\t\t\t\t</linearGradient>\n\t\t\t\t\t\t\t\t\t\t<linearGradient\n\t\t\t\t\t\t\t\t\t\t\tid=\"paint3_linear_87_7796\"\n\t\t\t\t\t\t\t\t\t\t\tx1=\"-0.340429\"\n\t\t\t\t\t\t\t\t\t\t\ty1=\"19.9998\"\n\t\t\t\t\t\t\t\t\t\t\tx2=\"14.5634\"\n\t\t\t\t\t\t\t\t\t\t\ty2=\"14.4649\"\n\t\t\t\t\t\t\t\t\t\t\tgradientUnits=\"userSpaceOnUse\"\n\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t<stop stop-color=\"#16589B\" />\n\t\t\t\t\t\t\t\t\t\t\t<stop offset=\"1\" stop-color=\"#1464B7\" />\n\t\t\t\t\t\t\t\t\t\t</linearGradient>\n\t\t\t\t\t\t\t\t\t</defs>\n\t\t\t\t\t\t\t\t</svg>\n\n\t\t\t\t\t\t\t\t<div class=\"flex items-center w-full justify-between\">\n\t\t\t\t\t\t\t\t\t<div class=\" line-clamp-1\">\n\t\t\t\t\t\t\t\t\t\t{$i18n.t('Microsoft OneDrive')}\n\t\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t\t<div class=\"text-gray-500\">\n\t\t\t\t\t\t\t\t\t\t<ChevronRight />\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t{/if}\n\t\t\t\t\t{/if}\n\t\t\t\t</div>\n\t\t\t{:else if tab === 'knowledge'}\n\t\t\t\t<div in:fly={{ x: 20, duration: 150 }}>\n\t\t\t\t\t<button\n\t\t\t\t\t\tclass=\"flex w-full justify-between gap-2 items-center px-3 py-1.5 text-sm cursor-pointer rounded-xl hover:bg-gray-50 dark:hover:bg-gray-800/50\"\n\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\ttab = '';\n\t\t\t\t\t\t}}\n\t\t\t\t\t>\n\t\t\t\t\t\t<ChevronLeft />\n\n\t\t\t\t\t\t<div class=\"flex items-center w-full justify-between\">\n\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t{$i18n.t('Knowledge')}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</button>\n\n\t\t\t\t\t<Knowledge {onSelect} />\n\t\t\t\t</div>\n\t\t\t{:else if tab === 'notes'}\n\t\t\t\t<div in:fly={{ x: 20, duration: 150 }}>\n\t\t\t\t\t<button\n\t\t\t\t\t\tclass=\"flex w-full justify-between gap-2 items-center px-3 py-1.5 text-sm cursor-pointer rounded-xl hover:bg-gray-50 dark:hover:bg-gray-800/50\"\n\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\ttab = '';\n\t\t\t\t\t\t}}\n\t\t\t\t\t>\n\t\t\t\t\t\t<ChevronLeft />\n\n\t\t\t\t\t\t<div class=\"flex items-center w-full justify-between\">\n\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t{$i18n.t('Notes')}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</button>\n\n\t\t\t\t\t<Notes {onSelect} />\n\t\t\t\t</div>\n\t\t\t{:else if tab === 'chats'}\n\t\t\t\t<div in:fly={{ x: 20, duration: 150 }}>\n\t\t\t\t\t<button\n\t\t\t\t\t\tclass=\"flex w-full justify-between gap-2 items-center px-3 py-1.5 text-sm cursor-pointer rounded-xl hover:bg-gray-50 dark:hover:bg-gray-800/50\"\n\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\ttab = '';\n\t\t\t\t\t\t}}\n\t\t\t\t\t>\n\t\t\t\t\t\t<ChevronLeft />\n\n\t\t\t\t\t\t<div class=\"flex items-center w-full justify-between\">\n\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t{$i18n.t('Chats')}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</button>\n\n\t\t\t\t\t<Chats {onSelect} />\n\t\t\t\t</div>\n\t\t\t{:else if tab === 'microsoft_onedrive'}\n\t\t\t\t<div in:fly={{ x: 20, duration: 150 }}>\n\t\t\t\t\t<button\n\t\t\t\t\t\tclass=\"flex w-full justify-between gap-2 items-center px-3 py-1.5 text-sm cursor-pointer rounded-xl hover:bg-gray-50 dark:hover:bg-gray-800/50\"\n\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\ttab = '';\n\t\t\t\t\t\t}}\n\t\t\t\t\t>\n\t\t\t\t\t\t<ChevronLeft />\n\n\t\t\t\t\t\t<div class=\"flex items-center w-full justify-between\">\n\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t{$i18n.t('Microsoft OneDrive')}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</button>\n\n\t\t\t\t\t{#if $config?.features?.enable_onedrive_personal}\n\t\t\t\t\t\t<DropdownMenu.Item\n\t\t\t\t\t\t\tclass=\"flex gap-2 items-center px-3 py-1.5 text-sm cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800/50 rounded-xl text-left\"\n\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\tuploadOneDriveHandler('personal');\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<div class=\"flex flex-col\">\n\t\t\t\t\t\t\t\t<div class=\"line-clamp-1\">{$i18n.t('Microsoft OneDrive (personal)')}</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</DropdownMenu.Item>\n\t\t\t\t\t{/if}\n\n\t\t\t\t\t{#if $config?.features?.enable_onedrive_business}\n\t\t\t\t\t\t<DropdownMenu.Item\n\t\t\t\t\t\t\tclass=\"flex gap-2 items-center px-3 py-1.5 text-sm cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800/50 rounded-xl text-left\"\n\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\tuploadOneDriveHandler('organizations');\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<div class=\"flex flex-col\">\n\t\t\t\t\t\t\t\t<div class=\"line-clamp-1\">\n\t\t\t\t\t\t\t\t\t{$i18n.t('Microsoft OneDrive (work/school)')}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class=\"text-xs text-gray-500\">{$i18n.t('Includes SharePoint')}</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</DropdownMenu.Item>\n\t\t\t\t\t{/if}\n\t\t\t\t</div>\n\t\t\t{/if}\n\t\t</DropdownMenu.Content>\n\t</div>\n</Dropdown>\n","<script lang=\"ts\">\n\timport { getContext, onMount } from 'svelte';\n\timport { models, config, toolServers, tools } from '$lib/stores';\n\n\timport { toast } from 'svelte-sonner';\n\timport { deleteSharedChatById, getChatById, shareChatById } from '$lib/apis/chats';\n\timport { copyToClipboard } from '$lib/utils';\n\n\timport Modal from '../common/Modal.svelte';\n\timport Link from '../icons/Link.svelte';\n\timport Collapsible from '../common/Collapsible.svelte';\n\timport XMark from '$lib/components/icons/XMark.svelte';\n\n\texport let show = false;\n\texport let selectedToolIds = [];\n\n\tlet selectedTools = [];\n\n\t$: selectedTools = ($tools ?? []).filter((tool) => selectedToolIds.includes(tool.id));\n\n\tconst i18n = getContext('i18n');\n</script>\n\n<Modal bind:show size=\"md\">\n\t<div>\n\t\t<div class=\" flex justify-between dark:text-gray-300 px-5 pt-4 pb-0.5\">\n\t\t\t<div class=\" text-lg font-medium self-center\">{$i18n.t('Available Tools')}</div>\n\t\t\t<button\n\t\t\t\tclass=\"self-center\"\n\t\t\t\ton:click={() => {\n\t\t\t\t\tshow = false;\n\t\t\t\t}}\n\t\t\t>\n\t\t\t\t<XMark className={'size-5'} />\n\t\t\t</button>\n\t\t</div>\n\n\t\t{#if selectedTools.length > 0}\n\t\t\t{#if $toolServers.length > 0}\n\t\t\t\t<div class=\" flex justify-between dark:text-gray-300 px-5 pb-1\">\n\t\t\t\t\t<div class=\" text-base font-medium self-center\">{$i18n.t('Tools')}</div>\n\t\t\t\t</div>\n\t\t\t{/if}\n\n\t\t\t<div class=\"px-5 pb-3 w-full flex flex-col justify-center\">\n\t\t\t\t<div class=\" text-sm dark:text-gray-300 mb-1\">\n\t\t\t\t\t{#each selectedTools as tool}\n\t\t\t\t\t\t<Collapsible buttonClassName=\"w-full mb-0.5\">\n\t\t\t\t\t\t\t<div class=\"truncate\">\n\t\t\t\t\t\t\t\t<div class=\"text-sm font-medium dark:text-gray-100 text-gray-800 truncate\">\n\t\t\t\t\t\t\t\t\t{tool?.name}\n\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t{#if tool?.meta?.description}\n\t\t\t\t\t\t\t\t\t<div class=\"text-xs text-gray-500\">\n\t\t\t\t\t\t\t\t\t\t{tool?.meta?.description}\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t<!-- <div slot=\"content\">\n\t\t\t\t\t\t\t{JSON.stringify(tool, null, 2)}\n\t\t\t\t\t\t</div> -->\n\t\t\t\t\t\t</Collapsible>\n\t\t\t\t\t{/each}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t{/if}\n\n\t\t{#if $toolServers.length > 0}\n\t\t\t<div class=\" flex justify-between dark:text-gray-300 px-5 pb-0.5\">\n\t\t\t\t<div class=\" text-base font-medium self-center\">{$i18n.t('Tool Servers')}</div>\n\t\t\t</div>\n\n\t\t\t<div class=\"px-5 pb-5 w-full flex flex-col justify-center\">\n\t\t\t\t<div class=\" text-xs text-gray-600 dark:text-gray-300 mb-2\">\n\t\t\t\t\t{$i18n.t('Open WebUI can use tools provided by any OpenAPI server.')} <br /><a\n\t\t\t\t\t\tclass=\"underline\"\n\t\t\t\t\t\thref=\"https://github.com/open-webui/openapi-servers\"\n\t\t\t\t\t\ttarget=\"_blank\">{$i18n.t('Learn more about OpenAPI tool servers.')}</a\n\t\t\t\t\t>\n\t\t\t\t</div>\n\t\t\t\t<div class=\" text-sm dark:text-gray-300 mb-1\">\n\t\t\t\t\t{#each $toolServers as toolServer}\n\t\t\t\t\t\t<Collapsible buttonClassName=\"w-full\" chevron>\n\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t<div class=\"text-sm font-medium dark:text-gray-100 text-gray-800\">\n\t\t\t\t\t\t\t\t\t{toolServer?.openapi?.info?.title} - v{toolServer?.openapi?.info?.version}\n\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t<div class=\"text-xs text-gray-500\">\n\t\t\t\t\t\t\t\t\t{toolServer?.openapi?.info?.description}\n\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t<div class=\"text-xs text-gray-500\">\n\t\t\t\t\t\t\t\t\t{toolServer?.url}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t<div slot=\"content\">\n\t\t\t\t\t\t\t\t{#each toolServer?.specs ?? [] as tool_spec}\n\t\t\t\t\t\t\t\t\t<div class=\"my-1\">\n\t\t\t\t\t\t\t\t\t\t<div class=\"font-medium text-gray-800 dark:text-gray-100\">\n\t\t\t\t\t\t\t\t\t\t\t{tool_spec?.name}\n\t\t\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t\t\t\t{tool_spec?.description}\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t{/each}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</Collapsible>\n\t\t\t\t\t{/each}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t{/if}\n\t</div>\n</Modal>\n","<script lang=\"ts\">\n\texport let className = 'size-4';\n\texport let strokeWidth = '1.5';\n</script>\n\n<svg\n\txmlns=\"http://www.w3.org/2000/svg\"\n\tfill=\"none\"\n\tviewBox=\"0 0 24 24\"\n\tstroke-width={strokeWidth}\n\tstroke=\"currentColor\"\n\tclass={className}\n\taria-hidden=\"true\"\n\t><path\n\t\td=\"M21 7.6V20.4C21 20.7314 20.7314 21 20.4 21H7.6C7.26863 21 7 20.7314 7 20.4V7.6C7 7.26863 7.26863 7 7.6 7H20.4C20.7314 7 21 7.26863 21 7.6Z\"\n\t\tstroke-linecap=\"round\"\n\t\tstroke-linejoin=\"round\"\n\t></path><path\n\t\td=\"M18 4H4.6C4.26863 4 4 4.26863 4 4.6V18\"\n\t\tstroke-linecap=\"round\"\n\t\tstroke-linejoin=\"round\"\n\t></path><path d=\"M7 16.8L12.4444 15L21 18\" stroke-linecap=\"round\" stroke-linejoin=\"round\"\n\t></path><path\n\t\td=\"M16.5 13C15.6716 13 15 12.3284 15 11.5C15 10.6716 15.6716 10 16.5 10C17.3284 10 18 10.6716 18 11.5C18 12.3284 17.3284 13 16.5 13Z\"\n\t\tstroke-linecap=\"round\"\n\t\tstroke-linejoin=\"round\"\n\t></path></svg\n>\n","<script lang=\"ts\">\n\texport let className = 'w-4 h-4';\n\texport let strokeWidth = '1.5';\n</script>\n\n<svg\n\txmlns=\"http://www.w3.org/2000/svg\"\n\tfill=\"none\"\n\tviewBox=\"0 0 24 24\"\n\tstroke-width={strokeWidth}\n\taria-hidden=\"true\"\n\tstroke=\"currentColor\"\n\tclass={className}\n>\n\t<path\n\t\tstroke-linecap=\"round\"\n\t\tstroke-linejoin=\"round\"\n\t\td=\"M21.75 6.75a4.5 4.5 0 0 1-4.884 4.484c-1.076-.091-2.264.071-2.95.904l-7.152 8.684a2.548 2.548 0 1 1-3.586-3.586l8.684-7.152c.833-.686.995-1.874.904-2.95a4.5 4.5 0 0 1 6.336-4.486l-3.276 3.276a3.004 3.004 0 0 0 2.25 2.25l3.276-3.276c.256.565.398 1.192.398 1.852Z\"\n\t/>\n\t<path stroke-linecap=\"round\" stroke-linejoin=\"round\" d=\"M4.867 19.125h.008v.008h-.008v-.008Z\" />\n</svg>\n","<script lang=\"ts\">\n\texport let className = 'w-4 h-4';\n\texport let strokeWidth = '1.5';\n</script>\n\n<svg\n\taria-hidden=\"true\"\n\txmlns=\"http://www.w3.org/2000/svg\"\n\tfill=\"currentColor\"\n\tviewBox=\"0 0 24 24\"\n\tstroke-width={strokeWidth}\n\tstroke=\"currentColor\"\n\tclass={className}\n\t><path d=\"M12 4L12 20\" stroke-linecap=\"round\" stroke-linejoin=\"round\"></path><path\n\t\td=\"M8 9L8 15\"\n\t\tstroke-linecap=\"round\"\n\t\tstroke-linejoin=\"round\"\n\t></path><path d=\"M20 10L20 14\" stroke-linecap=\"round\" stroke-linejoin=\"round\"></path><path\n\t\td=\"M4 10L4 14\"\n\t\tstroke-linecap=\"round\"\n\t\tstroke-linejoin=\"round\"\n\t></path><path d=\"M16 7L16 17\" stroke-linecap=\"round\" stroke-linejoin=\"round\"></path></svg\n>\n","<script lang=\"ts\">\n\texport let className = 'w-4 h-4';\n\texport let strokeWidth = '1.5';\n</script>\n\n<svg\n\txmlns=\"http://www.w3.org/2000/svg\"\n\tfill=\"none\"\n\tviewBox=\"0 0 24 24\"\n\tstroke-width={strokeWidth}\n\tstroke=\"currentColor\"\n\tclass={className}\n\taria-hidden=\"true\"\n\t><path d=\"M13 16H18\" stroke-linecap=\"round\" stroke-linejoin=\"round\"></path><path\n\t\td=\"M6 8L10 12L6 16\"\n\t\tstroke-linecap=\"round\"\n\t\tstroke-linejoin=\"round\"\n\t></path><path\n\t\td=\"M2 18V6C2 4.89543 2.89543 4 4 4H20C21.1046 4 22 4.89543 22 6V18C22 19.1046 21.1046 20 20 20H4C2.89543 20 2 19.1046 2 18Z\"\n\t\tstroke-linecap=\"round\"\n\t\tstroke-linejoin=\"round\"\n\t></path></svg\n>\n","<script lang=\"ts\">\n\texport let className = 'w-4 h-4';\n\texport let strokeWidth = '1.5';\n</script>\n\n<svg\n\txmlns=\"http://www.w3.org/2000/svg\"\n\tclass={className}\n\taria-hidden=\"true\"\n\tstroke-width={strokeWidth}\n\tfill=\"none\"\n\tstroke=\"currentColor\"\n\tviewBox=\"0 0 24 24\"\n>\n\t<path\n\t\tstroke-linecap=\"round\"\n\t\tstroke-linejoin=\"round\"\n\t\td=\"M10.5 6h9.75M10.5 6a1.5 1.5 0 1 1-3 0m3 0a1.5 1.5 0 1 0-3 0M3.75 6H7.5m3 12h9.75m-9.75 0a1.5 1.5 0 0 1-3 0m3 0a1.5 1.5 0 0 0-3 0m-3.75 0H7.5m9-6h3.75m-3.75 0a1.5 1.5 0 0 1-3 0m3 0a1.5 1.5 0 0 0-3 0m-9.75 0h9.75\"\n\t/>\n</svg>\n","<script lang=\"ts\">\n\timport { DropdownMenu } from 'bits-ui';\n\timport { getContext, onMount, tick } from 'svelte';\n\timport { fly } from 'svelte/transition';\n\timport { flyAndScale } from '$lib/utils/transitions';\n\n\timport { config, user, tools as _tools, mobile, settings, toolServers } from '$lib/stores';\n\n\timport { getOAuthClientAuthorizationUrl } from '$lib/apis/configs';\n\timport { getTools } from '$lib/apis/tools';\n\n\timport Knobs from '$lib/components/icons/Knobs.svelte';\n\timport Dropdown from '$lib/components/common/Dropdown.svelte';\n\timport Tooltip from '$lib/components/common/Tooltip.svelte';\n\timport Switch from '$lib/components/common/Switch.svelte';\n\timport Spinner from '$lib/components/common/Spinner.svelte';\n\timport Wrench from '$lib/components/icons/Wrench.svelte';\n\timport Sparkles from '$lib/components/icons/Sparkles.svelte';\n\timport GlobeAlt from '$lib/components/icons/GlobeAlt.svelte';\n\timport Photo from '$lib/components/icons/Photo.svelte';\n\timport Terminal from '$lib/components/icons/Terminal.svelte';\n\timport ChevronRight from '$lib/components/icons/ChevronRight.svelte';\n\timport ChevronLeft from '$lib/components/icons/ChevronLeft.svelte';\n\n\tconst i18n = getContext('i18n');\n\n\texport let selectedToolIds: string[] = [];\n\n\texport let selectedModels: string[] = [];\n\texport let fileUploadCapableModels: string[] = [];\n\n\texport let toggleFilters: { id: string; name: string; description?: string; icon?: string }[] =\n\t\t[];\n\texport let selectedFilterIds: string[] = [];\n\n\texport let showWebSearchButton = false;\n\texport let webSearchEnabled = false;\n\texport let showImageGenerationButton = false;\n\texport let imageGenerationEnabled = false;\n\texport let showCodeInterpreterButton = false;\n\texport let codeInterpreterEnabled = false;\n\n\texport let onShowValves: Function;\n\texport let onClose: Function;\n\texport let closeOnOutsideClick = true;\n\n\tlet show = false;\n\tlet tab = '';\n\n\tlet tools = null;\n\n\t$: if (show) {\n\t\tinit();\n\t}\n\n\tlet fileUploadEnabled = true;\n\t$: fileUploadEnabled =\n\t\tfileUploadCapableModels.length === selectedModels.length &&\n\t\t($user?.role === 'admin' || $user?.permissions?.chat?.file_upload);\n\n\tconst init = async () => {\n\t\tif ($_tools === null) {\n\t\t\tawait _tools.set(await getTools(localStorage.token));\n\t\t}\n\n\t\tif ($_tools) {\n\t\t\ttools = $_tools.reduce((a, tool, i, arr) => {\n\t\t\t\ta[tool.id] = {\n\t\t\t\t\tname: tool.name,\n\t\t\t\t\tdescription: tool.meta.description,\n\t\t\t\t\tenabled: selectedToolIds.includes(tool.id),\n\t\t\t\t\t...tool\n\t\t\t\t};\n\t\t\t\treturn a;\n\t\t\t}, {});\n\t\t}\n\n\t\tif ($toolServers) {\n\t\t\tfor (const serverIdx in $toolServers) {\n\t\t\t\tconst server = $toolServers[serverIdx];\n\t\t\t\tif (server.info) {\n\t\t\t\t\ttools[`direct_server:${serverIdx}`] = {\n\t\t\t\t\t\tname: server?.info?.title ?? server.url,\n\t\t\t\t\t\tdescription: server.info.description ?? '',\n\t\t\t\t\t\tenabled: selectedToolIds.includes(`direct_server:${serverIdx}`)\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tselectedToolIds = selectedToolIds.filter((id) => Object.keys(tools).includes(id));\n\t};\n</script>\n\n<Dropdown\n\tbind:show\n\ton:change={(e) => {\n\t\tif (e.detail === false) {\n\t\t\tonClose();\n\t\t}\n\t}}\n>\n\t<Tooltip content={$i18n.t('Integrations')} placement=\"top\">\n\t\t<slot />\n\t</Tooltip>\n\t<div slot=\"content\">\n\t\t<DropdownMenu.Content\n\t\t\tclass=\"w-full max-w-70 rounded-2xl px-1 py-1  border border-gray-100  dark:border-gray-800 z-50 bg-white dark:bg-gray-850 dark:text-white shadow-lg max-h-72 overflow-y-auto overflow-x-hidden scrollbar-thin\"\n\t\t\tsideOffset={4}\n\t\t\talignOffset={-6}\n\t\t\tside=\"bottom\"\n\t\t\talign=\"start\"\n\t\t\ttransition={flyAndScale}\n\t\t>\n\t\t\t{#if tab === ''}\n\t\t\t\t<div in:fly={{ x: -20, duration: 150 }}>\n\t\t\t\t\t{#if tools}\n\t\t\t\t\t\t{#if Object.keys(tools).length > 0}\n\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\tclass=\"flex w-full justify-between gap-2 items-center px-3 py-1.5 text-sm cursor-pointer rounded-xl hover:bg-gray-50 dark:hover:bg-gray-800/50\"\n\t\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\t\ttab = 'tools';\n\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<Wrench />\n\n\t\t\t\t\t\t\t\t<div class=\"flex items-center w-full justify-between\">\n\t\t\t\t\t\t\t\t\t<div class=\" line-clamp-1\">\n\t\t\t\t\t\t\t\t\t\t{$i18n.t('Tools')}\n\t\t\t\t\t\t\t\t\t\t<span class=\"ml-0.5 text-gray-500\">{Object.keys(tools).length}</span>\n\t\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t\t<div class=\"text-gray-500\">\n\t\t\t\t\t\t\t\t\t\t<ChevronRight />\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t{/if}\n\t\t\t\t\t{:else}\n\t\t\t\t\t\t<div class=\"py-4\">\n\t\t\t\t\t\t\t<Spinner />\n\t\t\t\t\t\t</div>\n\t\t\t\t\t{/if}\n\n\t\t\t\t\t{#if toggleFilters && toggleFilters.length > 0}\n\t\t\t\t\t\t{#each toggleFilters.sort( (a, b) => a.name.localeCompare( b.name, undefined, { sensitivity: 'base' } ) ) as filter, filterIdx (filter.id)}\n\t\t\t\t\t\t\t<Tooltip content={filter?.description} placement=\"top-start\">\n\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\tclass=\"flex w-full justify-between gap-2 items-center px-3 py-1.5 text-sm cursor-pointer rounded-xl hover:bg-gray-50 dark:hover:bg-gray-800/50\"\n\t\t\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\t\t\tif (selectedFilterIds.includes(filter.id)) {\n\t\t\t\t\t\t\t\t\t\t\tselectedFilterIds = selectedFilterIds.filter((id) => id !== filter.id);\n\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\tselectedFilterIds = [...selectedFilterIds, filter.id];\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<div class=\"flex-1 truncate\">\n\t\t\t\t\t\t\t\t\t\t<div class=\"flex flex-1 gap-2 items-center\">\n\t\t\t\t\t\t\t\t\t\t\t<div class=\"shrink-0\">\n\t\t\t\t\t\t\t\t\t\t\t\t{#if filter?.icon}\n\t\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"size-4 items-center flex justify-center\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<img\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tsrc={filter.icon}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tclass=\"size-3.5 {filter.icon.includes('svg')\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t? 'dark:invert-[80%]'\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t: ''}\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tstyle=\"fill: currentColor;\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\talt={filter.name}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t{:else}\n\t\t\t\t\t\t\t\t\t\t\t\t\t<Sparkles className=\"size-4\" strokeWidth=\"1.75\" />\n\t\t\t\t\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t\t\t\t<div class=\" truncate\">{filter?.name}</div>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t\t{#if filter?.has_user_valves}\n\t\t\t\t\t\t\t\t\t\t<div class=\" shrink-0\">\n\t\t\t\t\t\t\t\t\t\t\t<Tooltip content={$i18n.t('Valves')}>\n\t\t\t\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\t\t\t\tclass=\"self-center w-fit text-sm text-gray-600 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300 transition rounded-full\"\n\t\t\t\t\t\t\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t\t\t\t\t\t\t\ton:click={(e) => {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\t\t\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tonShowValves({\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype: 'function',\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tid: filter.id\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<Knobs />\n\t\t\t\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t\t\t\t</Tooltip>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t{/if}\n\n\t\t\t\t\t\t\t\t\t<div class=\" shrink-0\">\n\t\t\t\t\t\t\t\t\t\t<Switch\n\t\t\t\t\t\t\t\t\t\t\tstate={selectedFilterIds.includes(filter.id)}\n\t\t\t\t\t\t\t\t\t\t\ton:change={async (e) => {\n\t\t\t\t\t\t\t\t\t\t\t\tconst state = e.detail;\n\t\t\t\t\t\t\t\t\t\t\t\tawait tick();\n\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t</Tooltip>\n\t\t\t\t\t\t{/each}\n\t\t\t\t\t{/if}\n\n\t\t\t\t\t{#if showWebSearchButton}\n\t\t\t\t\t\t<Tooltip content={$i18n.t('Search the internet')} placement=\"top-start\">\n\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\tclass=\"flex w-full justify-between gap-2 items-center px-3 py-1.5 text-sm cursor-pointer rounded-xl hover:bg-gray-50 dark:hover:bg-gray-800/50\"\n\t\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\t\twebSearchEnabled = !webSearchEnabled;\n\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<div class=\"flex-1 truncate\">\n\t\t\t\t\t\t\t\t\t<div class=\"flex flex-1 gap-2 items-center\">\n\t\t\t\t\t\t\t\t\t\t<div class=\"shrink-0\">\n\t\t\t\t\t\t\t\t\t\t\t<GlobeAlt />\n\t\t\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t\t\t<div class=\" truncate\">{$i18n.t('Web Search')}</div>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t<div class=\" shrink-0\">\n\t\t\t\t\t\t\t\t\t<Switch\n\t\t\t\t\t\t\t\t\t\tstate={webSearchEnabled}\n\t\t\t\t\t\t\t\t\t\ton:change={async (e) => {\n\t\t\t\t\t\t\t\t\t\t\tconst state = e.detail;\n\t\t\t\t\t\t\t\t\t\t\tawait tick();\n\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t</Tooltip>\n\t\t\t\t\t{/if}\n\n\t\t\t\t\t{#if showImageGenerationButton}\n\t\t\t\t\t\t<Tooltip content={$i18n.t('Generate an image')} placement=\"top-start\">\n\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\tclass=\"flex w-full justify-between gap-2 items-center px-3 py-1.5 text-sm cursor-pointer rounded-xl hover:bg-gray-50 dark:hover:bg-gray-800/50\"\n\t\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\t\timageGenerationEnabled = !imageGenerationEnabled;\n\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<div class=\"flex-1 truncate\">\n\t\t\t\t\t\t\t\t\t<div class=\"flex flex-1 gap-2 items-center\">\n\t\t\t\t\t\t\t\t\t\t<div class=\"shrink-0\">\n\t\t\t\t\t\t\t\t\t\t\t<Photo className=\"size-4\" strokeWidth=\"1.5\" />\n\t\t\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t\t\t<div class=\" truncate\">{$i18n.t('Image')}</div>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t<div class=\" shrink-0\">\n\t\t\t\t\t\t\t\t\t<Switch\n\t\t\t\t\t\t\t\t\t\tstate={imageGenerationEnabled}\n\t\t\t\t\t\t\t\t\t\ton:change={async (e) => {\n\t\t\t\t\t\t\t\t\t\t\tconst state = e.detail;\n\t\t\t\t\t\t\t\t\t\t\tawait tick();\n\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t</Tooltip>\n\t\t\t\t\t{/if}\n\n\t\t\t\t\t{#if showCodeInterpreterButton}\n\t\t\t\t\t\t<Tooltip content={$i18n.t('Execute code for analysis')} placement=\"top-start\">\n\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\tclass=\"flex w-full justify-between gap-2 items-center px-3 py-1.5 text-sm cursor-pointer rounded-xl hover:bg-gray-50 dark:hover:bg-gray-800/50\"\n\t\t\t\t\t\t\t\taria-pressed={codeInterpreterEnabled}\n\t\t\t\t\t\t\t\taria-label={codeInterpreterEnabled\n\t\t\t\t\t\t\t\t\t? $i18n.t('Disable Code Interpreter')\n\t\t\t\t\t\t\t\t\t: $i18n.t('Enable Code Interpreter')}\n\t\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\t\tcodeInterpreterEnabled = !codeInterpreterEnabled;\n\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<div class=\"flex-1 truncate\">\n\t\t\t\t\t\t\t\t\t<div class=\"flex flex-1 gap-2 items-center\">\n\t\t\t\t\t\t\t\t\t\t<div class=\"shrink-0\">\n\t\t\t\t\t\t\t\t\t\t\t<Terminal className=\"size-3.5\" strokeWidth=\"1.75\" />\n\t\t\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t\t\t<div class=\" truncate\">{$i18n.t('Code Interpreter')}</div>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t<div class=\" shrink-0\">\n\t\t\t\t\t\t\t\t\t<Switch\n\t\t\t\t\t\t\t\t\t\tstate={codeInterpreterEnabled}\n\t\t\t\t\t\t\t\t\t\ton:change={async (e) => {\n\t\t\t\t\t\t\t\t\t\t\tconst state = e.detail;\n\t\t\t\t\t\t\t\t\t\t\tawait tick();\n\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t</Tooltip>\n\t\t\t\t\t{/if}\n\t\t\t\t</div>\n\t\t\t{:else if tab === 'tools' && tools}\n\t\t\t\t<div in:fly={{ x: 20, duration: 150 }}>\n\t\t\t\t\t<button\n\t\t\t\t\t\tclass=\"flex w-full justify-between gap-2 items-center px-3 py-1.5 text-sm cursor-pointer rounded-xl hover:bg-gray-50 dark:hover:bg-gray-800/50\"\n\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\ttab = '';\n\t\t\t\t\t\t}}\n\t\t\t\t\t>\n\t\t\t\t\t\t<ChevronLeft />\n\n\t\t\t\t\t\t<div class=\"flex items-center w-full justify-between\">\n\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t{$i18n.t('Tools')}\n\t\t\t\t\t\t\t\t<span class=\"ml-0.5 text-gray-500\">{Object.keys(tools).length}</span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</button>\n\n\t\t\t\t\t{#each Object.keys(tools) as toolId}\n\t\t\t\t\t\t<button\n\t\t\t\t\t\t\tclass=\"relative flex w-full justify-between gap-2 items-center px-3 py-1.5 text-sm cursor-pointer rounded-xl hover:bg-gray-50 dark:hover:bg-gray-800/50\"\n\t\t\t\t\t\t\ton:click={async (e) => {\n\t\t\t\t\t\t\t\tif (!(tools[toolId]?.authenticated ?? true)) {\n\t\t\t\t\t\t\t\t\te.preventDefault();\n\n\t\t\t\t\t\t\t\t\tlet parts = toolId.split(':');\n\t\t\t\t\t\t\t\t\tlet serverId = parts?.at(-1) ?? toolId;\n\n\t\t\t\t\t\t\t\t\tconst authUrl = getOAuthClientAuthorizationUrl(serverId, 'mcp');\n\t\t\t\t\t\t\t\t\twindow.open(authUrl, '_self', 'noopener');\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\ttools[toolId].enabled = !tools[toolId].enabled;\n\n\t\t\t\t\t\t\t\t\tconst state = tools[toolId].enabled;\n\t\t\t\t\t\t\t\t\tawait tick();\n\n\t\t\t\t\t\t\t\t\tif (state) {\n\t\t\t\t\t\t\t\t\t\tselectedToolIds = [...selectedToolIds, toolId];\n\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\tselectedToolIds = selectedToolIds.filter((id) => id !== toolId);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{#if !(tools[toolId]?.authenticated ?? true)}\n\t\t\t\t\t\t\t\t<!-- make it slighly darker and not clickable -->\n\t\t\t\t\t\t\t\t<div class=\"absolute inset-0 opacity-50 rounded-xl cursor-pointer z-10\" />\n\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t<div class=\"flex-1 truncate\">\n\t\t\t\t\t\t\t\t<div class=\"flex flex-1 gap-2 items-center\">\n\t\t\t\t\t\t\t\t\t<Tooltip content={tools[toolId]?.name ?? ''} placement=\"top\">\n\t\t\t\t\t\t\t\t\t\t<div class=\"shrink-0\">\n\t\t\t\t\t\t\t\t\t\t\t<Wrench />\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</Tooltip>\n\t\t\t\t\t\t\t\t\t<Tooltip content={tools[toolId]?.description ?? ''} placement=\"top-start\">\n\t\t\t\t\t\t\t\t\t\t<div class=\" truncate\">{tools[toolId].name}</div>\n\t\t\t\t\t\t\t\t\t</Tooltip>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t{#if tools[toolId]?.has_user_valves}\n\t\t\t\t\t\t\t\t<div class=\" shrink-0\">\n\t\t\t\t\t\t\t\t\t<Tooltip content={$i18n.t('Valves')}>\n\t\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\t\tclass=\"self-center w-fit text-sm text-gray-600 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300 transition rounded-full\"\n\t\t\t\t\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t\t\t\t\t\ton:click={(e) => {\n\t\t\t\t\t\t\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t\t\t\t\t\t\tonShowValves({\n\t\t\t\t\t\t\t\t\t\t\t\t\ttype: 'tool',\n\t\t\t\t\t\t\t\t\t\t\t\t\tid: toolId\n\t\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t<Knobs />\n\t\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t\t</Tooltip>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t{/if}\n\n\t\t\t\t\t\t\t<div class=\" shrink-0\">\n\t\t\t\t\t\t\t\t<Switch state={tools[toolId].enabled} />\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</button>\n\t\t\t\t\t{/each}\n\t\t\t\t</div>\n\t\t\t{/if}\n\t\t</DropdownMenu.Content>\n\t</div>\n</Dropdown>\n","<script lang=\"ts\">\n\texport let className = 'size-4';\n\texport let strokeWidth = '1.5';\n</script>\n\n<svg\n\txmlns=\"http://www.w3.org/2000/svg\"\n\tfill=\"none\"\n\tviewBox=\"0 0 24 24\"\n\tstroke-width={strokeWidth}\n\tstroke=\"currentColor\"\n\tclass={className}\n\t><path\n\t\td=\"M5.21173 15.1113L2.52473 12.4243C2.29041 12.1899 2.29041 11.8101 2.52473 11.5757L5.21173 8.88873C5.44605 8.65442 5.82595 8.65442 6.06026 8.88873L8.74727 11.5757C8.98158 11.8101 8.98158 12.1899 8.74727 12.4243L6.06026 15.1113C5.82595 15.3456 5.44605 15.3456 5.21173 15.1113Z\"\n\t></path><path\n\t\td=\"M11.5757 21.475L8.88874 18.788C8.65443 18.5537 8.65443 18.1738 8.88874 17.9395L11.5757 15.2525C11.8101 15.0182 12.19 15.0182 12.4243 15.2525L15.1113 17.9395C15.3456 18.1738 15.3456 18.5537 15.1113 18.788L12.4243 21.475C12.19 21.7094 11.8101 21.7094 11.5757 21.475Z\"\n\t></path><path\n\t\td=\"M11.5757 8.7475L8.88874 6.06049C8.65443 5.82618 8.65443 5.44628 8.88874 5.21197L11.5757 2.52496C11.8101 2.29065 12.19 2.29065 12.4243 2.52496L15.1113 5.21197C15.3456 5.44628 15.3456 5.82618 15.1113 6.06049L12.4243 8.7475C12.19 8.98181 11.8101 8.98181 11.5757 8.7475Z\"\n\t></path><path\n\t\td=\"M17.9396 15.1113L15.2526 12.4243C15.0183 12.1899 15.0183 11.8101 15.2526 11.5757L17.9396 8.88873C18.174 8.65442 18.5539 8.65442 18.7882 8.88873L21.4752 11.5757C21.7095 11.8101 21.7095 12.1899 21.4752 12.4243L18.7882 15.1113C18.5539 15.3456 18.174 15.3456 17.9396 15.1113Z\"\n\t></path></svg\n>\n","<script lang=\"ts\">\n\texport let className = 'size-4';\n\texport let strokeWidth = '1.5';\n</script>\n\n<svg\n\txmlns=\"http://www.w3.org/2000/svg\"\n\tfill=\"none\"\n\tviewBox=\"0 0 24 24\"\n\tstroke-width={strokeWidth}\n\tstroke=\"currentColor\"\n\tclass={className}\n\t><path d=\"M6 12H12M18 12H12M12 12V6M12 12V18\" stroke-linecap=\"round\" stroke-linejoin=\"round\"\n\t></path></svg\n>\n","<script lang=\"ts\">\n\timport { onMount, getContext } from 'svelte';\n\timport { settings } from '$lib/stores';\n\n\timport Drawer from './Drawer.svelte';\n\timport RichTextInput from './RichTextInput.svelte';\n\n\tconst i18n = getContext('i18n');\n\n\texport let id = 'input-modal';\n\n\texport let show = false;\n\texport let value = null;\n\texport let inputContent = null;\n\n\texport let autocomplete = false;\n\texport let generateAutoCompletion = null;\n\n\texport let onChange = () => {};\n\texport let onClose = () => {};\n\n\tlet inputElement;\n</script>\n\n<Drawer bind:show>\n\t<div class=\"flex h-full min-h-screen flex-col\">\n\t\t<div\n\t\t\tclass=\" sticky top-0 z-30 flex justify-between bg-white px-4.5 pt-3 pb-3 dark:bg-gray-900 dark:text-gray-100\"\n\t\t>\n\t\t\t<div class=\" font-primary self-center text-lg\">\n\t\t\t\t{$i18n.t('Input')}\n\t\t\t</div>\n\t\t\t<button\n\t\t\t\tclass=\"self-center\"\n\t\t\t\taria-label=\"Close\"\n\t\t\t\tonclick={() => {\n\t\t\t\t\tshow = false;\n\t\t\t\t\tonClose();\n\t\t\t\t}}\n\t\t\t>\n\t\t\t\t<svg\n\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\tviewBox=\"0 0 20 20\"\n\t\t\t\t\tfill=\"currentColor\"\n\t\t\t\t\tclass=\"h-5 w-5\"\n\t\t\t\t>\n\t\t\t\t\t<path\n\t\t\t\t\t\td=\"M6.28 5.22a.75.75 0 00-1.06 1.06L8.94 10l-3.72 3.72a.75.75 0 101.06 1.06L10 11.06l3.72 3.72a.75.75 0 101.06-1.06L11.06 10l3.72-3.72a.75.75 0 00-1.06-1.06L10 8.94 6.28 5.22z\"\n\t\t\t\t\t/>\n\t\t\t\t</svg>\n\t\t\t</button>\n\t\t</div>\n\n\t\t<div class=\"flex w-full px-4 dark:text-gray-200 min-h-full flex-1\">\n\t\t\t<div class=\"flex-1 w-full min-h-full\">\n\t\t\t\t<RichTextInput\n\t\t\t\t\tbind:this={inputElement}\n\t\t\t\t\t{id}\n\t\t\t\t\tonChange={(content) => {\n\t\t\t\t\t\tvalue = content.md;\n\t\t\t\t\t\tinputContent = content;\n\n\t\t\t\t\t\tonChange(content);\n\t\t\t\t\t}}\n\t\t\t\t\tjson={true}\n\t\t\t\t\tvalue={inputContent?.json}\n\t\t\t\t\thtml={inputContent?.html}\n\t\t\t\t\trichText={$settings?.richTextInput ?? true}\n\t\t\t\t\tmessageInput={true}\n\t\t\t\t\tshowFormattingToolbar={$settings?.showFormattingToolbar ?? false}\n\t\t\t\t\tfloatingMenuPlacement={'top-start'}\n\t\t\t\t\tinsertPromptAsRichText={$settings?.insertPromptAsRichText ?? false}\n\t\t\t\t\t{autocomplete}\n\t\t\t\t\t{generateAutoCompletion}\n\t\t\t\t/>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n</Drawer>\n","<script lang=\"ts\">\n\texport let className = 'w-4 h-4';\n\texport let strokeWidth = '1.5';\n</script>\n\n<svg\n\tclass={className}\n\taria-hidden=\"true\"\n\txmlns=\"http://www.w3.org/2000/svg\"\n\tstroke-width={strokeWidth}\n\tfill=\"none\"\n\tstroke=\"currentColor\"\n\tviewBox=\"0 0 24 24\"\n\t><path d=\"M9 9L4 4M4 4V8M4 4H8\" stroke-linecap=\"round\" stroke-linejoin=\"round\"></path><path\n\t\td=\"M15 9L20 4M20 4V8M20 4H16\"\n\t\tstroke-linecap=\"round\"\n\t\tstroke-linejoin=\"round\"\n\t></path><path d=\"M9 15L4 20M4 20V16M4 20H8\" stroke-linecap=\"round\" stroke-linejoin=\"round\"\n\t></path><path d=\"M15 15L20 20M20 20V16M20 20H16\" stroke-linecap=\"round\" stroke-linejoin=\"round\"\n\t></path></svg\n>\n","<script lang=\"ts\">\n\timport DOMPurify from 'dompurify';\n\timport { toast } from 'svelte-sonner';\n\n\timport { marked } from 'marked';\n\timport { v4 as uuidv4 } from 'uuid';\n\timport dayjs from '$lib/dayjs';\n\timport duration from 'dayjs/plugin/duration';\n\timport relativeTime from 'dayjs/plugin/relativeTime';\n\n\tdayjs.extend(duration);\n\tdayjs.extend(relativeTime);\n\n\timport { onMount, tick, getContext, createEventDispatcher, onDestroy } from 'svelte';\n\n\timport { createPicker, getAuthToken } from '$lib/utils/google-drive-picker';\n\timport { pickAndDownloadFile } from '$lib/utils/onedrive-file-picker';\n\timport { KokoroWorker } from '$lib/workers/KokoroWorker';\n\n\tconst dispatch = createEventDispatcher();\n\n\timport {\n\t\ttype Model,\n\t\tmobile,\n\t\tsettings,\n\t\tmodels,\n\t\tconfig,\n\t\tshowCallOverlay,\n\t\ttools,\n\t\ttoolServers,\n\t\tuser as _user,\n\t\tshowControls,\n\t\tTTSWorker,\n\t\ttemporaryChatEnabled\n\t} from '$lib/stores';\n\n\timport {\n\t\tconvertHeicToJpeg,\n\t\tcompressImage,\n\t\tcreateMessagesList,\n\t\textractContentFromFile,\n\t\textractCurlyBraceWords,\n\t\textractInputVariables,\n\t\tgetAge,\n\t\tgetCurrentDateTime,\n\t\tgetFormattedDate,\n\t\tgetFormattedTime,\n\t\tgetUserPosition,\n\t\tgetUserTimezone,\n\t\tgetWeekday\n\t} from '$lib/utils';\n\timport { uploadFile } from '$lib/apis/files';\n\timport { generateAutoCompletion } from '$lib/apis';\n\timport { deleteFileById } from '$lib/apis/files';\n\timport { getSessionUser } from '$lib/apis/auths';\n\timport { getTools } from '$lib/apis/tools';\n\n\timport { WEBUI_BASE_URL, WEBUI_API_BASE_URL, PASTED_TEXT_CHARACTER_LIMIT } from '$lib/constants';\n\n\timport { createNoteHandler } from '../notes/utils';\n\timport { getSuggestionRenderer } from '../common/RichTextInput/suggestions';\n\n\timport InputMenu from './MessageInput/InputMenu.svelte';\n\timport VoiceRecording from './MessageInput/VoiceRecording.svelte';\n\timport FilesOverlay from './MessageInput/FilesOverlay.svelte';\n\timport ToolServersModal from './ToolServersModal.svelte';\n\n\timport RichTextInput from '../common/RichTextInput.svelte';\n\timport Tooltip from '../common/Tooltip.svelte';\n\timport FileItem from '../common/FileItem.svelte';\n\timport Image from '../common/Image.svelte';\n\n\timport XMark from '../icons/XMark.svelte';\n\timport GlobeAlt from '../icons/GlobeAlt.svelte';\n\timport Photo from '../icons/Photo.svelte';\n\timport Wrench from '../icons/Wrench.svelte';\n\timport Sparkles from '../icons/Sparkles.svelte';\n\n\timport InputVariablesModal from './MessageInput/InputVariablesModal.svelte';\n\timport Voice from '../icons/Voice.svelte';\n\timport Terminal from '../icons/Terminal.svelte';\n\timport IntegrationsMenu from './MessageInput/IntegrationsMenu.svelte';\n\timport Component from '../icons/Component.svelte';\n\timport PlusAlt from '../icons/PlusAlt.svelte';\n\n\timport CommandSuggestionList from './MessageInput/CommandSuggestionList.svelte';\n\timport Knobs from '../icons/Knobs.svelte';\n\timport ValvesModal from '../workspace/common/ValvesModal.svelte';\n\timport PageEdit from '../icons/PageEdit.svelte';\n\timport { goto } from '$app/navigation';\n\timport InputModal from '../common/InputModal.svelte';\n\timport Expand from '../icons/Expand.svelte';\n\n\tconst i18n = getContext('i18n');\n\n\texport let onUpload: Function = (e) => {};\n\texport let onChange: Function = () => {};\n\n\texport let createMessagePair: Function;\n\texport let stopResponse: Function;\n\n\texport let autoScroll = false;\n\texport let generating = false;\n\n\texport let atSelectedModel: Model | undefined = undefined;\n\texport let selectedModels: [''];\n\n\tlet selectedModelIds = [];\n\t$: selectedModelIds = atSelectedModel !== undefined ? [atSelectedModel.id] : selectedModels;\n\n\texport let history;\n\texport let taskIds = null;\n\n\texport let prompt = '';\n\texport let files = [];\n\n\texport let selectedToolIds = [];\n\texport let selectedFilterIds = [];\n\n\texport let imageGenerationEnabled = false;\n\texport let webSearchEnabled = false;\n\texport let codeInterpreterEnabled = false;\n\n\tlet inputContent = null;\n\n\tlet showInputVariablesModal = false;\n\tlet inputVariablesModalCallback = (variableValues) => {};\n\tlet inputVariables = {};\n\tlet inputVariableValues = {};\n\n\tlet showValvesModal = false;\n\tlet selectedValvesType = 'tool'; // 'tool' or 'function'\n\tlet selectedValvesItemId = null;\n\tlet integrationsMenuCloseOnOutsideClick = true;\n\n\t$: if (!showValvesModal) {\n\t\tintegrationsMenuCloseOnOutsideClick = true;\n\t}\n\n\t$: onChange({\n\t\tprompt,\n\t\tfiles: files\n\t\t\t.filter((file) => file.type !== 'image')\n\t\t\t.map((file) => {\n\t\t\t\treturn {\n\t\t\t\t\t...file,\n\t\t\t\t\tuser: undefined,\n\t\t\t\t\taccess_control: undefined\n\t\t\t\t};\n\t\t\t}),\n\t\tselectedToolIds,\n\t\tselectedFilterIds,\n\t\timageGenerationEnabled,\n\t\twebSearchEnabled,\n\t\tcodeInterpreterEnabled\n\t});\n\n\tconst inputVariableHandler = async (text: string): Promise<string> => {\n\t\tinputVariables = extractInputVariables(text);\n\n\t\t// No variables? return the original text immediately.\n\t\tif (Object.keys(inputVariables).length === 0) {\n\t\t\treturn text;\n\t\t}\n\n\t\t// Show modal and wait for the user's input.\n\t\tshowInputVariablesModal = true;\n\t\treturn await new Promise<string>((resolve) => {\n\t\t\tinputVariablesModalCallback = (variableValues) => {\n\t\t\t\tinputVariableValues = { ...inputVariableValues, ...variableValues };\n\t\t\t\treplaceVariables(inputVariableValues);\n\t\t\t\tshowInputVariablesModal = false;\n\t\t\t\tresolve(text);\n\t\t\t};\n\t\t});\n\t};\n\n\tconst textVariableHandler = async (text: string) => {\n\t\tif (text.includes('{{CLIPBOARD}}')) {\n\t\t\tconst clipboardText = await navigator.clipboard.readText().catch((err) => {\n\t\t\t\ttoast.error($i18n.t('Failed to read clipboard contents'));\n\t\t\t\treturn '{{CLIPBOARD}}';\n\t\t\t});\n\n\t\t\tconst clipboardItems = await navigator.clipboard.read().catch((err) => {\n\t\t\t\tconsole.error('Failed to read clipboard items:', err);\n\t\t\t\treturn [];\n\t\t\t});\n\n\t\t\tfor (const item of clipboardItems) {\n\t\t\t\tfor (const type of item.types) {\n\t\t\t\t\tif (type.startsWith('image/')) {\n\t\t\t\t\t\tconst blob = await item.getType(type);\n\t\t\t\t\t\tconst file = new File([blob], `clipboard-image.${type.split('/')[1]}`, {\n\t\t\t\t\t\t\ttype: type\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\tinputFilesHandler([file]);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\ttext = text.replaceAll('{{CLIPBOARD}}', clipboardText.replaceAll('\\r\\n', '\\n'));\n\t\t}\n\n\t\tif (text.includes('{{USER_LOCATION}}')) {\n\t\t\tlet location;\n\t\t\ttry {\n\t\t\t\tlocation = await getUserPosition();\n\t\t\t} catch (error) {\n\t\t\t\ttoast.error($i18n.t('Location access not allowed'));\n\t\t\t\tlocation = 'LOCATION_UNKNOWN';\n\t\t\t}\n\t\t\ttext = text.replaceAll('{{USER_LOCATION}}', String(location));\n\t\t}\n\n\t\tconst sessionUser = await getSessionUser(localStorage.token);\n\n\t\tif (text.includes('{{USER_NAME}}')) {\n\t\t\tconst name = sessionUser?.name || 'User';\n\t\t\ttext = text.replaceAll('{{USER_NAME}}', name);\n\t\t}\n\n\t\tif (text.includes('{{USER_BIO}}')) {\n\t\t\tconst bio = sessionUser?.bio || '';\n\n\t\t\tif (bio) {\n\t\t\t\ttext = text.replaceAll('{{USER_BIO}}', bio);\n\t\t\t}\n\t\t}\n\n\t\tif (text.includes('{{USER_GENDER}}')) {\n\t\t\tconst gender = sessionUser?.gender || '';\n\n\t\t\tif (gender) {\n\t\t\t\ttext = text.replaceAll('{{USER_GENDER}}', gender);\n\t\t\t}\n\t\t}\n\n\t\tif (text.includes('{{USER_BIRTH_DATE}}')) {\n\t\t\tconst birthDate = sessionUser?.date_of_birth || '';\n\n\t\t\tif (birthDate) {\n\t\t\t\ttext = text.replaceAll('{{USER_BIRTH_DATE}}', birthDate);\n\t\t\t}\n\t\t}\n\n\t\tif (text.includes('{{USER_AGE}}')) {\n\t\t\tconst birthDate = sessionUser?.date_of_birth || '';\n\n\t\t\tif (birthDate) {\n\t\t\t\t// calculate age using date\n\t\t\t\tconst age = getAge(birthDate);\n\t\t\t\ttext = text.replaceAll('{{USER_AGE}}', age);\n\t\t\t}\n\t\t}\n\n\t\tif (text.includes('{{USER_LANGUAGE}}')) {\n\t\t\tconst language = localStorage.getItem('locale') || 'en-US';\n\t\t\ttext = text.replaceAll('{{USER_LANGUAGE}}', language);\n\t\t}\n\n\t\tif (text.includes('{{CURRENT_DATE}}')) {\n\t\t\tconst date = getFormattedDate();\n\t\t\ttext = text.replaceAll('{{CURRENT_DATE}}', date);\n\t\t}\n\n\t\tif (text.includes('{{CURRENT_TIME}}')) {\n\t\t\tconst time = getFormattedTime();\n\t\t\ttext = text.replaceAll('{{CURRENT_TIME}}', time);\n\t\t}\n\n\t\tif (text.includes('{{CURRENT_DATETIME}}')) {\n\t\t\tconst dateTime = getCurrentDateTime();\n\t\t\ttext = text.replaceAll('{{CURRENT_DATETIME}}', dateTime);\n\t\t}\n\n\t\tif (text.includes('{{CURRENT_TIMEZONE}}')) {\n\t\t\tconst timezone = getUserTimezone();\n\t\t\ttext = text.replaceAll('{{CURRENT_TIMEZONE}}', timezone);\n\t\t}\n\n\t\tif (text.includes('{{CURRENT_WEEKDAY}}')) {\n\t\t\tconst weekday = getWeekday();\n\t\t\ttext = text.replaceAll('{{CURRENT_WEEKDAY}}', weekday);\n\t\t}\n\n\t\treturn text;\n\t};\n\n\tconst replaceVariables = (variables: Record<string, any>) => {\n\t\tconsole.log('Replacing variables:', variables);\n\n\t\tconst chatInput = document.getElementById('chat-input');\n\n\t\tif (chatInput) {\n\t\t\tchatInputElement.replaceVariables(variables);\n\t\t\tchatInputElement.focus();\n\t\t}\n\t};\n\n\texport const setText = async (text?: string, cb?: (text: string) => void) => {\n\t\tconst chatInput = document.getElementById('chat-input');\n\n\t\tif (chatInput) {\n\t\t\tif (text !== '') {\n\t\t\t\ttext = await textVariableHandler(text || '');\n\t\t\t}\n\n\t\t\tchatInputElement?.setText(text);\n\t\t\tchatInputElement?.focus();\n\n\t\t\tif (text !== '') {\n\t\t\t\ttext = await inputVariableHandler(text);\n\t\t\t}\n\n\t\t\tawait tick();\n\t\t\tif (cb) await cb(text);\n\t\t}\n\t};\n\n\tconst getCommand = () => {\n\t\tconst chatInput = document.getElementById('chat-input');\n\t\tlet word = '';\n\n\t\tif (chatInput) {\n\t\t\tword = chatInputElement?.getWordAtDocPos();\n\t\t}\n\n\t\treturn word;\n\t};\n\n\tconst replaceCommandWithText = (text) => {\n\t\tconst chatInput = document.getElementById('chat-input');\n\t\tif (!chatInput) return;\n\n\t\tchatInputElement?.replaceCommandWithText(text);\n\t};\n\n\tconst insertTextAtCursor = async (text: string) => {\n\t\tconst chatInput = document.getElementById('chat-input');\n\t\tif (!chatInput) return;\n\n\t\ttext = await textVariableHandler(text);\n\n\t\tif (command) {\n\t\t\treplaceCommandWithText(text);\n\t\t} else {\n\t\t\tchatInputElement?.insertContent(text);\n\t\t}\n\n\t\tawait tick();\n\t\ttext = await inputVariableHandler(text);\n\t\tawait tick();\n\n\t\tconst chatInputContainer = document.getElementById('chat-input-container');\n\t\tif (chatInputContainer) {\n\t\t\tchatInputContainer.scrollTop = chatInputContainer.scrollHeight;\n\t\t}\n\n\t\tawait tick();\n\t\tif (chatInput) {\n\t\t\tchatInput.focus();\n\t\t\tchatInput.dispatchEvent(new Event('input'));\n\n\t\t\tconst words = extractCurlyBraceWords(prompt);\n\n\t\t\tif (words.length > 0) {\n\t\t\t\tconst word = words.at(0);\n\t\t\t\tawait tick();\n\t\t\t} else {\n\t\t\t\tchatInput.scrollTop = chatInput.scrollHeight;\n\t\t\t}\n\t\t}\n\t};\n\n\tlet command = '';\n\texport let showCommands = false;\n\t$: showCommands = ['/', '#', '@'].includes(command?.charAt(0)) || '\\\\#' === command?.slice(0, 2);\n\tlet suggestions = null;\n\n\tlet showTools = false;\n\n\tlet loaded = false;\n\tlet recording = false;\n\n\tlet isComposing = false;\n\t// Safari has a bug where compositionend is not triggered correctly #16615\n\t// when using the virtual keyboard on iOS.\n\tlet compositionEndedAt = -2e8;\n\tconst isSafari = /^((?!chrome|android).)*safari/i.test(navigator.userAgent);\n\tfunction inOrNearComposition(event: Event) {\n\t\tif (isComposing) {\n\t\t\treturn true;\n\t\t}\n\t\t// See https://www.stum.de/2016/06/24/handling-ime-events-in-javascript/.\n\t\t// On Japanese input method editors (IMEs), the Enter key is used to confirm character\n\t\t// selection. On Safari, when Enter is pressed, compositionend and keydown events are\n\t\t// emitted. The keydown event triggers newline insertion, which we don't want.\n\t\t// This method returns true if the keydown event should be ignored.\n\t\t// We only ignore it once, as pressing Enter a second time *should* insert a newline.\n\t\t// Furthermore, the keydown event timestamp must be close to the compositionEndedAt timestamp.\n\t\t// This guards against the case where compositionend is triggered without the keyboard\n\t\t// (e.g. character confirmation may be done with the mouse), and keydown is triggered\n\t\t// afterwards- we wouldn't want to ignore the keydown event in this case.\n\t\tif (isSafari && Math.abs(event.timeStamp - compositionEndedAt) < 500) {\n\t\t\tcompositionEndedAt = -2e8;\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\tlet chatInputContainerElement;\n\tlet chatInputElement;\n\n\tlet filesInputElement;\n\tlet commandsElement;\n\n\tlet inputFiles;\n\n\tlet showInputModal = false;\n\n\tlet dragged = false;\n\tlet shiftKey = false;\n\n\tlet user = null;\n\texport let placeholder = '';\n\n\tlet visionCapableModels = [];\n\t$: visionCapableModels = (atSelectedModel?.id ? [atSelectedModel.id] : selectedModels).filter(\n\t\t(model) => $models.find((m) => m.id === model)?.info?.meta?.capabilities?.vision ?? true\n\t);\n\n\tlet fileUploadCapableModels = [];\n\t$: fileUploadCapableModels = (atSelectedModel?.id ? [atSelectedModel.id] : selectedModels).filter(\n\t\t(model) => $models.find((m) => m.id === model)?.info?.meta?.capabilities?.file_upload ?? true\n\t);\n\n\tlet webSearchCapableModels = [];\n\t$: webSearchCapableModels = (atSelectedModel?.id ? [atSelectedModel.id] : selectedModels).filter(\n\t\t(model) => $models.find((m) => m.id === model)?.info?.meta?.capabilities?.web_search ?? true\n\t);\n\n\tlet imageGenerationCapableModels = [];\n\t$: imageGenerationCapableModels = (\n\t\tatSelectedModel?.id ? [atSelectedModel.id] : selectedModels\n\t).filter(\n\t\t(model) =>\n\t\t\t$models.find((m) => m.id === model)?.info?.meta?.capabilities?.image_generation ?? true\n\t);\n\n\tlet codeInterpreterCapableModels = [];\n\t$: codeInterpreterCapableModels = (\n\t\tatSelectedModel?.id ? [atSelectedModel.id] : selectedModels\n\t).filter(\n\t\t(model) =>\n\t\t\t$models.find((m) => m.id === model)?.info?.meta?.capabilities?.code_interpreter ?? true\n\t);\n\n\tlet toggleFilters = [];\n\t$: toggleFilters = (atSelectedModel?.id ? [atSelectedModel.id] : selectedModels)\n\t\t.map((id) => ($models.find((model) => model.id === id) || {})?.filters ?? [])\n\t\t.reduce((acc, filters) => acc.filter((f1) => filters.some((f2) => f2.id === f1.id)));\n\n\tlet showToolsButton = false;\n\t$: showToolsButton = ($tools ?? []).length > 0 || ($toolServers ?? []).length > 0;\n\n\tlet showWebSearchButton = false;\n\t$: showWebSearchButton =\n\t\t(atSelectedModel?.id ? [atSelectedModel.id] : selectedModels).length ===\n\t\t\twebSearchCapableModels.length &&\n\t\t$config?.features?.enable_web_search &&\n\t\t($_user.role === 'admin' || $_user?.permissions?.features?.web_search);\n\n\tlet showImageGenerationButton = false;\n\t$: showImageGenerationButton =\n\t\t(atSelectedModel?.id ? [atSelectedModel.id] : selectedModels).length ===\n\t\t\timageGenerationCapableModels.length &&\n\t\t$config?.features?.enable_image_generation &&\n\t\t($_user.role === 'admin' || $_user?.permissions?.features?.image_generation);\n\n\tlet showCodeInterpreterButton = false;\n\t$: showCodeInterpreterButton =\n\t\t(atSelectedModel?.id ? [atSelectedModel.id] : selectedModels).length ===\n\t\t\tcodeInterpreterCapableModels.length &&\n\t\t$config?.features?.enable_code_interpreter &&\n\t\t($_user.role === 'admin' || $_user?.permissions?.features?.code_interpreter);\n\n\tconst scrollToBottom = () => {\n\t\tconst element = document.getElementById('messages-container');\n\t\telement.scrollTo({\n\t\t\ttop: element.scrollHeight,\n\t\t\tbehavior: 'smooth'\n\t\t});\n\t};\n\n\tconst screenCaptureHandler = async () => {\n\t\ttry {\n\t\t\t// Request screen media\n\t\t\tconst mediaStream = await navigator.mediaDevices.getDisplayMedia({\n\t\t\t\tvideo: { cursor: 'never' },\n\t\t\t\taudio: false\n\t\t\t});\n\t\t\t// Once the user selects a screen, temporarily create a video element\n\t\t\tconst video = document.createElement('video');\n\t\t\tvideo.srcObject = mediaStream;\n\t\t\t// Ensure the video loads without affecting user experience or tab switching\n\t\t\tawait video.play();\n\t\t\t// Set up the canvas to match the video dimensions\n\t\t\tconst canvas = document.createElement('canvas');\n\t\t\tcanvas.width = video.videoWidth;\n\t\t\tcanvas.height = video.videoHeight;\n\t\t\t// Grab a single frame from the video stream using the canvas\n\t\t\tconst context = canvas.getContext('2d');\n\t\t\tcontext.drawImage(video, 0, 0, canvas.width, canvas.height);\n\t\t\t// Stop all video tracks (stop screen sharing) after capturing the image\n\t\t\tmediaStream.getTracks().forEach((track) => track.stop());\n\n\t\t\t// bring back focus to this current tab, so that the user can see the screen capture\n\t\t\twindow.focus();\n\n\t\t\t// Convert the canvas to a Base64 image URL\n\t\t\tconst imageUrl = canvas.toDataURL('image/png');\n\t\t\tconst blob = await (await fetch(imageUrl)).blob();\n\t\t\tconst file = new File([blob], `screen-capture-${Date.now()}.png`, { type: 'image/png' });\n\t\t\tinputFilesHandler([file]);\n\t\t\t// Clean memory: Clear video srcObject\n\t\t\tvideo.srcObject = null;\n\t\t} catch (error) {\n\t\t\t// Handle any errors (e.g., user cancels screen sharing)\n\t\t\tconsole.error('Error capturing screen:', error);\n\t\t}\n\t};\n\n\tconst uploadFileHandler = async (file, process = true, itemData = {}) => {\n\t\tif ($_user?.role !== 'admin' && !($_user?.permissions?.chat?.file_upload ?? true)) {\n\t\t\ttoast.error($i18n.t('You do not have permission to upload files.'));\n\t\t\treturn null;\n\t\t}\n\n\t\tif (fileUploadCapableModels.length !== selectedModels.length) {\n\t\t\ttoast.error($i18n.t('Model(s) do not support file upload'));\n\t\t\treturn null;\n\t\t}\n\n\t\tconst tempItemId = uuidv4();\n\t\tconst fileItem = {\n\t\t\ttype: 'file',\n\t\t\tfile: '',\n\t\t\tid: null,\n\t\t\turl: '',\n\t\t\tname: file.name,\n\t\t\tcollection_name: '',\n\t\t\tstatus: 'uploading',\n\t\t\tsize: file.size,\n\t\t\terror: '',\n\t\t\titemId: tempItemId,\n\t\t\t...itemData\n\t\t};\n\n\t\tif (fileItem.size == 0) {\n\t\t\ttoast.error($i18n.t('You cannot upload an empty file.'));\n\t\t\treturn null;\n\t\t}\n\n\t\tfiles = [...files, fileItem];\n\n\t\tif (!$temporaryChatEnabled) {\n\t\t\ttry {\n\t\t\t\t// If the file is an audio file, provide the language for STT.\n\t\t\t\tlet metadata = null;\n\t\t\t\tif (\n\t\t\t\t\t(file.type.startsWith('audio/') || file.type.startsWith('video/')) &&\n\t\t\t\t\t$settings?.audio?.stt?.language\n\t\t\t\t) {\n\t\t\t\t\tmetadata = {\n\t\t\t\t\t\tlanguage: $settings?.audio?.stt?.language\n\t\t\t\t\t};\n\t\t\t\t}\n\n\t\t\t\t// During the file upload, file content is automatically extracted.\n\t\t\t\tconst uploadedFile = await uploadFile(localStorage.token, file, metadata, process);\n\n\t\t\t\tif (uploadedFile) {\n\t\t\t\t\tconsole.log('File upload completed:', {\n\t\t\t\t\t\tid: uploadedFile.id,\n\t\t\t\t\t\tname: fileItem.name,\n\t\t\t\t\t\tcollection: uploadedFile?.meta?.collection_name\n\t\t\t\t\t});\n\n\t\t\t\t\tif (uploadedFile.error) {\n\t\t\t\t\t\tconsole.warn('File upload warning:', uploadedFile.error);\n\t\t\t\t\t\ttoast.warning(uploadedFile.error);\n\t\t\t\t\t}\n\n\t\t\t\t\tfileItem.status = 'uploaded';\n\t\t\t\t\tfileItem.file = uploadedFile;\n\t\t\t\t\tfileItem.id = uploadedFile.id;\n\t\t\t\t\tfileItem.collection_name =\n\t\t\t\t\t\tuploadedFile?.meta?.collection_name || uploadedFile?.collection_name;\n\t\t\t\t\tfileItem.content_type = uploadedFile.meta?.content_type || uploadedFile.content_type;\n\t\t\t\t\tfileItem.url = `${uploadedFile.id}`;\n\n\t\t\t\t\tfiles = files;\n\t\t\t\t} else {\n\t\t\t\t\tfiles = files.filter((item) => item?.itemId !== tempItemId);\n\t\t\t\t}\n\t\t\t} catch (e) {\n\t\t\t\ttoast.error(`${e}`);\n\t\t\t\tfiles = files.filter((item) => item?.itemId !== tempItemId);\n\t\t\t}\n\t\t} else {\n\t\t\t// If temporary chat is enabled, we just add the file to the list without uploading it.\n\n\t\t\tconst content = await extractContentFromFile(file).catch((error) => {\n\t\t\t\ttoast.error(\n\t\t\t\t\t$i18n.t('Failed to extract content from the file: {{error}}', { error: error })\n\t\t\t\t);\n\t\t\t\treturn null;\n\t\t\t});\n\n\t\t\tif (content === null) {\n\t\t\t\ttoast.error($i18n.t('Failed to extract content from the file.'));\n\t\t\t\tfiles = files.filter((item) => item?.itemId !== tempItemId);\n\t\t\t\treturn null;\n\t\t\t} else {\n\t\t\t\tconsole.log('Extracted content from file:', {\n\t\t\t\t\tname: file.name,\n\t\t\t\t\tsize: file.size,\n\t\t\t\t\tcontent: content\n\t\t\t\t});\n\n\t\t\t\tfileItem.status = 'uploaded';\n\t\t\t\tfileItem.type = 'text';\n\t\t\t\tfileItem.content = content;\n\t\t\t\tfileItem.id = uuidv4(); // Temporary ID for the file\n\n\t\t\t\tfiles = files;\n\t\t\t}\n\t\t}\n\t};\n\n\tconst inputFilesHandler = async (inputFiles) => {\n\t\tconsole.log('Input files handler called with:', inputFiles);\n\n\t\tif (\n\t\t\t($config?.file?.max_count ?? null) !== null &&\n\t\t\tfiles.length + inputFiles.length > $config?.file?.max_count\n\t\t) {\n\t\t\ttoast.error(\n\t\t\t\t$i18n.t(`You can only chat with a maximum of {{maxCount}} file(s) at a time.`, {\n\t\t\t\t\tmaxCount: $config?.file?.max_count\n\t\t\t\t})\n\t\t\t);\n\t\t\treturn;\n\t\t}\n\n\t\tinputFiles.forEach(async (file) => {\n\t\t\tconsole.log('Processing file:', {\n\t\t\t\tname: file.name,\n\t\t\t\ttype: file.type,\n\t\t\t\tsize: file.size,\n\t\t\t\textension: file.name.split('.').at(-1)\n\t\t\t});\n\n\t\t\tif (\n\t\t\t\t($config?.file?.max_size ?? null) !== null &&\n\t\t\t\tfile.size > ($config?.file?.max_size ?? 0) * 1024 * 1024\n\t\t\t) {\n\t\t\t\tconsole.log('File exceeds max size limit:', {\n\t\t\t\t\tfileSize: file.size,\n\t\t\t\t\tmaxSize: ($config?.file?.max_size ?? 0) * 1024 * 1024\n\t\t\t\t});\n\t\t\t\ttoast.error(\n\t\t\t\t\t$i18n.t(`File size should not exceed {{maxSize}} MB.`, {\n\t\t\t\t\t\tmaxSize: $config?.file?.max_size\n\t\t\t\t\t})\n\t\t\t\t);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (file['type'].startsWith('image/')) {\n\t\t\t\tif (visionCapableModels.length === 0) {\n\t\t\t\t\ttoast.error($i18n.t('Selected model(s) do not support image inputs'));\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst compressImageHandler = async (imageUrl, settings = {}, config = {}) => {\n\t\t\t\t\t// Quick shortcut so we dont do unnecessary work.\n\t\t\t\t\tconst settingsCompression = settings?.imageCompression ?? false;\n\t\t\t\t\tconst configWidth = config?.file?.image_compression?.width ?? null;\n\t\t\t\t\tconst configHeight = config?.file?.image_compression?.height ?? null;\n\n\t\t\t\t\t// If neither settings nor config wants compression, return original URL.\n\t\t\t\t\tif (!settingsCompression && !configWidth && !configHeight) {\n\t\t\t\t\t\treturn imageUrl;\n\t\t\t\t\t}\n\n\t\t\t\t\t// Default to null (no compression unless set)\n\t\t\t\t\tlet width = null;\n\t\t\t\t\tlet height = null;\n\n\t\t\t\t\t// If user/settings want compression, pick their preferred size.\n\t\t\t\t\tif (settingsCompression) {\n\t\t\t\t\t\twidth = settings?.imageCompressionSize?.width ?? null;\n\t\t\t\t\t\theight = settings?.imageCompressionSize?.height ?? null;\n\t\t\t\t\t}\n\n\t\t\t\t\t// Apply config limits as an upper bound if any\n\t\t\t\t\tif (configWidth && (width === null || width > configWidth)) {\n\t\t\t\t\t\twidth = configWidth;\n\t\t\t\t\t}\n\t\t\t\t\tif (configHeight && (height === null || height > configHeight)) {\n\t\t\t\t\t\theight = configHeight;\n\t\t\t\t\t}\n\n\t\t\t\t\t// Do the compression if required\n\t\t\t\t\tif (width || height) {\n\t\t\t\t\t\treturn await compressImage(imageUrl, width, height);\n\t\t\t\t\t}\n\t\t\t\t\treturn imageUrl;\n\t\t\t\t};\n\n\t\t\t\tlet reader = new FileReader();\n\n\t\t\t\treader.onload = async (event) => {\n\t\t\t\t\tlet imageUrl = event.target.result;\n\n\t\t\t\t\t// Compress the image if settings or config require it\n\t\t\t\t\tif ($settings?.imageCompression && $settings?.imageCompressionInChannels) {\n\t\t\t\t\t\timageUrl = await compressImageHandler(imageUrl, $settings, $config);\n\t\t\t\t\t}\n\n\t\t\t\t\tif ($temporaryChatEnabled) {\n\t\t\t\t\t\tfiles = [\n\t\t\t\t\t\t\t...files,\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\ttype: 'image',\n\t\t\t\t\t\t\t\turl: imageUrl\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t];\n\t\t\t\t\t} else {\n\t\t\t\t\t\tconst blob = await (await fetch(imageUrl)).blob();\n\t\t\t\t\t\tconst compressedFile = new File([blob], file.name, { type: file.type });\n\n\t\t\t\t\t\tuploadFileHandler(compressedFile, false);\n\t\t\t\t\t}\n\t\t\t\t};\n\n\t\t\t\treader.readAsDataURL(file['type'] === 'image/heic' ? await convertHeicToJpeg(file) : file);\n\t\t\t} else {\n\t\t\t\tuploadFileHandler(file);\n\t\t\t}\n\t\t});\n\t};\n\n\tconst createNote = async () => {\n\t\tif (inputContent?.md.trim() === '' && inputContent?.html.trim() === '') {\n\t\t\ttoast.error($i18n.t('Cannot create an empty note.'));\n\t\t\treturn;\n\t\t}\n\n\t\tconst res = await createNoteHandler(\n\t\t\tdayjs().format('YYYY-MM-DD'),\n\t\t\tinputContent?.md,\n\t\t\tinputContent?.html\n\t\t);\n\n\t\tif (res) {\n\t\t\t// Clear the input content saved in session storage.\n\t\t\tsessionStorage.removeItem('chat-input');\n\t\t\tgoto(`/notes/${res.id}`);\n\t\t}\n\t};\n\n\tconst onDragOver = (e) => {\n\t\te.preventDefault();\n\n\t\t// Check if a file is being dragged.\n\t\tif (e.dataTransfer?.types?.includes('Files')) {\n\t\t\tdragged = true;\n\t\t} else {\n\t\t\tdragged = false;\n\t\t}\n\t};\n\n\tconst onDragLeave = () => {\n\t\tdragged = false;\n\t};\n\n\tconst onDrop = async (e) => {\n\t\te.preventDefault();\n\t\tconsole.log(e);\n\n\t\tif (e.dataTransfer?.files) {\n\t\t\tconst inputFiles = Array.from(e.dataTransfer?.files);\n\t\t\tif (inputFiles && inputFiles.length > 0) {\n\t\t\t\tconsole.log(inputFiles);\n\t\t\t\tinputFilesHandler(inputFiles);\n\t\t\t}\n\t\t}\n\n\t\tdragged = false;\n\t};\n\n\tconst onKeyDown = (e) => {\n\t\tif (e.key === 'Shift') {\n\t\t\tshiftKey = true;\n\t\t}\n\n\t\tif (e.key === 'Escape') {\n\t\t\tconsole.log('Escape');\n\t\t\tdragged = false;\n\t\t}\n\t};\n\n\tconst onKeyUp = (e) => {\n\t\tif (e.key === 'Shift') {\n\t\t\tshiftKey = false;\n\t\t}\n\t};\n\n\tconst onFocus = () => {};\n\n\tconst onBlur = () => {\n\t\tshiftKey = false;\n\t};\n\n\tonMount(async () => {\n\t\tsuggestions = [\n\t\t\t{\n\t\t\t\tchar: '@',\n\t\t\t\trender: getSuggestionRenderer(CommandSuggestionList, {\n\t\t\t\t\ti18n,\n\t\t\t\t\tonSelect: (e) => {\n\t\t\t\t\t\tconst { type, data } = e;\n\n\t\t\t\t\t\tif (type === 'model') {\n\t\t\t\t\t\t\tatSelectedModel = data;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tdocument.getElementById('chat-input')?.focus();\n\t\t\t\t\t},\n\n\t\t\t\t\tinsertTextHandler: insertTextAtCursor,\n\t\t\t\t\tonUpload: (e) => {\n\t\t\t\t\t\tconst { type, data } = e;\n\n\t\t\t\t\t\tif (type === 'file') {\n\t\t\t\t\t\t\tif (files.find((f) => f.id === data.id)) {\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tfiles = [\n\t\t\t\t\t\t\t\t...files,\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t...data,\n\t\t\t\t\t\t\t\t\tstatus: 'processed'\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t];\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tonUpload(e);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t},\n\t\t\t{\n\t\t\t\tchar: '/',\n\t\t\t\trender: getSuggestionRenderer(CommandSuggestionList, {\n\t\t\t\t\ti18n,\n\t\t\t\t\tonSelect: (e) => {\n\t\t\t\t\t\tconst { type, data } = e;\n\n\t\t\t\t\t\tif (type === 'model') {\n\t\t\t\t\t\t\tatSelectedModel = data;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tdocument.getElementById('chat-input')?.focus();\n\t\t\t\t\t},\n\n\t\t\t\t\tinsertTextHandler: insertTextAtCursor,\n\t\t\t\t\tonUpload: (e) => {\n\t\t\t\t\t\tconst { type, data } = e;\n\n\t\t\t\t\t\tif (type === 'file') {\n\t\t\t\t\t\t\tif (files.find((f) => f.id === data.id)) {\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tfiles = [\n\t\t\t\t\t\t\t\t...files,\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t...data,\n\t\t\t\t\t\t\t\t\tstatus: 'processed'\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t];\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tonUpload(e);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t},\n\t\t\t{\n\t\t\t\tchar: '#',\n\t\t\t\trender: getSuggestionRenderer(CommandSuggestionList, {\n\t\t\t\t\ti18n,\n\t\t\t\t\tonSelect: (e) => {\n\t\t\t\t\t\tconst { type, data } = e;\n\n\t\t\t\t\t\tif (type === 'model') {\n\t\t\t\t\t\t\tatSelectedModel = data;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tdocument.getElementById('chat-input')?.focus();\n\t\t\t\t\t},\n\n\t\t\t\t\tinsertTextHandler: insertTextAtCursor,\n\t\t\t\t\tonUpload: (e) => {\n\t\t\t\t\t\tconst { type, data } = e;\n\n\t\t\t\t\t\tif (type === 'file') {\n\t\t\t\t\t\t\tif (files.find((f) => f.id === data.id)) {\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tfiles = [\n\t\t\t\t\t\t\t\t...files,\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t...data,\n\t\t\t\t\t\t\t\t\tstatus: 'processed'\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t];\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tonUpload(e);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t}\n\t\t];\n\t\tloaded = true;\n\n\t\twindow.setTimeout(() => {\n\t\t\tconst chatInput = document.getElementById('chat-input');\n\t\t\tchatInput?.focus();\n\t\t}, 0);\n\n\t\twindow.addEventListener('keydown', onKeyDown);\n\t\twindow.addEventListener('keyup', onKeyUp);\n\n\t\twindow.addEventListener('focus', onFocus);\n\t\twindow.addEventListener('blur', onBlur);\n\n\t\tawait tick();\n\n\t\tconst dropzoneElement = document.getElementById('chat-container');\n\n\t\tdropzoneElement?.addEventListener('dragover', onDragOver);\n\t\tdropzoneElement?.addEventListener('drop', onDrop);\n\t\tdropzoneElement?.addEventListener('dragleave', onDragLeave);\n\n\t\tawait tools.set(await getTools(localStorage.token));\n\t});\n\n\tonDestroy(() => {\n\t\tconsole.log('destroy');\n\t\twindow.removeEventListener('keydown', onKeyDown);\n\t\twindow.removeEventListener('keyup', onKeyUp);\n\n\t\twindow.removeEventListener('focus', onFocus);\n\t\twindow.removeEventListener('blur', onBlur);\n\n\t\tconst dropzoneElement = document.getElementById('chat-container');\n\n\t\tif (dropzoneElement) {\n\t\t\tdropzoneElement?.removeEventListener('dragover', onDragOver);\n\t\t\tdropzoneElement?.removeEventListener('drop', onDrop);\n\t\t\tdropzoneElement?.removeEventListener('dragleave', onDragLeave);\n\t\t}\n\t});\n</script>\n\n<FilesOverlay show={dragged} />\n<ToolServersModal bind:show={showTools} {selectedToolIds} />\n\n<InputVariablesModal\n\tbind:show={showInputVariablesModal}\n\tvariables={inputVariables}\n\tonSave={inputVariablesModalCallback}\n/>\n\n<ValvesModal\n\tbind:show={showValvesModal}\n\tuserValves={true}\n\ttype={selectedValvesType}\n\tid={selectedValvesItemId ?? null}\n\ton:save={async () => {\n\t\tawait tick();\n\t}}\n\ton:close={() => {\n\t\tintegrationsMenuCloseOnOutsideClick = true;\n\t}}\n/>\n\n<InputModal\n\tbind:show={showInputModal}\n\tbind:value={prompt}\n\tbind:inputContent\n\tonChange={(content) => {\n\t\tconsole.log(content);\n\t\tchatInputElement?.setContent(content?.json ?? null);\n\t}}\n\tonClose={async () => {\n\t\tawait tick();\n\t\tchatInputElement?.focus();\n\t}}\n/>\n\n{#if loaded}\n\t<div class=\"w-full font-primary\">\n\t\t<div class=\" mx-auto inset-x-0 bg-transparent flex justify-center\">\n\t\t\t<div\n\t\t\t\tclass=\"flex flex-col px-3 {($settings?.widescreenMode ?? null)\n\t\t\t\t\t? 'max-w-full'\n\t\t\t\t\t: 'max-w-6xl'} w-full\"\n\t\t\t>\n\t\t\t\t<div class=\"relative\">\n\t\t\t\t\t{#if autoScroll === false && history?.currentId}\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tclass=\" absolute -top-12 left-0 right-0 flex justify-center z-30 pointer-events-none\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\tclass=\" bg-white border border-gray-100 dark:border-none dark:bg-white/20 p-1.5 rounded-full pointer-events-auto\"\n\t\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\t\tautoScroll = true;\n\t\t\t\t\t\t\t\t\tscrollToBottom();\n\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<svg\n\t\t\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\t\t\t\t\tviewBox=\"0 0 20 20\"\n\t\t\t\t\t\t\t\t\tfill=\"currentColor\"\n\t\t\t\t\t\t\t\t\tclass=\"w-5 h-5\"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\t\tfill-rule=\"evenodd\"\n\t\t\t\t\t\t\t\t\t\td=\"M10 3a.75.75 0 01.75.75v10.638l3.96-4.158a.75.75 0 111.08 1.04l-5.25 5.5a.75.75 0 01-1.08 0l-5.25-5.5a.75.75 0 111.08-1.04l3.96 4.158V3.75A.75.75 0 0110 3z\"\n\t\t\t\t\t\t\t\t\t\tclip-rule=\"evenodd\"\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t{/if}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\n\t\t<div class=\"bg-transparent\">\n\t\t\t<div\n\t\t\t\tclass=\"{($settings?.widescreenMode ?? null)\n\t\t\t\t\t? 'max-w-full'\n\t\t\t\t\t: 'max-w-6xl'} px-2.5 mx-auto inset-x-0\"\n\t\t\t>\n\t\t\t\t<div class=\"\">\n\t\t\t\t\t<input\n\t\t\t\t\t\tbind:this={filesInputElement}\n\t\t\t\t\t\tbind:files={inputFiles}\n\t\t\t\t\t\ttype=\"file\"\n\t\t\t\t\t\thidden\n\t\t\t\t\t\tmultiple\n\t\t\t\t\t\ton:change={async () => {\n\t\t\t\t\t\t\tif (inputFiles && inputFiles.length > 0) {\n\t\t\t\t\t\t\t\tconst _inputFiles = Array.from(inputFiles);\n\t\t\t\t\t\t\t\tinputFilesHandler(_inputFiles);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\ttoast.error($i18n.t(`File not found.`));\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tfilesInputElement.value = '';\n\t\t\t\t\t\t}}\n\t\t\t\t\t/>\n\n\t\t\t\t\t<div class={recording ? '' : 'hidden'}>\n\t\t\t\t\t\t<VoiceRecording\n\t\t\t\t\t\t\tbind:recording\n\t\t\t\t\t\t\tonCancel={async () => {\n\t\t\t\t\t\t\t\trecording = false;\n\n\t\t\t\t\t\t\t\tawait tick();\n\t\t\t\t\t\t\t\tdocument.getElementById('chat-input')?.focus();\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\tonConfirm={async (data) => {\n\t\t\t\t\t\t\t\tconst { text, filename } = data;\n\n\t\t\t\t\t\t\t\trecording = false;\n\n\t\t\t\t\t\t\t\tawait tick();\n\t\t\t\t\t\t\t\tawait insertTextAtCursor(`${text}`);\n\t\t\t\t\t\t\t\tawait tick();\n\t\t\t\t\t\t\t\tdocument.getElementById('chat-input')?.focus();\n\n\t\t\t\t\t\t\t\tif ($settings?.speechAutoSend ?? false) {\n\t\t\t\t\t\t\t\t\tdispatch('submit', prompt);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t\t<form\n\t\t\t\t\t\tclass=\"w-full flex flex-col gap-1.5 {recording ? 'hidden' : ''}\"\n\t\t\t\t\t\ton:submit|preventDefault={() => {\n\t\t\t\t\t\t\t// check if selectedModels support image input\n\t\t\t\t\t\t\tdispatch('submit', prompt);\n\t\t\t\t\t\t}}\n\t\t\t\t\t>\n\t\t\t\t\t\t<button\n\t\t\t\t\t\t\tid=\"generate-message-pair-button\"\n\t\t\t\t\t\t\tclass=\"hidden\"\n\t\t\t\t\t\t\ton:click={() => createMessagePair(prompt)}\n\t\t\t\t\t\t/>\n\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tid=\"message-input-container\"\n\t\t\t\t\t\t\tclass=\"flex-1 flex flex-col relative w-full shadow-lg rounded-3xl border {$temporaryChatEnabled\n\t\t\t\t\t\t\t\t? 'border-dashed border-gray-100 dark:border-gray-800 hover:border-gray-200 focus-within:border-gray-200 hover:dark:border-gray-700 focus-within:dark:border-gray-700'\n\t\t\t\t\t\t\t\t: ' border-gray-100/30 dark:border-gray-850/30 hover:border-gray-200 focus-within:border-gray-100 hover:dark:border-gray-800 focus-within:dark:border-gray-800'}  transition px-1 bg-white/5 dark:bg-gray-500/5 backdrop-blur-sm dark:text-gray-100\"\n\t\t\t\t\t\t\tdir={$settings?.chatDirection ?? 'auto'}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{#if atSelectedModel !== undefined}\n\t\t\t\t\t\t\t\t<div class=\"px-3 pt-3 text-left w-full flex flex-col z-10\">\n\t\t\t\t\t\t\t\t\t<div class=\"flex items-center justify-between w-full\">\n\t\t\t\t\t\t\t\t\t\t<div class=\"pl-[1px] flex items-center gap-2 text-sm dark:text-gray-500\">\n\t\t\t\t\t\t\t\t\t\t\t<img\n\t\t\t\t\t\t\t\t\t\t\t\talt=\"model profile\"\n\t\t\t\t\t\t\t\t\t\t\t\tclass=\"size-3.5 max-w-[28px] object-cover rounded-full\"\n\t\t\t\t\t\t\t\t\t\t\t\tsrc={`${WEBUI_API_BASE_URL}/models/model/profile/image?id=${$models.find((model) => model.id === atSelectedModel.id).id}&lang=${$i18n.language}`}\n\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t\t<div class=\"translate-y-[0.5px]\">\n\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"\">{atSelectedModel.name}</span>\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\t\t\tclass=\"flex items-center dark:text-gray-500\"\n\t\t\t\t\t\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\t\t\t\t\t\tatSelectedModel = undefined;\n\t\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t<XMark />\n\t\t\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t{/if}\n\n\t\t\t\t\t\t\t{#if files.length > 0}\n\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\tclass=\"mx-2 mt-2.5 pb-1.5 flex items-center flex-wrap gap-2\"\n\t\t\t\t\t\t\t\t\tdir={$settings?.chatDirection ?? 'auto'}\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t{#each files as file, fileIdx}\n\t\t\t\t\t\t\t\t\t\t{#if file.type === 'image' || (file?.content_type ?? '').startsWith('image/')}\n\t\t\t\t\t\t\t\t\t\t\t{@const fileUrl =\n\t\t\t\t\t\t\t\t\t\t\t\tfile.url.startsWith('data') || file.url.startsWith('http')\n\t\t\t\t\t\t\t\t\t\t\t\t\t? file.url\n\t\t\t\t\t\t\t\t\t\t\t\t\t: `${WEBUI_API_BASE_URL}/files/${file.url}${file?.content_type ? '/content' : ''}`}\n\t\t\t\t\t\t\t\t\t\t\t<div class=\" relative group\">\n\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"relative flex items-center\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<Image\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tsrc={fileUrl}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\talt=\"\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\timageClassName=\" size-10 rounded-xl object-cover\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t\t\t\t{#if atSelectedModel ? visionCapableModels.length === 0 : selectedModels.length !== visionCapableModels.length}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Tooltip\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tclassName=\" absolute top-1 left-1\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcontent={$i18n.t('{{ models }}', {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tmodels: [...(atSelectedModel ? [atSelectedModel] : selectedModels)]\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t.filter((id) => !visionCapableModels.includes(id))\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t.join(', ')\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t})}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<svg\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tfill=\"currentColor\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\taria-hidden=\"true\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tclass=\"size-4 fill-yellow-300\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tfill-rule=\"evenodd\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\td=\"M9.401 3.003c1.155-2 4.043-2 5.197 0l7.355 12.748c1.154 2-.29 4.5-2.599 4.5H4.645c-2.309 0-3.752-2.5-2.598-4.5L9.4 3.003ZM12 8.25a.75.75 0 0 1 .75.75v3.75a.75.75 0 0 1-1.5 0V9a.75.75 0 0 1 .75-.75Zm0 8.25a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5Z\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tclip-rule=\"evenodd\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</Tooltip>\n\t\t\t\t\t\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t<div class=\" absolute -top-1 -right-1\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tclass=\" bg-white text-black border border-white rounded-full {($settings?.highContrastMode ??\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tfalse)\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t? ''\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t: 'outline-hidden focus:outline-hidden group-hover:visible invisible transition'}\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\taria-label={$i18n.t('Remove file')}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tfiles.splice(fileIdx, 1);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tfiles = files;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<svg\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tviewBox=\"0 0 20 20\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tfill=\"currentColor\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\taria-hidden=\"true\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tclass=\"size-4\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\td=\"M6.28 5.22a.75.75 0 00-1.06 1.06L8.94 10l-3.72 3.72a.75.75 0 101.06 1.06L10 11.06l3.72 3.72a.75.75 0 101.06-1.06L11.06 10l3.72-3.72a.75.75 0 00-1.06-1.06L10 8.94 6.28 5.22z\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t{:else}\n\t\t\t\t\t\t\t\t\t\t\t<FileItem\n\t\t\t\t\t\t\t\t\t\t\t\titem={file}\n\t\t\t\t\t\t\t\t\t\t\t\tname={file.name}\n\t\t\t\t\t\t\t\t\t\t\t\ttype={file.type}\n\t\t\t\t\t\t\t\t\t\t\t\tsize={file?.size}\n\t\t\t\t\t\t\t\t\t\t\t\tloading={file.status === 'uploading'}\n\t\t\t\t\t\t\t\t\t\t\t\tdismissible={true}\n\t\t\t\t\t\t\t\t\t\t\t\tedit={true}\n\t\t\t\t\t\t\t\t\t\t\t\tsmall={true}\n\t\t\t\t\t\t\t\t\t\t\t\tmodal={['file', 'collection'].includes(file?.type)}\n\t\t\t\t\t\t\t\t\t\t\t\ton:dismiss={async () => {\n\t\t\t\t\t\t\t\t\t\t\t\t\t// Remove from UI state\n\t\t\t\t\t\t\t\t\t\t\t\t\tfiles.splice(fileIdx, 1);\n\t\t\t\t\t\t\t\t\t\t\t\t\tfiles = files;\n\t\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\t\t\t\t\t\tconsole.log(file);\n\t\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t\t\t{/each}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t{/if}\n\n\t\t\t\t\t\t\t<div class=\"px-2.5\">\n\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\tclass=\"scrollbar-hidden rtl:text-right ltr:text-left bg-transparent dark:text-gray-100 outline-hidden w-full pb-1 px-1 resize-none h-fit max-h-96 overflow-auto {files.length ===\n\t\t\t\t\t\t\t\t\t0\n\t\t\t\t\t\t\t\t\t\t? atSelectedModel !== undefined\n\t\t\t\t\t\t\t\t\t\t\t? 'pt-1.5'\n\t\t\t\t\t\t\t\t\t\t\t: 'pt-2.5'\n\t\t\t\t\t\t\t\t\t\t: ''}\"\n\t\t\t\t\t\t\t\t\tid=\"chat-input-container\"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t{#if prompt.split('\\n').length > 2}\n\t\t\t\t\t\t\t\t\t\t<div class=\"fixed top-0 right-0 z-20\">\n\t\t\t\t\t\t\t\t\t\t\t<div class=\"mt-2.5 mr-3\">\n\t\t\t\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tclass=\"p-1 rounded-lg hover:bg-gray-100/50 dark:hover:bg-gray-800/50\"\n\t\t\t\t\t\t\t\t\t\t\t\t\taria-label=\"Expand input\"\n\t\t\t\t\t\t\t\t\t\t\t\t\ton:click={async () => {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tshowInputModal = true;\n\t\t\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<Expand />\n\t\t\t\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t{/if}\n\n\t\t\t\t\t\t\t\t\t{#if suggestions}\n\t\t\t\t\t\t\t\t\t\t{#key $settings?.richTextInput ?? true}\n\t\t\t\t\t\t\t\t\t\t\t{#key $settings?.showFormattingToolbar ?? false}\n\t\t\t\t\t\t\t\t\t\t\t\t<RichTextInput\n\t\t\t\t\t\t\t\t\t\t\t\t\tbind:this={chatInputElement}\n\t\t\t\t\t\t\t\t\t\t\t\t\tid=\"chat-input\"\n\t\t\t\t\t\t\t\t\t\t\t\t\teditable={!showInputModal}\n\t\t\t\t\t\t\t\t\t\t\t\t\tonChange={(content) => {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tprompt = content.md;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tinputContent = content;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tcommand = getCommand();\n\t\t\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t\t\t\tjson={true}\n\t\t\t\t\t\t\t\t\t\t\t\t\trichText={$settings?.richTextInput ?? true}\n\t\t\t\t\t\t\t\t\t\t\t\t\tmessageInput={true}\n\t\t\t\t\t\t\t\t\t\t\t\t\tshowFormattingToolbar={$settings?.showFormattingToolbar ?? false}\n\t\t\t\t\t\t\t\t\t\t\t\t\tfloatingMenuPlacement={'top-start'}\n\t\t\t\t\t\t\t\t\t\t\t\t\tinsertPromptAsRichText={$settings?.insertPromptAsRichText ?? false}\n\t\t\t\t\t\t\t\t\t\t\t\t\tshiftEnter={!($settings?.ctrlEnterToSend ?? false) &&\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t!$mobile &&\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t!(\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t'ontouchstart' in window ||\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tnavigator.maxTouchPoints > 0 ||\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tnavigator.msMaxTouchPoints > 0\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t\t\tplaceholder={placeholder ? placeholder : $i18n.t('Send a Message')}\n\t\t\t\t\t\t\t\t\t\t\t\t\tlargeTextAsFile={($settings?.largeTextAsFile ?? false) && !shiftKey}\n\t\t\t\t\t\t\t\t\t\t\t\t\tautocomplete={$config?.features?.enable_autocomplete_generation &&\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t($settings?.promptAutocomplete ?? false)}\n\t\t\t\t\t\t\t\t\t\t\t\t\tgenerateAutoCompletion={async (text) => {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (selectedModelIds.length === 0 || !selectedModelIds.at(0)) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttoast.error($i18n.t('Please select a model first.'));\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tconst res = await generateAutoCompletion(\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tlocalStorage.token,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tselectedModelIds.at(0),\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttext,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\thistory?.currentId\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t? createMessagesList(history, history.currentId)\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t: null\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t).catch((error) => {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tconsole.log(error);\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\treturn null;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tconsole.log(res);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\treturn res;\n\t\t\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t\t\t\t{suggestions}\n\t\t\t\t\t\t\t\t\t\t\t\t\toncompositionstart={() => (isComposing = true)}\n\t\t\t\t\t\t\t\t\t\t\t\t\toncompositionend={(e) => {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tcompositionEndedAt = e.timeStamp;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tisComposing = false;\n\t\t\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t\t\t\ton:keydown={async (e) => {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\te = e.detail.event;\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tconst isCtrlPressed = e.ctrlKey || e.metaKey; // metaKey is for Cmd key on Mac\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tconst suggestionsContainerElement =\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdocument.getElementById('suggestions-container');\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (e.key === 'Escape') {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tstopResponse();\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (prompt === '' && e.key == 'ArrowUp') {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\te.preventDefault();\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tconst userMessageElement = [\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t...document.getElementsByClassName('user-message')\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t]?.at(-1);\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (userMessageElement) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tuserMessageElement.scrollIntoView({ block: 'center' });\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tconst editButton = [\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t...document.getElementsByClassName('edit-user-message-button')\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t]?.at(-1);\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\teditButton?.click();\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (!suggestionsContainerElement) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t!$mobile ||\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t!(\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t'ontouchstart' in window ||\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tnavigator.maxTouchPoints > 0 ||\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tnavigator.msMaxTouchPoints > 0\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (inOrNearComposition(e)) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Uses keyCode '13' for Enter key for chinese/japanese keyboards.\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t//\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Depending on the user's settings, it will send the message\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// either when Enter is pressed or when Ctrl+Enter is pressed.\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tconst enterPressed =\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t($settings?.ctrlEnterToSend ?? false)\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t? (e.key === 'Enter' || e.keyCode === 13) && isCtrlPressed\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t: (e.key === 'Enter' || e.keyCode === 13) && !e.shiftKey;\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (enterPressed) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (prompt !== '' || files.length > 0) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdispatch('submit', prompt);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (e.key === 'Escape') {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tconsole.log('Escape');\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tatSelectedModel = undefined;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tselectedToolIds = [];\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tselectedFilterIds = [];\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twebSearchEnabled = false;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\timageGenerationEnabled = false;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcodeInterpreterEnabled = false;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t\t\t\ton:paste={async (e) => {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\te = e.detail.event;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tconsole.log(e);\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tconst clipboardData = e.clipboardData || window.clipboardData;\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (clipboardData && clipboardData.items) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tfor (const item of clipboardData.items) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (item.type === 'text/plain') {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (($settings?.largeTextAsFile ?? false) && !shiftKey) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tconst text = clipboardData.getData('text/plain');\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (text.length > PASTED_TEXT_CHARACTER_LIMIT) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tconst blob = new Blob([text], { type: 'text/plain' });\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tconst file = new File(\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t[blob],\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t`Pasted_Text_${Date.now()}.txt`,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype: 'text/plain'\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t);\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tawait uploadFileHandler(file, true, { context: 'full' });\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tconst file = item.getAsFile();\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (file) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tawait inputFilesHandler([file]);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t\t{/key}\n\t\t\t\t\t\t\t\t\t\t{/key}\n\t\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t<div class=\" flex justify-between mt-0.5 mb-2.5 mx-0.5 max-w-full\" dir=\"ltr\">\n\t\t\t\t\t\t\t\t<div class=\"ml-1 self-end flex items-center flex-1 max-w-[80%]\">\n\t\t\t\t\t\t\t\t\t<InputMenu\n\t\t\t\t\t\t\t\t\t\tbind:files\n\t\t\t\t\t\t\t\t\t\tselectedModels={atSelectedModel ? [atSelectedModel.id] : selectedModels}\n\t\t\t\t\t\t\t\t\t\t{fileUploadCapableModels}\n\t\t\t\t\t\t\t\t\t\t{screenCaptureHandler}\n\t\t\t\t\t\t\t\t\t\t{inputFilesHandler}\n\t\t\t\t\t\t\t\t\t\tuploadFilesHandler={() => {\n\t\t\t\t\t\t\t\t\t\t\tfilesInputElement.click();\n\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\tuploadGoogleDriveHandler={async () => {\n\t\t\t\t\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\t\t\t\t\tconst fileData = await createPicker();\n\t\t\t\t\t\t\t\t\t\t\t\tif (fileData) {\n\t\t\t\t\t\t\t\t\t\t\t\t\tconst file = new File([fileData.blob], fileData.name, {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype: fileData.blob.type\n\t\t\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\t\t\t\tawait uploadFileHandler(file);\n\t\t\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\t\t\tconsole.log('No file was selected from Google Drive');\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t} catch (error) {\n\t\t\t\t\t\t\t\t\t\t\t\tconsole.error('Google Drive Error:', error);\n\t\t\t\t\t\t\t\t\t\t\t\ttoast.error(\n\t\t\t\t\t\t\t\t\t\t\t\t\t$i18n.t('Error accessing Google Drive: {{error}}', {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\terror: error.message\n\t\t\t\t\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\tuploadOneDriveHandler={async (authorityType) => {\n\t\t\t\t\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\t\t\t\t\tconst fileData = await pickAndDownloadFile(authorityType);\n\t\t\t\t\t\t\t\t\t\t\t\tif (fileData) {\n\t\t\t\t\t\t\t\t\t\t\t\t\tconst file = new File([fileData.blob], fileData.name, {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype: fileData.blob.type || 'application/octet-stream'\n\t\t\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\t\t\t\tawait uploadFileHandler(file);\n\t\t\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\t\t\tconsole.log('No file was selected from OneDrive');\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t} catch (error) {\n\t\t\t\t\t\t\t\t\t\t\t\tconsole.error('OneDrive Error:', error);\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t{onUpload}\n\t\t\t\t\t\t\t\t\t\tonClose={async () => {\n\t\t\t\t\t\t\t\t\t\t\tawait tick();\n\n\t\t\t\t\t\t\t\t\t\t\tconst chatInput = document.getElementById('chat-input');\n\t\t\t\t\t\t\t\t\t\t\tchatInput?.focus();\n\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\t\t\tid=\"input-menu-button\"\n\t\t\t\t\t\t\t\t\t\t\tclass=\"bg-transparent hover:bg-gray-100 text-gray-700 dark:text-white dark:hover:bg-gray-800 rounded-full size-8 flex justify-center items-center outline-hidden focus:outline-hidden\"\n\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t<PlusAlt className=\"size-5.5\" />\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</InputMenu>\n\n\t\t\t\t\t\t\t\t\t{#if showWebSearchButton || showImageGenerationButton || showCodeInterpreterButton || showToolsButton || (toggleFilters && toggleFilters.length > 0)}\n\t\t\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\t\t\tclass=\"flex self-center w-[1px] h-4 mx-1 bg-gray-200/50 dark:bg-gray-800/50\"\n\t\t\t\t\t\t\t\t\t\t/>\n\n\t\t\t\t\t\t\t\t\t\t<IntegrationsMenu\n\t\t\t\t\t\t\t\t\t\t\tselectedModels={atSelectedModel ? [atSelectedModel.id] : selectedModels}\n\t\t\t\t\t\t\t\t\t\t\t{toggleFilters}\n\t\t\t\t\t\t\t\t\t\t\t{showWebSearchButton}\n\t\t\t\t\t\t\t\t\t\t\t{showImageGenerationButton}\n\t\t\t\t\t\t\t\t\t\t\t{showCodeInterpreterButton}\n\t\t\t\t\t\t\t\t\t\t\tbind:selectedToolIds\n\t\t\t\t\t\t\t\t\t\t\tbind:selectedFilterIds\n\t\t\t\t\t\t\t\t\t\t\tbind:webSearchEnabled\n\t\t\t\t\t\t\t\t\t\t\tbind:imageGenerationEnabled\n\t\t\t\t\t\t\t\t\t\t\tbind:codeInterpreterEnabled\n\t\t\t\t\t\t\t\t\t\t\tcloseOnOutsideClick={integrationsMenuCloseOnOutsideClick}\n\t\t\t\t\t\t\t\t\t\t\tonShowValves={(e) => {\n\t\t\t\t\t\t\t\t\t\t\t\tconst { type, id } = e;\n\t\t\t\t\t\t\t\t\t\t\t\tselectedValvesType = type;\n\t\t\t\t\t\t\t\t\t\t\t\tselectedValvesItemId = id;\n\t\t\t\t\t\t\t\t\t\t\t\tshowValvesModal = true;\n\t\t\t\t\t\t\t\t\t\t\t\tintegrationsMenuCloseOnOutsideClick = false;\n\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t\tonClose={async () => {\n\t\t\t\t\t\t\t\t\t\t\t\tawait tick();\n\n\t\t\t\t\t\t\t\t\t\t\t\tconst chatInput = document.getElementById('chat-input');\n\t\t\t\t\t\t\t\t\t\t\t\tchatInput?.focus();\n\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\t\t\t\tid=\"integration-menu-button\"\n\t\t\t\t\t\t\t\t\t\t\t\tclass=\"bg-transparent hover:bg-gray-100 text-gray-700 dark:text-white dark:hover:bg-gray-800 rounded-full size-8 flex justify-center items-center outline-hidden focus:outline-hidden\"\n\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t<Component className=\"size-4.5\" strokeWidth=\"1.5\" />\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t</IntegrationsMenu>\n\t\t\t\t\t\t\t\t\t{/if}\n\n\t\t\t\t\t\t\t\t\t{#if selectedModelIds.length === 1 && $models.find((m) => m.id === selectedModelIds[0])?.has_user_valves}\n\t\t\t\t\t\t\t\t\t\t<div class=\"ml-1 flex gap-1.5\">\n\t\t\t\t\t\t\t\t\t\t\t<Tooltip content={$i18n.t('Valves')} placement=\"top\">\n\t\t\t\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tid=\"model-valves-button\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tclass=\"bg-transparent hover:bg-gray-100 text-gray-700 dark:text-white dark:hover:bg-gray-800 rounded-full size-8 flex justify-center items-center outline-hidden focus:outline-hidden\"\n\t\t\t\t\t\t\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tselectedValvesType = 'function';\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tselectedValvesItemId = selectedModelIds[0]?.split('.')[0];\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tshowValvesModal = true;\n\t\t\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<Knobs className=\"size-4\" strokeWidth=\"1.5\" />\n\t\t\t\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t\t\t\t</Tooltip>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t{/if}\n\n\t\t\t\t\t\t\t\t\t<div class=\"ml-1 flex gap-1.5\">\n\t\t\t\t\t\t\t\t\t\t{#if (selectedToolIds ?? []).length > 0}\n\t\t\t\t\t\t\t\t\t\t\t<Tooltip\n\t\t\t\t\t\t\t\t\t\t\t\tcontent={$i18n.t('{{COUNT}} Available Tools', {\n\t\t\t\t\t\t\t\t\t\t\t\t\tCOUNT: selectedToolIds.length\n\t\t\t\t\t\t\t\t\t\t\t\t})}\n\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\t\t\t\tclass=\"translate-y-[0.5px] px-1 flex gap-1 items-center text-gray-600 dark:text-gray-300 hover:text-gray-700 dark:hover:text-gray-200 rounded-lg self-center transition\"\n\t\t\t\t\t\t\t\t\t\t\t\t\taria-label=\"Available Tools\"\n\t\t\t\t\t\t\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tshowTools = !showTools;\n\t\t\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<Wrench className=\"size-4\" strokeWidth=\"1.75\" />\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"text-sm\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t{selectedToolIds.length}\n\t\t\t\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t\t\t\t</Tooltip>\n\t\t\t\t\t\t\t\t\t\t{/if}\n\n\t\t\t\t\t\t\t\t\t\t{#each selectedFilterIds as filterId}\n\t\t\t\t\t\t\t\t\t\t\t{@const filter = toggleFilters.find((f) => f.id === filterId)}\n\t\t\t\t\t\t\t\t\t\t\t{#if filter}\n\t\t\t\t\t\t\t\t\t\t\t\t<Tooltip content={filter?.name} placement=\"top\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ton:click|preventDefault={() => {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tselectedFilterIds = selectedFilterIds.filter((id) => id !== filterId);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tclass=\"group p-[7px] flex gap-1.5 items-center text-sm rounded-full transition-colors duration-300 focus:outline-hidden max-w-full overflow-hidden {selectedFilterIds.includes(\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tfilterId\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t? 'text-sky-500 dark:text-sky-300 bg-sky-50 hover:bg-sky-100 dark:bg-sky-400/10 dark:hover:bg-sky-600/10 border border-sky-200/40 dark:border-sky-500/20'\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t: 'bg-transparent text-gray-600 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-800 '} capitalize\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t{#if filter?.icon}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"size-4 items-center flex justify-center\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<img\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tsrc={filter.icon}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tclass=\"size-3.5 {filter.icon.includes('svg')\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t? 'dark:invert-[80%]'\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t: ''}\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tstyle=\"fill: currentColor;\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\talt={filter.name}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t{:else}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Sparkles className=\"size-4\" strokeWidth=\"1.75\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"hidden group-hover:block\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<XMark className=\"size-4\" strokeWidth=\"1.75\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t\t\t\t\t</Tooltip>\n\t\t\t\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t\t\t\t{/each}\n\n\t\t\t\t\t\t\t\t\t\t{#if webSearchEnabled}\n\t\t\t\t\t\t\t\t\t\t\t<Tooltip content={$i18n.t('Web Search')} placement=\"top\">\n\t\t\t\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\t\t\t\ton:click|preventDefault={() => (webSearchEnabled = !webSearchEnabled)}\n\t\t\t\t\t\t\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tclass=\"group p-[7px] flex gap-1.5 items-center text-sm rounded-full transition-colors duration-300 focus:outline-hidden max-w-full overflow-hidden {webSearchEnabled ||\n\t\t\t\t\t\t\t\t\t\t\t\t\t($settings?.webSearch ?? false) === 'always'\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t? ' text-sky-500 dark:text-sky-300 bg-sky-50 hover:bg-sky-100 dark:bg-sky-400/10 dark:hover:bg-sky-600/10 border border-sky-200/40 dark:border-sky-500/20'\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t: 'bg-transparent text-gray-600 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-800 '}\"\n\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<GlobeAlt className=\"size-4\" strokeWidth=\"1.75\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"hidden group-hover:block\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<XMark className=\"size-4\" strokeWidth=\"1.75\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t\t\t\t</Tooltip>\n\t\t\t\t\t\t\t\t\t\t{/if}\n\n\t\t\t\t\t\t\t\t\t\t{#if imageGenerationEnabled}\n\t\t\t\t\t\t\t\t\t\t\t<Tooltip content={$i18n.t('Image')} placement=\"top\">\n\t\t\t\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\t\t\t\ton:click|preventDefault={() =>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t(imageGenerationEnabled = !imageGenerationEnabled)}\n\t\t\t\t\t\t\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tclass=\"group p-[7px] flex gap-1.5 items-center text-sm rounded-full transition-colors duration-300 focus:outline-hidden max-w-full overflow-hidden {imageGenerationEnabled\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t? ' text-sky-500 dark:text-sky-300 bg-sky-50 hover:bg-sky-100 dark:bg-sky-400/10 dark:hover:bg-sky-700/10 border border-sky-200/40 dark:border-sky-500/20'\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t: 'bg-transparent text-gray-600 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-800 '}\"\n\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<Photo className=\"size-4\" strokeWidth=\"1.75\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"hidden group-hover:block\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<XMark className=\"size-4\" strokeWidth=\"1.75\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t\t\t\t</Tooltip>\n\t\t\t\t\t\t\t\t\t\t{/if}\n\n\t\t\t\t\t\t\t\t\t\t{#if codeInterpreterEnabled}\n\t\t\t\t\t\t\t\t\t\t\t<Tooltip content={$i18n.t('Code Interpreter')} placement=\"top\">\n\t\t\t\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\t\t\t\taria-label={codeInterpreterEnabled\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t? $i18n.t('Disable Code Interpreter')\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t: $i18n.t('Enable Code Interpreter')}\n\t\t\t\t\t\t\t\t\t\t\t\t\taria-pressed={codeInterpreterEnabled}\n\t\t\t\t\t\t\t\t\t\t\t\t\ton:click|preventDefault={() =>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t(codeInterpreterEnabled = !codeInterpreterEnabled)}\n\t\t\t\t\t\t\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tclass=\" group p-[7px] flex gap-1.5 items-center text-sm transition-colors duration-300 max-w-full overflow-hidden {codeInterpreterEnabled\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t? ' text-sky-500 dark:text-sky-300 bg-sky-50 hover:bg-sky-100 dark:bg-sky-400/10 dark:hover:bg-sky-700/10 border border-sky-200/40 dark:border-sky-500/20'\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t: 'bg-transparent text-gray-600 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-800 '} {($settings?.highContrastMode ??\n\t\t\t\t\t\t\t\t\t\t\t\t\tfalse)\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t? 'm-1'\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t: 'focus:outline-hidden rounded-full'}\"\n\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<Terminal className=\"size-3.5\" strokeWidth=\"2\" />\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"hidden group-hover:block\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<XMark className=\"size-4\" strokeWidth=\"1.75\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t\t\t\t</Tooltip>\n\t\t\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t<div class=\"self-end flex space-x-1 mr-1 shrink-0 gap-[0.5px]\">\n\t\t\t\t\t\t\t\t\t{#if (taskIds && taskIds.length > 0) || (history.currentId && history.messages[history.currentId]?.done != true) || generating}\n\t\t\t\t\t\t\t\t\t\t<div class=\" flex items-center\">\n\t\t\t\t\t\t\t\t\t\t\t<Tooltip content={$i18n.t('Stop')}>\n\t\t\t\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\t\t\t\tclass=\"bg-white hover:bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-white dark:hover:bg-gray-800 transition rounded-full p-1.5\"\n\t\t\t\t\t\t\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tstopResponse();\n\t\t\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<svg\n\t\t\t\t\t\t\t\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tfill=\"currentColor\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tclass=\"size-5\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tfill-rule=\"evenodd\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\td=\"M2.25 12c0-5.385 4.365-9.75 9.75-9.75s9.75 4.365 9.75 9.75-4.365 9.75-9.75 9.75S2.25 17.385 2.25 12zm6-2.438c0-.724.588-1.312 1.313-1.312h4.874c.725 0 1.313.588 1.313 1.313v4.874c0 .725-.588 1.313-1.313 1.313H9.564a1.312 1.312 0 01-1.313-1.313V9.564z\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tclip-rule=\"evenodd\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t\t\t\t</Tooltip>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t{:else}\n\t\t\t\t\t\t\t\t\t\t{#if prompt !== '' && !history?.currentId && ($config?.features?.enable_notes ?? false) && ($_user?.role === 'admin' || ($_user?.permissions?.features?.notes ?? true))}\n\t\t\t\t\t\t\t\t\t\t\t<!-- {$i18n.t('Create Note')}  -->\n\t\t\t\t\t\t\t\t\t\t\t<Tooltip content={$i18n.t('Create note')} className=\" flex items-center\">\n\t\t\t\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\t\t\t\tid=\"send-message-button\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tclass=\" text-gray-600 dark:text-gray-300 hover:text-gray-700 dark:hover:text-gray-200 transition rounded-full p-1.5 self-center\"\n\t\t\t\t\t\t\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tdisabled={prompt === '' && files.length === 0}\n\t\t\t\t\t\t\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tcreateNote();\n\t\t\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<PageEdit className=\"size-4.5 translate-y-[0.5px]\" />\n\t\t\t\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t\t\t\t</Tooltip>\n\t\t\t\t\t\t\t\t\t\t{/if}\n\n\t\t\t\t\t\t\t\t\t\t{#if (!history?.currentId || history.messages[history.currentId]?.done == true) && ($_user?.role === 'admin' || ($_user?.permissions?.chat?.stt ?? true))}\n\t\t\t\t\t\t\t\t\t\t\t<!-- {$i18n.t('Record voice')} -->\n\t\t\t\t\t\t\t\t\t\t\t<Tooltip content={$i18n.t('Dictate')}>\n\t\t\t\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\t\t\t\tid=\"voice-input-button\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tclass=\" text-gray-600 dark:text-gray-300 hover:text-gray-700 dark:hover:text-gray-200 transition rounded-full p-1.5 self-center mr-0.5\"\n\t\t\t\t\t\t\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t\t\t\t\t\t\t\ton:click={async () => {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tlet stream = await navigator.mediaDevices\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t.getUserMedia({ audio: true })\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t.catch(function (err) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttoast.error(\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t$i18n.t(\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t`Permission denied when accessing microphone: {{error}}`,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\terror: err\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\treturn null;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (stream) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\trecording = true;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tconst tracks = stream.getTracks();\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttracks.forEach((track) => track.stop());\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tstream = null;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t} catch {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttoast.error($i18n.t('Permission denied when accessing microphone'));\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t\t\t\taria-label=\"Voice Input\"\n\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<svg\n\t\t\t\t\t\t\t\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tviewBox=\"0 0 20 20\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tfill=\"currentColor\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tclass=\"size-5 translate-y-[0.5px]\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<path d=\"M7 4a3 3 0 016 0v6a3 3 0 11-6 0V4z\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\td=\"M5.5 9.643a.75.75 0 00-1.5 0V10c0 3.06 2.29 5.585 5.25 5.954V17.5h-1.5a.75.75 0 000 1.5h4.5a.75.75 0 000-1.5h-1.5v-1.546A6.001 6.001 0 0016 10v-.357a.75.75 0 00-1.5 0V10a4.5 4.5 0 01-9 0v-.357z\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t\t\t\t</Tooltip>\n\t\t\t\t\t\t\t\t\t\t{/if}\n\n\t\t\t\t\t\t\t\t\t\t{#if prompt === '' && files.length === 0 && ($_user?.role === 'admin' || ($_user?.permissions?.chat?.call ?? true))}\n\t\t\t\t\t\t\t\t\t\t\t<div class=\" flex items-center\">\n\t\t\t\t\t\t\t\t\t\t\t\t<!-- {$i18n.t('Call')} -->\n\t\t\t\t\t\t\t\t\t\t\t\t<Tooltip content={$i18n.t('Voice mode')}>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tclass=\" bg-black text-white hover:bg-gray-900 dark:bg-white dark:text-black dark:hover:bg-gray-100 transition rounded-full p-1.5 self-center\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ton:click={async () => {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (selectedModels.length > 1) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttoast.error($i18n.t('Select only one model to call'));\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif ($config.audio.stt.engine === 'web') {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttoast.error(\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t$i18n.t('Call feature is not supported when using Web STT engine')\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t);\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// check if user has access to getUserMedia\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tlet stream = await navigator.mediaDevices.getUserMedia({\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\taudio: true\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// If the user grants the permission, proceed to show the call overlay\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (stream) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tconst tracks = stream.getTracks();\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttracks.forEach((track) => track.stop());\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tstream = null;\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif ($settings.audio?.tts?.engine === 'browser-kokoro') {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// If the user has not initialized the TTS worker, initialize it\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (!$TTSWorker) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tawait TTSWorker.set(\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tnew KokoroWorker({\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdtype: $settings.audio?.tts?.engineConfig?.dtype ?? 'fp32'\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t);\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tawait $TTSWorker.init();\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tshowCallOverlay.set(true);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tshowControls.set(true);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t} catch (err) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// If the user denies the permission or an error occurs, show an error message\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttoast.error(\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t$i18n.t('Permission denied when accessing media devices')\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\taria-label={$i18n.t('Voice mode')}\n\t\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Voice className=\"size-5\" strokeWidth=\"2.5\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t\t\t\t\t</Tooltip>\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t{:else}\n\t\t\t\t\t\t\t\t\t\t\t<div class=\" flex items-center\">\n\t\t\t\t\t\t\t\t\t\t\t\t<Tooltip content={$i18n.t('Send message')}>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tid=\"send-message-button\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tclass=\"{!(prompt === '' && files.length === 0)\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t? 'bg-black text-white hover:bg-gray-900 dark:bg-white dark:text-black dark:hover:bg-gray-100 '\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t: 'text-white bg-gray-200 dark:text-gray-900 dark:bg-gray-700 disabled'} transition rounded-full p-1.5 self-center\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype=\"submit\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdisabled={prompt === '' && files.length === 0}\n\t\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<svg\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tviewBox=\"0 0 16 16\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tfill=\"currentColor\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tclass=\"size-5\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tfill-rule=\"evenodd\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\td=\"M8 14a.75.75 0 0 1-.75-.75V4.56L4.03 7.78a.75.75 0 0 1-1.06-1.06l4.5-4.5a.75.75 0 0 1 1.06 0l4.5 4.5a.75.75 0 0 1-1.06 1.06L8.75 4.56v8.69A.75.75 0 0 1 8 14Z\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tclip-rule=\"evenodd\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t\t\t\t\t</Tooltip>\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t{#if $config?.license_metadata?.input_footer}\n\t\t\t\t\t\t\t<div class=\" text-xs text-gray-500 text-center line-clamp-1 marked\">\n\t\t\t\t\t\t\t\t{@html DOMPurify.sanitize(marked($config?.license_metadata?.input_footer))}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t{:else}\n\t\t\t\t\t\t\t<div class=\"mb-1\" />\n\t\t\t\t\t\t{/if}\n\t\t\t\t\t</form>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n{/if}\n","<script lang=\"ts\">\n\timport { models, showSettings, settings, user, mobile, config } from '$lib/stores';\n\timport { onMount, tick, getContext } from 'svelte';\n\timport { toast } from 'svelte-sonner';\n\timport Selector from './ModelSelector/Selector.svelte';\n\timport Tooltip from '../common/Tooltip.svelte';\n\n\timport { updateUserSettings } from '$lib/apis/users';\n\tconst i18n = getContext('i18n');\n\n\texport let selectedModels = [''];\n\texport let disabled = false;\n\n\texport let showSetDefault = true;\n\n\tconst saveDefaultModel = async () => {\n\t\tconst hasEmptyModel = selectedModels.filter((it) => it === '');\n\t\tif (hasEmptyModel.length) {\n\t\t\ttoast.error($i18n.t('Choose a model before saving...'));\n\t\t\treturn;\n\t\t}\n\t\tsettings.set({ ...$settings, models: selectedModels });\n\t\tawait updateUserSettings(localStorage.token, { ui: $settings });\n\n\t\ttoast.success($i18n.t('Default model updated'));\n\t};\n\n\tconst pinModelHandler = async (modelId) => {\n\t\tlet pinnedModels = $settings?.pinnedModels ?? [];\n\n\t\tif (pinnedModels.includes(modelId)) {\n\t\t\tpinnedModels = pinnedModels.filter((id) => id !== modelId);\n\t\t} else {\n\t\t\tpinnedModels = [...new Set([...pinnedModels, modelId])];\n\t\t}\n\n\t\tsettings.set({ ...$settings, pinnedModels: pinnedModels });\n\t\tawait updateUserSettings(localStorage.token, { ui: $settings });\n\t};\n\n\t$: if (selectedModels.length > 0 && $models.length > 0) {\n\t\tconst _selectedModels = selectedModels.map((model) =>\n\t\t\t$models.map((m) => m.id).includes(model) ? model : ''\n\t\t);\n\n\t\tif (JSON.stringify(_selectedModels) !== JSON.stringify(selectedModels)) {\n\t\t\tselectedModels = _selectedModels;\n\t\t}\n\t}\n</script>\n\n<div class=\"flex flex-col w-full items-start\">\n\t{#each selectedModels as selectedModel, selectedModelIdx}\n\t\t<div class=\"flex w-full max-w-fit\">\n\t\t\t<div class=\"overflow-hidden w-full\">\n\t\t\t\t<div class=\"max-w-full {($settings?.highContrastMode ?? false) ? 'm-1' : 'mr-1'}\">\n\t\t\t\t\t<Selector\n\t\t\t\t\t\tid={`${selectedModelIdx}`}\n\t\t\t\t\t\tplaceholder={$i18n.t('Select a model')}\n\t\t\t\t\t\titems={$models.map((model) => ({\n\t\t\t\t\t\t\tvalue: model.id,\n\t\t\t\t\t\t\tlabel: model.name,\n\t\t\t\t\t\t\tmodel: model\n\t\t\t\t\t\t}))}\n\t\t\t\t\t\t{pinModelHandler}\n\t\t\t\t\t\tbind:value={selectedModel}\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t{#if $user?.role === 'admin' || ($user?.permissions?.chat?.multiple_models ?? true)}\n\t\t\t\t{#if selectedModelIdx === 0}\n\t\t\t\t\t<div\n\t\t\t\t\t\tclass=\"  self-center mx-1 disabled:text-gray-600 disabled:hover:text-gray-600 -translate-y-[0.5px]\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<Tooltip content={$i18n.t('Add Model')}>\n\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\tclass=\" \"\n\t\t\t\t\t\t\t\t{disabled}\n\t\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\t\tselectedModels = [...selectedModels, ''];\n\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\taria-label=\"Add Model\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<svg\n\t\t\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\t\t\t\t\tfill=\"none\"\n\t\t\t\t\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\t\t\t\t\tstroke-width=\"2\"\n\t\t\t\t\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\t\t\t\t\tclass=\"size-3.5\"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<path stroke-linecap=\"round\" stroke-linejoin=\"round\" d=\"M12 6v12m6-6H6\" />\n\t\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t</Tooltip>\n\t\t\t\t\t</div>\n\t\t\t\t{:else}\n\t\t\t\t\t<div\n\t\t\t\t\t\tclass=\"  self-center mx-1 disabled:text-gray-600 disabled:hover:text-gray-600 -translate-y-[0.5px]\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<Tooltip content={$i18n.t('Remove Model')}>\n\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t{disabled}\n\t\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\t\tselectedModels.splice(selectedModelIdx, 1);\n\t\t\t\t\t\t\t\t\tselectedModels = selectedModels;\n\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\taria-label=\"Remove Model\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<svg\n\t\t\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\t\t\t\t\tfill=\"none\"\n\t\t\t\t\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\t\t\t\t\tstroke-width=\"2\"\n\t\t\t\t\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\t\t\t\t\tclass=\"size-3\"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<path stroke-linecap=\"round\" stroke-linejoin=\"round\" d=\"M19.5 12h-15\" />\n\t\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t</Tooltip>\n\t\t\t\t\t</div>\n\t\t\t\t{/if}\n\t\t\t{/if}\n\t\t</div>\n\t{/each}\n</div>\n\n{#if showSetDefault}\n\t<div\n\t\tclass=\"relative text-left mt-[1px] ml-1 text-[0.7rem] text-gray-600 dark:text-gray-400 font-primary\"\n\t>\n\t\t<button on:click={saveDefaultModel}> {$i18n.t('Set as default')}</button>\n\t</div>\n{/if}\n","<script lang=\"ts\">\n\texport let className = 'w-4 h-4';\n\texport let strokeWidth = '1.5';\n</script>\n\n<svg\n\txmlns=\"http://www.w3.org/2000/svg\"\n\tviewBox=\"0 0 24 24\"\n\tstroke=\"currentColor\"\n\tfill=\"currentColor\"\n\tclass={className}\n\tstroke-width={strokeWidth}\n>\n\t<path\n\t\tstroke-linecap=\"round\"\n\t\tstroke-linejoin=\"round\"\n\t\td=\"M10.5 6h9.75M10.5 6a1.5 1.5 0 1 1-3 0m3 0a1.5 1.5 0 1 0-3 0M3.75 6H7.5m3 12h9.75m-9.75 0a1.5 1.5 0 0 1-3 0m3 0a1.5 1.5 0 0 0-3 0m-3.75 0H7.5m9-6h3.75m-3.75 0a1.5 1.5 0 0 1-3 0m3 0a1.5 1.5 0 0 0-3 0m-9.75 0h9.75\"\n\t/>\n</svg>\n","<script lang=\"ts\">\n\timport { toast } from 'svelte-sonner';\n\timport { DropdownMenu } from 'bits-ui';\n\timport { getContext, tick } from 'svelte';\n\n\timport fileSaver from 'file-saver';\n\tconst { saveAs } = fileSaver;\n\n\timport { downloadChatAsPDF } from '$lib/apis/utils';\n\timport { copyToClipboard, createMessagesList } from '$lib/utils';\n\n\timport {\n\t\tshowOverview,\n\t\tshowControls,\n\t\tshowArtifacts,\n\t\tmobile,\n\t\ttemporaryChatEnabled,\n\t\ttheme,\n\t\tuser,\n\t\tsettings,\n\t\tfolders,\n\t\tshowEmbeds,\n\t\tartifactContents\n\t} from '$lib/stores';\n\timport { flyAndScale } from '$lib/utils/transitions';\n\timport { getChatById } from '$lib/apis/chats';\n\n\timport Dropdown from '$lib/components/common/Dropdown.svelte';\n\timport Tags from '$lib/components/chat/Tags.svelte';\n\timport Map from '$lib/components/icons/Map.svelte';\n\timport Clipboard from '$lib/components/icons/Clipboard.svelte';\n\timport AdjustmentsHorizontal from '$lib/components/icons/AdjustmentsHorizontal.svelte';\n\timport Cube from '$lib/components/icons/Cube.svelte';\n\timport Folder from '$lib/components/icons/Folder.svelte';\n\timport Share from '$lib/components/icons/Share.svelte';\n\timport ArchiveBox from '$lib/components/icons/ArchiveBox.svelte';\n\timport Messages from '$lib/components/chat/Messages.svelte';\n\timport Download from '$lib/components/icons/Download.svelte';\n\n\tconst i18n = getContext('i18n');\n\n\texport let shareEnabled: boolean = false;\n\n\texport let shareHandler: Function;\n\texport let moveChatHandler: Function;\n\n\texport let archiveChatHandler: Function;\n\n\t// export let tagHandler: Function;\n\n\texport let chat;\n\texport let onClose: Function = () => {};\n\n\tlet showFullMessages = false;\n\n\tconst getChatAsText = async () => {\n\t\tconst history = chat.chat.history;\n\t\tconst messages = createMessagesList(history, history.currentId);\n\t\tconst chatText = messages.reduce((a, message, i, arr) => {\n\t\t\treturn `${a}### ${message.role.toUpperCase()}\\n${message.content}\\n\\n`;\n\t\t}, '');\n\n\t\treturn chatText.trim();\n\t};\n\n\tconst downloadTxt = async () => {\n\t\tconst chatText = await getChatAsText();\n\n\t\tlet blob = new Blob([chatText], {\n\t\t\ttype: 'text/plain'\n\t\t});\n\n\t\tsaveAs(blob, `chat-${chat.chat.title}.txt`);\n\t};\n\n\tconst downloadPdf = async () => {\n\t\tconst [{ default: jsPDF }, { default: html2canvas }] = await Promise.all([\n\t\t\timport('jspdf'),\n\t\t\timport('html2canvas-pro')\n\t\t]);\n\n\t\tif ($settings?.stylizedPdfExport ?? true) {\n\t\t\tshowFullMessages = true;\n\t\t\tawait tick();\n\n\t\t\tconst containerElement = document.getElementById('full-messages-container');\n\t\t\tif (containerElement) {\n\t\t\t\ttry {\n\t\t\t\t\tconst isDarkMode = document.documentElement.classList.contains('dark');\n\t\t\t\t\tconst virtualWidth = 800; // px, fixed width for cloned element\n\n\t\t\t\t\t// Clone and style\n\t\t\t\t\tconst clonedElement = containerElement.cloneNode(true);\n\t\t\t\t\tclonedElement.classList.add('text-black');\n\t\t\t\t\tclonedElement.classList.add('dark:text-white');\n\t\t\t\t\tclonedElement.style.width = `${virtualWidth}px`;\n\t\t\t\t\tclonedElement.style.position = 'absolute';\n\t\t\t\t\tclonedElement.style.left = '-9999px';\n\t\t\t\t\tclonedElement.style.height = 'auto';\n\t\t\t\t\tdocument.body.appendChild(clonedElement);\n\n\t\t\t\t\t// Wait for DOM update/layout\n\t\t\t\t\tawait new Promise((r) => setTimeout(r, 100));\n\n\t\t\t\t\t// Render entire content once\n\t\t\t\t\tconst canvas = await html2canvas(clonedElement, {\n\t\t\t\t\t\tbackgroundColor: isDarkMode ? '#000' : '#fff',\n\t\t\t\t\t\tuseCORS: true,\n\t\t\t\t\t\tscale: 2, // increase resolution\n\t\t\t\t\t\twidth: virtualWidth\n\t\t\t\t\t});\n\n\t\t\t\t\tdocument.body.removeChild(clonedElement);\n\n\t\t\t\t\tconst pdf = new jsPDF('p', 'mm', 'a4');\n\t\t\t\t\tconst pageWidthMM = 210;\n\t\t\t\t\tconst pageHeightMM = 297;\n\n\t\t\t\t\t// Convert page height in mm to px on canvas scale for cropping\n\t\t\t\t\t// Get canvas DPI scale:\n\t\t\t\t\tconst pxPerMM = canvas.width / virtualWidth; // width in px / width in px?\n\t\t\t\t\t// Since 1 page width is 210 mm, but canvas width is 800 px at scale 2\n\t\t\t\t\t// Assume 1 mm = px / (pageWidthMM scaled)\n\t\t\t\t\t// Actually better: Calculate scale factor from px/mm:\n\t\t\t\t\t// virtualWidth px corresponds directly to 210mm in PDF, so pxPerMM:\n\t\t\t\t\tconst pxPerPDFMM = canvas.width / pageWidthMM; // canvas px per PDF mm\n\n\t\t\t\t\t// Height in px for one page slice:\n\t\t\t\t\tconst pagePixelHeight = Math.floor(pxPerPDFMM * pageHeightMM);\n\n\t\t\t\t\tlet offsetY = 0;\n\t\t\t\t\tlet page = 0;\n\n\t\t\t\t\twhile (offsetY < canvas.height) {\n\t\t\t\t\t\t// Height of slice\n\t\t\t\t\t\tconst sliceHeight = Math.min(pagePixelHeight, canvas.height - offsetY);\n\n\t\t\t\t\t\t// Create temp canvas for slice\n\t\t\t\t\t\tconst pageCanvas = document.createElement('canvas');\n\t\t\t\t\t\tpageCanvas.width = canvas.width;\n\t\t\t\t\t\tpageCanvas.height = sliceHeight;\n\n\t\t\t\t\t\tconst ctx = pageCanvas.getContext('2d');\n\n\t\t\t\t\t\t// Draw the slice of original canvas onto pageCanvas\n\t\t\t\t\t\tctx.drawImage(\n\t\t\t\t\t\t\tcanvas,\n\t\t\t\t\t\t\t0,\n\t\t\t\t\t\t\toffsetY,\n\t\t\t\t\t\t\tcanvas.width,\n\t\t\t\t\t\t\tsliceHeight,\n\t\t\t\t\t\t\t0,\n\t\t\t\t\t\t\t0,\n\t\t\t\t\t\t\tcanvas.width,\n\t\t\t\t\t\t\tsliceHeight\n\t\t\t\t\t\t);\n\n\t\t\t\t\t\tconst imgData = pageCanvas.toDataURL('image/jpeg', 0.7);\n\n\t\t\t\t\t\t// Calculate image height in PDF units keeping aspect ratio\n\t\t\t\t\t\tconst imgHeightMM = (sliceHeight * pageWidthMM) / canvas.width;\n\n\t\t\t\t\t\tif (page > 0) pdf.addPage();\n\n\t\t\t\t\t\tif (isDarkMode) {\n\t\t\t\t\t\t\tpdf.setFillColor(0, 0, 0);\n\t\t\t\t\t\t\tpdf.rect(0, 0, pageWidthMM, pageHeightMM, 'F'); // black bg\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tpdf.addImage(imgData, 'JPEG', 0, 0, pageWidthMM, imgHeightMM);\n\n\t\t\t\t\t\toffsetY += sliceHeight;\n\t\t\t\t\t\tpage++;\n\t\t\t\t\t}\n\n\t\t\t\t\tpdf.save(`chat-${chat.chat.title}.pdf`);\n\n\t\t\t\t\tshowFullMessages = false;\n\t\t\t\t} catch (error) {\n\t\t\t\t\tconsole.error('Error generating PDF', error);\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\tconsole.log('Downloading PDF');\n\n\t\t\tconst chatText = await getChatAsText();\n\n\t\t\tconst doc = new jsPDF();\n\n\t\t\t// Margins\n\t\t\tconst left = 15;\n\t\t\tconst top = 20;\n\t\t\tconst right = 15;\n\t\t\tconst bottom = 20;\n\n\t\t\tconst pageWidth = doc.internal.pageSize.getWidth();\n\t\t\tconst pageHeight = doc.internal.pageSize.getHeight();\n\t\t\tconst usableWidth = pageWidth - left - right;\n\t\t\tconst usableHeight = pageHeight - top - bottom;\n\n\t\t\t// Font size and line height\n\t\t\tconst fontSize = 8;\n\t\t\tdoc.setFontSize(fontSize);\n\t\t\tconst lineHeight = fontSize * 1; // adjust if needed\n\n\t\t\t// Split the markdown into lines (handles \\n)\n\t\t\tconst paragraphs = chatText.split('\\n');\n\n\t\t\tlet y = top;\n\n\t\t\tfor (let paragraph of paragraphs) {\n\t\t\t\t// Wrap each paragraph to fit the width\n\t\t\t\tconst lines = doc.splitTextToSize(paragraph, usableWidth);\n\n\t\t\t\tfor (let line of lines) {\n\t\t\t\t\t// If the line would overflow the bottom, add a new page\n\t\t\t\t\tif (y + lineHeight > pageHeight - bottom) {\n\t\t\t\t\t\tdoc.addPage();\n\t\t\t\t\t\ty = top;\n\t\t\t\t\t}\n\t\t\t\t\tdoc.text(line, left, y);\n\t\t\t\t\ty += lineHeight * 0.5;\n\t\t\t\t}\n\t\t\t\t// Add empty line at paragraph breaks\n\t\t\t\ty += lineHeight * 0.1;\n\t\t\t}\n\n\t\t\tdoc.save(`chat-${chat.chat.title}.pdf`);\n\t\t}\n\t};\n\n\tconst downloadJSONExport = async () => {\n\t\tif (chat.id) {\n\t\t\tlet chatObj = null;\n\n\t\t\tif ((chat?.id ?? '').startsWith('local') || $temporaryChatEnabled) {\n\t\t\t\tchatObj = chat;\n\t\t\t} else {\n\t\t\t\tchatObj = await getChatById(localStorage.token, chat.id);\n\t\t\t}\n\n\t\t\tlet blob = new Blob([JSON.stringify([chatObj])], {\n\t\t\t\ttype: 'application/json'\n\t\t\t});\n\t\t\tsaveAs(blob, `chat-export-${Date.now()}.json`);\n\t\t}\n\t};\n</script>\n\n{#if showFullMessages}\n\t<div class=\"hidden w-full h-full flex-col\">\n\t\t<div id=\"full-messages-container\">\n\t\t\t<Messages\n\t\t\t\tclassName=\"h-full flex pt-4 pb-8 w-full\"\n\t\t\t\tchatId={`chat-preview-${chat?.id ?? ''}`}\n\t\t\t\tuser={$user}\n\t\t\t\treadOnly={true}\n\t\t\t\thistory={chat.chat.history}\n\t\t\t\tmessages={chat.chat.messages}\n\t\t\t\tautoScroll={true}\n\t\t\t\tsendMessage={() => {}}\n\t\t\t\tcontinueResponse={() => {}}\n\t\t\t\tregenerateResponse={() => {}}\n\t\t\t\tmessagesCount={null}\n\t\t\t\teditCodeBlock={false}\n\t\t\t/>\n\t\t</div>\n\t</div>\n{/if}\n\n<Dropdown\n\ton:change={(e) => {\n\t\tif (e.detail === false) {\n\t\t\tonClose();\n\t\t}\n\t}}\n>\n\t<slot />\n\n\t<div slot=\"content\">\n\t\t<DropdownMenu.Content\n\t\t\tclass=\"w-full max-w-[200px] rounded-2xl px-1 py-1  border border-gray-100  dark:border-gray-800 z-50 bg-white dark:bg-gray-850 dark:text-white shadow-lg transition\"\n\t\t\tsideOffset={8}\n\t\t\tside=\"bottom\"\n\t\t\talign=\"end\"\n\t\t\ttransition={flyAndScale}\n\t\t>\n\t\t\t<!-- <DropdownMenu.Item\n\t\t\t\tclass=\"flex gap-2 items-center px-3 py-1.5 text-sm  cursor-pointer dark:hover:bg-gray-800 rounded-xl\"\n\t\t\t\ton:click={async () => {\n\t\t\t\t\tawait showSettings.set(!$showSettings);\n\t\t\t\t}}\n\t\t\t>\n\t\t\t\t<svg\n\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\tfill=\"none\"\n\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\tstroke-width=\"1.5\"\n\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\tclass=\"size-4\"\n\t\t\t\t>\n\t\t\t\t\t<path\n\t\t\t\t\t\tstroke-linecap=\"round\"\n\t\t\t\t\t\tstroke-linejoin=\"round\"\n\t\t\t\t\t\td=\"M9.594 3.94c.09-.542.56-.94 1.11-.94h2.593c.55 0 1.02.398 1.11.94l.213 1.281c.063.374.313.686.645.87.074.04.147.083.22.127.325.196.72.257 1.075.124l1.217-.456a1.125 1.125 0 0 1 1.37.49l1.296 2.247a1.125 1.125 0 0 1-.26 1.431l-1.003.827c-.293.241-.438.613-.43.992a7.723 7.723 0 0 1 0 .255c-.008.378.137.75.43.991l1.004.827c.424.35.534.955.26 1.43l-1.298 2.247a1.125 1.125 0 0 1-1.369.491l-1.217-.456c-.355-.133-.75-.072-1.076.124a6.47 6.47 0 0 1-.22.128c-.331.183-.581.495-.644.869l-.213 1.281c-.09.543-.56.94-1.11.94h-2.594c-.55 0-1.019-.398-1.11-.94l-.213-1.281c-.062-.374-.312-.686-.644-.87a6.52 6.52 0 0 1-.22-.127c-.325-.196-.72-.257-1.076-.124l-1.217.456a1.125 1.125 0 0 1-1.369-.49l-1.297-2.247a1.125 1.125 0 0 1 .26-1.431l1.004-.827c.292-.24.437-.613.43-.991a6.932 6.932 0 0 1 0-.255c.007-.38-.138-.751-.43-.992l-1.004-.827a1.125 1.125 0 0 1-.26-1.43l1.297-2.247a1.125 1.125 0 0 1 1.37-.491l1.216.456c.356.133.751.072 1.076-.124.072-.044.146-.086.22-.128.332-.183.582-.495.644-.869l.214-1.28Z\"\n\t\t\t\t\t/>\n\t\t\t\t\t<path\n\t\t\t\t\t\tstroke-linecap=\"round\"\n\t\t\t\t\t\tstroke-linejoin=\"round\"\n\t\t\t\t\t\td=\"M15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z\"\n\t\t\t\t\t/>\n\t\t\t\t</svg>\n\t\t\t\t<div class=\"flex items-center\">{$i18n.t('Settings')}</div>\n\t\t\t</DropdownMenu.Item> -->\n\n\t\t\t{#if $mobile && ($user?.role === 'admin' || ($user?.permissions.chat?.controls ?? true))}\n\t\t\t\t<DropdownMenu.Item\n\t\t\t\t\tclass=\"flex gap-2 items-center px-3 py-1.5 text-sm cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 rounded-xl select-none w-full\"\n\t\t\t\t\tid=\"chat-controls-button\"\n\t\t\t\t\ton:click={async () => {\n\t\t\t\t\t\tawait showControls.set(true);\n\t\t\t\t\t\tawait showOverview.set(false);\n\t\t\t\t\t\tawait showArtifacts.set(false);\n\t\t\t\t\t\tawait showEmbeds.set(false);\n\t\t\t\t\t}}\n\t\t\t\t>\n\t\t\t\t\t<AdjustmentsHorizontal className=\" size-4\" strokeWidth=\"1.5\" />\n\t\t\t\t\t<div class=\"flex items-center\">{$i18n.t('Controls')}</div>\n\t\t\t\t</DropdownMenu.Item>\n\t\t\t{/if}\n\n\t\t\t<DropdownMenu.Item\n\t\t\t\tclass=\"flex gap-2 items-center px-3 py-1.5 text-sm cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 rounded-xl select-none w-full\"\n\t\t\t\tid=\"chat-overview-button\"\n\t\t\t\ton:click={async () => {\n\t\t\t\t\tawait showControls.set(true);\n\t\t\t\t\tawait showOverview.set(true);\n\t\t\t\t\tawait showArtifacts.set(false);\n\t\t\t\t\tawait showEmbeds.set(false);\n\t\t\t\t}}\n\t\t\t>\n\t\t\t\t<Map className=\" size-4\" strokeWidth=\"1.5\" />\n\t\t\t\t<div class=\"flex items-center\">{$i18n.t('Overview')}</div>\n\t\t\t</DropdownMenu.Item>\n\n\t\t\t{#if ($artifactContents ?? []).length > 0}\n\t\t\t\t<DropdownMenu.Item\n\t\t\t\t\tclass=\"flex gap-2 items-center px-3 py-1.5 text-sm cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 rounded-xl select-none w-full\"\n\t\t\t\t\tid=\"chat-overview-button\"\n\t\t\t\t\ton:click={async () => {\n\t\t\t\t\t\tawait showControls.set(true);\n\t\t\t\t\t\tawait showArtifacts.set(true);\n\t\t\t\t\t\tawait showOverview.set(false);\n\t\t\t\t\t\tawait showEmbeds.set(false);\n\t\t\t\t\t}}\n\t\t\t\t>\n\t\t\t\t\t<Cube className=\" size-4\" strokeWidth=\"1.5\" />\n\t\t\t\t\t<div class=\"flex items-center\">{$i18n.t('Artifacts')}</div>\n\t\t\t\t</DropdownMenu.Item>\n\t\t\t{/if}\n\n\t\t\t<hr class=\"border-gray-50/30 dark:border-gray-800/30 my-1\" />\n\n\t\t\t{#if !$temporaryChatEnabled && ($user?.role === 'admin' || ($user.permissions?.chat?.share ?? true))}\n\t\t\t\t<DropdownMenu.Item\n\t\t\t\t\tclass=\"flex gap-2 items-center px-3 py-1.5 text-sm cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 rounded-xl select-none w-full\"\n\t\t\t\t\tid=\"chat-share-button\"\n\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\tshareHandler();\n\t\t\t\t\t}}\n\t\t\t\t>\n\t\t\t\t\t<Share strokeWidth=\"1.5\" />\n\t\t\t\t\t<div class=\"flex items-center\">{$i18n.t('Share')}</div>\n\t\t\t\t</DropdownMenu.Item>\n\t\t\t{/if}\n\n\t\t\t<DropdownMenu.Sub>\n\t\t\t\t<DropdownMenu.SubTrigger\n\t\t\t\t\tclass=\"flex gap-2 items-center px-3 py-1.5 text-sm cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 rounded-xl select-none w-full\"\n\t\t\t\t>\n\t\t\t\t\t<Download strokeWidth=\"1.5\" />\n\n\t\t\t\t\t<div class=\"flex items-center\">{$i18n.t('Download')}</div>\n\t\t\t\t</DropdownMenu.SubTrigger>\n\t\t\t\t<DropdownMenu.SubContent\n\t\t\t\t\tclass=\"w-full rounded-2xl p-1 z-50 bg-white dark:bg-gray-850 dark:text-white border border-gray-100  dark:border-gray-800 shadow-lg max-h-52 overflow-y-auto scrollbar-hidden\"\n\t\t\t\t\ttransition={flyAndScale}\n\t\t\t\t\tsideOffset={8}\n\t\t\t\t>\n\t\t\t\t\t{#if $user?.role === 'admin' || ($user.permissions?.chat?.export ?? true)}\n\t\t\t\t\t\t<DropdownMenu.Item\n\t\t\t\t\t\t\tclass=\"flex gap-2 items-center px-3 py-1.5 text-sm cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 rounded-xl select-none w-full\"\n\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\tdownloadJSONExport();\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<div class=\"flex items-center line-clamp-1\">{$i18n.t('Export chat (.json)')}</div>\n\t\t\t\t\t\t</DropdownMenu.Item>\n\t\t\t\t\t{/if}\n\t\t\t\t\t<DropdownMenu.Item\n\t\t\t\t\t\tclass=\"flex gap-2 items-center px-3 py-1.5 text-sm cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 rounded-xl select-none w-full\"\n\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\tdownloadTxt();\n\t\t\t\t\t\t}}\n\t\t\t\t\t>\n\t\t\t\t\t\t<div class=\"flex items-center line-clamp-1\">{$i18n.t('Plain text (.txt)')}</div>\n\t\t\t\t\t</DropdownMenu.Item>\n\n\t\t\t\t\t<DropdownMenu.Item\n\t\t\t\t\t\tclass=\"flex gap-2 items-center px-3 py-1.5 text-sm cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 rounded-xl select-none w-full\"\n\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\tdownloadPdf();\n\t\t\t\t\t\t}}\n\t\t\t\t\t>\n\t\t\t\t\t\t<div class=\"flex items-center line-clamp-1\">{$i18n.t('PDF document (.pdf)')}</div>\n\t\t\t\t\t</DropdownMenu.Item>\n\t\t\t\t</DropdownMenu.SubContent>\n\t\t\t</DropdownMenu.Sub>\n\n\t\t\t<DropdownMenu.Item\n\t\t\t\tclass=\"flex gap-2 items-center px-3 py-1.5 text-sm cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 rounded-xl select-none w-full\"\n\t\t\t\tid=\"chat-copy-button\"\n\t\t\t\ton:click={async () => {\n\t\t\t\t\tconst res = await copyToClipboard(await getChatAsText()).catch((e) => {\n\t\t\t\t\t\tconsole.error(e);\n\t\t\t\t\t});\n\n\t\t\t\t\tif (res) {\n\t\t\t\t\t\ttoast.success($i18n.t('Copied to clipboard'));\n\t\t\t\t\t}\n\t\t\t\t}}\n\t\t\t>\n\t\t\t\t<Clipboard className=\" size-4\" strokeWidth=\"1.5\" />\n\t\t\t\t<div class=\"flex items-center\">{$i18n.t('Copy')}</div>\n\t\t\t</DropdownMenu.Item>\n\n\t\t\t{#if !$temporaryChatEnabled && chat?.id}\n\t\t\t\t<hr class=\"border-gray-50/30 dark:border-gray-800/30 my-1\" />\n\n\t\t\t\t{#if $folders.length > 0}\n\t\t\t\t\t<DropdownMenu.Sub>\n\t\t\t\t\t\t<DropdownMenu.SubTrigger\n\t\t\t\t\t\t\tclass=\"flex gap-2 items-center px-3 py-1.5 text-sm cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 rounded-xl select-none w-full\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<Folder strokeWidth=\"1.5\" />\n\n\t\t\t\t\t\t\t<div class=\"flex items-center\">{$i18n.t('Move')}</div>\n\t\t\t\t\t\t</DropdownMenu.SubTrigger>\n\t\t\t\t\t\t<DropdownMenu.SubContent\n\t\t\t\t\t\t\tclass=\"w-full rounded-2xl p-1 z-50 bg-white dark:bg-gray-850 dark:text-white border border-gray-100  dark:border-gray-800 shadow-lg max-h-52 overflow-y-auto scrollbar-hidden\"\n\t\t\t\t\t\t\ttransition={flyAndScale}\n\t\t\t\t\t\t\tsideOffset={8}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{#each $folders.sort((a, b) => b.updated_at - a.updated_at) as folder}\n\t\t\t\t\t\t\t\t{#if folder?.id}\n\t\t\t\t\t\t\t\t\t<DropdownMenu.Item\n\t\t\t\t\t\t\t\t\t\tclass=\"flex gap-2 items-center px-3 py-1.5 text-sm cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 rounded-xl\"\n\t\t\t\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\t\t\t\tmoveChatHandler(chat.id, folder.id);\n\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t<Folder strokeWidth=\"1.5\" />\n\n\t\t\t\t\t\t\t\t\t\t<div class=\"flex items-center\">{folder.name ?? 'Folder'}</div>\n\t\t\t\t\t\t\t\t\t</DropdownMenu.Item>\n\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t{/each}\n\t\t\t\t\t\t</DropdownMenu.SubContent>\n\t\t\t\t\t</DropdownMenu.Sub>\n\t\t\t\t{/if}\n\n\t\t\t\t<DropdownMenu.Item\n\t\t\t\t\tclass=\"flex gap-2 items-center px-3 py-1.5 text-sm  cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 rounded-xl\"\n\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\tarchiveChatHandler();\n\t\t\t\t\t}}\n\t\t\t\t>\n\t\t\t\t\t<ArchiveBox className=\"size-4\" strokeWidth=\"1.5\" />\n\t\t\t\t\t<div class=\"flex items-center\">{$i18n.t('Archive')}</div>\n\t\t\t\t</DropdownMenu.Item>\n\n\t\t\t\t<hr class=\"border-gray-50/30 dark:border-gray-800/30 my-1\" />\n\n\t\t\t\t<div class=\"flex p-1\">\n\t\t\t\t\t<Tags chatId={chat.id} />\n\t\t\t\t</div>\n\t\t\t{/if}\n\t\t</DropdownMenu.Content>\n\t</div>\n</Dropdown>\n","<script lang=\"ts\">\n\texport let className = 'size-4';\n\texport let strokeWidth = '1.5';\n</script>\n\n<svg\n\txmlns=\"http://www.w3.org/2000/svg\"\n\tfill=\"none\"\n\tviewBox=\"0 0 24 24\"\n\tstroke-width={strokeWidth}\n\tstroke=\"currentColor\"\n\tclass={className}\n>\n\t<path\n\t\td=\"M12 22C17.5228 22 22 17.5228 22 12C22 6.47715 17.5228 2 12 2C6.47715 2 2 6.47715 2 12C2 13.8214 2.48697 15.5291 3.33782 17L2.5 21.5L7 20.6622C8.47087 21.513 10.1786 22 12 22Z\"\n\t\tstroke-linecap=\"round\"\n\t\tstroke-linejoin=\"round\"\n\t\tstroke-dasharray=\"2.5 3.5\"\n\t></path>\n</svg>\n","<script lang=\"ts\">\n\texport let className = 'size-4';\n\texport let strokeWidth = '1.5';\n</script>\n\n<svg\n\txmlns=\"http://www.w3.org/2000/svg\"\n\tfill=\"none\"\n\tviewBox=\"0 0 24 24\"\n\tstroke-width={strokeWidth}\n\tstroke=\"currentColor\"\n\tclass={className}\n>\n\t<path d=\"M8 12L11 15L16 10\" stroke-linecap=\"round\" stroke-linejoin=\"round\"></path>\n\t<path\n\t\td=\"M12 22C17.5228 22 22 17.5228 22 12C22 6.47715 17.5228 2 12 2C6.47715 2 2 6.47715 2 12C2 13.8214 2.48697 15.5291 3.33782 17L2.5 21.5L7 20.6622C8.47087 21.513 10.1786 22 12 22Z\"\n\t\tstroke-linecap=\"round\"\n\t\tstroke-linejoin=\"round\"\n\t\tstroke-dasharray=\"2.5 3.5\"\n\t></path>\n</svg>\n","<script lang=\"ts\">\n\texport let className = 'w-4 h-4';\n\texport let strokeWidth = '1.5';\n</script>\n\n<svg\n\txmlns=\"http://www.w3.org/2000/svg\"\n\tfill=\"none\"\n\tviewBox=\"0 0 24 24\"\n\tstroke-width={strokeWidth}\n\tstroke=\"currentColor\"\n\tclass={className}\n\t><path d=\"M9 12H12M15 12H12M12 12V9M12 12V15\" stroke-linecap=\"round\" stroke-linejoin=\"round\"\n\t></path><path\n\t\td=\"M12 22C17.5228 22 22 17.5228 22 12C22 6.47715 17.5228 2 12 2C6.47715 2 2 6.47715 2 12C2 13.8214 2.48697 15.5291 3.33782 17L2.5 21.5L7 20.6622C8.47087 21.513 10.1786 22 12 22Z\"\n\t\tstroke-linecap=\"round\"\n\t\tstroke-linejoin=\"round\"\n\t></path></svg\n>\n","<script lang=\"ts\">\n\texport let className = 'w-4 h-4';\n\texport let strokeWidth = '1.5';\n</script>\n\n<svg\n\txmlns=\"http://www.w3.org/2000/svg\"\n\tfill=\"none\"\n\tviewBox=\"0 0 24 24\"\n\tstroke-width={strokeWidth}\n\tstroke=\"currentColor\"\n\tclass={className}\n\t><path d=\"M8 12L11 15L16 10\" stroke-linecap=\"round\" stroke-linejoin=\"round\"></path><path\n\t\td=\"M12 22C17.5228 22 22 17.5228 22 12C22 6.47715 17.5228 2 12 2C6.47715 2 2 6.47715 2 12C2 13.8214 2.48697 15.5291 3.33782 17L2.5 21.5L7 20.6622C8.47087 21.513 10.1786 22 12 22Z\"\n\t\tstroke-linecap=\"round\"\n\t\tstroke-linejoin=\"round\"\n\t></path></svg\n>\n","<script lang=\"ts\">\n\timport { getContext } from 'svelte';\n\timport { toast } from 'svelte-sonner';\n\n\timport {\n\t\tWEBUI_NAME,\n\t\tbanners,\n\t\tchatId,\n\t\tconfig,\n\t\tmobile,\n\t\tsettings,\n\t\tshowArchivedChats,\n\t\tshowControls,\n\t\tshowSidebar,\n\t\ttemporaryChatEnabled,\n\t\tuser\n\t} from '$lib/stores';\n\n\timport { slide } from 'svelte/transition';\n\timport { page } from '$app/stores';\n\timport { goto } from '$app/navigation';\n\n\timport ShareChatModal from '../chat/ShareChatModal.svelte';\n\timport ModelSelector from '../chat/ModelSelector.svelte';\n\timport Tooltip from '../common/Tooltip.svelte';\n\timport Menu from '$lib/components/layout/Navbar/Menu.svelte';\n\timport UserMenu from '$lib/components/layout/Sidebar/UserMenu.svelte';\n\timport AdjustmentsHorizontal from '../icons/AdjustmentsHorizontal.svelte';\n\n\timport PencilSquare from '../icons/PencilSquare.svelte';\n\timport Banner from '../common/Banner.svelte';\n\timport Sidebar from '../icons/Sidebar.svelte';\n\n\timport ChatBubbleDotted from '../icons/ChatBubbleDotted.svelte';\n\timport ChatBubbleDottedChecked from '../icons/ChatBubbleDottedChecked.svelte';\n\n\timport EllipsisHorizontal from '../icons/EllipsisHorizontal.svelte';\n\timport ChatPlus from '../icons/ChatPlus.svelte';\n\timport ChatCheck from '../icons/ChatCheck.svelte';\n\timport Knobs from '../icons/Knobs.svelte';\n\timport { WEBUI_API_BASE_URL } from '$lib/constants';\n\n\tconst i18n = getContext('i18n');\n\n\texport let initNewChat: Function;\n\texport let shareEnabled: boolean = false;\n\texport let scrollTop = 0;\n\n\texport let chat;\n\texport let history;\n\texport let selectedModels;\n\texport let showModelSelector = true;\n\n\texport let onSaveTempChat: () => {};\n\texport let archiveChatHandler: (id: string) => void;\n\texport let moveChatHandler: (id: string, folderId: string) => void;\n\n\tlet closedBannerIds = [];\n\n\tlet showShareChatModal = false;\n\tlet showDownloadChatModal = false;\n</script>\n\n<ShareChatModal bind:show={showShareChatModal} chatId={$chatId} />\n\n<button\n\tid=\"new-chat-button\"\n\tclass=\"hidden\"\n\ton:click={() => {\n\t\tinitNewChat();\n\t}}\n\taria-label=\"New Chat\"\n/>\n\n<nav\n\tclass=\"sticky top-0 z-30 w-full {chat?.id\n\t\t? 'pt-0.5 pb-1'\n\t\t: 'pt-1 pb-1'} -mb-12 flex flex-col items-center drag-region\"\n>\n\t<div class=\"flex items-center w-full pl-1.5 pr-1\">\n\t\t<div\n\t\t\tid=\"navbar-bg-gradient-to-b\"\n\t\t\tclass=\"{chat?.id\n\t\t\t\t? 'visible'\n\t\t\t\t: 'invisible'} bg-linear-to-b via-40% to-97% from-white/90 via-white/50 to-transparent dark:from-gray-900/90 dark:via-gray-900/50 dark:to-transparent pointer-events-none absolute inset-0 -bottom-10 z-[-1]\"\n\t\t></div>\n\n\t\t<div class=\" flex max-w-full w-full mx-auto px-1.5 md:px-2 pt-0.5 bg-transparent\">\n\t\t\t<div class=\"flex items-center w-full max-w-full\">\n\t\t\t\t{#if $mobile && !$showSidebar}\n\t\t\t\t\t<div\n\t\t\t\t\t\tclass=\"-translate-x-0.5 mr-1 mt-1 self-start flex flex-none items-center text-gray-600 dark:text-gray-400\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<Tooltip content={$showSidebar ? $i18n.t('Close Sidebar') : $i18n.t('Open Sidebar')}>\n\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\tclass=\" cursor-pointer flex rounded-lg hover:bg-gray-100 dark:hover:bg-gray-850 transition\"\n\t\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\t\tshowSidebar.set(!$showSidebar);\n\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<div class=\" self-center p-1.5\">\n\t\t\t\t\t\t\t\t\t<Sidebar />\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t</Tooltip>\n\t\t\t\t\t</div>\n\t\t\t\t{/if}\n\n\t\t\t\t<div\n\t\t\t\t\tclass=\"flex-1 overflow-hidden max-w-full py-0.5\n\t\t\t{$showSidebar ? 'ml-1' : ''}\n\t\t\t\"\n\t\t\t\t>\n\t\t\t\t\t{#if showModelSelector}\n\t\t\t\t\t\t<ModelSelector bind:selectedModels showSetDefault={!shareEnabled} />\n\t\t\t\t\t{/if}\n\t\t\t\t</div>\n\n\t\t\t\t<div class=\"self-start flex flex-none items-center text-gray-600 dark:text-gray-400\">\n\t\t\t\t\t<!-- <div class=\"md:hidden flex self-center w-[1px] h-5 mx-2 bg-gray-300 dark:bg-stone-700\" /> -->\n\n\t\t\t\t\t{#if $user?.role === 'user' ? ($user?.permissions?.chat?.temporary ?? true) && !($user?.permissions?.chat?.temporary_enforced ?? false) : true}\n\t\t\t\t\t\t{#if !chat?.id}\n\t\t\t\t\t\t\t<Tooltip content={$i18n.t(`Temporary Chat`)}>\n\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\tclass=\"flex cursor-pointer px-2 py-2 rounded-xl hover:bg-gray-50 dark:hover:bg-gray-850 transition\"\n\t\t\t\t\t\t\t\t\tid=\"temporary-chat-button\"\n\t\t\t\t\t\t\t\t\ton:click={async () => {\n\t\t\t\t\t\t\t\t\t\tif (($settings?.temporaryChatByDefault ?? false) && $temporaryChatEnabled) {\n\t\t\t\t\t\t\t\t\t\t\t// for proper initNewChat handling\n\t\t\t\t\t\t\t\t\t\t\tawait temporaryChatEnabled.set(null);\n\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\tawait temporaryChatEnabled.set(!$temporaryChatEnabled);\n\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\tawait goto('/');\n\n\t\t\t\t\t\t\t\t\t\t// add 'temporary-chat=true' to the URL\n\t\t\t\t\t\t\t\t\t\tif ($temporaryChatEnabled) {\n\t\t\t\t\t\t\t\t\t\t\twindow.history.replaceState(null, '', '?temporary-chat=true');\n\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\twindow.history.replaceState(null, '', location.pathname);\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<div class=\" m-auto self-center\">\n\t\t\t\t\t\t\t\t\t\t{#if $temporaryChatEnabled}\n\t\t\t\t\t\t\t\t\t\t\t<ChatBubbleDottedChecked className=\" size-4.5\" strokeWidth=\"1.5\" />\n\t\t\t\t\t\t\t\t\t\t{:else}\n\t\t\t\t\t\t\t\t\t\t\t<ChatBubbleDotted className=\" size-4.5\" strokeWidth=\"1.5\" />\n\t\t\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t</Tooltip>\n\t\t\t\t\t\t{:else if $temporaryChatEnabled}\n\t\t\t\t\t\t\t<Tooltip content={$i18n.t(`Save Chat`)}>\n\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\tclass=\"flex cursor-pointer px-2 py-2 rounded-xl hover:bg-gray-50 dark:hover:bg-gray-850 transition\"\n\t\t\t\t\t\t\t\t\tid=\"save-temporary-chat-button\"\n\t\t\t\t\t\t\t\t\ton:click={async () => {\n\t\t\t\t\t\t\t\t\t\tonSaveTempChat();\n\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<div class=\" m-auto self-center\">\n\t\t\t\t\t\t\t\t\t\t<ChatCheck className=\" size-4.5\" strokeWidth=\"1.5\" />\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t</Tooltip>\n\t\t\t\t\t\t{/if}\n\t\t\t\t\t{/if}\n\n\t\t\t\t\t{#if $mobile && !$temporaryChatEnabled && chat && chat.id}\n\t\t\t\t\t\t<Tooltip content={$i18n.t('New Chat')}>\n\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\tclass=\" flex {$showSidebar\n\t\t\t\t\t\t\t\t\t? 'md:hidden'\n\t\t\t\t\t\t\t\t\t: ''} cursor-pointer px-2 py-2 rounded-xl text-gray-600 dark:text-gray-400 hover:bg-gray-50 dark:hover:bg-gray-850 transition\"\n\t\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\t\tinitNewChat();\n\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\taria-label=\"New Chat\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<div class=\" m-auto self-center\">\n\t\t\t\t\t\t\t\t\t<ChatPlus className=\" size-4.5\" strokeWidth=\"1.5\" />\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t</Tooltip>\n\t\t\t\t\t{/if}\n\n\t\t\t\t\t{#if shareEnabled && chat && (chat.id || $temporaryChatEnabled)}\n\t\t\t\t\t\t<Menu\n\t\t\t\t\t\t\t{chat}\n\t\t\t\t\t\t\t{shareEnabled}\n\t\t\t\t\t\t\tshareHandler={() => {\n\t\t\t\t\t\t\t\tshowShareChatModal = !showShareChatModal;\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\tarchiveChatHandler={() => {\n\t\t\t\t\t\t\t\tarchiveChatHandler(chat.id);\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t{moveChatHandler}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\tclass=\"flex cursor-pointer px-2 py-2 rounded-xl hover:bg-gray-50 dark:hover:bg-gray-850 transition\"\n\t\t\t\t\t\t\t\tid=\"chat-context-menu-button\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<div class=\" m-auto self-center\">\n\t\t\t\t\t\t\t\t\t<EllipsisHorizontal className=\" size-5\" strokeWidth=\"1.5\" />\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t</Menu>\n\t\t\t\t\t{/if}\n\n\t\t\t\t\t{#if $user?.role === 'admin' || ($user?.permissions.chat?.controls ?? true)}\n\t\t\t\t\t\t<Tooltip content={$i18n.t('Controls')}>\n\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\tclass=\" flex cursor-pointer px-2 py-2 rounded-xl hover:bg-gray-50 dark:hover:bg-gray-850 transition\"\n\t\t\t\t\t\t\t\ton:click={async () => {\n\t\t\t\t\t\t\t\t\tawait showControls.set(!$showControls);\n\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\taria-label=\"Controls\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<div class=\" m-auto self-center\">\n\t\t\t\t\t\t\t\t\t<Knobs className=\" size-5\" strokeWidth=\"1\" />\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t</Tooltip>\n\t\t\t\t\t{/if}\n\n\t\t\t\t\t{#if $user !== undefined && $user !== null}\n\t\t\t\t\t\t<UserMenu\n\t\t\t\t\t\t\tclassName=\"max-w-[240px]\"\n\t\t\t\t\t\t\trole={$user?.role}\n\t\t\t\t\t\t\thelp={true}\n\t\t\t\t\t\t\ton:show={(e) => {\n\t\t\t\t\t\t\t\tif (e.detail === 'archived-chat') {\n\t\t\t\t\t\t\t\t\tshowArchivedChats.set(true);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\tclass=\"select-none flex rounded-xl p-1.5 w-full hover:bg-gray-50 dark:hover:bg-gray-850 transition\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<div class=\" self-center\">\n\t\t\t\t\t\t\t\t\t<span class=\"sr-only\">{$i18n.t('User menu')}</span>\n\t\t\t\t\t\t\t\t\t<img\n\t\t\t\t\t\t\t\t\t\tsrc={`${WEBUI_API_BASE_URL}/users/${$user?.id}/profile/image`}\n\t\t\t\t\t\t\t\t\t\tclass=\"size-6 object-cover rounded-full\"\n\t\t\t\t\t\t\t\t\t\talt=\"\"\n\t\t\t\t\t\t\t\t\t\tdraggable=\"false\"\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</UserMenu>\n\t\t\t\t\t{/if}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n\n\t{#if $temporaryChatEnabled && ($chatId ?? '').startsWith('local:')}\n\t\t<div class=\" w-full z-30 text-center\">\n\t\t\t<div class=\"text-xs text-gray-500\">{$i18n.t('Temporary Chat')}</div>\n\t\t</div>\n\t{/if}\n\n\t<div class=\"absolute top-[100%] left-0 right-0 h-fit\">\n\t\t{#if !history.currentId && !$chatId && ($banners.length > 0 || ($config?.license_metadata?.type ?? null) === 'trial' || (($config?.license_metadata?.seats ?? null) !== null && $config?.user_count > $config?.license_metadata?.seats))}\n\t\t\t<div class=\" w-full z-30\">\n\t\t\t\t<div class=\" flex flex-col gap-1 w-full\">\n\t\t\t\t\t{#if ($config?.license_metadata?.type ?? null) === 'trial'}\n\t\t\t\t\t\t<Banner\n\t\t\t\t\t\t\tbanner={{\n\t\t\t\t\t\t\t\ttype: 'info',\n\t\t\t\t\t\t\t\ttitle: 'Trial License',\n\t\t\t\t\t\t\t\tcontent: $i18n.t(\n\t\t\t\t\t\t\t\t\t'You are currently using a trial license. Please contact support to upgrade your license.'\n\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t/>\n\t\t\t\t\t{/if}\n\n\t\t\t\t\t{#if ($config?.license_metadata?.seats ?? null) !== null && $config?.user_count > $config?.license_metadata?.seats}\n\t\t\t\t\t\t<Banner\n\t\t\t\t\t\t\tbanner={{\n\t\t\t\t\t\t\t\ttype: 'error',\n\t\t\t\t\t\t\t\ttitle: 'License Error',\n\t\t\t\t\t\t\t\tcontent: $i18n.t(\n\t\t\t\t\t\t\t\t\t'Exceeded the number of seats in your license. Please contact support to increase the number of seats.'\n\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t/>\n\t\t\t\t\t{/if}\n\n\t\t\t\t\t{#each $banners.filter((b) => ![...JSON.parse(localStorage.getItem('dismissedBannerIds') ?? '[]'), ...closedBannerIds].includes(b.id)) as banner (banner.id)}\n\t\t\t\t\t\t<Banner\n\t\t\t\t\t\t\t{banner}\n\t\t\t\t\t\t\ton:dismiss={(e) => {\n\t\t\t\t\t\t\t\tconst bannerId = e.detail;\n\n\t\t\t\t\t\t\t\tif (banner.dismissible) {\n\t\t\t\t\t\t\t\t\tlocalStorage.setItem(\n\t\t\t\t\t\t\t\t\t\t'dismissedBannerIds',\n\t\t\t\t\t\t\t\t\t\tJSON.stringify(\n\t\t\t\t\t\t\t\t\t\t\t[\n\t\t\t\t\t\t\t\t\t\t\t\tbannerId,\n\t\t\t\t\t\t\t\t\t\t\t\t...JSON.parse(localStorage.getItem('dismissedBannerIds') ?? '[]')\n\t\t\t\t\t\t\t\t\t\t\t].filter((id) => $banners.find((b) => b.id === id))\n\t\t\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tclosedBannerIds = [...closedBannerIds, bannerId];\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t/>\n\t\t\t\t\t{/each}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t{/if}\n\t</div>\n</nav>\n","<script lang=\"ts\">\n\timport { toast } from 'svelte-sonner';\n\n\timport { config, functions, models, settings, tools, user } from '$lib/stores';\n\timport { createEventDispatcher, onMount, getContext, tick } from 'svelte';\n\n\timport {\n\t\tgetUserValvesSpecById as getToolUserValvesSpecById,\n\t\tgetUserValvesById as getToolUserValvesById,\n\t\tupdateUserValvesById as updateToolUserValvesById,\n\t\tgetTools\n\t} from '$lib/apis/tools';\n\timport {\n\t\tgetUserValvesSpecById as getFunctionUserValvesSpecById,\n\t\tgetUserValvesById as getFunctionUserValvesById,\n\t\tupdateUserValvesById as updateFunctionUserValvesById,\n\t\tgetFunctions\n\t} from '$lib/apis/functions';\n\n\timport Tooltip from '$lib/components/common/Tooltip.svelte';\n\timport Spinner from '$lib/components/common/Spinner.svelte';\n\timport Valves from '$lib/components/common/Valves.svelte';\n\n\tconst dispatch = createEventDispatcher();\n\n\tconst i18n = getContext('i18n');\n\n\texport let show = false;\n\n\tlet tab = 'tools';\n\tlet selectedId = '';\n\n\tlet loading = false;\n\n\tlet valvesSpec = null;\n\tlet valves = {};\n\n\tlet debounceTimer;\n\n\tconst debounceSubmitHandler = async () => {\n\t\tif (debounceTimer) {\n\t\t\tclearTimeout(debounceTimer);\n\t\t}\n\n\t\t// Set a new timer\n\t\tdebounceTimer = setTimeout(() => {\n\t\t\tsubmitHandler();\n\t\t}, 500); // 0.5 second debounce\n\t};\n\n\tconst getUserValves = async () => {\n\t\tloading = true;\n\t\tif (tab === 'tools') {\n\t\t\tvalves = await getToolUserValvesById(localStorage.token, selectedId);\n\t\t\tvalvesSpec = await getToolUserValvesSpecById(localStorage.token, selectedId);\n\t\t} else if (tab === 'functions') {\n\t\t\tvalves = await getFunctionUserValvesById(localStorage.token, selectedId);\n\t\t\tvalvesSpec = await getFunctionUserValvesSpecById(localStorage.token, selectedId);\n\t\t}\n\n\t\tif (valvesSpec) {\n\t\t\t// Convert array to string\n\t\t\tfor (const property in valvesSpec.properties) {\n\t\t\t\tif (valvesSpec.properties[property]?.type === 'array') {\n\t\t\t\t\tvalves[property] = (valves[property] ?? []).join(',');\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tloading = false;\n\t};\n\n\tconst submitHandler = async () => {\n\t\tif (valvesSpec) {\n\t\t\t// Convert string to array\n\t\t\tfor (const property in valvesSpec.properties) {\n\t\t\t\tif (valvesSpec.properties[property]?.type === 'array') {\n\t\t\t\t\tvalves[property] = (valves[property] ?? '').split(',').map((v) => v.trim());\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (tab === 'tools') {\n\t\t\t\tconst res = await updateToolUserValvesById(localStorage.token, selectedId, valves).catch(\n\t\t\t\t\t(error) => {\n\t\t\t\t\t\ttoast.error(`${error}`);\n\t\t\t\t\t\treturn null;\n\t\t\t\t\t}\n\t\t\t\t);\n\n\t\t\t\tif (res) {\n\t\t\t\t\ttoast.success($i18n.t('Valves updated'));\n\t\t\t\t\tvalves = res;\n\t\t\t\t}\n\t\t\t} else if (tab === 'functions') {\n\t\t\t\tconst res = await updateFunctionUserValvesById(\n\t\t\t\t\tlocalStorage.token,\n\t\t\t\t\tselectedId,\n\t\t\t\t\tvalves\n\t\t\t\t).catch((error) => {\n\t\t\t\t\ttoast.error(`${error}`);\n\t\t\t\t\treturn null;\n\t\t\t\t});\n\n\t\t\t\tif (res) {\n\t\t\t\t\ttoast.success($i18n.t('Valves updated'));\n\t\t\t\t\tvalves = res;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t};\n\n\t$: if (tab) {\n\t\tselectedId = '';\n\t}\n\n\t$: if (selectedId) {\n\t\tgetUserValves();\n\t}\n\n\t$: if (show) {\n\t\tinit();\n\t}\n\n\tconst init = async () => {\n\t\tloading = true;\n\n\t\tif ($functions === null) {\n\t\t\tfunctions.set(await getFunctions(localStorage.token));\n\t\t}\n\t\tif ($tools === null) {\n\t\t\ttools.set(await getTools(localStorage.token));\n\t\t}\n\n\t\tloading = false;\n\t};\n</script>\n\n{#if show && !loading}\n\t<form\n\t\tclass=\"flex flex-col h-full justify-between space-y-3 text-sm\"\n\t\ton:submit|preventDefault={() => {\n\t\t\tsubmitHandler();\n\t\t\tdispatch('save');\n\t\t}}\n\t>\n\t\t<div class=\"flex flex-col\">\n\t\t\t<div class=\"space-y-1\">\n\t\t\t\t<div class=\"flex gap-2\">\n\t\t\t\t\t<div class=\"flex-1\">\n\t\t\t\t\t\t<select\n\t\t\t\t\t\t\tclass=\"  w-full rounded-sm text-xs py-2 px-1 bg-transparent outline-hidden\"\n\t\t\t\t\t\t\tbind:value={tab}\n\t\t\t\t\t\t\tplaceholder={$i18n.t('Select')}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<option value=\"tools\" class=\"bg-gray-100 dark:bg-gray-800\">{$i18n.t('Tools')}</option>\n\t\t\t\t\t\t\t<option value=\"functions\" class=\"bg-gray-100 dark:bg-gray-800\"\n\t\t\t\t\t\t\t\t>{$i18n.t('Functions')}</option\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t</select>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div class=\"flex-1\">\n\t\t\t\t\t\t<select\n\t\t\t\t\t\t\tclass=\"w-full rounded-sm py-2 px-1 text-xs bg-transparent outline-hidden\"\n\t\t\t\t\t\t\tbind:value={selectedId}\n\t\t\t\t\t\t\ton:change={async () => {\n\t\t\t\t\t\t\t\tawait tick();\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{#if tab === 'tools'}\n\t\t\t\t\t\t\t\t<option value=\"\" selected disabled class=\"bg-gray-100 dark:bg-gray-800\"\n\t\t\t\t\t\t\t\t\t>{$i18n.t('Select a tool')}</option\n\t\t\t\t\t\t\t\t>\n\n\t\t\t\t\t\t\t\t{#each $tools.filter((tool) => !tool?.id?.startsWith('server:')) as tool, toolIdx}\n\t\t\t\t\t\t\t\t\t<option value={tool.id} class=\"bg-gray-100 dark:bg-gray-800\">{tool.name}</option>\n\t\t\t\t\t\t\t\t{/each}\n\t\t\t\t\t\t\t{:else if tab === 'functions'}\n\t\t\t\t\t\t\t\t<option value=\"\" selected disabled class=\"bg-gray-100 dark:bg-gray-800\"\n\t\t\t\t\t\t\t\t\t>{$i18n.t('Select a function')}</option\n\t\t\t\t\t\t\t\t>\n\n\t\t\t\t\t\t\t\t{#each $functions as func, funcIdx}\n\t\t\t\t\t\t\t\t\t<option value={func.id} class=\"bg-gray-100 dark:bg-gray-800\">{func.name}</option>\n\t\t\t\t\t\t\t\t{/each}\n\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t</select>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t{#if selectedId}\n\t\t\t\t<hr class=\"border-gray-50/30 dark:border-gray-800/30 my-1 w-full\" />\n\n\t\t\t\t<div class=\"my-2 text-xs\">\n\t\t\t\t\t{#if !loading}\n\t\t\t\t\t\t<Valves\n\t\t\t\t\t\t\t{valvesSpec}\n\t\t\t\t\t\t\tbind:valves\n\t\t\t\t\t\t\ton:change={() => {\n\t\t\t\t\t\t\t\tdebounceSubmitHandler();\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t/>\n\t\t\t\t\t{:else}\n\t\t\t\t\t\t<Spinner className=\"size-5\" />\n\t\t\t\t\t{/if}\n\t\t\t\t</div>\n\t\t\t{/if}\n\t\t</div>\n\t</form>\n{:else}\n\t<Spinner className=\"size-4\" />\n{/if}\n","<script lang=\"ts\">\n\timport { createEventDispatcher, getContext } from 'svelte';\n\tconst dispatch = createEventDispatcher();\n\tconst i18n = getContext('i18n');\n\n\timport XMark from '$lib/components/icons/XMark.svelte';\n\timport AdvancedParams from '../Settings/Advanced/AdvancedParams.svelte';\n\timport Valves from '$lib/components/chat/Controls/Valves.svelte';\n\timport FileItem from '$lib/components/common/FileItem.svelte';\n\timport Collapsible from '$lib/components/common/Collapsible.svelte';\n\n\timport { user, settings } from '$lib/stores';\n\texport let models = [];\n\texport let chatFiles = [];\n\texport let params = {};\n\n\tlet showValves = false;\n</script>\n\n<div class=\" dark:text-white\">\n\t<div class=\" flex items-center justify-between dark:text-gray-100 mb-2\">\n\t\t<div class=\" text-lg font-medium self-center font-primary\">{$i18n.t('Chat Controls')}</div>\n\t\t<button\n\t\t\tclass=\"self-center\"\n\t\t\ton:click={() => {\n\t\t\t\tdispatch('close');\n\t\t\t}}\n\t\t>\n\t\t\t<XMark className=\"size-3.5\" />\n\t\t</button>\n\t</div>\n\n\t{#if $user?.role === 'admin' || ($user?.permissions.chat?.controls ?? true)}\n\t\t<div class=\" dark:text-gray-200 text-sm font-primary py-0.5 px-0.5\">\n\t\t\t{#if chatFiles.length > 0}\n\t\t\t\t<Collapsible title={$i18n.t('Files')} open={true} buttonClassName=\"w-full\">\n\t\t\t\t\t<div class=\"flex flex-col gap-1 mt-1.5\" slot=\"content\">\n\t\t\t\t\t\t{#each chatFiles as file, fileIdx}\n\t\t\t\t\t\t\t<FileItem\n\t\t\t\t\t\t\t\tclassName=\"w-full\"\n\t\t\t\t\t\t\t\titem={file}\n\t\t\t\t\t\t\t\tedit={true}\n\t\t\t\t\t\t\t\turl={file?.url ? file.url : null}\n\t\t\t\t\t\t\t\tname={file.name}\n\t\t\t\t\t\t\t\ttype={file.type}\n\t\t\t\t\t\t\t\tsize={file?.size}\n\t\t\t\t\t\t\t\tdismissible={true}\n\t\t\t\t\t\t\t\tsmall={true}\n\t\t\t\t\t\t\t\ton:dismiss={() => {\n\t\t\t\t\t\t\t\t\t// Remove the file from the chatFiles array\n\n\t\t\t\t\t\t\t\t\tchatFiles.splice(fileIdx, 1);\n\t\t\t\t\t\t\t\t\tchatFiles = chatFiles;\n\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\t\tconsole.log(file);\n\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t{/each}\n\t\t\t\t\t</div>\n\t\t\t\t</Collapsible>\n\n\t\t\t\t<hr class=\"my-2 border-gray-50 dark:border-gray-700/10\" />\n\t\t\t{/if}\n\n\t\t\t{#if $user?.role === 'admin' || ($user?.permissions.chat?.valves ?? true)}\n\t\t\t\t<Collapsible bind:open={showValves} title={$i18n.t('Valves')} buttonClassName=\"w-full\">\n\t\t\t\t\t<div class=\"text-sm\" slot=\"content\">\n\t\t\t\t\t\t<Valves show={showValves} />\n\t\t\t\t\t</div>\n\t\t\t\t</Collapsible>\n\n\t\t\t\t<hr class=\"my-2 border-gray-50 dark:border-gray-700/10\" />\n\t\t\t{/if}\n\n\t\t\t{#if $user?.role === 'admin' || ($user?.permissions.chat?.system_prompt ?? true)}\n\t\t\t\t<Collapsible title={$i18n.t('System Prompt')} open={true} buttonClassName=\"w-full\">\n\t\t\t\t\t<div class=\"\" slot=\"content\">\n\t\t\t\t\t\t<textarea\n\t\t\t\t\t\t\tbind:value={params.system}\n\t\t\t\t\t\t\tclass=\"w-full text-xs outline-hidden resize-vertical {$settings.highContrastMode\n\t\t\t\t\t\t\t\t? 'border-2 border-gray-300 dark:border-gray-700 rounded-lg bg-gray-50 dark:bg-gray-800 p-2.5'\n\t\t\t\t\t\t\t\t: 'py-1.5 bg-transparent'}\"\n\t\t\t\t\t\t\trows=\"4\"\n\t\t\t\t\t\t\tplaceholder={$i18n.t('Enter system prompt')}\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t</Collapsible>\n\n\t\t\t\t<hr class=\"my-2 border-gray-50 dark:border-gray-700/10\" />\n\t\t\t{/if}\n\n\t\t\t{#if $user?.role === 'admin' || ($user?.permissions.chat?.params ?? true)}\n\t\t\t\t<Collapsible title={$i18n.t('Advanced Params')} open={true} buttonClassName=\"w-full\">\n\t\t\t\t\t<div class=\"text-sm mt-1.5\" slot=\"content\">\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<AdvancedParams admin={$user?.role === 'admin'} custom={true} bind:params />\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</Collapsible>\n\t\t\t{/if}\n\t\t</div>\n\t{/if}\n</div>\n","<script lang=\"ts\">\n\timport { DropdownMenu } from 'bits-ui';\n\timport { flyAndScale } from '$lib/utils/transitions';\n\timport { getContext, createEventDispatcher } from 'svelte';\n\n\tconst i18n = getContext('i18n');\n\tconst dispatch = createEventDispatcher();\n\n\timport Dropdown from '$lib/components/common/Dropdown.svelte';\n\n\texport let onClose: Function = () => {};\n\texport let devices: any;\n\n\tlet show = false;\n</script>\n\n<Dropdown\n\tbind:show\n\ton:change={(e) => {\n\t\tif (e.detail === false) {\n\t\t\tonClose();\n\t\t}\n\t}}\n>\n\t<slot />\n\n\t<div slot=\"content\">\n\t\t<DropdownMenu.Content\n\t\t\tclass=\"w-full max-w-[180px] rounded-lg p-1 border border-gray-100  dark:border-gray-800 z-9999 bg-white dark:bg-gray-900 dark:text-white shadow-xs\"\n\t\t\tsideOffset={6}\n\t\t\tside=\"top\"\n\t\t\talign=\"start\"\n\t\t\ttransition={flyAndScale}\n\t\t>\n\t\t\t{#each devices as device}\n\t\t\t\t<DropdownMenu.Item\n\t\t\t\t\tclass=\"flex gap-2 items-center px-3 py-1.5 text-sm  cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 rounded-md\"\n\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\tdispatch('change', device.deviceId);\n\t\t\t\t\t}}\n\t\t\t\t>\n\t\t\t\t\t<div class=\"flex items-center\">\n\t\t\t\t\t\t<div class=\" line-clamp-1\">\n\t\t\t\t\t\t\t{device?.label ?? 'Camera'}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</DropdownMenu.Item>\n\t\t\t{/each}\n\t\t</DropdownMenu.Content>\n\t</div>\n</Dropdown>\n","<script lang=\"ts\">\n\timport { config, models, settings, showCallOverlay, TTSWorker } from '$lib/stores';\n\timport { onMount, tick, getContext, onDestroy, createEventDispatcher } from 'svelte';\n\n\tconst dispatch = createEventDispatcher();\n\n\timport { blobToFile } from '$lib/utils';\n\timport { generateEmoji } from '$lib/apis';\n\timport { synthesizeOpenAISpeech, transcribeAudio } from '$lib/apis/audio';\n\n\timport { toast } from 'svelte-sonner';\n\n\timport Tooltip from '$lib/components/common/Tooltip.svelte';\n\timport VideoInputMenu from './CallOverlay/VideoInputMenu.svelte';\n\timport { KokoroWorker } from '$lib/workers/KokoroWorker';\n\timport { WEBUI_API_BASE_URL } from '$lib/constants';\n\n\tconst i18n = getContext('i18n');\n\n\texport let eventTarget: EventTarget;\n\texport let submitPrompt: Function;\n\texport let stopResponse: Function;\n\texport let files;\n\texport let chatId;\n\texport let modelId;\n\n\tlet wakeLock = null;\n\n\tlet model = null;\n\n\tlet loading = false;\n\tlet confirmed = false;\n\tlet interrupted = false;\n\tlet assistantSpeaking = false;\n\n\tlet emoji = null;\n\tlet camera = false;\n\tlet cameraStream = null;\n\n\tlet chatStreaming = false;\n\tlet rmsLevel = 0;\n\tlet hasStartedSpeaking = false;\n\tlet mediaRecorder;\n\tlet audioStream = null;\n\tlet audioChunks = [];\n\n\tlet videoInputDevices = [];\n\tlet selectedVideoInputDeviceId = null;\n\n\tconst getVideoInputDevices = async () => {\n\t\tconst devices = await navigator.mediaDevices.enumerateDevices();\n\t\tvideoInputDevices = devices.filter((device) => device.kind === 'videoinput');\n\n\t\tif (!!navigator.mediaDevices.getDisplayMedia) {\n\t\t\tvideoInputDevices = [\n\t\t\t\t...videoInputDevices,\n\t\t\t\t{\n\t\t\t\t\tdeviceId: 'screen',\n\t\t\t\t\tlabel: 'Screen Share'\n\t\t\t\t}\n\t\t\t];\n\t\t}\n\n\t\tconsole.log(videoInputDevices);\n\t\tif (selectedVideoInputDeviceId === null && videoInputDevices.length > 0) {\n\t\t\tselectedVideoInputDeviceId = videoInputDevices[0].deviceId;\n\t\t}\n\t};\n\n\tconst startCamera = async () => {\n\t\tawait getVideoInputDevices();\n\n\t\tif (cameraStream === null) {\n\t\t\tcamera = true;\n\t\t\tawait tick();\n\t\t\ttry {\n\t\t\t\tawait startVideoStream();\n\t\t\t} catch (err) {\n\t\t\t\tconsole.error('Error accessing webcam: ', err);\n\t\t\t}\n\t\t}\n\t};\n\n\tconst startVideoStream = async () => {\n\t\tconst video = document.getElementById('camera-feed');\n\t\tif (video) {\n\t\t\tif (selectedVideoInputDeviceId === 'screen') {\n\t\t\t\tcameraStream = await navigator.mediaDevices.getDisplayMedia({\n\t\t\t\t\tvideo: {\n\t\t\t\t\t\tcursor: 'always'\n\t\t\t\t\t},\n\t\t\t\t\taudio: false\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tcameraStream = await navigator.mediaDevices.getUserMedia({\n\t\t\t\t\tvideo: {\n\t\t\t\t\t\tdeviceId: selectedVideoInputDeviceId ? { exact: selectedVideoInputDeviceId } : undefined\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (cameraStream) {\n\t\t\t\tawait getVideoInputDevices();\n\t\t\t\tvideo.srcObject = cameraStream;\n\t\t\t\tawait video.play();\n\t\t\t}\n\t\t}\n\t};\n\n\tconst stopVideoStream = async () => {\n\t\tif (cameraStream) {\n\t\t\tconst tracks = cameraStream.getTracks();\n\t\t\ttracks.forEach((track) => track.stop());\n\t\t}\n\n\t\tcameraStream = null;\n\t};\n\n\tconst takeScreenshot = () => {\n\t\tconst video = document.getElementById('camera-feed');\n\t\tconst canvas = document.getElementById('camera-canvas');\n\n\t\tif (!canvas) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst context = canvas.getContext('2d');\n\n\t\t// Make the canvas match the video dimensions\n\t\tcanvas.width = video.videoWidth;\n\t\tcanvas.height = video.videoHeight;\n\n\t\t// Draw the image from the video onto the canvas\n\t\tcontext.drawImage(video, 0, 0, video.videoWidth, video.videoHeight);\n\n\t\t// Convert the canvas to a data base64 URL and console log it\n\t\tconst dataURL = canvas.toDataURL('image/png');\n\t\tconsole.log(dataURL);\n\n\t\treturn dataURL;\n\t};\n\n\tconst stopCamera = async () => {\n\t\tawait stopVideoStream();\n\t\tcamera = false;\n\t};\n\n\tconst MIN_DECIBELS = -55;\n\tconst VISUALIZER_BUFFER_LENGTH = 300;\n\n\tconst transcribeHandler = async (audioBlob) => {\n\t\t// Create a blob from the audio chunks\n\n\t\tawait tick();\n\t\tconst file = blobToFile(audioBlob, 'recording.wav');\n\n\t\tconst res = await transcribeAudio(\n\t\t\tlocalStorage.token,\n\t\t\tfile,\n\t\t\t$settings?.audio?.stt?.language\n\t\t).catch((error) => {\n\t\t\ttoast.error(`${error}`);\n\t\t\treturn null;\n\t\t});\n\n\t\tif (res) {\n\t\t\tconsole.log(res.text);\n\n\t\t\tif (res.text !== '') {\n\t\t\t\tconst _responses = await submitPrompt(res.text, { _raw: true });\n\t\t\t\tconsole.log(_responses);\n\t\t\t}\n\t\t}\n\t};\n\n\tconst stopRecordingCallback = async (_continue = true) => {\n\t\tif ($showCallOverlay) {\n\t\t\tconsole.log('%c%s', 'color: red; font-size: 20px;', ' stopRecordingCallback ');\n\n\t\t\t// deep copy the audioChunks array\n\t\t\tconst _audioChunks = audioChunks.slice(0);\n\n\t\t\taudioChunks = [];\n\t\t\tmediaRecorder = false;\n\n\t\t\tif (_continue) {\n\t\t\t\tstartRecording();\n\t\t\t}\n\n\t\t\tif (confirmed) {\n\t\t\t\tloading = true;\n\t\t\t\temoji = null;\n\n\t\t\t\tif (cameraStream) {\n\t\t\t\t\tconst imageUrl = takeScreenshot();\n\n\t\t\t\t\tfiles = [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttype: 'image',\n\t\t\t\t\t\t\turl: imageUrl\n\t\t\t\t\t\t}\n\t\t\t\t\t];\n\t\t\t\t}\n\n\t\t\t\tconst audioBlob = new Blob(_audioChunks, { type: 'audio/wav' });\n\t\t\t\tawait transcribeHandler(audioBlob);\n\n\t\t\t\tconfirmed = false;\n\t\t\t\tloading = false;\n\t\t\t}\n\t\t} else {\n\t\t\taudioChunks = [];\n\t\t\tmediaRecorder = false;\n\n\t\t\tif (audioStream) {\n\t\t\t\tconst tracks = audioStream.getTracks();\n\t\t\t\ttracks.forEach((track) => track.stop());\n\t\t\t}\n\t\t\taudioStream = null;\n\t\t}\n\t};\n\n\tconst startRecording = async () => {\n\t\tif ($showCallOverlay) {\n\t\t\tif (!audioStream) {\n\t\t\t\taudioStream = await navigator.mediaDevices.getUserMedia({\n\t\t\t\t\taudio: {\n\t\t\t\t\t\techoCancellation: true,\n\t\t\t\t\t\tnoiseSuppression: true,\n\t\t\t\t\t\tautoGainControl: true\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t\tmediaRecorder = new MediaRecorder(audioStream);\n\n\t\t\tmediaRecorder.onstart = () => {\n\t\t\t\tconsole.log('Recording started');\n\t\t\t\taudioChunks = [];\n\t\t\t};\n\n\t\t\tmediaRecorder.ondataavailable = (event) => {\n\t\t\t\tif (hasStartedSpeaking) {\n\t\t\t\t\taudioChunks.push(event.data);\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tmediaRecorder.onstop = (e) => {\n\t\t\t\tconsole.log('Recording stopped', audioStream, e);\n\t\t\t\tstopRecordingCallback();\n\t\t\t};\n\n\t\t\tanalyseAudio(audioStream);\n\t\t}\n\t};\n\n\tconst stopAudioStream = async () => {\n\t\ttry {\n\t\t\tif (mediaRecorder) {\n\t\t\t\tmediaRecorder.stop();\n\t\t\t}\n\t\t} catch (error) {\n\t\t\tconsole.log('Error stopping audio stream:', error);\n\t\t}\n\n\t\tif (!audioStream) return;\n\n\t\taudioStream.getAudioTracks().forEach(function (track) {\n\t\t\ttrack.stop();\n\t\t});\n\n\t\taudioStream = null;\n\t};\n\n\t// Function to calculate the RMS level from time domain data\n\tconst calculateRMS = (data: Uint8Array) => {\n\t\tlet sumSquares = 0;\n\t\tfor (let i = 0; i < data.length; i++) {\n\t\t\tconst normalizedValue = (data[i] - 128) / 128; // Normalize the data\n\t\t\tsumSquares += normalizedValue * normalizedValue;\n\t\t}\n\t\treturn Math.sqrt(sumSquares / data.length);\n\t};\n\n\tconst analyseAudio = (stream) => {\n\t\tconst audioContext = new AudioContext();\n\t\tconst audioStreamSource = audioContext.createMediaStreamSource(stream);\n\n\t\tconst analyser = audioContext.createAnalyser();\n\t\tanalyser.minDecibels = MIN_DECIBELS;\n\t\taudioStreamSource.connect(analyser);\n\n\t\tconst bufferLength = analyser.frequencyBinCount;\n\n\t\tconst domainData = new Uint8Array(bufferLength);\n\t\tconst timeDomainData = new Uint8Array(analyser.fftSize);\n\n\t\tlet lastSoundTime = Date.now();\n\t\thasStartedSpeaking = false;\n\n\t\tconsole.log(' Sound detection started', lastSoundTime, hasStartedSpeaking);\n\n\t\tconst detectSound = () => {\n\t\t\tconst processFrame = () => {\n\t\t\t\tif (!mediaRecorder || !$showCallOverlay) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (assistantSpeaking && !($settings?.voiceInterruption ?? false)) {\n\t\t\t\t\t// Mute the audio if the assistant is speaking\n\t\t\t\t\tanalyser.maxDecibels = 0;\n\t\t\t\t\tanalyser.minDecibels = -1;\n\t\t\t\t} else {\n\t\t\t\t\tanalyser.minDecibels = MIN_DECIBELS;\n\t\t\t\t\tanalyser.maxDecibels = -30;\n\t\t\t\t}\n\n\t\t\t\tanalyser.getByteTimeDomainData(timeDomainData);\n\t\t\t\tanalyser.getByteFrequencyData(domainData);\n\n\t\t\t\t// Calculate RMS level from time domain data\n\t\t\t\trmsLevel = calculateRMS(timeDomainData);\n\n\t\t\t\t// Check if initial speech/noise has started\n\t\t\t\tconst hasSound = domainData.some((value) => value > 0);\n\t\t\t\tif (hasSound) {\n\t\t\t\t\t// BIG RED TEXT\n\t\t\t\t\tconsole.log('%c%s', 'color: red; font-size: 20px;', ' Sound detected');\n\t\t\t\t\tif (mediaRecorder && mediaRecorder.state !== 'recording') {\n\t\t\t\t\t\tmediaRecorder.start();\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!hasStartedSpeaking) {\n\t\t\t\t\t\thasStartedSpeaking = true;\n\t\t\t\t\t\tstopAllAudio();\n\t\t\t\t\t}\n\n\t\t\t\t\tlastSoundTime = Date.now();\n\t\t\t\t}\n\n\t\t\t\t// Start silence detection only after initial speech/noise has been detected\n\t\t\t\tif (hasStartedSpeaking) {\n\t\t\t\t\tif (Date.now() - lastSoundTime > 2000) {\n\t\t\t\t\t\tconfirmed = true;\n\n\t\t\t\t\t\tif (mediaRecorder) {\n\t\t\t\t\t\t\tconsole.log('%c%s', 'color: red; font-size: 20px;', ' Silence detected');\n\t\t\t\t\t\t\tmediaRecorder.stop();\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\twindow.requestAnimationFrame(processFrame);\n\t\t\t};\n\n\t\t\twindow.requestAnimationFrame(processFrame);\n\t\t};\n\n\t\tdetectSound();\n\t};\n\n\tlet finishedMessages = {};\n\tlet currentMessageId = null;\n\tlet currentUtterance = null;\n\n\t// Get voice: model-specific > user settings > config default\n\tconst getVoiceId = () => {\n\t\t// Check for model-specific TTS voice first\n\t\tif (model?.info?.meta?.tts?.voice) {\n\t\t\treturn model.info.meta.tts.voice;\n\t\t}\n\t\t// Fall back to user settings or config default\n\t\tif ($settings?.audio?.tts?.defaultVoice === $config.audio.tts.voice) {\n\t\t\treturn $settings?.audio?.tts?.voice ?? $config?.audio?.tts?.voice;\n\t\t}\n\t\treturn $config?.audio?.tts?.voice;\n\t};\n\n\tconst speakSpeechSynthesisHandler = (content) => {\n\t\tif ($showCallOverlay) {\n\t\t\treturn new Promise((resolve) => {\n\t\t\t\tlet voices = [];\n\t\t\t\tconst getVoicesLoop = setInterval(async () => {\n\t\t\t\t\tvoices = await speechSynthesis.getVoices();\n\t\t\t\t\tif (voices.length > 0) {\n\t\t\t\t\t\tclearInterval(getVoicesLoop);\n\n\t\t\t\t\t\tconst voiceId = getVoiceId();\n\t\t\t\t\t\tconst voice = voices?.filter((v) => v.voiceURI === voiceId)?.at(0) ?? undefined;\n\n\t\t\t\t\t\tcurrentUtterance = new SpeechSynthesisUtterance(content);\n\t\t\t\t\t\tcurrentUtterance.rate = $settings.audio?.tts?.playbackRate ?? 1;\n\n\t\t\t\t\t\tif (voice) {\n\t\t\t\t\t\t\tcurrentUtterance.voice = voice;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tspeechSynthesis.speak(currentUtterance);\n\t\t\t\t\t\tcurrentUtterance.onend = async (e) => {\n\t\t\t\t\t\t\tawait new Promise((r) => setTimeout(r, 200));\n\t\t\t\t\t\t\tresolve(e);\n\t\t\t\t\t\t};\n\t\t\t\t\t}\n\t\t\t\t}, 100);\n\t\t\t});\n\t\t} else {\n\t\t\treturn Promise.resolve();\n\t\t}\n\t};\n\n\tconst playAudio = (audio) => {\n\t\tif ($showCallOverlay) {\n\t\t\treturn new Promise((resolve) => {\n\t\t\t\tconst audioElement = document.getElementById('audioElement') as HTMLAudioElement;\n\n\t\t\t\tif (audioElement) {\n\t\t\t\t\taudioElement.src = audio.src;\n\t\t\t\t\taudioElement.muted = true;\n\t\t\t\t\taudioElement.playbackRate = $settings.audio?.tts?.playbackRate ?? 1;\n\n\t\t\t\t\taudioElement\n\t\t\t\t\t\t.play()\n\t\t\t\t\t\t.then(() => {\n\t\t\t\t\t\t\taudioElement.muted = false;\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.catch((error) => {\n\t\t\t\t\t\t\tconsole.error(error);\n\t\t\t\t\t\t});\n\n\t\t\t\t\taudioElement.onended = async (e) => {\n\t\t\t\t\t\tawait new Promise((r) => setTimeout(r, 100));\n\t\t\t\t\t\tresolve(e);\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t});\n\t\t} else {\n\t\t\treturn Promise.resolve();\n\t\t}\n\t};\n\n\tconst stopAllAudio = async () => {\n\t\tassistantSpeaking = false;\n\t\tinterrupted = true;\n\n\t\tif (chatStreaming) {\n\t\t\tstopResponse();\n\t\t}\n\n\t\tif (currentUtterance) {\n\t\t\tspeechSynthesis.cancel();\n\t\t\tcurrentUtterance = null;\n\t\t}\n\n\t\tconst audioElement = document.getElementById('audioElement');\n\t\tif (audioElement) {\n\t\t\taudioElement.muted = true;\n\t\t\taudioElement.pause();\n\t\t\taudioElement.currentTime = 0;\n\t\t}\n\t};\n\n\tlet audioAbortController = new AbortController();\n\n\t// Audio cache map where key is the content and value is the Audio object.\n\tconst audioCache = new Map();\n\tconst emojiCache = new Map();\n\n\tconst fetchAudio = async (content) => {\n\t\tif (!audioCache.has(content)) {\n\t\t\ttry {\n\t\t\t\t// Set the emoji for the content if needed\n\t\t\t\tif ($settings?.showEmojiInCall ?? false) {\n\t\t\t\t\tconst emoji = await generateEmoji(localStorage.token, modelId, content, chatId);\n\t\t\t\t\tif (emoji) {\n\t\t\t\t\t\temojiCache.set(content, emoji);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif ($settings.audio?.tts?.engine === 'browser-kokoro') {\n\t\t\t\t\tconst url = await $TTSWorker\n\t\t\t\t\t\t.generate({\n\t\t\t\t\t\t\ttext: content,\n\t\t\t\t\t\t\tvoice: getVoiceId()\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.catch((error) => {\n\t\t\t\t\t\t\tconsole.error(error);\n\t\t\t\t\t\t\ttoast.error(`${error}`);\n\t\t\t\t\t\t});\n\n\t\t\t\t\tif (url) {\n\t\t\t\t\t\taudioCache.set(content, new Audio(url));\n\t\t\t\t\t}\n\t\t\t\t} else if ($config.audio.tts.engine !== '') {\n\t\t\t\t\tconst res = await synthesizeOpenAISpeech(localStorage.token, getVoiceId(), content).catch(\n\t\t\t\t\t\t(error) => {\n\t\t\t\t\t\t\tconsole.error(error);\n\t\t\t\t\t\t\treturn null;\n\t\t\t\t\t\t}\n\t\t\t\t\t);\n\n\t\t\t\t\tif (res) {\n\t\t\t\t\t\tconst blob = await res.blob();\n\t\t\t\t\t\tconst blobUrl = URL.createObjectURL(blob);\n\t\t\t\t\t\taudioCache.set(content, new Audio(blobUrl));\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\taudioCache.set(content, true);\n\t\t\t\t}\n\t\t\t} catch (error) {\n\t\t\t\tconsole.error('Error synthesizing speech:', error);\n\t\t\t}\n\t\t}\n\n\t\treturn audioCache.get(content);\n\t};\n\n\tlet messages = {};\n\n\tconst monitorAndPlayAudio = async (id, signal) => {\n\t\twhile (!signal.aborted) {\n\t\t\tif (messages[id] && messages[id].length > 0) {\n\t\t\t\t// Retrieve the next content string from the queue\n\t\t\t\tconst content = messages[id].shift(); // Dequeues the content for playing\n\n\t\t\t\tif (audioCache.has(content)) {\n\t\t\t\t\t// If content is available in the cache, play it\n\n\t\t\t\t\t// Set the emoji for the content if available\n\t\t\t\t\tif (($settings?.showEmojiInCall ?? false) && emojiCache.has(content)) {\n\t\t\t\t\t\temoji = emojiCache.get(content);\n\t\t\t\t\t} else {\n\t\t\t\t\t\temoji = null;\n\t\t\t\t\t}\n\n\t\t\t\t\tif ($config.audio.tts.engine !== '') {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tconsole.log(\n\t\t\t\t\t\t\t\t'%c%s',\n\t\t\t\t\t\t\t\t'color: red; font-size: 20px;',\n\t\t\t\t\t\t\t\t`Playing audio for content: ${content}`\n\t\t\t\t\t\t\t);\n\n\t\t\t\t\t\t\tconst audio = audioCache.get(content);\n\t\t\t\t\t\t\tawait playAudio(audio); // Here ensure that playAudio is indeed correct method to execute\n\t\t\t\t\t\t\tconsole.log(`Played audio for content: ${content}`);\n\t\t\t\t\t\t\tawait new Promise((resolve) => setTimeout(resolve, 200)); // Wait before retrying to reduce tight loop\n\t\t\t\t\t\t} catch (error) {\n\t\t\t\t\t\t\tconsole.error('Error playing audio:', error);\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tawait speakSpeechSynthesisHandler(content);\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\t// If not available in the cache, push it back to the queue and delay\n\t\t\t\t\tmessages[id].unshift(content); // Re-queue the content at the start\n\t\t\t\t\tconsole.log(`Audio for \"${content}\" not yet available in the cache, re-queued...`);\n\t\t\t\t\tawait new Promise((resolve) => setTimeout(resolve, 200)); // Wait before retrying to reduce tight loop\n\t\t\t\t}\n\t\t\t} else if (finishedMessages[id] && messages[id] && messages[id].length === 0) {\n\t\t\t\t// If the message is finished and there are no more messages to process, break the loop\n\t\t\t\tassistantSpeaking = false;\n\t\t\t\tbreak;\n\t\t\t} else {\n\t\t\t\t// No messages to process, sleep for a bit\n\t\t\t\tawait new Promise((resolve) => setTimeout(resolve, 200));\n\t\t\t}\n\t\t}\n\t\tconsole.log(`Audio monitoring and playing stopped for message ID ${id}`);\n\t};\n\n\tconst chatStartHandler = async (e) => {\n\t\tconst { id } = e.detail;\n\n\t\tchatStreaming = true;\n\n\t\tif (currentMessageId !== id) {\n\t\t\tconsole.log(`Received chat start event for message ID ${id}`);\n\n\t\t\tcurrentMessageId = id;\n\t\t\tif (audioAbortController) {\n\t\t\t\taudioAbortController.abort();\n\t\t\t}\n\t\t\taudioAbortController = new AbortController();\n\n\t\t\tassistantSpeaking = true;\n\t\t\t// Start monitoring and playing audio for the message ID\n\t\t\tmonitorAndPlayAudio(id, audioAbortController.signal);\n\t\t}\n\t};\n\n\tconst chatEventHandler = async (e) => {\n\t\tconst { id, content } = e.detail;\n\t\t// \"id\" here is message id\n\t\t// if \"id\" is not the same as \"currentMessageId\" then do not process\n\t\t// \"content\" here is a sentence from the assistant,\n\t\t// there will be many sentences for the same \"id\"\n\n\t\tif (currentMessageId === id) {\n\t\t\tconsole.log(`Received chat event for message ID ${id}: ${content}`);\n\n\t\t\ttry {\n\t\t\t\tif (messages[id] === undefined) {\n\t\t\t\t\tmessages[id] = [content];\n\t\t\t\t} else {\n\t\t\t\t\tmessages[id].push(content);\n\t\t\t\t}\n\n\t\t\t\tconsole.log(content);\n\n\t\t\t\tfetchAudio(content);\n\t\t\t} catch (error) {\n\t\t\t\tconsole.error('Failed to fetch or play audio:', error);\n\t\t\t}\n\t\t}\n\t};\n\n\tconst chatFinishHandler = async (e) => {\n\t\tconst { id, content } = e.detail;\n\t\t// \"content\" here is the entire message from the assistant\n\t\tfinishedMessages[id] = true;\n\n\t\tchatStreaming = false;\n\t};\n\n\tonMount(async () => {\n\t\tconst setWakeLock = async () => {\n\t\t\ttry {\n\t\t\t\twakeLock = await navigator.wakeLock.request('screen');\n\t\t\t} catch (err) {\n\t\t\t\t// The Wake Lock request has failed - usually system related, such as battery.\n\t\t\t\tconsole.log(err);\n\t\t\t}\n\n\t\t\tif (wakeLock) {\n\t\t\t\t// Add a listener to release the wake lock when the page is unloaded\n\t\t\t\twakeLock.addEventListener('release', () => {\n\t\t\t\t\t// the wake lock has been released\n\t\t\t\t\tconsole.log('Wake Lock released');\n\t\t\t\t});\n\t\t\t}\n\t\t};\n\n\t\tif ('wakeLock' in navigator) {\n\t\t\tawait setWakeLock();\n\n\t\t\tdocument.addEventListener('visibilitychange', async () => {\n\t\t\t\t// Re-request the wake lock if the document becomes visible\n\t\t\t\tif (wakeLock !== null && document.visibilityState === 'visible') {\n\t\t\t\t\tawait setWakeLock();\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tmodel = $models.find((m) => m.id === modelId);\n\n\t\tstartRecording();\n\n\t\teventTarget.addEventListener('chat:start', chatStartHandler);\n\t\teventTarget.addEventListener('chat', chatEventHandler);\n\t\teventTarget.addEventListener('chat:finish', chatFinishHandler);\n\n\t\treturn async () => {\n\t\t\tawait stopAllAudio();\n\n\t\t\tstopAudioStream();\n\n\t\t\teventTarget.removeEventListener('chat:start', chatStartHandler);\n\t\t\teventTarget.removeEventListener('chat', chatEventHandler);\n\t\t\teventTarget.removeEventListener('chat:finish', chatFinishHandler);\n\n\t\t\taudioAbortController.abort();\n\t\t\tawait tick();\n\n\t\t\tawait stopAllAudio();\n\n\t\t\tawait stopRecordingCallback(false);\n\t\t\tawait stopCamera();\n\t\t};\n\t});\n\n\tonDestroy(async () => {\n\t\tawait stopAllAudio();\n\t\tawait stopRecordingCallback(false);\n\t\tawait stopCamera();\n\n\t\tawait stopAudioStream();\n\t\teventTarget.removeEventListener('chat:start', chatStartHandler);\n\t\teventTarget.removeEventListener('chat', chatEventHandler);\n\t\teventTarget.removeEventListener('chat:finish', chatFinishHandler);\n\t\taudioAbortController.abort();\n\n\t\tawait tick();\n\n\t\tawait stopAllAudio();\n\t});\n</script>\n\n{#if $showCallOverlay}\n\t<div class=\"max-w-lg w-full h-full max-h-[100dvh] flex flex-col justify-between p-3 md:p-6\">\n\t\t{#if camera}\n\t\t\t<button\n\t\t\t\ttype=\"button\"\n\t\t\t\tclass=\"flex justify-center items-center w-full h-20 min-h-20\"\n\t\t\t\ton:click={() => {\n\t\t\t\t\tif (assistantSpeaking) {\n\t\t\t\t\t\tstopAllAudio();\n\t\t\t\t\t}\n\t\t\t\t}}\n\t\t\t>\n\t\t\t\t{#if emoji}\n\t\t\t\t\t<div\n\t\t\t\t\t\tclass=\"  transition-all rounded-full\"\n\t\t\t\t\t\tstyle=\"font-size:{rmsLevel * 100 > 4\n\t\t\t\t\t\t\t? '4.5'\n\t\t\t\t\t\t\t: rmsLevel * 100 > 2\n\t\t\t\t\t\t\t\t? '4.25'\n\t\t\t\t\t\t\t\t: rmsLevel * 100 > 1\n\t\t\t\t\t\t\t\t\t? '3.75'\n\t\t\t\t\t\t\t\t\t: '3.5'}rem;width: 100%; text-align:center;\"\n\t\t\t\t\t>\n\t\t\t\t\t\t{emoji}\n\t\t\t\t\t</div>\n\t\t\t\t{:else if loading || assistantSpeaking}\n\t\t\t\t\t<svg\n\t\t\t\t\t\tclass=\"size-12 text-gray-900 dark:text-gray-400\"\n\t\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\t\tfill=\"currentColor\"\n\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\t\t><style>\n\t\t\t\t\t\t\t.spinner_qM83 {\n\t\t\t\t\t\t\t\tanimation: spinner_8HQG 1.05s infinite;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t.spinner_oXPr {\n\t\t\t\t\t\t\t\tanimation-delay: 0.1s;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t.spinner_ZTLf {\n\t\t\t\t\t\t\t\tanimation-delay: 0.2s;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t@keyframes spinner_8HQG {\n\t\t\t\t\t\t\t\t0%,\n\t\t\t\t\t\t\t\t57.14% {\n\t\t\t\t\t\t\t\t\tanimation-timing-function: cubic-bezier(0.33, 0.66, 0.66, 1);\n\t\t\t\t\t\t\t\t\ttransform: translate(0);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t28.57% {\n\t\t\t\t\t\t\t\t\tanimation-timing-function: cubic-bezier(0.33, 0, 0.66, 0.33);\n\t\t\t\t\t\t\t\t\ttransform: translateY(-6px);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t100% {\n\t\t\t\t\t\t\t\t\ttransform: translate(0);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t</style><circle class=\"spinner_qM83\" cx=\"4\" cy=\"12\" r=\"3\" /><circle\n\t\t\t\t\t\t\tclass=\"spinner_qM83 spinner_oXPr\"\n\t\t\t\t\t\t\tcx=\"12\"\n\t\t\t\t\t\t\tcy=\"12\"\n\t\t\t\t\t\t\tr=\"3\"\n\t\t\t\t\t\t/><circle class=\"spinner_qM83 spinner_ZTLf\" cx=\"20\" cy=\"12\" r=\"3\" /></svg\n\t\t\t\t\t>\n\t\t\t\t{:else}\n\t\t\t\t\t<div\n\t\t\t\t\t\tclass=\" {rmsLevel * 100 > 4\n\t\t\t\t\t\t\t? ' size-[4.5rem]'\n\t\t\t\t\t\t\t: rmsLevel * 100 > 2\n\t\t\t\t\t\t\t\t? ' size-16'\n\t\t\t\t\t\t\t\t: rmsLevel * 100 > 1\n\t\t\t\t\t\t\t\t\t? 'size-14'\n\t\t\t\t\t\t\t\t\t: 'size-12'}  transition-all rounded-full bg-cover bg-center bg-no-repeat\"\n\t\t\t\t\t\tstyle={`background-image: url('${WEBUI_API_BASE_URL}/models/model/profile/image?id=${model?.id}&lang=${$i18n.language}&voice=true');`}\n\t\t\t\t\t/>\n\t\t\t\t{/if}\n\t\t\t\t<!-- navbar -->\n\t\t\t</button>\n\t\t{/if}\n\n\t\t<div class=\"flex justify-center items-center flex-1 h-full w-full max-h-full\">\n\t\t\t{#if !camera}\n\t\t\t\t<button\n\t\t\t\t\ttype=\"button\"\n\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\tif (assistantSpeaking) {\n\t\t\t\t\t\t\tstopAllAudio();\n\t\t\t\t\t\t}\n\t\t\t\t\t}}\n\t\t\t\t>\n\t\t\t\t\t{#if emoji}\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tclass=\"  transition-all rounded-full\"\n\t\t\t\t\t\t\tstyle=\"font-size:{rmsLevel * 100 > 4\n\t\t\t\t\t\t\t\t? '13'\n\t\t\t\t\t\t\t\t: rmsLevel * 100 > 2\n\t\t\t\t\t\t\t\t\t? '12'\n\t\t\t\t\t\t\t\t\t: rmsLevel * 100 > 1\n\t\t\t\t\t\t\t\t\t\t? '11.5'\n\t\t\t\t\t\t\t\t\t\t: '11'}rem;width:100%;text-align:center;\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{emoji}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t{:else if loading || assistantSpeaking}\n\t\t\t\t\t\t<svg\n\t\t\t\t\t\t\tclass=\"size-44 text-gray-900 dark:text-gray-400\"\n\t\t\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\t\t\tfill=\"currentColor\"\n\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\t\t\t><style>\n\t\t\t\t\t\t\t\t.spinner_qM83 {\n\t\t\t\t\t\t\t\t\tanimation: spinner_8HQG 1.05s infinite;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t.spinner_oXPr {\n\t\t\t\t\t\t\t\t\tanimation-delay: 0.1s;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t.spinner_ZTLf {\n\t\t\t\t\t\t\t\t\tanimation-delay: 0.2s;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t@keyframes spinner_8HQG {\n\t\t\t\t\t\t\t\t\t0%,\n\t\t\t\t\t\t\t\t\t57.14% {\n\t\t\t\t\t\t\t\t\t\tanimation-timing-function: cubic-bezier(0.33, 0.66, 0.66, 1);\n\t\t\t\t\t\t\t\t\t\ttransform: translate(0);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t28.57% {\n\t\t\t\t\t\t\t\t\t\tanimation-timing-function: cubic-bezier(0.33, 0, 0.66, 0.33);\n\t\t\t\t\t\t\t\t\t\ttransform: translateY(-6px);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t100% {\n\t\t\t\t\t\t\t\t\t\ttransform: translate(0);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t</style><circle class=\"spinner_qM83\" cx=\"4\" cy=\"12\" r=\"3\" /><circle\n\t\t\t\t\t\t\t\tclass=\"spinner_qM83 spinner_oXPr\"\n\t\t\t\t\t\t\t\tcx=\"12\"\n\t\t\t\t\t\t\t\tcy=\"12\"\n\t\t\t\t\t\t\t\tr=\"3\"\n\t\t\t\t\t\t\t/><circle class=\"spinner_qM83 spinner_ZTLf\" cx=\"20\" cy=\"12\" r=\"3\" /></svg\n\t\t\t\t\t\t>\n\t\t\t\t\t{:else}\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tclass=\" {rmsLevel * 100 > 4\n\t\t\t\t\t\t\t\t? ' size-52'\n\t\t\t\t\t\t\t\t: rmsLevel * 100 > 2\n\t\t\t\t\t\t\t\t\t? 'size-48'\n\t\t\t\t\t\t\t\t\t: rmsLevel * 100 > 1\n\t\t\t\t\t\t\t\t\t\t? 'size-44'\n\t\t\t\t\t\t\t\t\t\t: 'size-40'} transition-all rounded-full bg-cover bg-center bg-no-repeat\"\n\t\t\t\t\t\t\tstyle={`background-image: url('${WEBUI_API_BASE_URL}/models/model/profile/image?id=${model?.id}&lang=${$i18n.language}&voice=true');`}\n\t\t\t\t\t\t/>\n\t\t\t\t\t{/if}\n\t\t\t\t</button>\n\t\t\t{:else}\n\t\t\t\t<div class=\"relative flex video-container w-full max-h-full pt-2 pb-4 md:py-6 px-2 h-full\">\n\t\t\t\t\t<!-- svelte-ignore a11y-media-has-caption -->\n\t\t\t\t\t<video\n\t\t\t\t\t\tid=\"camera-feed\"\n\t\t\t\t\t\tautoplay\n\t\t\t\t\t\tclass=\"rounded-2xl h-full min-w-full object-cover object-center\"\n\t\t\t\t\t\tplaysinline\n\t\t\t\t\t/>\n\n\t\t\t\t\t<canvas id=\"camera-canvas\" style=\"display:none;\" />\n\n\t\t\t\t\t<div class=\" absolute top-4 md:top-8 left-4\">\n\t\t\t\t\t\t<button\n\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t\tclass=\"p-1.5 text-white cursor-pointer backdrop-blur-xl bg-black/10 rounded-full\"\n\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\tstopCamera();\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<svg\n\t\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\t\t\t\tviewBox=\"0 0 16 16\"\n\t\t\t\t\t\t\t\tfill=\"currentColor\"\n\t\t\t\t\t\t\t\tclass=\"size-6\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\td=\"M5.28 4.22a.75.75 0 0 0-1.06 1.06L6.94 8l-2.72 2.72a.75.75 0 1 0 1.06 1.06L8 9.06l2.72 2.72a.75.75 0 1 0 1.06-1.06L9.06 8l2.72-2.72a.75.75 0 0 0-1.06-1.06L8 6.94 5.28 4.22Z\"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t{/if}\n\t\t</div>\n\n\t\t<div class=\"flex justify-between items-center pb-2 w-full\">\n\t\t\t<div>\n\t\t\t\t{#if camera}\n\t\t\t\t\t<VideoInputMenu\n\t\t\t\t\t\tdevices={videoInputDevices}\n\t\t\t\t\t\ton:change={async (e) => {\n\t\t\t\t\t\t\tconsole.log(e.detail);\n\t\t\t\t\t\t\tselectedVideoInputDeviceId = e.detail;\n\t\t\t\t\t\t\tawait stopVideoStream();\n\t\t\t\t\t\t\tawait startVideoStream();\n\t\t\t\t\t\t}}\n\t\t\t\t\t>\n\t\t\t\t\t\t<button class=\" p-3 rounded-full bg-gray-50 dark:bg-gray-900\" type=\"button\">\n\t\t\t\t\t\t\t<svg\n\t\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\t\t\t\tviewBox=\"0 0 20 20\"\n\t\t\t\t\t\t\t\tfill=\"currentColor\"\n\t\t\t\t\t\t\t\tclass=\"size-5\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\tfill-rule=\"evenodd\"\n\t\t\t\t\t\t\t\t\td=\"M15.312 11.424a5.5 5.5 0 0 1-9.201 2.466l-.312-.311h2.433a.75.75 0 0 0 0-1.5H3.989a.75.75 0 0 0-.75.75v4.242a.75.75 0 0 0 1.5 0v-2.43l.31.31a7 7 0 0 0 11.712-3.138.75.75 0 0 0-1.449-.39Zm1.23-3.723a.75.75 0 0 0 .219-.53V2.929a.75.75 0 0 0-1.5 0V5.36l-.31-.31A7 7 0 0 0 3.239 8.188a.75.75 0 1 0 1.448.389A5.5 5.5 0 0 1 13.89 6.11l.311.31h-2.432a.75.75 0 0 0 0 1.5h4.243a.75.75 0 0 0 .53-.219Z\"\n\t\t\t\t\t\t\t\t\tclip-rule=\"evenodd\"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</VideoInputMenu>\n\t\t\t\t{:else}\n\t\t\t\t\t<Tooltip content={$i18n.t('Camera')}>\n\t\t\t\t\t\t<button\n\t\t\t\t\t\t\tclass=\" p-3 rounded-full bg-gray-50 dark:bg-gray-900\"\n\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t\ton:click={async () => {\n\t\t\t\t\t\t\t\tawait navigator.mediaDevices.getUserMedia({ video: true });\n\t\t\t\t\t\t\t\tstartCamera();\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<svg\n\t\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\t\t\t\tfill=\"none\"\n\t\t\t\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\t\t\t\tstroke-width=\"1.5\"\n\t\t\t\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\t\t\t\tclass=\"size-5\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\tstroke-linecap=\"round\"\n\t\t\t\t\t\t\t\t\tstroke-linejoin=\"round\"\n\t\t\t\t\t\t\t\t\td=\"M6.827 6.175A2.31 2.31 0 0 1 5.186 7.23c-.38.054-.757.112-1.134.175C2.999 7.58 2.25 8.507 2.25 9.574V18a2.25 2.25 0 0 0 2.25 2.25h15A2.25 2.25 0 0 0 21.75 18V9.574c0-1.067-.75-1.994-1.802-2.169a47.865 47.865 0 0 0-1.134-.175 2.31 2.31 0 0 1-1.64-1.055l-.822-1.316a2.192 2.192 0 0 0-1.736-1.039 48.774 48.774 0 0 0-5.232 0 2.192 2.192 0 0 0-1.736 1.039l-.821 1.316Z\"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\tstroke-linecap=\"round\"\n\t\t\t\t\t\t\t\t\tstroke-linejoin=\"round\"\n\t\t\t\t\t\t\t\t\td=\"M16.5 12.75a4.5 4.5 0 1 1-9 0 4.5 4.5 0 0 1 9 0ZM18.75 10.5h.008v.008h-.008V10.5Z\"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</Tooltip>\n\t\t\t\t{/if}\n\t\t\t</div>\n\n\t\t\t<div>\n\t\t\t\t<button\n\t\t\t\t\ttype=\"button\"\n\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\tif (assistantSpeaking) {\n\t\t\t\t\t\t\tstopAllAudio();\n\t\t\t\t\t\t}\n\t\t\t\t\t}}\n\t\t\t\t>\n\t\t\t\t\t<div class=\" line-clamp-1 text-sm font-medium\">\n\t\t\t\t\t\t{#if loading}\n\t\t\t\t\t\t\t{$i18n.t('Thinking...')}\n\t\t\t\t\t\t{:else if assistantSpeaking}\n\t\t\t\t\t\t\t{$i18n.t('Tap to interrupt')}\n\t\t\t\t\t\t{:else}\n\t\t\t\t\t\t\t{$i18n.t('Listening...')}\n\t\t\t\t\t\t{/if}\n\t\t\t\t\t</div>\n\t\t\t\t</button>\n\t\t\t</div>\n\n\t\t\t<div>\n\t\t\t\t<button\n\t\t\t\t\tclass=\" p-3 rounded-full bg-gray-50 dark:bg-gray-900\"\n\t\t\t\t\ton:click={async () => {\n\t\t\t\t\t\tawait stopAudioStream();\n\t\t\t\t\t\tawait stopVideoStream();\n\n\t\t\t\t\t\tconsole.log(audioStream);\n\t\t\t\t\t\tconsole.log(cameraStream);\n\n\t\t\t\t\t\tshowCallOverlay.set(false);\n\t\t\t\t\t\tdispatch('close');\n\t\t\t\t\t}}\n\t\t\t\t\ttype=\"button\"\n\t\t\t\t>\n\t\t\t\t\t<svg\n\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\t\tviewBox=\"0 0 20 20\"\n\t\t\t\t\t\tfill=\"currentColor\"\n\t\t\t\t\t\tclass=\"size-5\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<path\n\t\t\t\t\t\t\td=\"M6.28 5.22a.75.75 0 0 0-1.06 1.06L8.94 10l-3.72 3.72a.75.75 0 1 0 1.06 1.06L10 11.06l3.72 3.72a.75.75 0 1 0 1.06-1.06L11.06 10l3.72-3.72a.75.75 0 0 0-1.06-1.06L10 8.94 6.28 5.22Z\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</svg>\n\t\t\t\t</button>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n{/if}\n","<script lang=\"ts\">\n\texport let className = 'size-4';\n\texport let strokeWidth = '1.5';\n</script>\n\n<svg\n\txmlns=\"http://www.w3.org/2000/svg\"\n\tfill=\"none\"\n\tviewBox=\"0 0 24 24\"\n\tstroke-width={strokeWidth}\n\tstroke=\"currentColor\"\n\tclass={className}\n>\n\t<path\n\t\tstroke-linecap=\"round\"\n\t\tstroke-linejoin=\"round\"\n\t\td=\"M3.75 3.75v4.5m0-4.5h4.5m-4.5 0L9 9M3.75 20.25v-4.5m0 4.5h4.5m-4.5 0L9 15M20.25 3.75h-4.5m4.5 0v4.5m0-4.5L15 9m5.25 11.25h-4.5m4.5 0v-4.5m0 4.5L15 15\"\n\t/>\n</svg>\n","<script lang=\"ts\">\n\timport { toast } from 'svelte-sonner';\n\timport { onMount, getContext, createEventDispatcher } from 'svelte';\n\tconst i18n = getContext('i18n');\n\tconst dispatch = createEventDispatcher();\n\n\timport {\n\t\tartifactCode,\n\t\tchatId,\n\t\tsettings,\n\t\tshowArtifacts,\n\t\tshowControls,\n\t\tartifactContents\n\t} from '$lib/stores';\n\timport { copyToClipboard, createMessagesList } from '$lib/utils';\n\n\timport XMark from '../icons/XMark.svelte';\n\timport ArrowsPointingOut from '../icons/ArrowsPointingOut.svelte';\n\timport Tooltip from '../common/Tooltip.svelte';\n\timport SvgPanZoom from '../common/SVGPanZoom.svelte';\n\timport ArrowLeft from '../icons/ArrowLeft.svelte';\n\timport Download from '../icons/Download.svelte';\n\n\texport let overlay = false;\n\n\tlet contents: Array<{ type: string; content: string }> = [];\n\tlet selectedContentIdx = 0;\n\n\tlet copied = false;\n\tlet iframeElement: HTMLIFrameElement;\n\n\tfunction navigateContent(direction: 'prev' | 'next') {\n\t\tselectedContentIdx =\n\t\t\tdirection === 'prev'\n\t\t\t\t? Math.max(selectedContentIdx - 1, 0)\n\t\t\t\t: Math.min(selectedContentIdx + 1, contents.length - 1);\n\t}\n\n\tconst iframeLoadHandler = () => {\n\t\tiframeElement.contentWindow.addEventListener(\n\t\t\t'click',\n\t\t\tfunction (e) {\n\t\t\t\tconst target = e.target.closest('a');\n\t\t\t\tif (target && target.href) {\n\t\t\t\t\te.preventDefault();\n\t\t\t\t\tconst url = new URL(target.href, iframeElement.baseURI);\n\t\t\t\t\tif (url.origin === window.location.origin) {\n\t\t\t\t\t\tiframeElement.contentWindow.history.pushState(\n\t\t\t\t\t\t\tnull,\n\t\t\t\t\t\t\t'',\n\t\t\t\t\t\t\turl.pathname + url.search + url.hash\n\t\t\t\t\t\t);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tconsole.info('External navigation blocked:', url.href);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t\ttrue\n\t\t);\n\n\t\t// Cancel drag when hovering over iframe\n\t\tiframeElement.contentWindow.addEventListener('mouseenter', function (e) {\n\t\t\te.preventDefault();\n\t\t\tiframeElement.contentWindow.addEventListener('dragstart', (event) => {\n\t\t\t\tevent.preventDefault();\n\t\t\t});\n\t\t});\n\t};\n\n\tconst showFullScreen = () => {\n\t\tif (iframeElement.requestFullscreen) {\n\t\t\tiframeElement.requestFullscreen();\n\t\t} else if (iframeElement.webkitRequestFullscreen) {\n\t\t\tiframeElement.webkitRequestFullscreen();\n\t\t} else if (iframeElement.msRequestFullscreen) {\n\t\t\tiframeElement.msRequestFullscreen();\n\t\t}\n\t};\n\n\tconst downloadArtifact = () => {\n\t\tconst blob = new Blob([contents[selectedContentIdx].content], { type: 'text/html' });\n\t\tconst url = URL.createObjectURL(blob);\n\t\tconst a = document.createElement('a');\n\t\ta.href = url;\n\t\ta.download = `artifact-${$chatId}-${selectedContentIdx}.html`;\n\t\tdocument.body.appendChild(a);\n\t\ta.click();\n\t\tdocument.body.removeChild(a);\n\t\tURL.revokeObjectURL(url);\n\t};\n\n\tonMount(() => {\n\t\tartifactCode.subscribe((value) => {\n\t\t\tif (contents) {\n\t\t\t\tconst codeIdx = contents.findIndex((content) => content.content.includes(value));\n\t\t\t\tselectedContentIdx = codeIdx !== -1 ? codeIdx : 0;\n\t\t\t}\n\t\t});\n\n\t\tartifactContents.subscribe((value) => {\n\t\t\tcontents = value;\n\t\t\tconsole.log('Artifact contents updated:', contents);\n\n\t\t\tif (contents.length === 0) {\n\t\t\t\tshowControls.set(false);\n\t\t\t\tshowArtifacts.set(false);\n\t\t\t}\n\n\t\t\tselectedContentIdx = contents ? contents.length - 1 : 0;\n\t\t});\n\t});\n</script>\n\n<div\n\tclass=\" w-full h-full relative flex flex-col bg-white dark:bg-gray-850\"\n\tid=\"artifacts-container\"\n>\n\t<div class=\"w-full h-full flex flex-col flex-1 relative\">\n\t\t{#if contents.length > 0}\n\t\t\t<div\n\t\t\t\tclass=\"pointer-events-auto z-20 flex justify-between items-center p-2.5 font-primar text-gray-900 dark:text-white\"\n\t\t\t>\n\t\t\t\t<div class=\"flex-1 flex items-center justify-between pr-1\">\n\t\t\t\t\t<div class=\"flex items-center space-x-2\">\n\t\t\t\t\t\t<div class=\"flex items-center gap-0.5 self-center min-w-fit\" dir=\"ltr\">\n\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\tclass=\"self-center p-1 hover:bg-black/5 dark:hover:bg-white/5 dark:hover:text-white hover:text-black rounded-md transition disabled:cursor-not-allowed\"\n\t\t\t\t\t\t\t\ton:click={() => navigateContent('prev')}\n\t\t\t\t\t\t\t\tdisabled={contents.length <= 1}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<svg\n\t\t\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\t\t\t\t\tfill=\"none\"\n\t\t\t\t\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\t\t\t\t\tstroke-width=\"2.5\"\n\t\t\t\t\t\t\t\t\tclass=\"size-3.5\"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\t\tstroke-linecap=\"round\"\n\t\t\t\t\t\t\t\t\t\tstroke-linejoin=\"round\"\n\t\t\t\t\t\t\t\t\t\td=\"M15.75 19.5 8.25 12l7.5-7.5\"\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t</button>\n\n\t\t\t\t\t\t\t<div class=\"text-xs self-center dark:text-gray-100 min-w-fit\">\n\t\t\t\t\t\t\t\t{$i18n.t('Version {{selectedVersion}} of {{totalVersions}}', {\n\t\t\t\t\t\t\t\t\tselectedVersion: selectedContentIdx + 1,\n\t\t\t\t\t\t\t\t\ttotalVersions: contents.length\n\t\t\t\t\t\t\t\t})}\n\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\tclass=\"self-center p-1 hover:bg-black/5 dark:hover:bg-white/5 dark:hover:text-white hover:text-black rounded-md transition disabled:cursor-not-allowed\"\n\t\t\t\t\t\t\t\ton:click={() => navigateContent('next')}\n\t\t\t\t\t\t\t\tdisabled={contents.length <= 1}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<svg\n\t\t\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\t\t\t\t\tfill=\"none\"\n\t\t\t\t\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\t\t\t\t\tstroke-width=\"2.5\"\n\t\t\t\t\t\t\t\t\tclass=\"size-3.5\"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\t\tstroke-linecap=\"round\"\n\t\t\t\t\t\t\t\t\t\tstroke-linejoin=\"round\"\n\t\t\t\t\t\t\t\t\t\td=\"m8.25 4.5 7.5 7.5-7.5 7.5\"\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div class=\"flex items-center gap-1.5\">\n\t\t\t\t\t\t<button\n\t\t\t\t\t\t\tclass=\"copy-code-button bg-none border-none text-xs bg-gray-50 hover:bg-gray-100 dark:bg-gray-850 dark:hover:bg-gray-800 transition rounded-md px-1.5 py-0.5\"\n\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\tcopyToClipboard(contents[selectedContentIdx].content);\n\t\t\t\t\t\t\t\tcopied = true;\n\n\t\t\t\t\t\t\t\tsetTimeout(() => {\n\t\t\t\t\t\t\t\t\tcopied = false;\n\t\t\t\t\t\t\t\t}, 2000);\n\t\t\t\t\t\t\t}}>{copied ? $i18n.t('Copied') : $i18n.t('Copy')}</button\n\t\t\t\t\t\t>\n\n\t\t\t\t\t\t<Tooltip content={$i18n.t('Download')}>\n\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\tclass=\" bg-none border-none text-xs bg-gray-50 hover:bg-gray-100 dark:bg-gray-850 dark:hover:bg-gray-800 transition rounded-md p-0.5\"\n\t\t\t\t\t\t\t\ton:click={downloadArtifact}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<Download className=\"size-3.5\" />\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t</Tooltip>\n\n\t\t\t\t\t\t{#if contents[selectedContentIdx].type === 'iframe'}\n\t\t\t\t\t\t\t<Tooltip content={$i18n.t('Open in full screen')}>\n\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\tclass=\" bg-none border-none text-xs bg-gray-50 hover:bg-gray-100 dark:bg-gray-850 dark:hover:bg-gray-800 transition rounded-md p-0.5\"\n\t\t\t\t\t\t\t\t\ton:click={showFullScreen}\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<ArrowsPointingOut className=\"size-3.5\" />\n\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t</Tooltip>\n\t\t\t\t\t\t{/if}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\n\t\t\t\t<button\n\t\t\t\t\tclass=\"self-center pointer-events-auto p-1 rounded-full bg-white dark:bg-gray-850\"\n\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\tdispatch('close');\n\t\t\t\t\t\tshowControls.set(false);\n\t\t\t\t\t\tshowArtifacts.set(false);\n\t\t\t\t\t}}\n\t\t\t\t>\n\t\t\t\t\t<XMark className=\"size-3.5 text-gray-900 dark:text-white\" />\n\t\t\t\t</button>\n\t\t\t</div>\n\t\t{/if}\n\n\t\t{#if overlay}\n\t\t\t<div class=\" absolute top-0 left-0 right-0 bottom-0 z-10\"></div>\n\t\t{/if}\n\n\t\t<div class=\"flex-1 w-full h-full\">\n\t\t\t<div class=\" h-full flex flex-col\">\n\t\t\t\t{#if contents.length > 0}\n\t\t\t\t\t<div class=\"max-w-full w-full h-full\">\n\t\t\t\t\t\t{#if contents[selectedContentIdx].type === 'iframe'}\n\t\t\t\t\t\t\t<iframe\n\t\t\t\t\t\t\t\tbind:this={iframeElement}\n\t\t\t\t\t\t\t\ttitle=\"Content\"\n\t\t\t\t\t\t\t\tsrcdoc={contents[selectedContentIdx].content}\n\t\t\t\t\t\t\t\tclass=\"w-full border-0 h-full rounded-none\"\n\t\t\t\t\t\t\t\tsandbox=\"allow-scripts allow-downloads{($settings?.iframeSandboxAllowForms ?? false)\n\t\t\t\t\t\t\t\t\t? ' allow-forms'\n\t\t\t\t\t\t\t\t\t: ''}{($settings?.iframeSandboxAllowSameOrigin ?? false)\n\t\t\t\t\t\t\t\t\t? ' allow-same-origin'\n\t\t\t\t\t\t\t\t\t: ''}\"\n\t\t\t\t\t\t\t\ton:load={iframeLoadHandler}\n\t\t\t\t\t\t\t></iframe>\n\t\t\t\t\t\t{:else if contents[selectedContentIdx].type === 'svg'}\n\t\t\t\t\t\t\t<SvgPanZoom\n\t\t\t\t\t\t\t\tclassName=\" w-full h-full max-h-full overflow-hidden\"\n\t\t\t\t\t\t\t\tsvg={contents[selectedContentIdx].content}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t{/if}\n\t\t\t\t\t</div>\n\t\t\t\t{:else}\n\t\t\t\t\t<div class=\"m-auto font-medium text-xs text-gray-900 dark:text-white\">\n\t\t\t\t\t\t{$i18n.t('No HTML, CSS, or JavaScript content found.')}\n\t\t\t\t\t</div>\n\t\t\t\t{/if}\n\t\t\t</div>\n\t\t</div>\n\t</div>\n</div>\n","<script lang=\"ts\">\n\timport { embed, showControls, showEmbeds } from '$lib/stores';\n\n\timport FullHeightIframe from '$lib/components/common/FullHeightIframe.svelte';\n\timport XMark from '$lib/components/icons/XMark.svelte';\n\n\texport let overlay = false;\n\n\tconst getSrcUrl = (url: string, chatId?: string, messageId?: string, sourceId: string) => {\n\t\ttry {\n\t\t\tconst parsed = new URL(url);\n\n\t\t\tif (chatId) {\n\t\t\t\tparsed.searchParams.set('chat_id', chatId);\n\t\t\t}\n\n\t\t\tif (messageId) {\n\t\t\t\tparsed.searchParams.set('message_id', messageId);\n\t\t\t}\n\n\t\t\tif (sourceId) {\n\t\t\t\tparsed.searchParams.set('source_id', sourceId);\n\t\t\t}\n\n\t\t\treturn parsed.toString();\n\t\t} catch {\n\t\t\t// Fallback for relative URLs or invalid input\n\t\t\tconst hasQuery = url.includes('?');\n\t\t\tconst parts = [];\n\n\t\t\tif (chatId) parts.push(`chat_id=${encodeURIComponent(chatId)}`);\n\t\t\tif (messageId) parts.push(`message_id=${encodeURIComponent(messageId)}`);\n\t\t\tif (sourceId) parts.push(`source_id=${encodeURIComponent(sourceId)}`);\n\n\t\t\tif (parts.length === 0) return url;\n\n\t\t\treturn url + (hasQuery ? '&' : '?') + parts.join('&');\n\t\t}\n\t};\n</script>\n\n{#if $embed}\n\t<div class=\"h-full w-full\">\n\t\t<div\n\t\t\tclass=\"pointer-events-auto z-20 flex justify-between items-center py-3 px-2 font-primar text-gray-900 dark:text-white\"\n\t\t>\n\t\t\t<div class=\"flex-1 flex items-center justify-between pl-2\">\n\t\t\t\t<a\n\t\t\t\t\tclass=\"flex items-center space-x-2 hover:underline\"\n\t\t\t\t\thref={$embed?.url}\n\t\t\t\t\ttarget=\"_blank\"\n\t\t\t\t\trel=\"noopener noreferrer\"\n\t\t\t\t>\n\t\t\t\t\t{$embed?.title ?? 'Embedded Content'}\n\t\t\t\t</a>\n\t\t\t</div>\n\n\t\t\t<button\n\t\t\t\tclass=\"self-center pointer-events-auto p-1 rounded-full bg-white dark:bg-gray-850\"\n\t\t\t\ton:click={() => {\n\t\t\t\t\tshowControls.set(false);\n\t\t\t\t\tshowEmbeds.set(false);\n\t\t\t\t\tembed.set(null);\n\t\t\t\t}}\n\t\t\t>\n\t\t\t\t<XMark className=\"size-3.5 text-gray-900 dark:text-white\" />\n\t\t\t</button>\n\t\t</div>\n\n\t\t<div class=\" w-full h-full relative\">\n\t\t\t{#if overlay}\n\t\t\t\t<div class=\" absolute top-0 left-0 right-0 bottom-0 z-10\"></div>\n\t\t\t{/if}\n\n\t\t\t<FullHeightIframe\n\t\t\t\tsrc={getSrcUrl($embed?.url ?? '', $embed?.chatId, $embed?.messageId, $embed?.sourceId)}\n\t\t\t\tpayload={$embed?.source ?? null}\n\t\t\t\tiframeClassName=\"w-full h-full\"\n\t\t\t/>\n\t\t</div>\n\t</div>\n{/if}\n","<script lang=\"ts\">\n\timport { SvelteFlowProvider } from '@xyflow/svelte';\n\timport { slide } from 'svelte/transition';\n\timport { Pane, PaneResizer } from 'paneforge';\n\n\timport { onDestroy, onMount, tick } from 'svelte';\n\timport {\n\t\tmobile,\n\t\tshowControls,\n\t\tshowCallOverlay,\n\t\tshowOverview,\n\t\tshowArtifacts,\n\t\tshowEmbeds\n\t} from '$lib/stores';\n\n\timport Controls from './Controls/Controls.svelte';\n\timport CallOverlay from './MessageInput/CallOverlay.svelte';\n\timport Drawer from '../common/Drawer.svelte';\n\timport Artifacts from './Artifacts.svelte';\n\timport Embeds from './ChatControls/Embeds.svelte';\n\n\texport let history;\n\texport let models = [];\n\n\texport let chatId = null;\n\n\texport let chatFiles = [];\n\texport let params = {};\n\n\texport let eventTarget: EventTarget;\n\texport let submitPrompt: Function;\n\texport let stopResponse: Function;\n\texport let showMessage: Function;\n\texport let files;\n\texport let modelId;\n\n\texport let pane;\n\n\tlet mediaQuery;\n\tlet largeScreen = false;\n\tlet dragged = false;\n\n\tlet minSize = 0;\n\n\texport const openPane = () => {\n\t\tif (parseInt(localStorage?.chatControlsSize)) {\n\t\t\tconst container = document.getElementById('chat-container');\n\t\t\tlet size = Math.floor(\n\t\t\t\t(parseInt(localStorage?.chatControlsSize) / container.clientWidth) * 100\n\t\t\t);\n\t\t\tpane.resize(size);\n\t\t} else {\n\t\t\tpane.resize(minSize);\n\t\t}\n\t};\n\n\tconst handleMediaQuery = async (e) => {\n\t\tif (e.matches) {\n\t\t\tlargeScreen = true;\n\n\t\t\tif ($showCallOverlay) {\n\t\t\t\tshowCallOverlay.set(false);\n\t\t\t\tawait tick();\n\t\t\t\tshowCallOverlay.set(true);\n\t\t\t}\n\t\t} else {\n\t\t\tlargeScreen = false;\n\n\t\t\tif ($showCallOverlay) {\n\t\t\t\tshowCallOverlay.set(false);\n\t\t\t\tawait tick();\n\t\t\t\tshowCallOverlay.set(true);\n\t\t\t}\n\t\t\tpane = null;\n\t\t}\n\t};\n\n\tconst onMouseDown = (event) => {\n\t\tdragged = true;\n\t};\n\n\tconst onMouseUp = (event) => {\n\t\tdragged = false;\n\t};\n\n\tonMount(() => {\n\t\t// listen to resize 1024px\n\t\tmediaQuery = window.matchMedia('(min-width: 1024px)');\n\n\t\tmediaQuery.addEventListener('change', handleMediaQuery);\n\t\thandleMediaQuery(mediaQuery);\n\n\t\t// Select the container element you want to observe\n\t\tconst container = document.getElementById('chat-container');\n\n\t\t// initialize the minSize based on the container width\n\t\tminSize = Math.floor((350 / container.clientWidth) * 100);\n\n\t\t// Create a new ResizeObserver instance\n\t\tconst resizeObserver = new ResizeObserver((entries) => {\n\t\t\tfor (let entry of entries) {\n\t\t\t\tconst width = entry.contentRect.width;\n\t\t\t\t// calculate the percentage of 350px\n\t\t\t\tconst percentage = (350 / width) * 100;\n\t\t\t\t// set the minSize to the percentage, must be an integer\n\t\t\t\tminSize = Math.floor(percentage);\n\n\t\t\t\tif ($showControls) {\n\t\t\t\t\tif (pane && pane.isExpanded() && pane.getSize() < minSize) {\n\t\t\t\t\t\tpane.resize(minSize);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tlet size = Math.floor(\n\t\t\t\t\t\t\t(parseInt(localStorage?.chatControlsSize) / container.clientWidth) * 100\n\t\t\t\t\t\t);\n\t\t\t\t\t\tif (size < minSize) {\n\t\t\t\t\t\t\tpane.resize(minSize);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\t// Start observing the container's size changes\n\t\tresizeObserver.observe(container);\n\n\t\tdocument.addEventListener('mousedown', onMouseDown);\n\t\tdocument.addEventListener('mouseup', onMouseUp);\n\t});\n\n\tonDestroy(() => {\n\t\tshowControls.set(false);\n\n\t\tmediaQuery.removeEventListener('change', handleMediaQuery);\n\t\tdocument.removeEventListener('mousedown', onMouseDown);\n\t\tdocument.removeEventListener('mouseup', onMouseUp);\n\t});\n\n\tconst closeHandler = () => {\n\t\tshowControls.set(false);\n\t\tshowOverview.set(false);\n\t\tshowArtifacts.set(false);\n\t\tshowEmbeds.set(false);\n\n\t\tif ($showCallOverlay) {\n\t\t\tshowCallOverlay.set(false);\n\t\t}\n\t};\n\n\t$: if (!chatId) {\n\t\tcloseHandler();\n\t}\n</script>\n\n{#if !largeScreen}\n\t{#if $showControls}\n\t\t<Drawer\n\t\t\tshow={$showControls}\n\t\t\tonClose={() => {\n\t\t\t\tshowControls.set(false);\n\t\t\t}}\n\t\t>\n\t\t\t<div\n\t\t\t\tclass=\" {$showCallOverlay || $showOverview || $showArtifacts || $showEmbeds\n\t\t\t\t\t? ' h-screen  w-full'\n\t\t\t\t\t: 'px-4 py-3'} h-full\"\n\t\t\t>\n\t\t\t\t{#if $showCallOverlay}\n\t\t\t\t\t<div\n\t\t\t\t\t\tclass=\" h-full max-h-[100dvh] bg-white text-gray-700 dark:bg-black dark:text-gray-300 flex justify-center\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<CallOverlay\n\t\t\t\t\t\t\tbind:files\n\t\t\t\t\t\t\t{submitPrompt}\n\t\t\t\t\t\t\t{stopResponse}\n\t\t\t\t\t\t\t{modelId}\n\t\t\t\t\t\t\t{chatId}\n\t\t\t\t\t\t\t{eventTarget}\n\t\t\t\t\t\t\ton:close={() => {\n\t\t\t\t\t\t\t\tshowControls.set(false);\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t{:else if $showEmbeds}\n\t\t\t\t\t<Embeds />\n\t\t\t\t{:else if $showArtifacts}\n\t\t\t\t\t<Artifacts {history} />\n\t\t\t\t{:else if $showOverview}\n\t\t\t\t\t{#await import('./Overview.svelte') then { default: Overview }}\n\t\t\t\t\t\t<Overview\n\t\t\t\t\t\t\t{history}\n\t\t\t\t\t\t\tonNodeClick={(e) => {\n\t\t\t\t\t\t\t\tconst node = e.node;\n\t\t\t\t\t\t\t\tshowMessage(node.data.message, true);\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\tonClose={() => {\n\t\t\t\t\t\t\t\tshowControls.set(false);\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t/>\n\t\t\t\t\t{/await}\n\t\t\t\t{:else}\n\t\t\t\t\t<Controls\n\t\t\t\t\t\ton:close={() => {\n\t\t\t\t\t\t\tshowControls.set(false);\n\t\t\t\t\t\t}}\n\t\t\t\t\t\t{models}\n\t\t\t\t\t\tbind:chatFiles\n\t\t\t\t\t\tbind:params\n\t\t\t\t\t/>\n\t\t\t\t{/if}\n\t\t\t</div>\n\t\t</Drawer>\n\t{/if}\n{:else}\n\t<!-- if $showControls -->\n\n\t{#if $showControls}\n\t\t<PaneResizer\n\t\t\tclass=\"relative flex items-center justify-center group border-l border-gray-50 dark:border-gray-850/30 hover:border-gray-200 dark:hover:border-gray-800  transition z-20\"\n\t\t\tid=\"controls-resizer\"\n\t\t>\n\t\t\t<div\n\t\t\t\tclass=\" absolute -left-1.5 -right-1.5 -top-0 -bottom-0 z-20 cursor-col-resize bg-transparent\"\n\t\t\t/>\n\t\t</PaneResizer>\n\t{/if}\n\n\t<Pane\n\t\tbind:pane\n\t\tdefaultSize={0}\n\t\tonResize={(size) => {\n\t\t\tif ($showControls && pane.isExpanded()) {\n\t\t\t\tif (size < minSize) {\n\t\t\t\t\tpane.resize(minSize);\n\t\t\t\t}\n\n\t\t\t\tif (size < minSize) {\n\t\t\t\t\tlocalStorage.chatControlsSize = 0;\n\t\t\t\t} else {\n\t\t\t\t\t// save the size in  pixels to localStorage\n\t\t\t\t\tconst container = document.getElementById('chat-container');\n\t\t\t\t\tlocalStorage.chatControlsSize = Math.floor((size / 100) * container.clientWidth);\n\t\t\t\t}\n\t\t\t}\n\t\t}}\n\t\tonCollapse={() => {\n\t\t\tshowControls.set(false);\n\t\t}}\n\t\tcollapsible={true}\n\t\tclass=\" z-10 bg-white dark:bg-gray-850\"\n\t>\n\t\t{#if $showControls}\n\t\t\t<div class=\"flex max-h-full min-h-full\">\n\t\t\t\t<div\n\t\t\t\t\tclass=\"w-full {($showOverview || $showArtifacts || $showEmbeds) && !$showCallOverlay\n\t\t\t\t\t\t? ' '\n\t\t\t\t\t\t: 'px-4 py-3 bg-white dark:shadow-lg dark:bg-gray-850 '} z-40 pointer-events-auto overflow-y-auto scrollbar-hidden\"\n\t\t\t\t\tid=\"controls-container\"\n\t\t\t\t>\n\t\t\t\t\t{#if $showCallOverlay}\n\t\t\t\t\t\t<div class=\"w-full h-full flex justify-center\">\n\t\t\t\t\t\t\t<CallOverlay\n\t\t\t\t\t\t\t\tbind:files\n\t\t\t\t\t\t\t\t{submitPrompt}\n\t\t\t\t\t\t\t\t{stopResponse}\n\t\t\t\t\t\t\t\t{modelId}\n\t\t\t\t\t\t\t\t{chatId}\n\t\t\t\t\t\t\t\t{eventTarget}\n\t\t\t\t\t\t\t\ton:close={() => {\n\t\t\t\t\t\t\t\t\tshowControls.set(false);\n\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t{:else if $showEmbeds}\n\t\t\t\t\t\t<Embeds overlay={dragged} />\n\t\t\t\t\t{:else if $showArtifacts}\n\t\t\t\t\t\t<Artifacts {history} overlay={dragged} />\n\t\t\t\t\t{:else if $showOverview}\n\t\t\t\t\t\t{#await import('./Overview.svelte') then { default: Overview }}\n\t\t\t\t\t\t\t<Overview\n\t\t\t\t\t\t\t\t{history}\n\t\t\t\t\t\t\t\tonNodeClick={(e) => {\n\t\t\t\t\t\t\t\t\tconst node = e.node;\n\t\t\t\t\t\t\t\t\tif (node?.data?.message?.favorite) {\n\t\t\t\t\t\t\t\t\t\thistory.messages[node.data.message.id].favorite = true;\n\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\thistory.messages[node.data.message.id].favorite = null;\n\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\tshowMessage(node.data.message, true);\n\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\tonClose={() => {\n\t\t\t\t\t\t\t\t\tshowControls.set(false);\n\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t{/await}\n\t\t\t\t\t{:else}\n\t\t\t\t\t\t<Controls\n\t\t\t\t\t\t\ton:close={() => {\n\t\t\t\t\t\t\t\tshowControls.set(false);\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t{models}\n\t\t\t\t\t\t\tbind:chatFiles\n\t\t\t\t\t\t\tbind:params\n\t\t\t\t\t\t/>\n\t\t\t\t\t{/if}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t{/if}\n\t</Pane>\n{/if}\n","<script lang=\"ts\">\n\timport { getContext, onMount } from 'svelte';\n\tconst i18n = getContext('i18n');\n\n\timport dayjs from 'dayjs';\n\timport localizedFormat from 'dayjs/plugin/localizedFormat';\n\timport { getTimeRange } from '$lib/utils';\n\timport ChevronUp from '$lib/components/icons/ChevronUp.svelte';\n\timport ChevronDown from '$lib/components/icons/ChevronDown.svelte';\n\timport Loader from '$lib/components/common/Loader.svelte';\n\timport Spinner from '$lib/components/common/Spinner.svelte';\n\n\tdayjs.extend(localizedFormat);\n\n\texport let chats = [];\n\n\texport let chatListLoading = false;\n\texport let allChatsLoaded = false;\n\n\texport let loadHandler: Function = null;\n\n\tlet chatList = null;\n\n\tconst init = async () => {\n\t\tif (chats.length === 0) {\n\t\t\tchatList = [];\n\t\t} else {\n\t\t\tchatList = chats.map((chat) => ({\n\t\t\t\t...chat,\n\t\t\t\ttime_range: getTimeRange(chat.updated_at)\n\t\t\t}));\n\n\t\t\tchatList.sort((a, b) => {\n\t\t\t\tif (direction === 'asc') {\n\t\t\t\t\treturn a[orderBy] > b[orderBy] ? 1 : -1;\n\t\t\t\t} else {\n\t\t\t\t\treturn a[orderBy] < b[orderBy] ? 1 : -1;\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t};\n\n\tconst setSortKey = (key) => {\n\t\tif (orderBy === key) {\n\t\t\tdirection = direction === 'asc' ? 'desc' : 'asc';\n\t\t} else {\n\t\t\torderBy = key;\n\t\t\tdirection = 'asc';\n\t\t}\n\n\t\tinit();\n\t};\n\n\tlet orderBy = 'updated_at';\n\tlet direction = 'desc'; // 'asc' or 'desc'\n\n\t$: if (chats) {\n\t\tinit();\n\t}\n</script>\n\n{#if chatList}\n\t{#if chatList.length > 0}\n\t\t<div class=\"flex text-xs font-medium mb-1 items-center -mr-0.5\">\n\t\t\t<button\n\t\t\t\tclass=\"px-1.5 py-1 cursor-pointer select-none basis-3/5\"\n\t\t\t\ton:click={() => setSortKey('title')}\n\t\t\t>\n\t\t\t\t<div class=\"flex gap-1.5 items-center\">\n\t\t\t\t\t{$i18n.t('Title')}\n\n\t\t\t\t\t{#if orderBy === 'title'}\n\t\t\t\t\t\t<span class=\"font-normal\"\n\t\t\t\t\t\t\t>{#if direction === 'asc'}\n\t\t\t\t\t\t\t\t<ChevronUp className=\"size-2\" />\n\t\t\t\t\t\t\t{:else}\n\t\t\t\t\t\t\t\t<ChevronDown className=\"size-2\" />\n\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t{:else}\n\t\t\t\t\t\t<span class=\"invisible\">\n\t\t\t\t\t\t\t<ChevronUp className=\"size-2\" />\n\t\t\t\t\t\t</span>\n\t\t\t\t\t{/if}\n\t\t\t\t</div>\n\t\t\t</button>\n\t\t\t<button\n\t\t\t\tclass=\"px-1.5 py-1 cursor-pointer select-none hidden sm:flex sm:basis-2/5 justify-end\"\n\t\t\t\ton:click={() => setSortKey('updated_at')}\n\t\t\t>\n\t\t\t\t<div class=\"flex gap-1.5 items-center\">\n\t\t\t\t\t{$i18n.t('Updated at')}\n\n\t\t\t\t\t{#if orderBy === 'updated_at'}\n\t\t\t\t\t\t<span class=\"font-normal\"\n\t\t\t\t\t\t\t>{#if direction === 'asc'}\n\t\t\t\t\t\t\t\t<ChevronUp className=\"size-2\" />\n\t\t\t\t\t\t\t{:else}\n\t\t\t\t\t\t\t\t<ChevronDown className=\"size-2\" />\n\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t{:else}\n\t\t\t\t\t\t<span class=\"invisible\">\n\t\t\t\t\t\t\t<ChevronUp className=\"size-2\" />\n\t\t\t\t\t\t</span>\n\t\t\t\t\t{/if}\n\t\t\t\t</div>\n\t\t\t</button>\n\t\t</div>\n\t{/if}\n\n\t<div class=\"text-left text-sm w-full mb-3\">\n\t\t{#if chatList.length === 0}\n\t\t\t<div\n\t\t\t\tclass=\"text-xs text-gray-500 dark:text-gray-400 text-center px-5 min-h-20 w-full h-full flex justify-center items-center\"\n\t\t\t>\n\t\t\t\t{$i18n.t('No chats found')}\n\t\t\t</div>\n\t\t{/if}\n\n\t\t{#each chatList as chat, idx (chat.id)}\n\t\t\t{#if (idx === 0 || (idx > 0 && chat.time_range !== chatList[idx - 1].time_range)) && chat?.time_range}\n\t\t\t\t<div\n\t\t\t\t\tclass=\"w-full text-xs text-gray-500 dark:text-gray-500 font-medium {idx === 0\n\t\t\t\t\t\t? ''\n\t\t\t\t\t\t: 'pt-5'} pb-2 px-2\"\n\t\t\t\t>\n\t\t\t\t\t{$i18n.t(chat.time_range)}\n\t\t\t\t\t<!-- localisation keys for time_range to be recognized from the i18next parser (so they don't get automatically removed):\n\t\t\t\t\t\t\t{$i18n.t('Today')}\n\t\t\t\t\t\t\t{$i18n.t('Yesterday')}\n\t\t\t\t\t\t\t{$i18n.t('Previous 7 days')}\n\t\t\t\t\t\t\t{$i18n.t('Previous 30 days')}\n\t\t\t\t\t\t\t{$i18n.t('January')}\n\t\t\t\t\t\t\t{$i18n.t('February')}\n\t\t\t\t\t\t\t{$i18n.t('March')}\n\t\t\t\t\t\t\t{$i18n.t('April')}\n\t\t\t\t\t\t\t{$i18n.t('May')}\n\t\t\t\t\t\t\t{$i18n.t('June')}\n\t\t\t\t\t\t\t{$i18n.t('July')}\n\t\t\t\t\t\t\t{$i18n.t('August')}\n\t\t\t\t\t\t\t{$i18n.t('September')}\n\t\t\t\t\t\t\t{$i18n.t('October')}\n\t\t\t\t\t\t\t{$i18n.t('November')}\n\t\t\t\t\t\t\t{$i18n.t('December')}\n\t\t\t\t\t\t\t-->\n\t\t\t\t</div>\n\t\t\t{/if}\n\n\t\t\t<a\n\t\t\t\tclass=\" w-full flex justify-between items-center rounded-lg text-sm py-2 px-3 hover:bg-gray-50 dark:hover:bg-gray-850\"\n\t\t\t\tdraggable=\"false\"\n\t\t\t\thref={`/c/${chat.id}`}\n\t\t\t\ton:click={() => (show = false)}\n\t\t\t>\n\t\t\t\t<div class=\"text-ellipsis line-clamp-1 w-full sm:basis-3/5\">\n\t\t\t\t\t{chat?.title}\n\t\t\t\t</div>\n\n\t\t\t\t<div class=\"hidden sm:flex sm:basis-2/5 items-center justify-end\">\n\t\t\t\t\t<div class=\" text-gray-500 dark:text-gray-400 text-xs\">\n\t\t\t\t\t\t{dayjs(chat?.updated_at * 1000).calendar()}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</a>\n\t\t{/each}\n\n\t\t{#if !allChatsLoaded && loadHandler}\n\t\t\t<Loader\n\t\t\t\ton:visible={(e) => {\n\t\t\t\t\tif (!chatListLoading) {\n\t\t\t\t\t\tloadHandler();\n\t\t\t\t\t}\n\t\t\t\t}}\n\t\t\t>\n\t\t\t\t<div class=\"w-full flex justify-center py-1 text-xs animate-pulse items-center gap-2\">\n\t\t\t\t\t<Spinner className=\" size-4\" />\n\t\t\t\t\t<div class=\" \">Loading...</div>\n\t\t\t\t</div>\n\t\t\t</Loader>\n\t\t{/if}\n\t</div>\n{/if}\n","<script lang=\"ts\">\n\timport { getContext, onMount } from 'svelte';\n\timport type { Writable } from 'svelte/store';\n\n\tconst i18n: Writable<any> = getContext('i18n');\n\n\timport { fade } from 'svelte/transition';\n\n\timport ChatList from './ChatList.svelte';\n\timport FolderKnowledge from './FolderKnowledge.svelte';\n\timport Spinner from '$lib/components/common/Spinner.svelte';\n\timport { getChatListByFolderId } from '$lib/apis/chats';\n\n\texport let folder: any = null;\n\n\tlet selectedTab = 'chats';\n\n\tlet page = 1;\n\n\tlet chats: any[] | null = null;\n\tlet chatListLoading = false;\n\tlet allChatsLoaded = false;\n\n\tconst loadChats = async () => {\n\t\tchatListLoading = true;\n\n\t\tpage += 1;\n\n\t\tlet newChatList: any[] = [];\n\n\t\tnewChatList = await getChatListByFolderId(localStorage.token, folder.id, page).catch(\n\t\t\t(error) => {\n\t\t\t\tconsole.error(error);\n\t\t\t\treturn [];\n\t\t\t}\n\t\t);\n\n\t\t// once the bottom of the list has been reached (no results) there is no need to continue querying\n\t\tallChatsLoaded = newChatList.length === 0;\n\t\tchats = [...(chats || []), ...(newChatList || [])];\n\n\t\tchatListLoading = false;\n\t};\n\n\tconst setChatList = async () => {\n\t\tchats = null;\n\t\tpage = 1;\n\t\tallChatsLoaded = false;\n\t\tchatListLoading = false;\n\n\t\tif (folder && folder.id) {\n\t\t\tconst res = await getChatListByFolderId(localStorage.token, folder.id, page);\n\n\t\t\tif (res) {\n\t\t\t\tchats = res;\n\t\t\t} else {\n\t\t\t\tchats = [];\n\t\t\t}\n\t\t} else {\n\t\t\tchats = [];\n\t\t}\n\t};\n\n\t$: if (folder) {\n\t\tsetChatList();\n\t}\n</script>\n\n<div>\n\t<!-- <div class=\"mb-1\">\n\t\t<div\n\t\t\tclass=\"flex gap-1 scrollbar-none overflow-x-auto w-fit text-center text-sm font-medium rounded-full bg-transparent py-1 touch-auto pointer-events-auto\"\n\t\t>\n\t\t\t<button\n\t\t\t\tclass=\"min-w-fit p-1.5 {selectedTab === 'knowledge'\n\t\t\t\t\t? ''\n\t\t\t\t\t: 'text-gray-300 dark:text-gray-600 hover:text-gray-700 dark:hover:text-white'} transition\"\n\t\t\t\ttype=\"button\"\n\t\t\t\ton:click={() => {\n\t\t\t\t\tselectedTab = 'knowledge';\n\t\t\t\t}}>{$i18n.t('Knowledge')}</button\n\t\t\t>\n\n\t\t\t<button\n\t\t\t\tclass=\"min-w-fit p-1.5 {selectedTab === 'chats'\n\t\t\t\t\t? ''\n\t\t\t\t\t: 'text-gray-300 dark:text-gray-600 hover:text-gray-700 dark:hover:text-white'} transition\"\n\t\t\t\ttype=\"button\"\n\t\t\t\ton:click={() => {\n\t\t\t\t\tselectedTab = 'chats';\n\t\t\t\t}}\n\t\t\t>\n\t\t\t\t{$i18n.t('Chats')}\n\t\t\t</button>\n\t\t</div>\n\t</div> -->\n\n\t<div class=\"\">\n\t\t{#if selectedTab === 'knowledge'}\n\t\t\t<FolderKnowledge />\n\t\t{:else if selectedTab === 'chats'}\n\t\t\t{#if chats !== null}\n\t\t\t\t<ChatList {chats} {chatListLoading} {allChatsLoaded} loadHandler={loadChats} />\n\t\t\t{:else}\n\t\t\t\t<div class=\"py-10\">\n\t\t\t\t\t<Spinner />\n\t\t\t\t</div>\n\t\t\t{/if}\n\t\t{/if}\n\t</div>\n</div>\n","<script lang=\"ts\">\n\timport { getContext } from 'svelte';\n\tconst i18n = getContext('i18n');\n\n\timport DOMPurify from 'dompurify';\n\n\timport fileSaver from 'file-saver';\n\tconst { saveAs } = fileSaver;\n\n\timport { toast } from 'svelte-sonner';\n\n\timport { selectedFolder } from '$lib/stores';\n\n\timport { deleteFolderById, getFolderById, updateFolderById } from '$lib/apis/folders';\n\timport { getChatsByFolderId } from '$lib/apis/chats';\n\n\timport FolderModal from '$lib/components/layout/Sidebar/Folders/FolderModal.svelte';\n\n\timport Folder from '$lib/components/icons/Folder.svelte';\n\timport XMark from '$lib/components/icons/XMark.svelte';\n\timport FolderMenu from '$lib/components/layout/Sidebar/Folders/FolderMenu.svelte';\n\timport EllipsisHorizontal from '$lib/components/icons/EllipsisHorizontal.svelte';\n\timport DeleteConfirmDialog from '$lib/components/common/ConfirmDialog.svelte';\n\timport Emoji from '$lib/components/common/Emoji.svelte';\n\timport EmojiPicker from '$lib/components/common/EmojiPicker.svelte';\n\n\texport let folder = null;\n\n\texport let onUpdate: Function = (folderId) => {};\n\texport let onDelete: Function = (folderId) => {};\n\n\tlet showFolderModal = false;\n\tlet showDeleteConfirm = false;\n\tlet deleteFolderContents = true;\n\n\tconst updateHandler = async ({ name, meta, data }) => {\n\t\tif (name === '') {\n\t\t\ttoast.error($i18n.t('Folder name cannot be empty.'));\n\t\t\treturn;\n\t\t}\n\n\t\tconst currentName = folder.name;\n\n\t\tname = name.trim();\n\t\tfolder.name = name;\n\n\t\tconst res = await updateFolderById(localStorage.token, folder.id, {\n\t\t\tname,\n\t\t\t...(meta ? { meta } : {}),\n\t\t\t...(data ? { data } : {})\n\t\t}).catch((error) => {\n\t\t\ttoast.error(`${error}`);\n\n\t\t\tfolder.name = currentName;\n\t\t\treturn null;\n\t\t});\n\n\t\tif (res) {\n\t\t\tfolder.name = name;\n\t\t\tif (data) {\n\t\t\t\tfolder.data = data;\n\t\t\t}\n\n\t\t\ttoast.success($i18n.t('Folder updated successfully'));\n\n\t\t\tconst _folder = await getFolderById(localStorage.token, folder.id).catch((error) => {\n\t\t\t\ttoast.error(`${error}`);\n\t\t\t\treturn null;\n\t\t\t});\n\n\t\t\tawait selectedFolder.set(_folder);\n\t\t\tonUpdate(_folder);\n\t\t}\n\t};\n\n\tconst updateIconHandler = async (iconName) => {\n\t\tconst res = await updateFolderById(localStorage.token, folder.id, {\n\t\t\tmeta: {\n\t\t\t\ticon: iconName\n\t\t\t}\n\t\t}).catch((error) => {\n\t\t\ttoast.error(`${error}`);\n\t\t\treturn null;\n\t\t});\n\n\t\tif (res) {\n\t\t\tfolder.meta = { ...folder.meta, icon: iconName };\n\n\t\t\ttoast.success($i18n.t('Folder updated successfully'));\n\n\t\t\tconst _folder = await getFolderById(localStorage.token, folder.id).catch((error) => {\n\t\t\t\ttoast.error(`${error}`);\n\t\t\t\treturn null;\n\t\t\t});\n\n\t\t\tawait selectedFolder.set(_folder);\n\t\t\tonUpdate(_folder);\n\t\t}\n\t};\n\n\tconst deleteHandler = async () => {\n\t\tconst res = await deleteFolderById(localStorage.token, folder.id, deleteFolderContents).catch(\n\t\t\t(error) => {\n\t\t\t\ttoast.error(`${error}`);\n\t\t\t\treturn null;\n\t\t\t}\n\t\t);\n\n\t\tif (res) {\n\t\t\ttoast.success($i18n.t('Folder deleted successfully'));\n\t\t\tonDelete(folder);\n\t\t}\n\t};\n\n\tconst exportHandler = async () => {\n\t\tconst chats = await getChatsByFolderId(localStorage.token, folder.id).catch((error) => {\n\t\t\ttoast.error(`${error}`);\n\t\t\treturn null;\n\t\t});\n\t\tif (!chats) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst blob = new Blob([JSON.stringify(chats)], {\n\t\t\ttype: 'application/json'\n\t\t});\n\n\t\tsaveAs(blob, `folder-${folder.name}-export-${Date.now()}.json`);\n\t};\n</script>\n\n{#if folder}\n\t<FolderModal\n\t\tbind:show={showFolderModal}\n\t\tedit={true}\n\t\tfolderId={folder.id}\n\t\tonSubmit={updateHandler}\n\t/>\n\n\t<DeleteConfirmDialog\n\t\tbind:show={showDeleteConfirm}\n\t\ttitle={$i18n.t('Delete folder?')}\n\t\ton:confirm={() => {\n\t\t\tdeleteHandler();\n\t\t}}\n\t>\n\t\t<div class=\" text-sm text-gray-700 dark:text-gray-300 flex-1 line-clamp-3 mb-2\">\n\t\t\t<!-- {$i18n.t('This will delete <strong>{{NAME}}</strong> and <strong>all its contents</strong>.', {\n\t\t\t\tNAME: folders[folderId].name\n\t\t\t})} -->\n\n\t\t\t{$i18n.t(`Are you sure you want to delete \"{{NAME}}\"?`, {\n\t\t\t\tNAME: folders[folderId].name\n\t\t\t})}\n\t\t</div>\n\n\t\t<div class=\"flex items-center gap-1.5\">\n\t\t\t<input type=\"checkbox\" bind:checked={deleteFolderContents} />\n\n\t\t\t<div class=\"text-xs text-gray-500\">\n\t\t\t\t{$i18n.t('Delete all contents inside this folder')}\n\t\t\t</div>\n\t\t</div>\n\t</DeleteConfirmDialog>\n\n\t<div class=\"mb-3 px-6 @md:max-w-3xl justify-between w-full flex relative group items-center\">\n\t\t<div class=\"text-center flex gap-3.5 items-center\">\n\t\t\t<EmojiPicker\n\t\t\t\tonClose={() => {}}\n\t\t\t\tonSubmit={(name) => {\n\t\t\t\t\tconsole.log(name);\n\t\t\t\t\tupdateIconHandler(name);\n\t\t\t\t}}\n\t\t\t>\n\t\t\t\t<button\n\t\t\t\t\tclass=\" rounded-full bg-gray-50 dark:bg-gray-800 size-11 flex justify-center items-center\"\n\t\t\t\t>\n\t\t\t\t\t{#if folder?.meta?.icon}\n\t\t\t\t\t\t<Emoji className=\"size-6\" shortCode={folder.meta.icon} />\n\t\t\t\t\t{:else}\n\t\t\t\t\t\t<Folder className=\"size-4.5\" strokeWidth=\"2\" />\n\t\t\t\t\t{/if}\n\t\t\t\t</button>\n\t\t\t</EmojiPicker>\n\n\t\t\t<div class=\"text-3xl line-clamp-1\">\n\t\t\t\t{folder.name}\n\t\t\t</div>\n\t\t</div>\n\n\t\t<div class=\"flex items-center translate-x-2.5\">\n\t\t\t<FolderMenu\n\t\t\t\talign=\"end\"\n\t\t\t\tonEdit={() => {\n\t\t\t\t\tshowFolderModal = true;\n\t\t\t\t}}\n\t\t\t\tonDelete={() => {\n\t\t\t\t\tshowDeleteConfirm = true;\n\t\t\t\t}}\n\t\t\t\tonExport={() => {\n\t\t\t\t\texportHandler();\n\t\t\t\t}}\n\t\t\t>\n\t\t\t\t<button class=\"p-1.5 dark:hover:bg-gray-850 rounded-full touch-auto\" on:click={(e) => {}}>\n\t\t\t\t\t<EllipsisHorizontal className=\"size-4\" strokeWidth=\"2.5\" />\n\t\t\t\t</button>\n\t\t\t</FolderMenu>\n\t\t</div>\n\t</div>\n{/if}\n","<script lang=\"ts\">\n\timport { toast } from 'svelte-sonner';\n\timport { marked } from 'marked';\n\n\timport { onMount, getContext, tick, createEventDispatcher } from 'svelte';\n\timport { blur, fade } from 'svelte/transition';\n\n\tconst dispatch = createEventDispatcher();\n\n\timport { getChatList } from '$lib/apis/chats';\n\timport { updateFolderById } from '$lib/apis/folders';\n\n\timport {\n\t\tconfig,\n\t\tuser,\n\t\tmodels as _models,\n\t\ttemporaryChatEnabled,\n\t\tselectedFolder,\n\t\tchats,\n\t\tcurrentChatPage\n\t} from '$lib/stores';\n\timport { sanitizeResponseContent, extractCurlyBraceWords } from '$lib/utils';\n\timport { WEBUI_API_BASE_URL, WEBUI_BASE_URL } from '$lib/constants';\n\n\timport Suggestions from './Suggestions.svelte';\n\timport Tooltip from '$lib/components/common/Tooltip.svelte';\n\timport EyeSlash from '$lib/components/icons/EyeSlash.svelte';\n\timport MessageInput from './MessageInput.svelte';\n\timport FolderPlaceholder from './Placeholder/FolderPlaceholder.svelte';\n\timport FolderTitle from './Placeholder/FolderTitle.svelte';\n\n\tconst i18n = getContext('i18n');\n\n\texport let createMessagePair: Function;\n\texport let stopResponse: Function;\n\n\texport let autoScroll = false;\n\n\texport let atSelectedModel: Model | undefined;\n\texport let selectedModels: [''];\n\n\texport let history;\n\n\texport let prompt = '';\n\texport let files = [];\n\texport let messageInput = null;\n\n\texport let selectedToolIds = [];\n\texport let selectedFilterIds = [];\n\n\texport let showCommands = false;\n\n\texport let imageGenerationEnabled = false;\n\texport let codeInterpreterEnabled = false;\n\texport let webSearchEnabled = false;\n\n\texport let onUpload: Function = (e) => {};\n\texport let onSelect = (e) => {};\n\texport let onChange = (e) => {};\n\n\texport let toolServers = [];\n\n\tlet models = [];\n\tlet selectedModelIdx = 0;\n\n\t$: if (selectedModels.length > 0) {\n\t\tselectedModelIdx = models.length - 1;\n\t}\n\n\t$: models = selectedModels.map((id) => $_models.find((m) => m.id === id));\n</script>\n\n<div class=\"m-auto w-full max-w-6xl px-2 @2xl:px-20 translate-y-6 py-24 text-center\">\n\t{#if $temporaryChatEnabled}\n\t\t<Tooltip\n\t\t\tcontent={$i18n.t(\"This chat won't appear in history and your messages will not be saved.\")}\n\t\t\tclassName=\"w-full flex justify-center mb-0.5\"\n\t\t\tplacement=\"top\"\n\t\t>\n\t\t\t<div class=\"flex items-center gap-2 text-gray-500 text-base my-2 w-fit\">\n\t\t\t\t<EyeSlash strokeWidth=\"2.5\" className=\"size-4\" />{$i18n.t('Temporary Chat')}\n\t\t\t</div>\n\t\t</Tooltip>\n\t{/if}\n\n\t<div\n\t\tclass=\"w-full text-3xl text-gray-800 dark:text-gray-100 text-center flex items-center gap-4 font-primary\"\n\t>\n\t\t<div class=\"w-full flex flex-col justify-center items-center\">\n\t\t\t{#if $selectedFolder}\n\t\t\t\t<FolderTitle\n\t\t\t\t\tfolder={$selectedFolder}\n\t\t\t\t\tonUpdate={async (folder) => {\n\t\t\t\t\t\tawait chats.set(await getChatList(localStorage.token, $currentChatPage));\n\t\t\t\t\t\tcurrentChatPage.set(1);\n\t\t\t\t\t}}\n\t\t\t\t\tonDelete={async () => {\n\t\t\t\t\t\tawait chats.set(await getChatList(localStorage.token, $currentChatPage));\n\t\t\t\t\t\tcurrentChatPage.set(1);\n\n\t\t\t\t\t\tselectedFolder.set(null);\n\t\t\t\t\t}}\n\t\t\t\t/>\n\t\t\t{:else}\n\t\t\t\t<div class=\"flex flex-row justify-center gap-3 @sm:gap-3.5 w-fit px-5 max-w-xl\">\n\t\t\t\t\t<div class=\"flex shrink-0 justify-center\">\n\t\t\t\t\t\t<div class=\"flex -space-x-4 mb-0.5\" in:fade={{ duration: 100 }}>\n\t\t\t\t\t\t\t{#each models as model, modelIdx}\n\t\t\t\t\t\t\t\t<Tooltip\n\t\t\t\t\t\t\t\t\tcontent={(models[modelIdx]?.info?.meta?.tags ?? [])\n\t\t\t\t\t\t\t\t\t\t.map((tag) => tag.name.toUpperCase())\n\t\t\t\t\t\t\t\t\t\t.join(', ')}\n\t\t\t\t\t\t\t\t\tplacement=\"top\"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\taria-hidden={models.length <= 1}\n\t\t\t\t\t\t\t\t\t\taria-label={$i18n.t('Get information on {{name}} in the UI', {\n\t\t\t\t\t\t\t\t\t\t\tname: models[modelIdx]?.name\n\t\t\t\t\t\t\t\t\t\t})}\n\t\t\t\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\t\t\t\tselectedModelIdx = modelIdx;\n\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t<img\n\t\t\t\t\t\t\t\t\t\t\tsrc={`${WEBUI_API_BASE_URL}/models/model/profile/image?id=${model?.id}&lang=${$i18n.language}`}\n\t\t\t\t\t\t\t\t\t\t\tclass=\" size-9 @sm:size-10 rounded-full border-[1px] border-gray-100 dark:border-none\"\n\t\t\t\t\t\t\t\t\t\t\taria-hidden=\"true\"\n\t\t\t\t\t\t\t\t\t\t\tdraggable=\"false\"\n\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t</Tooltip>\n\t\t\t\t\t\t\t{/each}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div\n\t\t\t\t\t\tclass=\" text-3xl @sm:text-3xl line-clamp-1 flex items-center\"\n\t\t\t\t\t\tin:fade={{ duration: 100 }}\n\t\t\t\t\t>\n\t\t\t\t\t\t{#if models[selectedModelIdx]?.name}\n\t\t\t\t\t\t\t<Tooltip\n\t\t\t\t\t\t\t\tcontent={models[selectedModelIdx]?.name}\n\t\t\t\t\t\t\t\tplacement=\"top\"\n\t\t\t\t\t\t\t\tclassName=\" flex items-center \"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<span class=\"line-clamp-1\">\n\t\t\t\t\t\t\t\t\t{models[selectedModelIdx]?.name}\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t</Tooltip>\n\t\t\t\t\t\t{:else}\n\t\t\t\t\t\t\t{$i18n.t('Hello, {{name}}', { name: $user?.name })}\n\t\t\t\t\t\t{/if}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\n\t\t\t\t<div class=\"flex mt-1 mb-2\">\n\t\t\t\t\t<div in:fade={{ duration: 100, delay: 50 }}>\n\t\t\t\t\t\t{#if models[selectedModelIdx]?.info?.meta?.description ?? null}\n\t\t\t\t\t\t\t<Tooltip\n\t\t\t\t\t\t\t\tclassName=\" w-fit\"\n\t\t\t\t\t\t\t\tcontent={marked.parse(\n\t\t\t\t\t\t\t\t\tsanitizeResponseContent(\n\t\t\t\t\t\t\t\t\t\tmodels[selectedModelIdx]?.info?.meta?.description ?? ''\n\t\t\t\t\t\t\t\t\t).replaceAll('\\n', '<br>')\n\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\tplacement=\"top\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\tclass=\"mt-0.5 px-2 text-sm font-normal text-gray-500 dark:text-gray-400 line-clamp-2 max-w-xl markdown\"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t{@html marked.parse(\n\t\t\t\t\t\t\t\t\t\tsanitizeResponseContent(\n\t\t\t\t\t\t\t\t\t\t\tmodels[selectedModelIdx]?.info?.meta?.description ?? ''\n\t\t\t\t\t\t\t\t\t\t).replaceAll('\\n', '<br>')\n\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</Tooltip>\n\n\t\t\t\t\t\t\t{#if models[selectedModelIdx]?.info?.meta?.user}\n\t\t\t\t\t\t\t\t<div class=\"mt-0.5 text-sm font-normal text-gray-400 dark:text-gray-500\">\n\t\t\t\t\t\t\t\t\tBy\n\t\t\t\t\t\t\t\t\t{#if models[selectedModelIdx]?.info?.meta?.user.community}\n\t\t\t\t\t\t\t\t\t\t<a\n\t\t\t\t\t\t\t\t\t\t\thref=\"https://openwebui.com/m/{models[selectedModelIdx]?.info?.meta?.user\n\t\t\t\t\t\t\t\t\t\t\t\t.username}\"\n\t\t\t\t\t\t\t\t\t\t\t>{models[selectedModelIdx]?.info?.meta?.user.name\n\t\t\t\t\t\t\t\t\t\t\t\t? models[selectedModelIdx]?.info?.meta?.user.name\n\t\t\t\t\t\t\t\t\t\t\t\t: `@${models[selectedModelIdx]?.info?.meta?.user.username}`}</a\n\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t{:else}\n\t\t\t\t\t\t\t\t\t\t{models[selectedModelIdx]?.info?.meta?.user.name}\n\t\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t{/if}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t{/if}\n\n\t\t\t<div class=\"text-base font-normal @md:max-w-3xl w-full py-3 {atSelectedModel ? 'mt-2' : ''}\">\n\t\t\t\t<MessageInput\n\t\t\t\t\tbind:this={messageInput}\n\t\t\t\t\t{history}\n\t\t\t\t\t{selectedModels}\n\t\t\t\t\tbind:files\n\t\t\t\t\tbind:prompt\n\t\t\t\t\tbind:autoScroll\n\t\t\t\t\tbind:selectedToolIds\n\t\t\t\t\tbind:selectedFilterIds\n\t\t\t\t\tbind:imageGenerationEnabled\n\t\t\t\t\tbind:codeInterpreterEnabled\n\t\t\t\t\tbind:webSearchEnabled\n\t\t\t\t\tbind:atSelectedModel\n\t\t\t\t\tbind:showCommands\n\t\t\t\t\t{toolServers}\n\t\t\t\t\t{stopResponse}\n\t\t\t\t\t{createMessagePair}\n\t\t\t\t\tplaceholder={$i18n.t('How can I help you today?')}\n\t\t\t\t\t{onChange}\n\t\t\t\t\t{onUpload}\n\t\t\t\t\ton:submit={(e) => {\n\t\t\t\t\t\tdispatch('submit', e.detail);\n\t\t\t\t\t}}\n\t\t\t\t/>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n\n\t{#if $selectedFolder}\n\t\t<div\n\t\t\tclass=\"mx-auto px-4 md:max-w-3xl md:px-6 font-primary min-h-62\"\n\t\t\tin:fade={{ duration: 200, delay: 200 }}\n\t\t>\n\t\t\t<FolderPlaceholder folder={$selectedFolder} />\n\t\t</div>\n\t{:else}\n\t\t<div class=\"mx-auto max-w-2xl font-primary mt-2\" in:fade={{ duration: 200, delay: 200 }}>\n\t\t\t<div class=\"mx-5\">\n\t\t\t\t<Suggestions\n\t\t\t\t\tsuggestionPrompts={atSelectedModel?.info?.meta?.suggestion_prompts ??\n\t\t\t\t\t\tmodels[selectedModelIdx]?.info?.meta?.suggestion_prompts ??\n\t\t\t\t\t\t$config?.default_prompt_suggestions ??\n\t\t\t\t\t\t[]}\n\t\t\t\t\tinputValue={prompt}\n\t\t\t\t\t{onSelect}\n\t\t\t\t/>\n\t\t\t</div>\n\t\t</div>\n\t{/if}\n</div>\n","<script lang=\"ts\">\n\timport { v4 as uuidv4 } from 'uuid';\n\timport { toast } from 'svelte-sonner';\n\timport { PaneGroup, Pane, PaneResizer } from 'paneforge';\n\n\timport { getContext, onDestroy, onMount, tick } from 'svelte';\n\timport { fade } from 'svelte/transition';\n\tconst i18n: Writable<i18nType> = getContext('i18n');\n\n\timport { goto } from '$app/navigation';\n\timport { page } from '$app/stores';\n\n\timport { get, type Unsubscriber, type Writable } from 'svelte/store';\n\timport type { i18n as i18nType } from 'i18next';\n\timport { WEBUI_BASE_URL } from '$lib/constants';\n\n\timport {\n\t\tchatId,\n\t\tchats,\n\t\tconfig,\n\t\ttype Model,\n\t\tmodels,\n\t\ttags as allTags,\n\t\tsettings,\n\t\tshowSidebar,\n\t\tWEBUI_NAME,\n\t\tbanners,\n\t\tuser,\n\t\tsocket,\n\t\taudioQueue,\n\t\tshowControls,\n\t\tshowCallOverlay,\n\t\tcurrentChatPage,\n\t\ttemporaryChatEnabled,\n\t\tmobile,\n\t\tshowOverview,\n\t\tchatTitle,\n\t\tshowArtifacts,\n\t\tartifactContents,\n\t\ttools,\n\t\ttoolServers,\n\t\tfunctions,\n\t\tselectedFolder,\n\t\tpinnedChats,\n\t\tshowEmbeds\n\t} from '$lib/stores';\n\n\timport {\n\t\tconvertMessagesToHistory,\n\t\tcopyToClipboard,\n\t\tgetMessageContentParts,\n\t\tcreateMessagesList,\n\t\tgetPromptVariables,\n\t\tprocessDetails,\n\t\tremoveAllDetails,\n\t\tgetCodeBlockContents,\n\t\tisYoutubeUrl\n\t} from '$lib/utils';\n\timport { AudioQueue } from '$lib/utils/audio';\n\n\timport {\n\t\tcreateNewChat,\n\t\tgetAllTags,\n\t\tgetChatById,\n\t\tgetChatList,\n\t\tgetPinnedChatList,\n\t\tgetTagsById,\n\t\tupdateChatById,\n\t\tupdateChatFolderIdById\n\t} from '$lib/apis/chats';\n\timport { generateOpenAIChatCompletion } from '$lib/apis/openai';\n\timport { processWeb, processWebSearch, processYoutubeVideo } from '$lib/apis/retrieval';\n\timport { getAndUpdateUserLocation, getUserSettings } from '$lib/apis/users';\n\timport {\n\t\tchatCompleted,\n\t\tgenerateQueries,\n\t\tchatAction,\n\t\tgenerateMoACompletion,\n\t\tstopTask,\n\t\tgetTaskIdsByChatId\n\t} from '$lib/apis';\n\timport { getTools } from '$lib/apis/tools';\n\timport { uploadFile } from '$lib/apis/files';\n\timport { createOpenAITextStream } from '$lib/apis/streaming';\n\timport { getFunctions } from '$lib/apis/functions';\n\timport { updateFolderById } from '$lib/apis/folders';\n\n\timport Banner from '../common/Banner.svelte';\n\timport MessageInput from '$lib/components/chat/MessageInput.svelte';\n\timport Messages from '$lib/components/chat/Messages.svelte';\n\timport Navbar from '$lib/components/chat/Navbar.svelte';\n\timport ChatControls from './ChatControls.svelte';\n\timport EventConfirmDialog from '../common/ConfirmDialog.svelte';\n\timport Placeholder from './Placeholder.svelte';\n\timport NotificationToast from '../NotificationToast.svelte';\n\timport Spinner from '../common/Spinner.svelte';\n\timport Tooltip from '../common/Tooltip.svelte';\n\timport Sidebar from '../icons/Sidebar.svelte';\n\timport Image from '../common/Image.svelte';\n\n\texport let chatIdProp = '';\n\n\tlet loading = true;\n\n\tconst eventTarget = new EventTarget();\n\tlet controlPane;\n\tlet controlPaneComponent;\n\n\tlet messageInput;\n\n\tlet autoScroll = true;\n\tlet processing = '';\n\tlet messagesContainerElement: HTMLDivElement;\n\n\tlet navbarElement;\n\n\tlet showEventConfirmation = false;\n\tlet eventConfirmationTitle = '';\n\tlet eventConfirmationMessage = '';\n\tlet eventConfirmationInput = false;\n\tlet eventConfirmationInputPlaceholder = '';\n\tlet eventConfirmationInputValue = '';\n\tlet eventCallback = null;\n\n\tlet chatIdUnsubscriber: Unsubscriber | undefined;\n\n\tlet selectedModels = [''];\n\tlet atSelectedModel: Model | undefined;\n\tlet selectedModelIds = [];\n\t$: if (atSelectedModel !== undefined) {\n\t\tselectedModelIds = [atSelectedModel.id];\n\t} else {\n\t\tselectedModelIds = selectedModels;\n\t}\n\n\tlet selectedToolIds = [];\n\tlet selectedFilterIds = [];\n\tlet imageGenerationEnabled = false;\n\tlet webSearchEnabled = false;\n\tlet codeInterpreterEnabled = false;\n\n\tlet showCommands = false;\n\n\tlet generating = false;\n\tlet generationController = null;\n\n\tlet chat = null;\n\tlet tags = [];\n\n\tlet history = {\n\t\tmessages: {},\n\t\tcurrentId: null\n\t};\n\n\tlet taskIds = null;\n\n\t// Chat Input\n\tlet prompt = '';\n\tlet chatFiles = [];\n\tlet files = [];\n\tlet params = {};\n\n\t$: if (chatIdProp) {\n\t\tnavigateHandler();\n\t}\n\n\tconst navigateHandler = async () => {\n\t\tloading = true;\n\n\t\tprompt = '';\n\t\tmessageInput?.setText('');\n\n\t\tfiles = [];\n\t\tselectedToolIds = [];\n\t\tselectedFilterIds = [];\n\t\twebSearchEnabled = false;\n\t\timageGenerationEnabled = false;\n\n\t\tconst storageChatInput = sessionStorage.getItem(\n\t\t\t`chat-input${chatIdProp ? `-${chatIdProp}` : ''}`\n\t\t);\n\n\t\tif (chatIdProp && (await loadChat())) {\n\t\t\tawait tick();\n\t\t\tloading = false;\n\t\t\twindow.setTimeout(() => scrollToBottom(), 0);\n\n\t\t\tawait tick();\n\n\t\t\tif (storageChatInput) {\n\t\t\t\ttry {\n\t\t\t\t\tconst input = JSON.parse(storageChatInput);\n\n\t\t\t\t\tif (!$temporaryChatEnabled) {\n\t\t\t\t\t\tmessageInput?.setText(input.prompt);\n\t\t\t\t\t\tfiles = input.files;\n\t\t\t\t\t\tselectedToolIds = input.selectedToolIds;\n\t\t\t\t\t\tselectedFilterIds = input.selectedFilterIds;\n\t\t\t\t\t\twebSearchEnabled = input.webSearchEnabled;\n\t\t\t\t\t\timageGenerationEnabled = input.imageGenerationEnabled;\n\t\t\t\t\t\tcodeInterpreterEnabled = input.codeInterpreterEnabled;\n\t\t\t\t\t}\n\t\t\t\t} catch (e) {}\n\t\t\t} else {\n\t\t\t\tawait setDefaults();\n\t\t\t}\n\n\t\t\tconst chatInput = document.getElementById('chat-input');\n\t\t\tchatInput?.focus();\n\t\t} else {\n\t\t\tawait goto('/');\n\t\t}\n\t};\n\n\tconst onSelect = async (e) => {\n\t\tconst { type, data } = e;\n\n\t\tif (type === 'prompt') {\n\t\t\t// Handle prompt selection\n\t\t\tmessageInput?.setText(data, async () => {\n\t\t\t\tif (!($settings?.insertSuggestionPrompt ?? false)) {\n\t\t\t\t\tawait tick();\n\t\t\t\t\tsubmitPrompt(prompt);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t};\n\n\t$: if (selectedModels && chatIdProp !== '') {\n\t\tsaveSessionSelectedModels();\n\t}\n\n\tconst saveSessionSelectedModels = () => {\n\t\tconst selectedModelsString = JSON.stringify(selectedModels);\n\t\tif (\n\t\t\tselectedModels.length === 0 ||\n\t\t\t(selectedModels.length === 1 && selectedModels[0] === '') ||\n\t\t\tsessionStorage.selectedModels === selectedModelsString\n\t\t) {\n\t\t\treturn;\n\t\t}\n\t\tsessionStorage.selectedModels = selectedModelsString;\n\t\tconsole.log('saveSessionSelectedModels', selectedModels, sessionStorage.selectedModels);\n\t};\n\n\tlet oldSelectedModelIds = [''];\n\t$: if (JSON.stringify(selectedModelIds) !== JSON.stringify(oldSelectedModelIds)) {\n\t\tonSelectedModelIdsChange();\n\t}\n\n\tconst onSelectedModelIdsChange = () => {\n\t\tresetInput();\n\t\toldSelectedModelIds = JSON.parse(JSON.stringify(selectedModelIds));\n\t};\n\n\tconst resetInput = () => {\n\t\tselectedToolIds = [];\n\t\tselectedFilterIds = [];\n\t\twebSearchEnabled = false;\n\t\timageGenerationEnabled = false;\n\t\tcodeInterpreterEnabled = false;\n\n\t\tif (selectedModelIds.filter((id) => id).length > 0) {\n\t\t\tsetDefaults();\n\t\t}\n\t};\n\n\tconst setDefaults = async () => {\n\t\tif (!$tools) {\n\t\t\ttools.set(await getTools(localStorage.token));\n\t\t}\n\t\tif (!$functions) {\n\t\t\tfunctions.set(await getFunctions(localStorage.token));\n\t\t}\n\t\tif (selectedModels.length !== 1 && !atSelectedModel) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst model = atSelectedModel ?? $models.find((m) => m.id === selectedModels[0]);\n\t\tif (model) {\n\t\t\t// Set Default Tools\n\t\t\tif (model?.info?.meta?.toolIds) {\n\t\t\t\tselectedToolIds = [\n\t\t\t\t\t...new Set(\n\t\t\t\t\t\t[...(model?.info?.meta?.toolIds ?? [])].filter((id) => $tools.find((t) => t.id === id))\n\t\t\t\t\t)\n\t\t\t\t];\n\t\t\t}\n\n\t\t\t// Set Default Filters (Toggleable only)\n\t\t\tif (model?.info?.meta?.defaultFilterIds) {\n\t\t\t\tselectedFilterIds = model.info.meta.defaultFilterIds.filter((id) =>\n\t\t\t\t\tmodel?.filters?.find((f) => f.id === id)\n\t\t\t\t);\n\t\t\t}\n\n\t\t\t// Set Default Features\n\t\t\tif (model?.info?.meta?.defaultFeatureIds) {\n\t\t\t\tif (model.info?.meta?.capabilities?.['image_generation']) {\n\t\t\t\t\timageGenerationEnabled = model.info.meta.defaultFeatureIds.includes('image_generation');\n\t\t\t\t}\n\n\t\t\t\tif (model.info?.meta?.capabilities?.['web_search']) {\n\t\t\t\t\twebSearchEnabled = model.info.meta.defaultFeatureIds.includes('web_search');\n\t\t\t\t}\n\n\t\t\t\tif (model.info?.meta?.capabilities?.['code_interpreter']) {\n\t\t\t\t\tcodeInterpreterEnabled = model.info.meta.defaultFeatureIds.includes('code_interpreter');\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t};\n\n\tconst showMessage = async (message, ignoreSettings = false) => {\n\t\tawait tick();\n\n\t\tconst _chatId = JSON.parse(JSON.stringify($chatId));\n\t\tlet _messageId = JSON.parse(JSON.stringify(message.id));\n\n\t\tlet messageChildrenIds = [];\n\t\tif (_messageId === null) {\n\t\t\tmessageChildrenIds = Object.keys(history.messages).filter(\n\t\t\t\t(id) => history.messages[id].parentId === null\n\t\t\t);\n\t\t} else {\n\t\t\tmessageChildrenIds = history.messages[_messageId].childrenIds;\n\t\t}\n\n\t\twhile (messageChildrenIds.length !== 0) {\n\t\t\t_messageId = messageChildrenIds.at(-1);\n\t\t\tmessageChildrenIds = history.messages[_messageId].childrenIds;\n\t\t}\n\n\t\thistory.currentId = _messageId;\n\n\t\tawait tick();\n\t\tawait tick();\n\t\tawait tick();\n\n\t\tif (($settings?.scrollOnBranchChange ?? true) || ignoreSettings) {\n\t\t\tconst messageElement = document.getElementById(`message-${message.id}`);\n\t\t\tif (messageElement) {\n\t\t\t\tmessageElement.scrollIntoView({ behavior: 'smooth' });\n\t\t\t}\n\t\t}\n\n\t\tawait tick();\n\t\tsaveChatHandler(_chatId, history);\n\t};\n\n\tconst chatEventHandler = async (event, cb) => {\n\t\tconsole.log(event);\n\n\t\tif (event.chat_id === $chatId) {\n\t\t\tawait tick();\n\t\t\tlet message = history.messages[event.message_id];\n\n\t\t\tif (message) {\n\t\t\t\tconst type = event?.data?.type ?? null;\n\t\t\t\tconst data = event?.data?.data ?? null;\n\n\t\t\t\tif (type === 'status') {\n\t\t\t\t\tif (message?.statusHistory) {\n\t\t\t\t\t\tmessage.statusHistory.push(data);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tmessage.statusHistory = [data];\n\t\t\t\t\t}\n\t\t\t\t} else if (type === 'chat:completion') {\n\t\t\t\t\tchatCompletionEventHandler(data, message, event.chat_id);\n\t\t\t\t} else if (type === 'chat:tasks:cancel') {\n\t\t\t\t\ttaskIds = null;\n\t\t\t\t\tconst responseMessage = history.messages[history.currentId];\n\t\t\t\t\t// Set all response messages to done\n\t\t\t\t\tfor (const messageId of history.messages[responseMessage.parentId].childrenIds) {\n\t\t\t\t\t\thistory.messages[messageId].done = true;\n\t\t\t\t\t}\n\t\t\t\t} else if (type === 'chat:message:delta' || type === 'message') {\n\t\t\t\t\tmessage.content += data.content;\n\t\t\t\t} else if (type === 'chat:message' || type === 'replace') {\n\t\t\t\t\tmessage.content = data.content;\n\t\t\t\t} else if (type === 'chat:message:files' || type === 'files') {\n\t\t\t\t\tmessage.files = data.files;\n\t\t\t\t} else if (type === 'chat:message:embeds' || type === 'embeds') {\n\t\t\t\t\tmessage.embeds = data.embeds;\n\t\t\t\t} else if (type === 'chat:message:error') {\n\t\t\t\t\tmessage.error = data.error;\n\t\t\t\t} else if (type === 'chat:message:follow_ups') {\n\t\t\t\t\tmessage.followUps = data.follow_ups;\n\n\t\t\t\t\tif (autoScroll) {\n\t\t\t\t\t\tscrollToBottom('smooth');\n\t\t\t\t\t}\n\t\t\t\t} else if (type === 'chat:message:favorite') {\n\t\t\t\t\t// Update message favorite status\n\t\t\t\t\tmessage.favorite = data.favorite;\n\t\t\t\t} else if (type === 'chat:title') {\n\t\t\t\t\tchatTitle.set(data);\n\t\t\t\t\tcurrentChatPage.set(1);\n\t\t\t\t\tawait chats.set(await getChatList(localStorage.token, $currentChatPage));\n\t\t\t\t} else if (type === 'chat:tags') {\n\t\t\t\t\tchat = await getChatById(localStorage.token, $chatId);\n\t\t\t\t\tallTags.set(await getAllTags(localStorage.token));\n\t\t\t\t} else if (type === 'source' || type === 'citation') {\n\t\t\t\t\tif (data?.type === 'code_execution') {\n\t\t\t\t\t\t// Code execution; update existing code execution by ID, or add new one.\n\t\t\t\t\t\tif (!message?.code_executions) {\n\t\t\t\t\t\t\tmessage.code_executions = [];\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tconst existingCodeExecutionIndex = message.code_executions.findIndex(\n\t\t\t\t\t\t\t(execution) => execution.id === data.id\n\t\t\t\t\t\t);\n\n\t\t\t\t\t\tif (existingCodeExecutionIndex !== -1) {\n\t\t\t\t\t\t\tmessage.code_executions[existingCodeExecutionIndex] = data;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tmessage.code_executions.push(data);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tmessage.code_executions = message.code_executions;\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// Regular source.\n\t\t\t\t\t\tif (message?.sources) {\n\t\t\t\t\t\t\tmessage.sources.push(data);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tmessage.sources = [data];\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} else if (type === 'notification') {\n\t\t\t\t\tconst toastType = data?.type ?? 'info';\n\t\t\t\t\tconst toastContent = data?.content ?? '';\n\n\t\t\t\t\tif (toastType === 'success') {\n\t\t\t\t\t\ttoast.success(toastContent);\n\t\t\t\t\t} else if (toastType === 'error') {\n\t\t\t\t\t\ttoast.error(toastContent);\n\t\t\t\t\t} else if (toastType === 'warning') {\n\t\t\t\t\t\ttoast.warning(toastContent);\n\t\t\t\t\t} else {\n\t\t\t\t\t\ttoast.info(toastContent);\n\t\t\t\t\t}\n\t\t\t\t} else if (type === 'confirmation') {\n\t\t\t\t\teventCallback = cb;\n\n\t\t\t\t\teventConfirmationInput = false;\n\t\t\t\t\tshowEventConfirmation = true;\n\n\t\t\t\t\teventConfirmationTitle = data.title;\n\t\t\t\t\teventConfirmationMessage = data.message;\n\t\t\t\t} else if (type === 'execute') {\n\t\t\t\t\teventCallback = cb;\n\n\t\t\t\t\ttry {\n\t\t\t\t\t\t// Use Function constructor to evaluate code in a safer way\n\t\t\t\t\t\tconst asyncFunction = new Function(`return (async () => { ${data.code} })()`);\n\t\t\t\t\t\tconst result = await asyncFunction(); // Await the result of the async function\n\n\t\t\t\t\t\tif (cb) {\n\t\t\t\t\t\t\tcb(result);\n\t\t\t\t\t\t}\n\t\t\t\t\t} catch (error) {\n\t\t\t\t\t\tconsole.error('Error executing code:', error);\n\t\t\t\t\t}\n\t\t\t\t} else if (type === 'input') {\n\t\t\t\t\teventCallback = cb;\n\n\t\t\t\t\teventConfirmationInput = true;\n\t\t\t\t\tshowEventConfirmation = true;\n\n\t\t\t\t\teventConfirmationTitle = data.title;\n\t\t\t\t\teventConfirmationMessage = data.message;\n\t\t\t\t\teventConfirmationInputPlaceholder = data.placeholder;\n\t\t\t\t\teventConfirmationInputValue = data?.value ?? '';\n\t\t\t\t} else {\n\t\t\t\t\tconsole.log('Unknown message type', data);\n\t\t\t\t}\n\n\t\t\t\thistory.messages[event.message_id] = message;\n\t\t\t}\n\t\t}\n\t};\n\n\tconst onMessageHandler = async (event: {\n\t\torigin: string;\n\t\tdata: { type: string; text: string };\n\t}) => {\n\t\tif (event.origin !== window.origin) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (event.data.type === 'action:submit') {\n\t\t\tconsole.debug(event.data.text);\n\n\t\t\tif (prompt !== '') {\n\t\t\t\tawait tick();\n\t\t\t\tsubmitPrompt(prompt);\n\t\t\t}\n\t\t}\n\n\t\t// Replace with your iframe's origin\n\t\tif (event.data.type === 'input:prompt') {\n\t\t\tconsole.debug(event.data.text);\n\n\t\t\tconst inputElement = document.getElementById('chat-input');\n\n\t\t\tif (inputElement) {\n\t\t\t\tmessageInput?.setText(event.data.text);\n\t\t\t\tinputElement.focus();\n\t\t\t}\n\t\t}\n\n\t\tif (event.data.type === 'input:prompt:submit') {\n\t\t\tconsole.debug(event.data.text);\n\n\t\t\tif (event.data.text !== '') {\n\t\t\t\tawait tick();\n\t\t\t\tsubmitPrompt(event.data.text);\n\t\t\t}\n\t\t}\n\t};\n\n\tconst savedModelIds = async () => {\n\t\tif (\n\t\t\t$selectedFolder &&\n\t\t\tselectedModels.filter((modelId) => modelId !== '').length > 0 &&\n\t\t\tJSON.stringify($selectedFolder?.data?.model_ids) !== JSON.stringify(selectedModels)\n\t\t) {\n\t\t\tconst res = await updateFolderById(localStorage.token, $selectedFolder.id, {\n\t\t\t\tdata: {\n\t\t\t\t\tmodel_ids: selectedModels\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t};\n\n\t$: if (selectedModels !== null) {\n\t\tsavedModelIds();\n\t}\n\n\tlet pageSubscribe = null;\n\tlet showControlsSubscribe = null;\n\tlet selectedFolderSubscribe = null;\n\n\tconst stopAudio = () => {\n\t\ttry {\n\t\t\tspeechSynthesis.cancel();\n\t\t\t$audioQueue.stop();\n\t\t} catch {}\n\t};\n\n\tonMount(async () => {\n\t\tloading = true;\n\t\tconsole.log('mounted');\n\t\twindow.addEventListener('message', onMessageHandler);\n\t\t$socket?.on('events', chatEventHandler);\n\n\t\taudioQueue.set(new AudioQueue(document.getElementById('audioElement')));\n\n\t\tpageSubscribe = page.subscribe(async (p) => {\n\t\t\tif (p.url.pathname === '/') {\n\t\t\t\tawait tick();\n\t\t\t\tinitNewChat();\n\t\t\t}\n\n\t\t\tstopAudio();\n\t\t});\n\n\t\tconst storageChatInput = sessionStorage.getItem(\n\t\t\t`chat-input${chatIdProp ? `-${chatIdProp}` : ''}`\n\t\t);\n\n\t\tif (!chatIdProp) {\n\t\t\tloading = false;\n\t\t\tawait tick();\n\t\t}\n\n\t\tif (storageChatInput) {\n\t\t\tprompt = '';\n\t\t\tmessageInput?.setText('');\n\n\t\t\tfiles = [];\n\t\t\tselectedToolIds = [];\n\t\t\tselectedFilterIds = [];\n\t\t\twebSearchEnabled = false;\n\t\t\timageGenerationEnabled = false;\n\t\t\tcodeInterpreterEnabled = false;\n\n\t\t\ttry {\n\t\t\t\tconst input = JSON.parse(storageChatInput);\n\n\t\t\t\tif (!$temporaryChatEnabled) {\n\t\t\t\t\tmessageInput?.setText(input.prompt);\n\t\t\t\t\tfiles = input.files;\n\t\t\t\t\tselectedToolIds = input.selectedToolIds;\n\t\t\t\t\tselectedFilterIds = input.selectedFilterIds;\n\t\t\t\t\twebSearchEnabled = input.webSearchEnabled;\n\t\t\t\t\timageGenerationEnabled = input.imageGenerationEnabled;\n\t\t\t\t\tcodeInterpreterEnabled = input.codeInterpreterEnabled;\n\t\t\t\t}\n\t\t\t} catch (e) {}\n\t\t}\n\n\t\tshowControlsSubscribe = showControls.subscribe(async (value) => {\n\t\t\tif (controlPane && !$mobile) {\n\t\t\t\ttry {\n\t\t\t\t\tif (value) {\n\t\t\t\t\t\tcontrolPaneComponent.openPane();\n\t\t\t\t\t} else {\n\t\t\t\t\t\tcontrolPane.collapse();\n\t\t\t\t\t}\n\t\t\t\t} catch (e) {\n\t\t\t\t\t// ignore\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (!value) {\n\t\t\t\tshowCallOverlay.set(false);\n\t\t\t\tshowOverview.set(false);\n\t\t\t\tshowArtifacts.set(false);\n\t\t\t\tshowEmbeds.set(false);\n\t\t\t}\n\t\t});\n\n\t\tselectedFolderSubscribe = selectedFolder.subscribe(async (folder) => {\n\t\t\tif (\n\t\t\t\tfolder?.data?.model_ids &&\n\t\t\t\tJSON.stringify(selectedModels) !== JSON.stringify(folder.data.model_ids)\n\t\t\t) {\n\t\t\t\tselectedModels = folder.data.model_ids;\n\n\t\t\t\tconsole.log('Set selectedModels from folder data:', selectedModels);\n\t\t\t}\n\t\t});\n\n\t\tconst chatInput = document.getElementById('chat-input');\n\t\tchatInput?.focus();\n\t});\n\n\tonDestroy(() => {\n\t\ttry {\n\t\t\tpageSubscribe();\n\t\t\tshowControlsSubscribe();\n\t\t\tselectedFolderSubscribe();\n\t\t\tchatIdUnsubscriber?.();\n\t\t\twindow.removeEventListener('message', onMessageHandler);\n\t\t\t$socket?.off('events', chatEventHandler);\n\t\t\t$audioQueue?.destroy();\n\t\t} catch (e) {\n\t\t\tconsole.error(e);\n\t\t}\n\t});\n\n\t// File upload functions\n\n\tconst uploadGoogleDriveFile = async (fileData) => {\n\t\tconsole.log('Starting uploadGoogleDriveFile with:', {\n\t\t\tid: fileData.id,\n\t\t\tname: fileData.name,\n\t\t\turl: fileData.url,\n\t\t\theaders: {\n\t\t\t\tAuthorization: `Bearer ${token}`\n\t\t\t}\n\t\t});\n\n\t\t// Validate input\n\t\tif (!fileData?.id || !fileData?.name || !fileData?.url || !fileData?.headers?.Authorization) {\n\t\t\tthrow new Error('Invalid file data provided');\n\t\t}\n\n\t\tconst tempItemId = uuidv4();\n\t\tconst fileItem = {\n\t\t\ttype: 'file',\n\t\t\tfile: '',\n\t\t\tid: null,\n\t\t\turl: fileData.url,\n\t\t\tname: fileData.name,\n\t\t\tcollection_name: '',\n\t\t\tstatus: 'uploading',\n\t\t\terror: '',\n\t\t\titemId: tempItemId,\n\t\t\tsize: 0\n\t\t};\n\n\t\ttry {\n\t\t\tfiles = [...files, fileItem];\n\t\t\tconsole.log('Processing web file with URL:', fileData.url);\n\n\t\t\t// Configure fetch options with proper headers\n\t\t\tconst fetchOptions = {\n\t\t\t\theaders: {\n\t\t\t\t\tAuthorization: fileData.headers.Authorization,\n\t\t\t\t\tAccept: '*/*'\n\t\t\t\t},\n\t\t\t\tmethod: 'GET'\n\t\t\t};\n\n\t\t\t// Attempt to fetch the file\n\t\t\tconsole.log('Fetching file content from Google Drive...');\n\t\t\tconst fileResponse = await fetch(fileData.url, fetchOptions);\n\n\t\t\tif (!fileResponse.ok) {\n\t\t\t\tconst errorText = await fileResponse.text();\n\t\t\t\tthrow new Error(`Failed to fetch file (${fileResponse.status}): ${errorText}`);\n\t\t\t}\n\n\t\t\t// Get content type from response\n\t\t\tconst contentType = fileResponse.headers.get('content-type') || 'application/octet-stream';\n\t\t\tconsole.log('Response received with content-type:', contentType);\n\n\t\t\t// Convert response to blob\n\t\t\tconsole.log('Converting response to blob...');\n\t\t\tconst fileBlob = await fileResponse.blob();\n\n\t\t\tif (fileBlob.size === 0) {\n\t\t\t\tthrow new Error('Retrieved file is empty');\n\t\t\t}\n\n\t\t\tconsole.log('Blob created:', {\n\t\t\t\tsize: fileBlob.size,\n\t\t\t\ttype: fileBlob.type || contentType\n\t\t\t});\n\n\t\t\t// Create File object with proper MIME type\n\t\t\tconst file = new File([fileBlob], fileData.name, {\n\t\t\t\ttype: fileBlob.type || contentType\n\t\t\t});\n\n\t\t\tconsole.log('File object created:', {\n\t\t\t\tname: file.name,\n\t\t\t\tsize: file.size,\n\t\t\t\ttype: file.type\n\t\t\t});\n\n\t\t\tif (file.size === 0) {\n\t\t\t\tthrow new Error('Created file is empty');\n\t\t\t}\n\n\t\t\t// If the file is an audio file, provide the language for STT.\n\t\t\tlet metadata = null;\n\t\t\tif (\n\t\t\t\t(file.type.startsWith('audio/') || file.type.startsWith('video/')) &&\n\t\t\t\t$settings?.audio?.stt?.language\n\t\t\t) {\n\t\t\t\tmetadata = {\n\t\t\t\t\tlanguage: $settings?.audio?.stt?.language\n\t\t\t\t};\n\t\t\t}\n\n\t\t\t// Upload file to server\n\t\t\tconsole.log('Uploading file to server...');\n\t\t\tconst uploadedFile = await uploadFile(localStorage.token, file, metadata);\n\n\t\t\tif (!uploadedFile) {\n\t\t\t\tthrow new Error('Server returned null response for file upload');\n\t\t\t}\n\n\t\t\tconsole.log('File uploaded successfully:', uploadedFile);\n\n\t\t\t// Update file item with upload results\n\t\t\tfileItem.status = 'uploaded';\n\t\t\tfileItem.file = uploadedFile;\n\t\t\tfileItem.id = uploadedFile.id;\n\t\t\tfileItem.size = file.size;\n\t\t\tfileItem.collection_name = uploadedFile?.meta?.collection_name;\n\t\t\tfileItem.url = `${uploadedFile.id}`;\n\n\t\t\tfiles = files;\n\t\t\ttoast.success($i18n.t('File uploaded successfully'));\n\t\t} catch (e) {\n\t\t\tconsole.error('Error uploading file:', e);\n\t\t\tfiles = files.filter((f) => f.itemId !== tempItemId);\n\t\t\ttoast.error(\n\t\t\t\t$i18n.t('Error uploading file: {{error}}', {\n\t\t\t\t\terror: e.message || 'Unknown error'\n\t\t\t\t})\n\t\t\t);\n\t\t}\n\t};\n\n\tconst uploadWeb = async (urls) => {\n\t\tif (!Array.isArray(urls)) {\n\t\t\turls = [urls];\n\t\t}\n\n\t\t// Create file items first\n\t\tconst fileItems = urls.map((url) => ({\n\t\t\ttype: 'text',\n\t\t\tname: url,\n\t\t\tcollection_name: '',\n\t\t\tstatus: 'uploading',\n\t\t\tcontext: 'full',\n\t\t\turl,\n\t\t\terror: ''\n\t\t}));\n\n\t\t// Display all items at once\n\t\tfiles = [...files, ...fileItems];\n\n\t\tfor (const fileItem of fileItems) {\n\t\t\ttry {\n\t\t\t\tconst res = isYoutubeUrl(fileItem.url)\n\t\t\t\t\t? await processYoutubeVideo(localStorage.token, fileItem.url)\n\t\t\t\t\t: await processWeb(localStorage.token, '', fileItem.url);\n\n\t\t\t\tif (res) {\n\t\t\t\t\tfileItem.status = 'uploaded';\n\t\t\t\t\tfileItem.collection_name = res.collection_name;\n\t\t\t\t\tfileItem.file = {\n\t\t\t\t\t\t...res.file,\n\t\t\t\t\t\t...fileItem.file\n\t\t\t\t\t};\n\t\t\t\t}\n\n\t\t\t\tfiles = [...files];\n\t\t\t} catch (e) {\n\t\t\t\tfiles = files.filter((f) => f.name !== url);\n\t\t\t\ttoast.error(`${e}`);\n\t\t\t}\n\t\t}\n\t};\n\n\tconst onUpload = async (event) => {\n\t\tconst { type, data } = event;\n\n\t\tif (type === 'google-drive') {\n\t\t\tawait uploadGoogleDriveFile(data);\n\t\t} else if (type === 'web') {\n\t\t\tawait uploadWeb(data);\n\t\t}\n\t};\n\n\t$: if (history) {\n\t\tgetContents();\n\t} else {\n\t\tartifactContents.set([]);\n\t}\n\n\tconst getContents = () => {\n\t\tconst messages = history ? createMessagesList(history, history.currentId) : [];\n\t\tlet contents = [];\n\t\tmessages.forEach((message) => {\n\t\t\tif (message?.role !== 'user' && message?.content) {\n\t\t\t\tconst {\n\t\t\t\t\tcodeBlocks: codeBlocks,\n\t\t\t\t\thtml: htmlContent,\n\t\t\t\t\tcss: cssContent,\n\t\t\t\t\tjs: jsContent\n\t\t\t\t} = getCodeBlockContents(message.content);\n\n\t\t\t\tif (htmlContent || cssContent || jsContent) {\n\t\t\t\t\tconst renderedContent = `\n                        <!DOCTYPE html>\n                        <html lang=\"en\">\n                        <head>\n                            <meta charset=\"UTF-8\">\n                            <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n\t\t\t\t\t\t\t<${''}style>\n\t\t\t\t\t\t\t\tbody {\n\t\t\t\t\t\t\t\t\tbackground-color: white; /* Ensure the iframe has a white background */\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t${cssContent}\n\t\t\t\t\t\t\t</${''}style>\n                        </head>\n                        <body>\n                            ${htmlContent}\n\n\t\t\t\t\t\t\t<${''}script>\n                            \t${jsContent}\n\t\t\t\t\t\t\t</${''}script>\n                        </body>\n                        </html>\n                    `;\n\t\t\t\t\tcontents = [...contents, { type: 'iframe', content: renderedContent }];\n\t\t\t\t} else {\n\t\t\t\t\t// Check for SVG content\n\t\t\t\t\tfor (const block of codeBlocks) {\n\t\t\t\t\t\tif (block.lang === 'svg' || (block.lang === 'xml' && block.code.includes('<svg'))) {\n\t\t\t\t\t\t\tcontents = [...contents, { type: 'svg', content: block.code }];\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tartifactContents.set(contents);\n\t};\n\n\t//////////////////////////\n\t// Web functions\n\t//////////////////////////\n\n\tconst initNewChat = async () => {\n\t\tconsole.log('initNewChat');\n\t\tif ($user?.role !== 'admin' && $user?.permissions?.chat?.temporary_enforced) {\n\t\t\tawait temporaryChatEnabled.set(true);\n\t\t}\n\n\t\tif ($settings?.temporaryChatByDefault ?? false) {\n\t\t\tif ($temporaryChatEnabled === false) {\n\t\t\t\tawait temporaryChatEnabled.set(true);\n\t\t\t} else if ($temporaryChatEnabled === null) {\n\t\t\t\t// if set to null set to false; refer to temp chat toggle click handler\n\t\t\t\tawait temporaryChatEnabled.set(false);\n\t\t\t}\n\t\t}\n\n\t\tif ($user?.role !== 'admin' && !$user?.permissions?.chat?.temporary) {\n\t\t\tawait temporaryChatEnabled.set(false);\n\t\t}\n\n\t\tconst availableModels = $models\n\t\t\t.filter((m) => !(m?.info?.meta?.hidden ?? false))\n\t\t\t.map((m) => m.id);\n\n\t\tconst defaultModels = $config?.default_models ? $config?.default_models.split(',') : [];\n\n\t\tif ($page.url.searchParams.get('models') || $page.url.searchParams.get('model')) {\n\t\t\tconst urlModels = (\n\t\t\t\t$page.url.searchParams.get('models') ||\n\t\t\t\t$page.url.searchParams.get('model') ||\n\t\t\t\t''\n\t\t\t)?.split(',');\n\n\t\t\tif (urlModels.length === 1) {\n\t\t\t\tif (!$models.find((m) => m.id === urlModels[0])) {\n\t\t\t\t\t// Model not found; open model selector and prefill\n\t\t\t\t\tconst modelSelectorButton = document.getElementById('model-selector-0-button');\n\t\t\t\t\tif (modelSelectorButton) {\n\t\t\t\t\t\tmodelSelectorButton.click();\n\t\t\t\t\t\tawait tick();\n\n\t\t\t\t\t\tconst modelSelectorInput = document.getElementById('model-search-input');\n\t\t\t\t\t\tif (modelSelectorInput) {\n\t\t\t\t\t\t\tmodelSelectorInput.focus();\n\t\t\t\t\t\t\tmodelSelectorInput.value = urlModels[0];\n\t\t\t\t\t\t\tmodelSelectorInput.dispatchEvent(new Event('input'));\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\t// Model found; set it as selected\n\t\t\t\t\tselectedModels = urlModels;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t// Multiple models; set as selected\n\t\t\t\tselectedModels = urlModels;\n\t\t\t}\n\n\t\t\t// Unavailable models filtering\n\t\t\tselectedModels = selectedModels.filter((modelId) =>\n\t\t\t\t$models.map((m) => m.id).includes(modelId)\n\t\t\t);\n\t\t} else {\n\t\t\tif ($selectedFolder?.data?.model_ids) {\n\t\t\t\t// Set from folder model IDs\n\t\t\t\tselectedModels = $selectedFolder?.data?.model_ids;\n\t\t\t} else {\n\t\t\t\tif (sessionStorage.selectedModels) {\n\t\t\t\t\t// Set from session storage (temporary selection)\n\t\t\t\t\tselectedModels = JSON.parse(sessionStorage.selectedModels);\n\t\t\t\t\tsessionStorage.removeItem('selectedModels');\n\t\t\t\t} else {\n\t\t\t\t\tif ($settings?.models) {\n\t\t\t\t\t\t// Set from user settings\n\t\t\t\t\t\tselectedModels = $settings?.models;\n\t\t\t\t\t} else if (defaultModels && defaultModels.length > 0) {\n\t\t\t\t\t\t// Set from default models\n\t\t\t\t\t\tselectedModels = defaultModels;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Unavailable & hidden models filtering\n\t\t\tselectedModels = selectedModels.filter((modelId) => availableModels.includes(modelId));\n\t\t}\n\n\t\t// Ensure at least one model is selected\n\t\tif (selectedModels.length === 0 || (selectedModels.length === 1 && selectedModels[0] === '')) {\n\t\t\tif (availableModels.length > 0) {\n\t\t\t\tif (defaultModels && defaultModels.length > 0) {\n\t\t\t\t\t// Set from default models\n\t\t\t\t\tselectedModels = defaultModels.filter((modelId) => availableModels.includes(modelId));\n\t\t\t\t}\n\n\t\t\t\t// Set to first available model\n\t\t\t\tselectedModels = [availableModels?.at(0) ?? ''];\n\t\t\t} else {\n\t\t\t\tselectedModels = [''];\n\t\t\t}\n\t\t}\n\n\t\tawait showControls.set(false);\n\t\tawait showCallOverlay.set(false);\n\t\tawait showOverview.set(false);\n\t\tawait showArtifacts.set(false);\n\n\t\tif ($page.url.pathname.includes('/c/')) {\n\t\t\twindow.history.replaceState(history.state, '', `/`);\n\t\t}\n\n\t\tautoScroll = true;\n\n\t\tresetInput();\n\t\tawait chatId.set('');\n\t\tawait chatTitle.set('');\n\n\t\thistory = {\n\t\t\tmessages: {},\n\t\t\tcurrentId: null\n\t\t};\n\n\t\tchatFiles = [];\n\t\tparams = {};\n\n\t\tif ($page.url.searchParams.get('youtube')) {\n\t\t\tawait uploadWeb(`https://www.youtube.com/watch?v=${$page.url.searchParams.get('youtube')}`);\n\t\t}\n\n\t\tif ($page.url.searchParams.get('load-url')) {\n\t\t\tawait uploadWeb($page.url.searchParams.get('load-url'));\n\t\t}\n\n\t\tif ($page.url.searchParams.get('web-search') === 'true') {\n\t\t\twebSearchEnabled = true;\n\t\t}\n\n\t\tif ($page.url.searchParams.get('image-generation') === 'true') {\n\t\t\timageGenerationEnabled = true;\n\t\t}\n\n\t\tif ($page.url.searchParams.get('code-interpreter') === 'true') {\n\t\t\tcodeInterpreterEnabled = true;\n\t\t}\n\n\t\tif ($page.url.searchParams.get('tools')) {\n\t\t\tselectedToolIds = $page.url.searchParams\n\t\t\t\t.get('tools')\n\t\t\t\t?.split(',')\n\t\t\t\t.map((id) => id.trim())\n\t\t\t\t.filter((id) => id);\n\t\t} else if ($page.url.searchParams.get('tool-ids')) {\n\t\t\tselectedToolIds = $page.url.searchParams\n\t\t\t\t.get('tool-ids')\n\t\t\t\t?.split(',')\n\t\t\t\t.map((id) => id.trim())\n\t\t\t\t.filter((id) => id);\n\t\t}\n\n\t\tif ($page.url.searchParams.get('call') === 'true') {\n\t\t\tshowCallOverlay.set(true);\n\t\t\tshowControls.set(true);\n\t\t}\n\n\t\tif ($page.url.searchParams.get('q')) {\n\t\t\tconst q = $page.url.searchParams.get('q') ?? '';\n\t\t\tmessageInput?.setText(q);\n\n\t\t\tif (q) {\n\t\t\t\tif (($page.url.searchParams.get('submit') ?? 'true') === 'true') {\n\t\t\t\t\tawait tick();\n\t\t\t\t\tsubmitPrompt(q);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tselectedModels = selectedModels.map((modelId) =>\n\t\t\t$models.map((m) => m.id).includes(modelId) ? modelId : ''\n\t\t);\n\n\t\tconst chatInput = document.getElementById('chat-input');\n\t\tsetTimeout(() => chatInput?.focus(), 0);\n\t};\n\n\tconst loadChat = async () => {\n\t\tchatId.set(chatIdProp);\n\n\t\tif ($temporaryChatEnabled) {\n\t\t\ttemporaryChatEnabled.set(false);\n\t\t}\n\n\t\tchat = await getChatById(localStorage.token, $chatId).catch(async (error) => {\n\t\t\tawait goto('/');\n\t\t\treturn null;\n\t\t});\n\n\t\tif (chat) {\n\t\t\ttags = await getTagsById(localStorage.token, $chatId).catch(async (error) => {\n\t\t\t\treturn [];\n\t\t\t});\n\n\t\t\tconst chatContent = chat.chat;\n\n\t\t\tif (chatContent) {\n\t\t\t\tconsole.log(chatContent);\n\n\t\t\t\tselectedModels =\n\t\t\t\t\t(chatContent?.models ?? undefined) !== undefined\n\t\t\t\t\t\t? chatContent.models\n\t\t\t\t\t\t: [chatContent.models ?? ''];\n\n\t\t\t\tif (!($user?.role === 'admin' || ($user?.permissions?.chat?.multiple_models ?? true))) {\n\t\t\t\t\tselectedModels = selectedModels.length > 0 ? [selectedModels[0]] : [''];\n\t\t\t\t}\n\n\t\t\t\toldSelectedModelIds = JSON.parse(JSON.stringify(selectedModels));\n\n\t\t\t\thistory =\n\t\t\t\t\t(chatContent?.history ?? undefined) !== undefined\n\t\t\t\t\t\t? chatContent.history\n\t\t\t\t\t\t: convertMessagesToHistory(chatContent.messages);\n\n\t\t\t\tchatTitle.set(chatContent.title);\n\n\t\t\t\tparams = chatContent?.params ?? {};\n\t\t\t\tchatFiles = chatContent?.files ?? [];\n\n\t\t\t\tautoScroll = true;\n\t\t\t\tawait tick();\n\n\t\t\t\tif (history.currentId) {\n\t\t\t\t\tfor (const message of Object.values(history.messages)) {\n\t\t\t\t\t\tif (message && message.role === 'assistant') {\n\t\t\t\t\t\t\tmessage.done = true;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tconst taskRes = await getTaskIdsByChatId(localStorage.token, $chatId).catch((error) => {\n\t\t\t\t\treturn null;\n\t\t\t\t});\n\n\t\t\t\tif (taskRes) {\n\t\t\t\t\ttaskIds = taskRes.task_ids;\n\t\t\t\t}\n\n\t\t\t\tawait tick();\n\n\t\t\t\treturn true;\n\t\t\t} else {\n\t\t\t\treturn null;\n\t\t\t}\n\t\t}\n\t};\n\n\tconst scrollToBottom = async (behavior = 'auto') => {\n\t\tawait tick();\n\t\tif (messagesContainerElement) {\n\t\t\tmessagesContainerElement.scrollTo({\n\t\t\t\ttop: messagesContainerElement.scrollHeight,\n\t\t\t\tbehavior\n\t\t\t});\n\t\t}\n\t};\n\tconst chatCompletedHandler = async (_chatId, modelId, responseMessageId, messages) => {\n\t\tconst res = await chatCompleted(localStorage.token, {\n\t\t\tmodel: modelId,\n\t\t\tmessages: messages.map((m) => ({\n\t\t\t\tid: m.id,\n\t\t\t\trole: m.role,\n\t\t\t\tcontent: m.content,\n\t\t\t\tinfo: m.info ? m.info : undefined,\n\t\t\t\ttimestamp: m.timestamp,\n\t\t\t\t...(m.usage ? { usage: m.usage } : {}),\n\t\t\t\t...(m.sources ? { sources: m.sources } : {})\n\t\t\t})),\n\t\t\tfilter_ids: selectedFilterIds.length > 0 ? selectedFilterIds : undefined,\n\t\t\tmodel_item: $models.find((m) => m.id === modelId),\n\t\t\tchat_id: _chatId,\n\t\t\tsession_id: $socket?.id,\n\t\t\tid: responseMessageId\n\t\t}).catch((error) => {\n\t\t\ttoast.error(`${error}`);\n\t\t\tmessages.at(-1).error = { content: error };\n\n\t\t\treturn null;\n\t\t});\n\n\t\tif (res !== null && res.messages) {\n\t\t\t// Update chat history with the new messages\n\t\t\tfor (const message of res.messages) {\n\t\t\t\tif (message?.id) {\n\t\t\t\t\t// Add null check for message and message.id\n\t\t\t\t\thistory.messages[message.id] = {\n\t\t\t\t\t\t...history.messages[message.id],\n\t\t\t\t\t\t...(history.messages[message.id].content !== message.content\n\t\t\t\t\t\t\t? { originalContent: history.messages[message.id].content }\n\t\t\t\t\t\t\t: {}),\n\t\t\t\t\t\t...message\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tawait tick();\n\n\t\tif ($chatId == _chatId) {\n\t\t\tif (!$temporaryChatEnabled) {\n\t\t\t\tchat = await updateChatById(localStorage.token, _chatId, {\n\t\t\t\t\tmodels: selectedModels,\n\t\t\t\t\tmessages: messages,\n\t\t\t\t\thistory: history,\n\t\t\t\t\tparams: params,\n\t\t\t\t\tfiles: chatFiles\n\t\t\t\t});\n\n\t\t\t\tcurrentChatPage.set(1);\n\t\t\t\tawait chats.set(await getChatList(localStorage.token, $currentChatPage));\n\t\t\t}\n\t\t}\n\n\t\ttaskIds = null;\n\t};\n\n\tconst chatActionHandler = async (_chatId, actionId, modelId, responseMessageId, event = null) => {\n\t\tconst messages = createMessagesList(history, responseMessageId);\n\n\t\tconst res = await chatAction(localStorage.token, actionId, {\n\t\t\tmodel: modelId,\n\t\t\tmessages: messages.map((m) => ({\n\t\t\t\tid: m.id,\n\t\t\t\trole: m.role,\n\t\t\t\tcontent: m.content,\n\t\t\t\tinfo: m.info ? m.info : undefined,\n\t\t\t\ttimestamp: m.timestamp,\n\t\t\t\t...(m.sources ? { sources: m.sources } : {})\n\t\t\t})),\n\t\t\t...(event ? { event: event } : {}),\n\t\t\tmodel_item: $models.find((m) => m.id === modelId),\n\t\t\tchat_id: _chatId,\n\t\t\tsession_id: $socket?.id,\n\t\t\tid: responseMessageId\n\t\t}).catch((error) => {\n\t\t\ttoast.error(`${error}`);\n\t\t\tmessages.at(-1).error = { content: error };\n\t\t\treturn null;\n\t\t});\n\n\t\tif (res !== null && res.messages) {\n\t\t\t// Update chat history with the new messages\n\t\t\tfor (const message of res.messages) {\n\t\t\t\thistory.messages[message.id] = {\n\t\t\t\t\t...history.messages[message.id],\n\t\t\t\t\t...(history.messages[message.id].content !== message.content\n\t\t\t\t\t\t? { originalContent: history.messages[message.id].content }\n\t\t\t\t\t\t: {}),\n\t\t\t\t\t...message\n\t\t\t\t};\n\t\t\t}\n\t\t}\n\n\t\tif ($chatId == _chatId) {\n\t\t\tif (!$temporaryChatEnabled) {\n\t\t\t\tchat = await updateChatById(localStorage.token, _chatId, {\n\t\t\t\t\tmodels: selectedModels,\n\t\t\t\t\tmessages: messages,\n\t\t\t\t\thistory: history,\n\t\t\t\t\tparams: params,\n\t\t\t\t\tfiles: chatFiles\n\t\t\t\t});\n\n\t\t\t\tcurrentChatPage.set(1);\n\t\t\t\tawait chats.set(await getChatList(localStorage.token, $currentChatPage));\n\t\t\t}\n\t\t}\n\t};\n\n\tconst getChatEventEmitter = async (modelId: string, chatId: string = '') => {\n\t\treturn setInterval(() => {\n\t\t\t$socket?.emit('usage', {\n\t\t\t\taction: 'chat',\n\t\t\t\tmodel: modelId,\n\t\t\t\tchat_id: chatId\n\t\t\t});\n\t\t}, 1000);\n\t};\n\n\tconst createMessagePair = async (userPrompt) => {\n\t\tmessageInput?.setText('');\n\t\tif (selectedModels.length === 0) {\n\t\t\ttoast.error($i18n.t('Model not selected'));\n\t\t} else {\n\t\t\tconst modelId = selectedModels[0];\n\t\t\tconst model = $models.filter((m) => m.id === modelId).at(0);\n\n\t\t\tconst messages = createMessagesList(history, history.currentId);\n\t\t\tconst parentMessage = messages.length !== 0 ? messages.at(-1) : null;\n\n\t\t\tconst userMessageId = uuidv4();\n\t\t\tconst responseMessageId = uuidv4();\n\n\t\t\tconst userMessage = {\n\t\t\t\tid: userMessageId,\n\t\t\t\tparentId: parentMessage ? parentMessage.id : null,\n\t\t\t\tchildrenIds: [responseMessageId],\n\t\t\t\trole: 'user',\n\t\t\t\tcontent: userPrompt ? userPrompt : `[PROMPT] ${userMessageId}`,\n\t\t\t\ttimestamp: Math.floor(Date.now() / 1000)\n\t\t\t};\n\n\t\t\tconst responseMessage = {\n\t\t\t\tid: responseMessageId,\n\t\t\t\tparentId: userMessageId,\n\t\t\t\tchildrenIds: [],\n\t\t\t\trole: 'assistant',\n\t\t\t\tcontent: `[RESPONSE] ${responseMessageId}`,\n\t\t\t\tdone: true,\n\n\t\t\t\tmodel: modelId,\n\t\t\t\tmodelName: model.name ?? model.id,\n\t\t\t\tmodelIdx: 0,\n\t\t\t\ttimestamp: Math.floor(Date.now() / 1000)\n\t\t\t};\n\n\t\t\tif (parentMessage) {\n\t\t\t\tparentMessage.childrenIds.push(userMessageId);\n\t\t\t\thistory.messages[parentMessage.id] = parentMessage;\n\t\t\t}\n\t\t\thistory.messages[userMessageId] = userMessage;\n\t\t\thistory.messages[responseMessageId] = responseMessage;\n\n\t\t\thistory.currentId = responseMessageId;\n\n\t\t\tawait tick();\n\n\t\t\tif (autoScroll) {\n\t\t\t\tscrollToBottom();\n\t\t\t}\n\n\t\t\tif (messages.length === 0) {\n\t\t\t\tawait initChatHandler(history);\n\t\t\t} else {\n\t\t\t\tawait saveChatHandler($chatId, history);\n\t\t\t}\n\t\t}\n\t};\n\n\tconst addMessages = async ({ modelId, parentId, messages }) => {\n\t\tconst model = $models.filter((m) => m.id === modelId).at(0);\n\n\t\tlet parentMessage = history.messages[parentId];\n\t\tlet currentParentId = parentMessage ? parentMessage.id : null;\n\t\tfor (const message of messages) {\n\t\t\tlet messageId = uuidv4();\n\n\t\t\tif (message.role === 'user') {\n\t\t\t\tconst userMessage = {\n\t\t\t\t\tid: messageId,\n\t\t\t\t\tparentId: currentParentId,\n\t\t\t\t\tchildrenIds: [],\n\t\t\t\t\ttimestamp: Math.floor(Date.now() / 1000),\n\t\t\t\t\t...message\n\t\t\t\t};\n\n\t\t\t\tif (parentMessage) {\n\t\t\t\t\tparentMessage.childrenIds.push(messageId);\n\t\t\t\t\thistory.messages[parentMessage.id] = parentMessage;\n\t\t\t\t}\n\n\t\t\t\thistory.messages[messageId] = userMessage;\n\t\t\t\tparentMessage = userMessage;\n\t\t\t\tcurrentParentId = messageId;\n\t\t\t} else {\n\t\t\t\tconst responseMessage = {\n\t\t\t\t\tid: messageId,\n\t\t\t\t\tparentId: currentParentId,\n\t\t\t\t\tchildrenIds: [],\n\t\t\t\t\tdone: true,\n\t\t\t\t\tmodel: model.id,\n\t\t\t\t\tmodelName: model.name ?? model.id,\n\t\t\t\t\tmodelIdx: 0,\n\t\t\t\t\ttimestamp: Math.floor(Date.now() / 1000),\n\t\t\t\t\t...message\n\t\t\t\t};\n\n\t\t\t\tif (parentMessage) {\n\t\t\t\t\tparentMessage.childrenIds.push(messageId);\n\t\t\t\t\thistory.messages[parentMessage.id] = parentMessage;\n\t\t\t\t}\n\n\t\t\t\thistory.messages[messageId] = responseMessage;\n\t\t\t\tparentMessage = responseMessage;\n\t\t\t\tcurrentParentId = messageId;\n\t\t\t}\n\t\t}\n\n\t\thistory.currentId = currentParentId;\n\t\tawait tick();\n\n\t\tif (autoScroll) {\n\t\t\tscrollToBottom();\n\t\t}\n\n\t\tif (messages.length === 0) {\n\t\t\tawait initChatHandler(history);\n\t\t} else {\n\t\t\tawait saveChatHandler($chatId, history);\n\t\t}\n\t};\n\n\tconst chatCompletionEventHandler = async (data, message, chatId) => {\n\t\tconst { id, done, choices, content, sources, selected_model_id, error, usage } = data;\n\n\t\tif (error) {\n\t\t\tawait handleOpenAIError(error, message);\n\t\t}\n\n\t\tif (sources && !message?.sources) {\n\t\t\tmessage.sources = sources;\n\t\t}\n\n\t\tif (choices) {\n\t\t\tif (choices[0]?.message?.content) {\n\t\t\t\t// Non-stream response\n\t\t\t\tmessage.content += choices[0]?.message?.content;\n\t\t\t} else {\n\t\t\t\t// Stream response\n\t\t\t\tlet value = choices[0]?.delta?.content ?? '';\n\t\t\t\tif (message.content == '' && value == '\\n') {\n\t\t\t\t\tconsole.log('Empty response');\n\t\t\t\t} else {\n\t\t\t\t\tmessage.content += value;\n\n\t\t\t\t\tif (navigator.vibrate && ($settings?.hapticFeedback ?? false)) {\n\t\t\t\t\t\tnavigator.vibrate(5);\n\t\t\t\t\t}\n\n\t\t\t\t\t// Emit chat event for TTS\n\t\t\t\t\tconst messageContentParts = getMessageContentParts(\n\t\t\t\t\t\tremoveAllDetails(message.content),\n\t\t\t\t\t\t$config?.audio?.tts?.split_on ?? 'punctuation'\n\t\t\t\t\t);\n\t\t\t\t\tmessageContentParts.pop();\n\n\t\t\t\t\t// dispatch only last sentence and make sure it hasn't been dispatched before\n\t\t\t\t\tif (\n\t\t\t\t\t\tmessageContentParts.length > 0 &&\n\t\t\t\t\t\tmessageContentParts[messageContentParts.length - 1] !== message.lastSentence\n\t\t\t\t\t) {\n\t\t\t\t\t\tmessage.lastSentence = messageContentParts[messageContentParts.length - 1];\n\t\t\t\t\t\teventTarget.dispatchEvent(\n\t\t\t\t\t\t\tnew CustomEvent('chat', {\n\t\t\t\t\t\t\t\tdetail: {\n\t\t\t\t\t\t\t\t\tid: message.id,\n\t\t\t\t\t\t\t\t\tcontent: messageContentParts[messageContentParts.length - 1]\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (content) {\n\t\t\t// REALTIME_CHAT_SAVE is disabled\n\t\t\tmessage.content = content;\n\n\t\t\tif (navigator.vibrate && ($settings?.hapticFeedback ?? false)) {\n\t\t\t\tnavigator.vibrate(5);\n\t\t\t}\n\n\t\t\t// Emit chat event for TTS\n\t\t\tconst messageContentParts = getMessageContentParts(\n\t\t\t\tremoveAllDetails(message.content),\n\t\t\t\t$config?.audio?.tts?.split_on ?? 'punctuation'\n\t\t\t);\n\t\t\tmessageContentParts.pop();\n\n\t\t\t// dispatch only last sentence and make sure it hasn't been dispatched before\n\t\t\tif (\n\t\t\t\tmessageContentParts.length > 0 &&\n\t\t\t\tmessageContentParts[messageContentParts.length - 1] !== message.lastSentence\n\t\t\t) {\n\t\t\t\tmessage.lastSentence = messageContentParts[messageContentParts.length - 1];\n\t\t\t\teventTarget.dispatchEvent(\n\t\t\t\t\tnew CustomEvent('chat', {\n\t\t\t\t\t\tdetail: {\n\t\t\t\t\t\t\tid: message.id,\n\t\t\t\t\t\t\tcontent: messageContentParts[messageContentParts.length - 1]\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\n\t\tif (selected_model_id) {\n\t\t\tmessage.selectedModelId = selected_model_id;\n\t\t\tmessage.arena = true;\n\t\t}\n\n\t\tif (usage) {\n\t\t\tmessage.usage = usage;\n\t\t}\n\n\t\thistory.messages[message.id] = message;\n\n\t\tif (done) {\n\t\t\tmessage.done = true;\n\n\t\t\tif ($settings.responseAutoCopy) {\n\t\t\t\tcopyToClipboard(message.content);\n\t\t\t}\n\n\t\t\tif ($settings.responseAutoPlayback && !$showCallOverlay) {\n\t\t\t\tawait tick();\n\t\t\t\tdocument.getElementById(`speak-button-${message.id}`)?.click();\n\t\t\t}\n\n\t\t\t// Emit chat event for TTS\n\t\t\tlet lastMessageContentPart =\n\t\t\t\tgetMessageContentParts(\n\t\t\t\t\tremoveAllDetails(message.content),\n\t\t\t\t\t$config?.audio?.tts?.split_on ?? 'punctuation'\n\t\t\t\t)?.at(-1) ?? '';\n\t\t\tif (lastMessageContentPart) {\n\t\t\t\teventTarget.dispatchEvent(\n\t\t\t\t\tnew CustomEvent('chat', {\n\t\t\t\t\t\tdetail: { id: message.id, content: lastMessageContentPart }\n\t\t\t\t\t})\n\t\t\t\t);\n\t\t\t}\n\t\t\teventTarget.dispatchEvent(\n\t\t\t\tnew CustomEvent('chat:finish', {\n\t\t\t\t\tdetail: {\n\t\t\t\t\t\tid: message.id,\n\t\t\t\t\t\tcontent: message.content\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t);\n\n\t\t\thistory.messages[message.id] = message;\n\n\t\t\tawait tick();\n\t\t\tif (autoScroll) {\n\t\t\t\tscrollToBottom();\n\t\t\t}\n\n\t\t\tawait chatCompletedHandler(\n\t\t\t\tchatId,\n\t\t\t\tmessage.model,\n\t\t\t\tmessage.id,\n\t\t\t\tcreateMessagesList(history, message.id)\n\t\t\t);\n\t\t}\n\n\t\tconsole.log(data);\n\t\tawait tick();\n\n\t\tif (autoScroll) {\n\t\t\tscrollToBottom();\n\t\t}\n\t};\n\n\t//////////////////////////\n\t// Chat functions\n\t//////////////////////////\n\n\tconst submitPrompt = async (userPrompt, { _raw = false } = {}) => {\n\t\tconsole.log('submitPrompt', userPrompt, $chatId);\n\n\t\tconst _selectedModels = selectedModels.map((modelId) =>\n\t\t\t$models.map((m) => m.id).includes(modelId) ? modelId : ''\n\t\t);\n\n\t\tif (JSON.stringify(selectedModels) !== JSON.stringify(_selectedModels)) {\n\t\t\tselectedModels = _selectedModels;\n\t\t}\n\n\t\tif (userPrompt === '' && files.length === 0) {\n\t\t\ttoast.error($i18n.t('Please enter a prompt'));\n\t\t\treturn;\n\t\t}\n\t\tif (selectedModels.includes('')) {\n\t\t\ttoast.error($i18n.t('Model not selected'));\n\t\t\treturn;\n\t\t}\n\n\t\tif (\n\t\t\tfiles.length > 0 &&\n\t\t\tfiles.filter((file) => file.type !== 'image' && file.status === 'uploading').length > 0\n\t\t) {\n\t\t\ttoast.error(\n\t\t\t\t$i18n.t(`Oops! There are files still uploading. Please wait for the upload to complete.`)\n\t\t\t);\n\t\t\treturn;\n\t\t}\n\n\t\tif (\n\t\t\t($config?.file?.max_count ?? null) !== null &&\n\t\t\tfiles.length + chatFiles.length > $config?.file?.max_count\n\t\t) {\n\t\t\ttoast.error(\n\t\t\t\t$i18n.t(`You can only chat with a maximum of {{maxCount}} file(s) at a time.`, {\n\t\t\t\t\tmaxCount: $config?.file?.max_count\n\t\t\t\t})\n\t\t\t);\n\t\t\treturn;\n\t\t}\n\n\t\tif (history?.currentId) {\n\t\t\tconst lastMessage = history.messages[history.currentId];\n\t\t\tif (lastMessage.done != true) {\n\t\t\t\t// Response not done\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (lastMessage.error && !lastMessage.content) {\n\t\t\t\t// Error in response\n\t\t\t\ttoast.error($i18n.t(`Oops! There was an error in the previous response.`));\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tmessageInput?.setText('');\n\t\tprompt = '';\n\n\t\tconst messages = createMessagesList(history, history.currentId);\n\t\tconst _files = JSON.parse(JSON.stringify(files));\n\n\t\tchatFiles.push(\n\t\t\t..._files.filter(\n\t\t\t\t(item) =>\n\t\t\t\t\t['doc', 'text', 'note', 'chat', 'folder', 'collection'].includes(item.type) ||\n\t\t\t\t\t(item.type === 'file' && !(item?.content_type ?? '').startsWith('image/'))\n\t\t\t)\n\t\t);\n\t\tchatFiles = chatFiles.filter(\n\t\t\t// Remove duplicates\n\t\t\t(item, index, array) =>\n\t\t\t\tarray.findIndex((i) => JSON.stringify(i) === JSON.stringify(item)) === index\n\t\t);\n\n\t\tfiles = [];\n\t\tmessageInput?.setText('');\n\n\t\t// Create user message\n\t\tlet userMessageId = uuidv4();\n\t\tlet userMessage = {\n\t\t\tid: userMessageId,\n\t\t\tparentId: messages.length !== 0 ? messages.at(-1).id : null,\n\t\t\tchildrenIds: [],\n\t\t\trole: 'user',\n\t\t\tcontent: userPrompt,\n\t\t\tfiles: _files.length > 0 ? _files : undefined,\n\t\t\ttimestamp: Math.floor(Date.now() / 1000), // Unix epoch\n\t\t\tmodels: selectedModels\n\t\t};\n\n\t\t// Add message to history and Set currentId to messageId\n\t\thistory.messages[userMessageId] = userMessage;\n\t\thistory.currentId = userMessageId;\n\n\t\t// Append messageId to childrenIds of parent message\n\t\tif (messages.length !== 0) {\n\t\t\thistory.messages[messages.at(-1).id].childrenIds.push(userMessageId);\n\t\t}\n\n\t\t// focus on chat input\n\t\tconst chatInput = document.getElementById('chat-input');\n\t\tchatInput?.focus();\n\n\t\tsaveSessionSelectedModels();\n\n\t\tawait sendMessage(history, userMessageId, { newChat: true });\n\t};\n\n\tconst sendMessage = async (\n\t\t_history,\n\t\tparentId: string,\n\t\t{\n\t\t\tmessages = null,\n\t\t\tmodelId = null,\n\t\t\tmodelIdx = null,\n\t\t\tnewChat = false\n\t\t}: {\n\t\t\tmessages?: any[] | null;\n\t\t\tmodelId?: string | null;\n\t\t\tmodelIdx?: number | null;\n\t\t\tnewChat?: boolean;\n\t\t} = {}\n\t) => {\n\t\tif (autoScroll) {\n\t\t\tscrollToBottom();\n\t\t}\n\n\t\tlet _chatId = JSON.parse(JSON.stringify($chatId));\n\t\t_history = JSON.parse(JSON.stringify(_history));\n\n\t\tconst responseMessageIds: Record<PropertyKey, string> = {};\n\t\t// If modelId is provided, use it, else use selected model\n\t\tlet selectedModelIds = modelId\n\t\t\t? [modelId]\n\t\t\t: atSelectedModel !== undefined\n\t\t\t\t? [atSelectedModel.id]\n\t\t\t\t: selectedModels;\n\n\t\t// Create response messages for each selected model\n\t\tfor (const [_modelIdx, modelId] of selectedModelIds.entries()) {\n\t\t\tconst model = $models.filter((m) => m.id === modelId).at(0);\n\n\t\t\tif (model) {\n\t\t\t\tlet responseMessageId = uuidv4();\n\t\t\t\tlet responseMessage = {\n\t\t\t\t\tparentId: parentId,\n\t\t\t\t\tid: responseMessageId,\n\t\t\t\t\tchildrenIds: [],\n\t\t\t\t\trole: 'assistant',\n\t\t\t\t\tcontent: '',\n\t\t\t\t\tmodel: model.id,\n\t\t\t\t\tmodelName: model.name ?? model.id,\n\t\t\t\t\tmodelIdx: modelIdx ? modelIdx : _modelIdx,\n\t\t\t\t\ttimestamp: Math.floor(Date.now() / 1000) // Unix epoch\n\t\t\t\t};\n\n\t\t\t\t// Add message to history and Set currentId to messageId\n\t\t\t\thistory.messages[responseMessageId] = responseMessage;\n\t\t\t\thistory.currentId = responseMessageId;\n\n\t\t\t\t// Append messageId to childrenIds of parent message\n\t\t\t\tif (parentId !== null && history.messages[parentId]) {\n\t\t\t\t\t// Add null check before accessing childrenIds\n\t\t\t\t\thistory.messages[parentId].childrenIds = [\n\t\t\t\t\t\t...history.messages[parentId].childrenIds,\n\t\t\t\t\t\tresponseMessageId\n\t\t\t\t\t];\n\t\t\t\t}\n\n\t\t\t\tresponseMessageIds[`${modelId}-${modelIdx ? modelIdx : _modelIdx}`] = responseMessageId;\n\t\t\t}\n\t\t}\n\t\thistory = history;\n\n\t\t// Create new chat if newChat is true and first user message\n\t\tif (newChat && _history.messages[_history.currentId].parentId === null) {\n\t\t\t_chatId = await initChatHandler(_history);\n\t\t}\n\n\t\tawait tick();\n\n\t\t_history = JSON.parse(JSON.stringify(history));\n\t\t// Save chat after all messages have been created\n\t\tawait saveChatHandler(_chatId, _history);\n\n\t\tawait Promise.all(\n\t\t\tselectedModelIds.map(async (modelId, _modelIdx) => {\n\t\t\t\tconsole.log('modelId', modelId);\n\t\t\t\tconst model = $models.filter((m) => m.id === modelId).at(0);\n\n\t\t\t\tif (model) {\n\t\t\t\t\t// If there are image files, check if model is vision capable\n\t\t\t\t\t// Skip this check if image generation is enabled, as images may be for editing or are generated outputs in the history\n\t\t\t\t\tconst hasImages = createMessagesList(_history, parentId).some((message) =>\n\t\t\t\t\t\tmessage.files?.some(\n\t\t\t\t\t\t\t(file) => file.type === 'image' || (file?.content_type ?? '').startsWith('image/')\n\t\t\t\t\t\t)\n\t\t\t\t\t);\n\n\t\t\t\t\tif (\n\t\t\t\t\t\thasImages &&\n\t\t\t\t\t\t!(model.info?.meta?.capabilities?.vision ?? true) &&\n\t\t\t\t\t\t!imageGenerationEnabled\n\t\t\t\t\t) {\n\t\t\t\t\t\ttoast.error(\n\t\t\t\t\t\t\t$i18n.t('Model {{modelName}} is not vision capable', {\n\t\t\t\t\t\t\t\tmodelName: model.name ?? model.id\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\n\t\t\t\t\tlet responseMessageId =\n\t\t\t\t\t\tresponseMessageIds[`${modelId}-${modelIdx ? modelIdx : _modelIdx}`];\n\t\t\t\t\tconst chatEventEmitter = await getChatEventEmitter(model.id, _chatId);\n\n\t\t\t\t\tscrollToBottom();\n\t\t\t\t\tawait sendMessageSocket(\n\t\t\t\t\t\tmodel,\n\t\t\t\t\t\tmessages && messages.length > 0\n\t\t\t\t\t\t\t? messages\n\t\t\t\t\t\t\t: createMessagesList(_history, responseMessageId),\n\t\t\t\t\t\t_history,\n\t\t\t\t\t\tresponseMessageId,\n\t\t\t\t\t\t_chatId\n\t\t\t\t\t);\n\n\t\t\t\t\tif (chatEventEmitter) clearInterval(chatEventEmitter);\n\t\t\t\t} else {\n\t\t\t\t\ttoast.error($i18n.t(`Model {{modelId}} not found`, { modelId }));\n\t\t\t\t}\n\t\t\t})\n\t\t);\n\n\t\tcurrentChatPage.set(1);\n\t\tchats.set(await getChatList(localStorage.token, $currentChatPage));\n\t};\n\n\tconst getFeatures = () => {\n\t\tlet features = {};\n\n\t\tif ($config?.features)\n\t\t\tfeatures = {\n\t\t\t\tvoice: $showCallOverlay,\n\t\t\t\timage_generation:\n\t\t\t\t\t$config?.features?.enable_image_generation &&\n\t\t\t\t\t($user?.role === 'admin' || $user?.permissions?.features?.image_generation)\n\t\t\t\t\t\t? imageGenerationEnabled\n\t\t\t\t\t\t: false,\n\t\t\t\tcode_interpreter:\n\t\t\t\t\t$config?.features?.enable_code_interpreter &&\n\t\t\t\t\t($user?.role === 'admin' || $user?.permissions?.features?.code_interpreter)\n\t\t\t\t\t\t? codeInterpreterEnabled\n\t\t\t\t\t\t: false,\n\t\t\t\tweb_search:\n\t\t\t\t\t$config?.features?.enable_web_search &&\n\t\t\t\t\t($user?.role === 'admin' || $user?.permissions?.features?.web_search)\n\t\t\t\t\t\t? webSearchEnabled\n\t\t\t\t\t\t: false\n\t\t\t};\n\n\t\tconst currentModels = atSelectedModel?.id ? [atSelectedModel.id] : selectedModels;\n\t\tif (\n\t\t\tcurrentModels.filter(\n\t\t\t\t(model) => $models.find((m) => m.id === model)?.info?.meta?.capabilities?.web_search ?? true\n\t\t\t).length === currentModels.length\n\t\t) {\n\t\t\tif ($config?.features?.enable_web_search && ($settings?.webSearch ?? false) === 'always') {\n\t\t\t\tfeatures = { ...features, web_search: true };\n\t\t\t}\n\t\t}\n\n\t\tif ($settings?.memory ?? false) {\n\t\t\tfeatures = { ...features, memory: true };\n\t\t}\n\n\t\treturn features;\n\t};\n\n\tconst sendMessageSocket = async (model, _messages, _history, responseMessageId, _chatId) => {\n\t\tconst responseMessage = _history.messages[responseMessageId];\n\t\tconst userMessage = _history.messages[responseMessage.parentId];\n\n\t\tconst chatMessageFiles = _messages\n\t\t\t.filter((message) => message.files)\n\t\t\t.flatMap((message) => message.files);\n\n\t\t// Filter chatFiles to only include files that are in the chatMessageFiles\n\t\tchatFiles = chatFiles.filter((item) => {\n\t\t\tconst fileExists = chatMessageFiles.some((messageFile) => messageFile.id === item.id);\n\t\t\treturn fileExists;\n\t\t});\n\n\t\tlet files = JSON.parse(JSON.stringify(chatFiles));\n\t\tfiles.push(\n\t\t\t...(userMessage?.files ?? []).filter(\n\t\t\t\t(item) =>\n\t\t\t\t\t['doc', 'text', 'note', 'chat', 'collection'].includes(item.type) ||\n\t\t\t\t\t(item.type === 'file' && !(item?.content_type ?? '').startsWith('image/'))\n\t\t\t)\n\t\t);\n\t\t// Remove duplicates\n\t\tfiles = files.filter(\n\t\t\t(item, index, array) =>\n\t\t\t\tarray.findIndex((i) => JSON.stringify(i) === JSON.stringify(item)) === index\n\t\t);\n\n\t\tscrollToBottom();\n\t\teventTarget.dispatchEvent(\n\t\t\tnew CustomEvent('chat:start', {\n\t\t\t\tdetail: {\n\t\t\t\t\tid: responseMessageId\n\t\t\t\t}\n\t\t\t})\n\t\t);\n\t\tawait tick();\n\n\t\tlet userLocation;\n\t\tif ($settings?.userLocation) {\n\t\t\tuserLocation = await getAndUpdateUserLocation(localStorage.token).catch((err) => {\n\t\t\t\tconsole.error(err);\n\t\t\t\treturn undefined;\n\t\t\t});\n\t\t}\n\n\t\tconst stream =\n\t\t\tmodel?.info?.params?.stream_response ??\n\t\t\t$settings?.params?.stream_response ??\n\t\t\tparams?.stream_response ??\n\t\t\ttrue;\n\n\t\tlet messages = [\n\t\t\tparams?.system || $settings.system\n\t\t\t\t? {\n\t\t\t\t\t\trole: 'system',\n\t\t\t\t\t\tcontent: `${params?.system ?? $settings?.system ?? ''}`\n\t\t\t\t\t}\n\t\t\t\t: undefined,\n\t\t\t..._messages.map((message) => ({\n\t\t\t\t...message,\n\t\t\t\tcontent: processDetails(message.content)\n\t\t\t}))\n\t\t].filter((message) => message);\n\n\t\tmessages = messages\n\t\t\t.map((message, idx, arr) => {\n\t\t\t\tconst imageFiles = (message?.files ?? []).filter(\n\t\t\t\t\t(file) => file.type === 'image' || (file?.content_type ?? '').startsWith('image/')\n\t\t\t\t);\n\n\t\t\t\treturn {\n\t\t\t\t\trole: message.role,\n\t\t\t\t\t...(message.role === 'user' && imageFiles.length > 0\n\t\t\t\t\t\t? {\n\t\t\t\t\t\t\t\tcontent: [\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\ttype: 'text',\n\t\t\t\t\t\t\t\t\t\ttext: message?.merged?.content ?? message.content\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t...imageFiles.map((file) => ({\n\t\t\t\t\t\t\t\t\t\ttype: 'image_url',\n\t\t\t\t\t\t\t\t\t\timage_url: {\n\t\t\t\t\t\t\t\t\t\t\turl: file.url\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}))\n\t\t\t\t\t\t\t\t]\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t: {\n\t\t\t\t\t\t\t\tcontent: message?.merged?.content ?? message.content\n\t\t\t\t\t\t\t})\n\t\t\t\t};\n\t\t\t})\n\t\t\t.filter((message) => message?.role === 'user' || message?.content?.trim());\n\n\t\tconst toolIds = [];\n\t\tconst toolServerIds = [];\n\n\t\tfor (const toolId of selectedToolIds) {\n\t\t\tif (toolId.startsWith('direct_server:')) {\n\t\t\t\tlet serverId = toolId.replace('direct_server:', '');\n\t\t\t\t// Check if serverId is a number\n\t\t\t\tif (!isNaN(parseInt(serverId))) {\n\t\t\t\t\ttoolServerIds.push(parseInt(serverId));\n\t\t\t\t} else {\n\t\t\t\t\ttoolServerIds.push(serverId);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\ttoolIds.push(toolId);\n\t\t\t}\n\t\t}\n\n\t\tconst res = await generateOpenAIChatCompletion(\n\t\t\tlocalStorage.token,\n\t\t\t{\n\t\t\t\tstream: stream,\n\t\t\t\tmodel: model.id,\n\t\t\t\tmessages: messages,\n\t\t\t\tparams: {\n\t\t\t\t\t...$settings?.params,\n\t\t\t\t\t...params,\n\t\t\t\t\tstop:\n\t\t\t\t\t\t(params?.stop ?? $settings?.params?.stop ?? undefined)\n\t\t\t\t\t\t\t? (params?.stop.split(',').map((token) => token.trim()) ?? $settings.params.stop).map(\n\t\t\t\t\t\t\t\t\t(str) => decodeURIComponent(JSON.parse('\"' + str.replace(/\\\"/g, '\\\\\"') + '\"'))\n\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t: undefined\n\t\t\t\t},\n\n\t\t\t\tfiles: (files?.length ?? 0) > 0 ? files : undefined,\n\n\t\t\t\tfilter_ids: selectedFilterIds.length > 0 ? selectedFilterIds : undefined,\n\t\t\t\ttool_ids: toolIds.length > 0 ? toolIds : undefined,\n\t\t\t\ttool_servers: ($toolServers ?? []).filter(\n\t\t\t\t\t(server, idx) => toolServerIds.includes(idx) || toolServerIds.includes(server?.id)\n\t\t\t\t),\n\t\t\t\tfeatures: getFeatures(),\n\t\t\t\tvariables: {\n\t\t\t\t\t...getPromptVariables($user?.name, $settings?.userLocation ? userLocation : undefined)\n\t\t\t\t},\n\t\t\t\tmodel_item: $models.find((m) => m.id === model.id),\n\n\t\t\t\tsession_id: $socket?.id,\n\t\t\t\tchat_id: $chatId,\n\n\t\t\t\tid: responseMessageId,\n\t\t\t\tparent_id: userMessage?.id ?? null,\n\t\t\t\tparent_message: userMessage,\n\n\t\t\t\tbackground_tasks: {\n\t\t\t\t\t...(!$temporaryChatEnabled &&\n\t\t\t\t\t(messages.length == 1 ||\n\t\t\t\t\t\t(messages.length == 2 &&\n\t\t\t\t\t\t\tmessages.at(0)?.role === 'system' &&\n\t\t\t\t\t\t\tmessages.at(1)?.role === 'user')) &&\n\t\t\t\t\t(selectedModels[0] === model.id || atSelectedModel !== undefined)\n\t\t\t\t\t\t? {\n\t\t\t\t\t\t\t\ttitle_generation: $settings?.title?.auto ?? true,\n\t\t\t\t\t\t\t\ttags_generation: $settings?.autoTags ?? true\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t: {}),\n\t\t\t\t\tfollow_up_generation: $settings?.autoFollowUps ?? true\n\t\t\t\t},\n\n\t\t\t\t...(stream && (model.info?.meta?.capabilities?.usage ?? false)\n\t\t\t\t\t? {\n\t\t\t\t\t\t\tstream_options: {\n\t\t\t\t\t\t\t\tinclude_usage: true\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t: {})\n\t\t\t},\n\t\t\t`${WEBUI_BASE_URL}/api`\n\t\t).catch(async (error) => {\n\t\t\tconsole.log(error);\n\n\t\t\tlet errorMessage = error;\n\t\t\tif (error?.error?.message) {\n\t\t\t\terrorMessage = error.error.message;\n\t\t\t} else if (error?.message) {\n\t\t\t\terrorMessage = error.message;\n\t\t\t}\n\n\t\t\tif (typeof errorMessage === 'object') {\n\t\t\t\terrorMessage = $i18n.t(`Uh-oh! There was an issue with the response.`);\n\t\t\t}\n\n\t\t\ttoast.error(`${errorMessage}`);\n\t\t\tresponseMessage.error = {\n\t\t\t\tcontent: error\n\t\t\t};\n\n\t\t\tresponseMessage.done = true;\n\n\t\t\thistory.messages[responseMessageId] = responseMessage;\n\t\t\thistory.currentId = responseMessageId;\n\n\t\t\treturn null;\n\t\t});\n\n\t\tif (res) {\n\t\t\tif (res.error) {\n\t\t\t\tawait handleOpenAIError(res.error, responseMessage);\n\t\t\t} else {\n\t\t\t\tif (taskIds) {\n\t\t\t\t\ttaskIds.push(res.task_id);\n\t\t\t\t} else {\n\t\t\t\t\ttaskIds = [res.task_id];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tawait tick();\n\t\tscrollToBottom();\n\t};\n\n\tconst handleOpenAIError = async (error, responseMessage) => {\n\t\tlet errorMessage = '';\n\t\tlet innerError;\n\n\t\tif (error) {\n\t\t\tinnerError = error;\n\t\t}\n\n\t\tconsole.error(innerError);\n\t\tif ('detail' in innerError) {\n\t\t\t// FastAPI error\n\t\t\ttoast.error(innerError.detail);\n\t\t\terrorMessage = innerError.detail;\n\t\t} else if ('error' in innerError) {\n\t\t\t// OpenAI error\n\t\t\tif ('message' in innerError.error) {\n\t\t\t\ttoast.error(innerError.error.message);\n\t\t\t\terrorMessage = innerError.error.message;\n\t\t\t} else {\n\t\t\t\ttoast.error(innerError.error);\n\t\t\t\terrorMessage = innerError.error;\n\t\t\t}\n\t\t} else if ('message' in innerError) {\n\t\t\t// OpenAI error\n\t\t\ttoast.error(innerError.message);\n\t\t\terrorMessage = innerError.message;\n\t\t}\n\n\t\tresponseMessage.error = {\n\t\t\tcontent: $i18n.t(`Uh-oh! There was an issue with the response.`) + '\\n' + errorMessage\n\t\t};\n\t\tresponseMessage.done = true;\n\n\t\tif (responseMessage.statusHistory) {\n\t\t\tresponseMessage.statusHistory = responseMessage.statusHistory.filter(\n\t\t\t\t(status) => status.action !== 'knowledge_search'\n\t\t\t);\n\t\t}\n\n\t\thistory.messages[responseMessage.id] = responseMessage;\n\t};\n\n\tconst stopResponse = async () => {\n\t\tif (taskIds) {\n\t\t\tfor (const taskId of taskIds) {\n\t\t\t\tconst res = await stopTask(localStorage.token, taskId).catch((error) => {\n\t\t\t\t\ttoast.error(`${error}`);\n\t\t\t\t\treturn null;\n\t\t\t\t});\n\t\t\t}\n\n\t\t\ttaskIds = null;\n\n\t\t\tconst responseMessage = history.messages[history.currentId];\n\t\t\t// Set all response messages to done\n\t\t\tif (responseMessage.parentId && history.messages[responseMessage.parentId]) {\n\t\t\t\tfor (const messageId of history.messages[responseMessage.parentId].childrenIds) {\n\t\t\t\t\thistory.messages[messageId].done = true;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\thistory.messages[history.currentId] = responseMessage;\n\n\t\t\tif (autoScroll) {\n\t\t\t\tscrollToBottom();\n\t\t\t}\n\t\t}\n\n\t\tif (generating) {\n\t\t\tgenerating = false;\n\t\t\tgenerationController?.abort();\n\t\t\tgenerationController = null;\n\t\t}\n\t};\n\n\tconst submitMessage = async (parentId, prompt) => {\n\t\tlet userPrompt = prompt;\n\t\tlet userMessageId = uuidv4();\n\n\t\tlet userMessage = {\n\t\t\tid: userMessageId,\n\t\t\tparentId: parentId,\n\t\t\tchildrenIds: [],\n\t\t\trole: 'user',\n\t\t\tcontent: userPrompt,\n\t\t\tmodels: selectedModels,\n\t\t\ttimestamp: Math.floor(Date.now() / 1000) // Unix epoch\n\t\t};\n\n\t\tif (parentId !== null) {\n\t\t\thistory.messages[parentId].childrenIds = [\n\t\t\t\t...history.messages[parentId].childrenIds,\n\t\t\t\tuserMessageId\n\t\t\t];\n\t\t}\n\n\t\thistory.messages[userMessageId] = userMessage;\n\t\thistory.currentId = userMessageId;\n\n\t\tawait tick();\n\n\t\tif (autoScroll) {\n\t\t\tscrollToBottom();\n\t\t}\n\n\t\tawait sendMessage(history, userMessageId);\n\t};\n\n\tconst regenerateResponse = async (message, suggestionPrompt = null) => {\n\t\tconsole.log('regenerateResponse');\n\n\t\tif (history.currentId) {\n\t\t\tlet userMessage = history.messages[message.parentId];\n\n\t\t\tif (!userMessage) {\n\t\t\t\ttoast.error($i18n.t('Parent message not found'));\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (autoScroll) {\n\t\t\t\tscrollToBottom();\n\t\t\t}\n\n\t\t\tawait sendMessage(history, userMessage.id, {\n\t\t\t\t...(suggestionPrompt\n\t\t\t\t\t? {\n\t\t\t\t\t\t\tmessages: [\n\t\t\t\t\t\t\t\t...createMessagesList(history, message.id),\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\trole: 'user',\n\t\t\t\t\t\t\t\t\tcontent: suggestionPrompt\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t]\n\t\t\t\t\t\t}\n\t\t\t\t\t: {}),\n\t\t\t\t...((userMessage?.models ?? [...selectedModels]).length > 1\n\t\t\t\t\t? {\n\t\t\t\t\t\t\t// If multiple models are selected, use the model from the message\n\t\t\t\t\t\t\tmodelId: message.model,\n\t\t\t\t\t\t\tmodelIdx: message.modelIdx\n\t\t\t\t\t\t}\n\t\t\t\t\t: {})\n\t\t\t});\n\t\t}\n\t};\n\n\tconst continueResponse = async () => {\n\t\tconsole.log('continueResponse');\n\t\tconst _chatId = JSON.parse(JSON.stringify($chatId));\n\n\t\tif (history.currentId && history.messages[history.currentId].done == true) {\n\t\t\tconst responseMessage = history.messages[history.currentId];\n\t\t\tresponseMessage.done = false;\n\t\t\tawait tick();\n\n\t\t\tconst model = $models\n\t\t\t\t.filter((m) => m.id === (responseMessage?.selectedModelId ?? responseMessage.model))\n\t\t\t\t.at(0);\n\n\t\t\tif (model) {\n\t\t\t\tawait sendMessageSocket(\n\t\t\t\t\tmodel,\n\t\t\t\t\tcreateMessagesList(history, responseMessage.id),\n\t\t\t\t\thistory,\n\t\t\t\t\tresponseMessage.id,\n\t\t\t\t\t_chatId\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\t};\n\n\tconst mergeResponses = async (messageId, responses, _chatId) => {\n\t\tconsole.log('mergeResponses', messageId, responses);\n\t\tconst message = history.messages[messageId];\n\t\tconst mergedResponse = {\n\t\t\tstatus: true,\n\t\t\tcontent: ''\n\t\t};\n\t\tmessage.merged = mergedResponse;\n\t\thistory.messages[messageId] = message;\n\n\t\ttry {\n\t\t\tgenerating = true;\n\t\t\tconst [res, controller] = await generateMoACompletion(\n\t\t\t\tlocalStorage.token,\n\t\t\t\tmessage.model ?? '',\n\t\t\t\tmessage.parentId ? history.messages[message.parentId].content : '',\n\t\t\t\tresponses\n\t\t\t);\n\n\t\t\tif (res && res.ok && res.body && generating) {\n\t\t\t\tgenerationController = controller as AbortController;\n\t\t\t\tconst textStream = await createOpenAITextStream(\n\t\t\t\t\tres.body,\n\t\t\t\t\tBoolean($settings?.splitLargeChunks ?? false)\n\t\t\t\t);\n\t\t\t\tfor await (const update of textStream) {\n\t\t\t\t\tconst { value, done, sources, error, usage } = update;\n\t\t\t\t\tif (error || done) {\n\t\t\t\t\t\tgenerating = false;\n\t\t\t\t\t\tgenerationController = null;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (mergedResponse.content == '' && value == '\\n') {\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tmergedResponse.content += value;\n\t\t\t\t\t\thistory.messages[messageId] = message;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (autoScroll) {\n\t\t\t\t\t\tscrollToBottom();\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tawait saveChatHandler(_chatId, history);\n\t\t\t} else {\n\t\t\t\tconsole.error(res);\n\t\t\t}\n\t\t} catch (e) {\n\t\t\tconsole.error(e);\n\t\t}\n\t};\n\n\tconst initChatHandler = async (history) => {\n\t\tlet _chatId = $chatId;\n\n\t\tif (!$temporaryChatEnabled) {\n\t\t\tchat = await createNewChat(\n\t\t\t\tlocalStorage.token,\n\t\t\t\t{\n\t\t\t\t\tid: _chatId,\n\t\t\t\t\ttitle: $i18n.t('New Chat'),\n\t\t\t\t\tmodels: selectedModels,\n\t\t\t\t\tsystem: $settings.system ?? undefined,\n\t\t\t\t\tparams: params,\n\t\t\t\t\thistory: history,\n\t\t\t\t\tmessages: createMessagesList(history, history.currentId),\n\t\t\t\t\ttags: [],\n\t\t\t\t\ttimestamp: Date.now()\n\t\t\t\t},\n\t\t\t\t$selectedFolder?.id\n\t\t\t);\n\n\t\t\t_chatId = chat.id;\n\t\t\tawait chatId.set(_chatId);\n\n\t\t\twindow.history.replaceState(history.state, '', `/c/${_chatId}`);\n\n\t\t\tawait tick();\n\n\t\t\tawait chats.set(await getChatList(localStorage.token, $currentChatPage));\n\t\t\tcurrentChatPage.set(1);\n\n\t\t\tselectedFolder.set(null);\n\t\t} else {\n\t\t\t_chatId = `local:${$socket?.id}`; // Use socket id for temporary chat\n\t\t\tawait chatId.set(_chatId);\n\t\t}\n\t\tawait tick();\n\n\t\treturn _chatId;\n\t};\n\n\tconst saveChatHandler = async (_chatId, history) => {\n\t\tif ($chatId == _chatId) {\n\t\t\tif (!$temporaryChatEnabled) {\n\t\t\t\tchat = await updateChatById(localStorage.token, _chatId, {\n\t\t\t\t\tmodels: selectedModels,\n\t\t\t\t\thistory: history,\n\t\t\t\t\tmessages: createMessagesList(history, history.currentId),\n\t\t\t\t\tparams: params,\n\t\t\t\t\tfiles: chatFiles\n\t\t\t\t});\n\t\t\t\tcurrentChatPage.set(1);\n\t\t\t\tawait chats.set(await getChatList(localStorage.token, $currentChatPage));\n\t\t\t}\n\t\t}\n\t};\n\n\tconst MAX_DRAFT_LENGTH = 5000;\n\tlet saveDraftTimeout: ReturnType<typeof setTimeout> | null = null;\n\n\tconst saveDraft = async (draft, chatId = null) => {\n\t\tif (saveDraftTimeout) {\n\t\t\tclearTimeout(saveDraftTimeout);\n\t\t}\n\n\t\tif (draft.prompt !== null && draft.prompt.length < MAX_DRAFT_LENGTH) {\n\t\t\tsaveDraftTimeout = setTimeout(async () => {\n\t\t\t\tawait sessionStorage.setItem(\n\t\t\t\t\t`chat-input${chatId ? `-${chatId}` : ''}`,\n\t\t\t\t\tJSON.stringify(draft)\n\t\t\t\t);\n\t\t\t}, 500);\n\t\t} else {\n\t\t\tsessionStorage.removeItem(`chat-input${chatId ? `-${chatId}` : ''}`);\n\t\t}\n\t};\n\n\tconst clearDraft = async (chatId = null) => {\n\t\tif (saveDraftTimeout) {\n\t\t\tclearTimeout(saveDraftTimeout);\n\t\t}\n\t\tawait sessionStorage.removeItem(`chat-input${chatId ? `-${chatId}` : ''}`);\n\t};\n\n\tconst moveChatHandler = async (chatId, folderId) => {\n\t\tif (chatId && folderId) {\n\t\t\tconst res = await updateChatFolderIdById(localStorage.token, chatId, folderId).catch(\n\t\t\t\t(error) => {\n\t\t\t\t\ttoast.error(`${error}`);\n\t\t\t\t\treturn null;\n\t\t\t\t}\n\t\t\t);\n\n\t\t\tif (res) {\n\t\t\t\tcurrentChatPage.set(1);\n\t\t\t\tawait chats.set(await getChatList(localStorage.token, $currentChatPage));\n\t\t\t\tawait pinnedChats.set(await getPinnedChatList(localStorage.token));\n\n\t\t\t\ttoast.success($i18n.t('Chat moved successfully'));\n\t\t\t}\n\t\t} else {\n\t\t\ttoast.error($i18n.t('Failed to move chat'));\n\t\t}\n\t};\n</script>\n\n<svelte:head>\n\t<title>\n\t\t{$settings.showChatTitleInTab !== false && $chatTitle\n\t\t\t? `${$chatTitle.length > 30 ? `${$chatTitle.slice(0, 30)}...` : $chatTitle}  ${$WEBUI_NAME}`\n\t\t\t: `${$WEBUI_NAME}`}\n\t</title>\n</svelte:head>\n\n<audio id=\"audioElement\" src=\"\" style=\"display: none;\"></audio>\n\n<EventConfirmDialog\n\tbind:show={showEventConfirmation}\n\ttitle={eventConfirmationTitle}\n\tmessage={eventConfirmationMessage}\n\tinput={eventConfirmationInput}\n\tinputPlaceholder={eventConfirmationInputPlaceholder}\n\tinputValue={eventConfirmationInputValue}\n\ton:confirm={(e) => {\n\t\tif (e.detail) {\n\t\t\teventCallback(e.detail);\n\t\t} else {\n\t\t\teventCallback(true);\n\t\t}\n\t}}\n\ton:cancel={() => {\n\t\teventCallback(false);\n\t}}\n/>\n\n<div\n\tclass=\"h-screen max-h-[100dvh] transition-width duration-200 ease-in-out {$showSidebar\n\t\t? '  md:max-w-[calc(100%-var(--sidebar-width))]'\n\t\t: ' '} w-full max-w-full flex flex-col\"\n\tid=\"chat-container\"\n>\n\t{#if !loading}\n\t\t<div in:fade={{ duration: 50 }} class=\"w-full h-full flex flex-col\">\n\t\t\t{#if $selectedFolder && $selectedFolder?.meta?.background_image_url}\n\t\t\t\t<div\n\t\t\t\t\tclass=\"absolute top-0 left-0 w-full h-full bg-cover bg-center bg-no-repeat\"\n\t\t\t\t\tstyle=\"background-image: url({$selectedFolder?.meta?.background_image_url})  \"\n\t\t\t\t/>\n\n\t\t\t\t<div\n\t\t\t\t\tclass=\"absolute top-0 left-0 w-full h-full bg-linear-to-t from-white to-white/85 dark:from-gray-900 dark:to-gray-900/90 z-0\"\n\t\t\t\t/>\n\t\t\t{:else if $settings?.backgroundImageUrl ?? $config?.license_metadata?.background_image_url ?? null}\n\t\t\t\t<div\n\t\t\t\t\tclass=\"absolute top-0 left-0 w-full h-full bg-cover bg-center bg-no-repeat\"\n\t\t\t\t\tstyle=\"background-image: url({$settings?.backgroundImageUrl ??\n\t\t\t\t\t\t$config?.license_metadata?.background_image_url})  \"\n\t\t\t\t/>\n\n\t\t\t\t<div\n\t\t\t\t\tclass=\"absolute top-0 left-0 w-full h-full bg-linear-to-t from-white to-white/85 dark:from-gray-900 dark:to-gray-900/90 z-0\"\n\t\t\t\t/>\n\t\t\t{/if}\n\n\t\t\t<PaneGroup direction=\"horizontal\" class=\"w-full h-full\">\n\t\t\t\t<Pane defaultSize={50} minSize={30} class=\"h-full flex relative max-w-full flex-col\">\n\t\t\t\t\t<Navbar\n\t\t\t\t\t\tbind:this={navbarElement}\n\t\t\t\t\t\tchat={{\n\t\t\t\t\t\t\tid: $chatId,\n\t\t\t\t\t\t\tchat: {\n\t\t\t\t\t\t\t\ttitle: $chatTitle,\n\t\t\t\t\t\t\t\tmodels: selectedModels,\n\t\t\t\t\t\t\t\tsystem: $settings.system ?? undefined,\n\t\t\t\t\t\t\t\tparams: params,\n\t\t\t\t\t\t\t\thistory: history,\n\t\t\t\t\t\t\t\ttimestamp: Date.now()\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}}\n\t\t\t\t\t\t{history}\n\t\t\t\t\t\ttitle={$chatTitle}\n\t\t\t\t\t\tbind:selectedModels\n\t\t\t\t\t\tshareEnabled={!!history.currentId}\n\t\t\t\t\t\t{initNewChat}\n\t\t\t\t\t\tarchiveChatHandler={() => {}}\n\t\t\t\t\t\t{moveChatHandler}\n\t\t\t\t\t\tonSaveTempChat={async () => {\n\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\tif (!history?.currentId || !Object.keys(history.messages).length) {\n\t\t\t\t\t\t\t\t\ttoast.error($i18n.t('No conversation to save'));\n\t\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tconst messages = createMessagesList(history, history.currentId);\n\t\t\t\t\t\t\t\tconst title =\n\t\t\t\t\t\t\t\t\tmessages.find((m) => m.role === 'user')?.content ?? $i18n.t('New Chat');\n\n\t\t\t\t\t\t\t\tconst savedChat = await createNewChat(\n\t\t\t\t\t\t\t\t\tlocalStorage.token,\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\tid: uuidv4(),\n\t\t\t\t\t\t\t\t\t\ttitle: title.length > 50 ? `${title.slice(0, 50)}...` : title,\n\t\t\t\t\t\t\t\t\t\tmodels: selectedModels,\n\t\t\t\t\t\t\t\t\t\thistory: history,\n\t\t\t\t\t\t\t\t\t\tmessages: messages,\n\t\t\t\t\t\t\t\t\t\ttimestamp: Date.now()\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\tnull\n\t\t\t\t\t\t\t\t);\n\n\t\t\t\t\t\t\t\tif (savedChat) {\n\t\t\t\t\t\t\t\t\ttemporaryChatEnabled.set(false);\n\t\t\t\t\t\t\t\t\tchatId.set(savedChat.id);\n\t\t\t\t\t\t\t\t\tchats.set(await getChatList(localStorage.token, $currentChatPage));\n\n\t\t\t\t\t\t\t\t\tawait goto(`/c/${savedChat.id}`);\n\t\t\t\t\t\t\t\t\ttoast.success($i18n.t('Conversation saved successfully'));\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t} catch (error) {\n\t\t\t\t\t\t\t\tconsole.error('Error saving conversation:', error);\n\t\t\t\t\t\t\t\ttoast.error($i18n.t('Failed to save conversation'));\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}}\n\t\t\t\t\t/>\n\n\t\t\t\t\t<div class=\"flex flex-col flex-auto z-10 w-full @container overflow-auto\">\n\t\t\t\t\t\t{#if ($settings?.landingPageMode === 'chat' && !$selectedFolder) || createMessagesList(history, history.currentId).length > 0}\n\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\tclass=\" pb-2.5 flex flex-col justify-between w-full flex-auto overflow-auto h-0 max-w-full z-10 scrollbar-hidden\"\n\t\t\t\t\t\t\t\tid=\"messages-container\"\n\t\t\t\t\t\t\t\tbind:this={messagesContainerElement}\n\t\t\t\t\t\t\t\ton:scroll={(e) => {\n\t\t\t\t\t\t\t\t\tautoScroll =\n\t\t\t\t\t\t\t\t\t\tmessagesContainerElement.scrollHeight - messagesContainerElement.scrollTop <=\n\t\t\t\t\t\t\t\t\t\tmessagesContainerElement.clientHeight + 5;\n\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<div class=\" h-full w-full flex flex-col\">\n\t\t\t\t\t\t\t\t\t<Messages\n\t\t\t\t\t\t\t\t\t\tchatId={$chatId}\n\t\t\t\t\t\t\t\t\t\tbind:history\n\t\t\t\t\t\t\t\t\t\tbind:autoScroll\n\t\t\t\t\t\t\t\t\t\tbind:prompt\n\t\t\t\t\t\t\t\t\t\tsetInputText={(text) => {\n\t\t\t\t\t\t\t\t\t\t\tmessageInput?.setText(text);\n\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t{selectedModels}\n\t\t\t\t\t\t\t\t\t\t{atSelectedModel}\n\t\t\t\t\t\t\t\t\t\t{sendMessage}\n\t\t\t\t\t\t\t\t\t\t{showMessage}\n\t\t\t\t\t\t\t\t\t\t{submitMessage}\n\t\t\t\t\t\t\t\t\t\t{continueResponse}\n\t\t\t\t\t\t\t\t\t\t{regenerateResponse}\n\t\t\t\t\t\t\t\t\t\t{mergeResponses}\n\t\t\t\t\t\t\t\t\t\t{chatActionHandler}\n\t\t\t\t\t\t\t\t\t\t{addMessages}\n\t\t\t\t\t\t\t\t\t\ttopPadding={true}\n\t\t\t\t\t\t\t\t\t\tbottomPadding={files.length > 0}\n\t\t\t\t\t\t\t\t\t\t{onSelect}\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t<div class=\" pb-2 z-10\">\n\t\t\t\t\t\t\t\t<MessageInput\n\t\t\t\t\t\t\t\t\tbind:this={messageInput}\n\t\t\t\t\t\t\t\t\t{history}\n\t\t\t\t\t\t\t\t\t{taskIds}\n\t\t\t\t\t\t\t\t\t{selectedModels}\n\t\t\t\t\t\t\t\t\tbind:files\n\t\t\t\t\t\t\t\t\tbind:prompt\n\t\t\t\t\t\t\t\t\tbind:autoScroll\n\t\t\t\t\t\t\t\t\tbind:selectedToolIds\n\t\t\t\t\t\t\t\t\tbind:selectedFilterIds\n\t\t\t\t\t\t\t\t\tbind:imageGenerationEnabled\n\t\t\t\t\t\t\t\t\tbind:codeInterpreterEnabled\n\t\t\t\t\t\t\t\t\tbind:webSearchEnabled\n\t\t\t\t\t\t\t\t\tbind:atSelectedModel\n\t\t\t\t\t\t\t\t\tbind:showCommands\n\t\t\t\t\t\t\t\t\ttoolServers={$toolServers}\n\t\t\t\t\t\t\t\t\t{generating}\n\t\t\t\t\t\t\t\t\t{stopResponse}\n\t\t\t\t\t\t\t\t\t{createMessagePair}\n\t\t\t\t\t\t\t\t\t{onUpload}\n\t\t\t\t\t\t\t\t\tonChange={(data) => {\n\t\t\t\t\t\t\t\t\t\tif (!$temporaryChatEnabled) {\n\t\t\t\t\t\t\t\t\t\t\tsaveDraft(data, $chatId);\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\ton:submit={async (e) => {\n\t\t\t\t\t\t\t\t\t\tclearDraft();\n\t\t\t\t\t\t\t\t\t\tif (e.detail || files.length > 0) {\n\t\t\t\t\t\t\t\t\t\t\tawait tick();\n\n\t\t\t\t\t\t\t\t\t\t\tsubmitPrompt(e.detail.replaceAll('\\n\\n', '\\n'));\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t/>\n\n\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\tclass=\"absolute bottom-1 text-xs text-gray-500 text-center line-clamp-1 right-0 left-0\"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<!-- {$i18n.t('LLMs can make mistakes. Verify important information.')} -->\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t{:else}\n\t\t\t\t\t\t\t<div class=\"flex items-center h-full\">\n\t\t\t\t\t\t\t\t<Placeholder\n\t\t\t\t\t\t\t\t\t{history}\n\t\t\t\t\t\t\t\t\t{selectedModels}\n\t\t\t\t\t\t\t\t\tbind:messageInput\n\t\t\t\t\t\t\t\t\tbind:files\n\t\t\t\t\t\t\t\t\tbind:prompt\n\t\t\t\t\t\t\t\t\tbind:autoScroll\n\t\t\t\t\t\t\t\t\tbind:selectedToolIds\n\t\t\t\t\t\t\t\t\tbind:selectedFilterIds\n\t\t\t\t\t\t\t\t\tbind:imageGenerationEnabled\n\t\t\t\t\t\t\t\t\tbind:codeInterpreterEnabled\n\t\t\t\t\t\t\t\t\tbind:webSearchEnabled\n\t\t\t\t\t\t\t\t\tbind:atSelectedModel\n\t\t\t\t\t\t\t\t\tbind:showCommands\n\t\t\t\t\t\t\t\t\ttoolServers={$toolServers}\n\t\t\t\t\t\t\t\t\t{stopResponse}\n\t\t\t\t\t\t\t\t\t{createMessagePair}\n\t\t\t\t\t\t\t\t\t{onSelect}\n\t\t\t\t\t\t\t\t\t{onUpload}\n\t\t\t\t\t\t\t\t\tonChange={(data) => {\n\t\t\t\t\t\t\t\t\t\tif (!$temporaryChatEnabled) {\n\t\t\t\t\t\t\t\t\t\t\tsaveDraft(data);\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\ton:submit={async (e) => {\n\t\t\t\t\t\t\t\t\t\tclearDraft();\n\t\t\t\t\t\t\t\t\t\tif (e.detail || files.length > 0) {\n\t\t\t\t\t\t\t\t\t\t\tawait tick();\n\t\t\t\t\t\t\t\t\t\t\tsubmitPrompt(e.detail.replaceAll('\\n\\n', '\\n'));\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t{/if}\n\t\t\t\t\t</div>\n\t\t\t\t</Pane>\n\n\t\t\t\t<ChatControls\n\t\t\t\t\tbind:this={controlPaneComponent}\n\t\t\t\t\tbind:history\n\t\t\t\t\tbind:chatFiles\n\t\t\t\t\tbind:params\n\t\t\t\t\tbind:files\n\t\t\t\t\tbind:pane={controlPane}\n\t\t\t\t\tchatId={$chatId}\n\t\t\t\t\tmodelId={selectedModelIds?.at(0) ?? null}\n\t\t\t\t\tmodels={selectedModelIds.reduce((a, e, i, arr) => {\n\t\t\t\t\t\tconst model = $models.find((m) => m.id === e);\n\t\t\t\t\t\tif (model) {\n\t\t\t\t\t\t\treturn [...a, model];\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn a;\n\t\t\t\t\t}, [])}\n\t\t\t\t\t{submitPrompt}\n\t\t\t\t\t{stopResponse}\n\t\t\t\t\t{showMessage}\n\t\t\t\t\t{eventTarget}\n\t\t\t\t/>\n\t\t\t</PaneGroup>\n\t\t</div>\n\t{:else if loading}\n\t\t<div class=\" flex items-center justify-center h-full w-full\">\n\t\t\t<div class=\"m-auto\">\n\t\t\t\t<Spinner className=\"size-5\" />\n\t\t\t</div>\n\t\t</div>\n\t{/if}\n</div>\n\n<style>\n\t::-webkit-scrollbar {\n\t\theight: 0.5rem;\n\t\twidth: 0.5rem;\n\t}\n</style>\n"],"file":"_app/immutable/chunks/Ck-74lEN.js"}