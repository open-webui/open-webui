{"version":3,"file":"CYBNiUQ7.js","sources":["../../../../../../src/lib/apis/files/index.ts","../../../../../../src/lib/components/icons/DocumentPage.svelte"],"sourcesContent":["import { WEBUI_API_BASE_URL } from '$lib/constants';\nimport { splitStream } from '$lib/utils';\n\nexport const uploadFile = async (\n\ttoken: string,\n\tfile: File,\n\tmetadata?: object | null,\n\tprocess?: boolean | null\n) => {\n\tconst data = new FormData();\n\tdata.append('file', file);\n\tif (metadata) {\n\t\tdata.append('metadata', JSON.stringify(metadata));\n\t}\n\n\tconst searchParams = new URLSearchParams();\n\tif (process !== undefined && process !== null) {\n\t\tsearchParams.append('process', String(process));\n\t}\n\n\tlet error = null;\n\n\tconst res = await fetch(`${WEBUI_API_BASE_URL}/files/?${searchParams.toString()}`, {\n\t\tmethod: 'POST',\n\t\theaders: {\n\t\t\tAccept: 'application/json',\n\t\t\tauthorization: `Bearer ${token}`\n\t\t},\n\t\tbody: data\n\t})\n\t\t.then(async (res) => {\n\t\t\tif (!res.ok) throw await res.json();\n\t\t\treturn res.json();\n\t\t})\n\t\t.catch((err) => {\n\t\t\terror = err.detail || err.message;\n\t\t\tconsole.error(err);\n\t\t\treturn null;\n\t\t});\n\n\tif (error) {\n\t\tthrow error;\n\t}\n\n\tif (res) {\n\t\tconst status = await getFileProcessStatus(token, res.id);\n\n\t\tif (status && status.ok) {\n\t\t\tconst reader = status.body\n\t\t\t\t.pipeThrough(new TextDecoderStream())\n\t\t\t\t.pipeThrough(splitStream('\\n'))\n\t\t\t\t.getReader();\n\n\t\t\twhile (true) {\n\t\t\t\tconst { value, done } = await reader.read();\n\t\t\t\tif (done) {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\ttry {\n\t\t\t\t\tlet lines = value.split('\\n');\n\n\t\t\t\t\tfor (const line of lines) {\n\t\t\t\t\t\tif (line !== '') {\n\t\t\t\t\t\t\tconsole.log(line);\n\t\t\t\t\t\t\tif (line === 'data: [DONE]') {\n\t\t\t\t\t\t\t\tconsole.log(line);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tlet data = JSON.parse(line.replace(/^data: /, ''));\n\t\t\t\t\t\t\t\tconsole.log(data);\n\n\t\t\t\t\t\t\t\tif (data?.error) {\n\t\t\t\t\t\t\t\t\tconsole.error(data.error);\n\t\t\t\t\t\t\t\t\tres.error = data.error;\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tif (res?.data) {\n\t\t\t\t\t\t\t\t\tres.data = data;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} catch (error) {\n\t\t\t\t\tconsole.log(error);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tif (error) {\n\t\tthrow error;\n\t}\n\n\treturn res;\n};\n\nexport const getFileProcessStatus = async (token: string, id: string) => {\n\tconst queryParams = new URLSearchParams();\n\tqueryParams.append('stream', 'true');\n\n\tlet error = null;\n\tconst res = await fetch(`${WEBUI_API_BASE_URL}/files/${id}/process/status?${queryParams}`, {\n\t\tmethod: 'GET',\n\t\theaders: {\n\t\t\tAccept: 'application/json',\n\t\t\tauthorization: `Bearer ${token}`\n\t\t}\n\t}).catch((err) => {\n\t\terror = err.detail;\n\t\tconsole.error(err);\n\t\treturn null;\n\t});\n\n\tif (error) {\n\t\tthrow error;\n\t}\n\n\treturn res;\n};\n\nexport const uploadDir = async (token: string) => {\n\tlet error = null;\n\n\tconst res = await fetch(`${WEBUI_API_BASE_URL}/files/upload/dir`, {\n\t\tmethod: 'POST',\n\t\theaders: {\n\t\t\tAccept: 'application/json',\n\t\t\tauthorization: `Bearer ${token}`\n\t\t}\n\t})\n\t\t.then(async (res) => {\n\t\t\tif (!res.ok) throw await res.json();\n\t\t\treturn res.json();\n\t\t})\n\t\t.catch((err) => {\n\t\t\terror = err.detail;\n\t\t\treturn null;\n\t\t});\n\n\tif (error) {\n\t\tthrow error;\n\t}\n\n\treturn res;\n};\n\nexport const getFiles = async (token: string = '') => {\n\tlet error = null;\n\n\tconst res = await fetch(`${WEBUI_API_BASE_URL}/files/`, {\n\t\tmethod: 'GET',\n\t\theaders: {\n\t\t\tAccept: 'application/json',\n\t\t\t'Content-Type': 'application/json',\n\t\t\tauthorization: `Bearer ${token}`\n\t\t}\n\t})\n\t\t.then(async (res) => {\n\t\t\tif (!res.ok) throw await res.json();\n\t\t\treturn res.json();\n\t\t})\n\t\t.then((json) => {\n\t\t\treturn json;\n\t\t})\n\t\t.catch((err) => {\n\t\t\terror = err.detail;\n\t\t\tconsole.error(err);\n\t\t\treturn null;\n\t\t});\n\n\tif (error) {\n\t\tthrow error;\n\t}\n\n\treturn res;\n};\n\nexport const getFileById = async (token: string, id: string) => {\n\tlet error = null;\n\n\tconst res = await fetch(`${WEBUI_API_BASE_URL}/files/${id}`, {\n\t\tmethod: 'GET',\n\t\theaders: {\n\t\t\tAccept: 'application/json',\n\t\t\t'Content-Type': 'application/json',\n\t\t\tauthorization: `Bearer ${token}`\n\t\t}\n\t})\n\t\t.then(async (res) => {\n\t\t\tif (!res.ok) throw await res.json();\n\t\t\treturn res.json();\n\t\t})\n\t\t.then((json) => {\n\t\t\treturn json;\n\t\t})\n\t\t.catch((err) => {\n\t\t\terror = err.detail;\n\t\t\tconsole.error(err);\n\t\t\treturn null;\n\t\t});\n\n\tif (error) {\n\t\tthrow error;\n\t}\n\n\treturn res;\n};\n\nexport const updateFileDataContentById = async (token: string, id: string, content: string) => {\n\tlet error = null;\n\n\tconst res = await fetch(`${WEBUI_API_BASE_URL}/files/${id}/data/content/update`, {\n\t\tmethod: 'POST',\n\t\theaders: {\n\t\t\tAccept: 'application/json',\n\t\t\t'Content-Type': 'application/json',\n\t\t\tauthorization: `Bearer ${token}`\n\t\t},\n\t\tbody: JSON.stringify({\n\t\t\tcontent: content\n\t\t})\n\t})\n\t\t.then(async (res) => {\n\t\t\tif (!res.ok) throw await res.json();\n\t\t\treturn res.json();\n\t\t})\n\t\t.then((json) => {\n\t\t\treturn json;\n\t\t})\n\t\t.catch((err) => {\n\t\t\terror = err.detail;\n\t\t\tconsole.error(err);\n\t\t\treturn null;\n\t\t});\n\n\tif (error) {\n\t\tthrow error;\n\t}\n\n\treturn res;\n};\n\nexport const getFileContentById = async (id: string) => {\n\tlet error = null;\n\n\tconst res = await fetch(`${WEBUI_API_BASE_URL}/files/${id}/content`, {\n\t\tmethod: 'GET',\n\t\theaders: {\n\t\t\tAccept: 'application/json'\n\t\t},\n\t\tcredentials: 'include'\n\t})\n\t\t.then(async (res) => {\n\t\t\tif (!res.ok) throw await res.json();\n\t\t\treturn await res.arrayBuffer();\n\t\t})\n\t\t.catch((err) => {\n\t\t\terror = err.detail;\n\t\t\tconsole.error(err);\n\n\t\t\treturn null;\n\t\t});\n\n\tif (error) {\n\t\tthrow error;\n\t}\n\n\treturn res;\n};\n\nexport const deleteFileById = async (token: string, id: string) => {\n\tlet error = null;\n\n\tconst res = await fetch(`${WEBUI_API_BASE_URL}/files/${id}`, {\n\t\tmethod: 'DELETE',\n\t\theaders: {\n\t\t\tAccept: 'application/json',\n\t\t\t'Content-Type': 'application/json',\n\t\t\tauthorization: `Bearer ${token}`\n\t\t}\n\t})\n\t\t.then(async (res) => {\n\t\t\tif (!res.ok) throw await res.json();\n\t\t\treturn res.json();\n\t\t})\n\t\t.then((json) => {\n\t\t\treturn json;\n\t\t})\n\t\t.catch((err) => {\n\t\t\terror = err.detail;\n\t\t\tconsole.error(err);\n\t\t\treturn null;\n\t\t});\n\n\tif (error) {\n\t\tthrow error;\n\t}\n\n\treturn res;\n};\n\nexport const deleteAllFiles = async (token: string) => {\n\tlet error = null;\n\n\tconst res = await fetch(`${WEBUI_API_BASE_URL}/files/all`, {\n\t\tmethod: 'DELETE',\n\t\theaders: {\n\t\t\tAccept: 'application/json',\n\t\t\t'Content-Type': 'application/json',\n\t\t\tauthorization: `Bearer ${token}`\n\t\t}\n\t})\n\t\t.then(async (res) => {\n\t\t\tif (!res.ok) throw await res.json();\n\t\t\treturn res.json();\n\t\t})\n\t\t.then((json) => {\n\t\t\treturn json;\n\t\t})\n\t\t.catch((err) => {\n\t\t\terror = err.detail;\n\t\t\tconsole.error(err);\n\t\t\treturn null;\n\t\t});\n\n\tif (error) {\n\t\tthrow error;\n\t}\n\n\treturn res;\n};\n","<script lang=\"ts\">\n\texport let className = 'size-4';\n\texport let strokeWidth = '1.5';\n</script>\n\n<svg\n\txmlns=\"http://www.w3.org/2000/svg\"\n\tfill=\"none\"\n\tviewBox=\"0 0 24 24\"\n\tstroke-width={strokeWidth}\n\tstroke=\"currentColor\"\n\tclass={className}\n\t><path\n\t\td=\"M4 21.4V2.6C4 2.26863 4.26863 2 4.6 2H16.2515C16.4106 2 16.5632 2.06321 16.6757 2.17574L19.8243 5.32426C19.9368 5.43679 20 5.5894 20 5.74853V21.4C20 21.7314 19.7314 22 19.4 22H4.6C4.26863 22 4 21.7314 4 21.4Z\"\n\t\tstroke-linecap=\"round\"\n\t\tstroke-linejoin=\"round\"\n\t></path><path d=\"M8 10L16 10\" stroke-linecap=\"round\" stroke-linejoin=\"round\"></path><path\n\t\td=\"M8 18L16 18\"\n\t\tstroke-linecap=\"round\"\n\t\tstroke-linejoin=\"round\"\n\t></path><path d=\"M8 14L12 14\" stroke-linecap=\"round\" stroke-linejoin=\"round\"></path><path\n\t\td=\"M16 2V5.4C16 5.73137 16.2686 6 16.6 6H20\"\n\t\tstroke-linecap=\"round\"\n\t\tstroke-linejoin=\"round\"\n\t></path></svg\n>\n"],"names":["uploadFile","token","file","metadata","process","data","searchParams","error","res","WEBUI_API_BASE_URL","err","status","getFileProcessStatus","reader","splitStream","value","done","lines","line","id","queryParams","getFileById","json","updateFileDataContentById","content","getFileContentById","deleteAllFiles","className","strokeWidth","svg","root","$.set_attribute","$.set_class","$.clsx","$.append","$$anchor"],"mappings":"kPAGO,MAAMA,EAAa,MACzBC,EACAC,EACAC,EACAC,IACI,CACJ,MAAMC,EAAO,IAAI,SACjBA,EAAK,OAAO,OAAQH,CAAI,EACpBC,GACHE,EAAK,OAAO,WAAY,KAAK,UAAUF,CAAQ,CAAC,EAGjD,MAAMG,EAAe,IAAI,gBACIF,GAAY,MACxCE,EAAa,OAAO,UAAW,OAAOF,CAAO,CAAC,EAG/C,IAAIG,EAAQ,KAEZ,MAAMC,EAAM,MAAM,MAAM,GAAGC,CAAkB,WAAWH,EAAa,SAAA,CAAU,GAAI,CAClF,OAAQ,OACR,QAAS,CACR,OAAQ,mBACR,cAAe,UAAUL,CAAK,EAAA,EAE/B,KAAMI,CAAA,CACN,EACC,KAAK,MAAOG,GAAQ,CACpB,GAAI,CAACA,EAAI,GAAI,MAAM,MAAMA,EAAI,KAAA,EAC7B,OAAOA,EAAI,KAAA,CACZ,CAAC,EACA,MAAOE,IACPH,EAAQG,EAAI,QAAUA,EAAI,QAEnB,KACP,EAEF,GAAIH,EACH,MAAMA,EAGP,GAAIC,EAAK,CACR,MAAMG,EAAS,MAAMC,EAAqBX,EAAOO,EAAI,EAAE,EAEvD,GAAIG,GAAUA,EAAO,GAAI,CACxB,MAAME,EAASF,EAAO,KACpB,YAAY,IAAI,iBAAmB,EACnC,YAAYG,EAAY;AAAA,CAAI,CAAC,EAC7B,UAAA,EAEF,OAAa,CACZ,KAAM,CAAE,MAAAC,EAAO,KAAAC,CAAA,EAAS,MAAMH,EAAO,KAAA,EACrC,GAAIG,EACH,MAGD,GAAI,CACH,IAAIC,EAAQF,EAAM,MAAM;AAAA,CAAI,EAE5B,UAAWG,KAAQD,EAClB,GAAIC,IAAS,IAERA,IAAS,eAEN,CACN,IAAIb,EAAO,KAAK,MAAMa,EAAK,QAAQ,UAAW,EAAE,CAAC,EAG7Cb,GAAAA,MAAAA,EAAM,QACKA,EAAK,MACnBG,EAAI,MAAQH,EAAK,OAGdG,GAAA,MAAAA,EAAK,OACRA,EAAI,KAAOH,EAEb,CAGH,MAAgB,CAEhB,CACD,CACD,CACD,CAEA,GAAIE,EACH,MAAMA,EAGP,OAAOC,CACR,EAEaI,EAAuB,MAAOX,EAAekB,IAAe,CACxE,MAAMC,EAAc,IAAI,gBACxBA,EAAY,OAAO,SAAU,MAAM,EAEnC,IAAIb,EAAQ,KACZ,MAAMC,EAAM,MAAM,MAAM,GAAGC,CAAkB,UAAUU,CAAE,mBAAmBC,CAAW,GAAI,CAC1F,OAAQ,MACR,QAAS,CACR,OAAQ,mBACR,cAAe,UAAUnB,CAAK,EAAA,CAC/B,CACA,EAAE,MAAOS,IACTH,EAAQG,EAAI,OAEL,KACP,EAED,GAAIH,EACH,MAAMA,EAGP,OAAOC,CACR,EA2Daa,EAAc,MAAOpB,EAAekB,IAAe,CAC/D,IAAIZ,EAAQ,KAEZ,MAAMC,EAAM,MAAM,MAAM,GAAGC,CAAkB,UAAUU,CAAE,GAAI,CAC5D,OAAQ,MACR,QAAS,CACR,OAAQ,mBACR,eAAgB,mBAChB,cAAe,UAAUlB,CAAK,EAAA,CAC/B,CACA,EACC,KAAK,MAAOO,GAAQ,CACpB,GAAI,CAACA,EAAI,GAAI,MAAM,MAAMA,EAAI,KAAA,EAC7B,OAAOA,EAAI,KAAA,CACZ,CAAC,EACA,KAAMc,GACCA,CACP,EACA,MAAOZ,IACPH,EAAQG,EAAI,OAEL,KACP,EAEF,GAAIH,EACH,MAAMA,EAGP,OAAOC,CACR,EAEae,EAA4B,MAAOtB,EAAekB,EAAYK,IAAoB,CAC9F,IAAIjB,EAAQ,KAEZ,MAAMC,EAAM,MAAM,MAAM,GAAGC,CAAkB,UAAUU,CAAE,uBAAwB,CAChF,OAAQ,OACR,QAAS,CACR,OAAQ,mBACR,eAAgB,mBAChB,cAAe,UAAUlB,CAAK,EAAA,EAE/B,KAAM,KAAK,UAAU,CACpB,QAAAuB,CAAA,CACA,CAAA,CACD,EACC,KAAK,MAAOhB,GAAQ,CACpB,GAAI,CAACA,EAAI,GAAI,MAAM,MAAMA,EAAI,KAAA,EAC7B,OAAOA,EAAI,KAAA,CACZ,CAAC,EACA,KAAMc,GACCA,CACP,EACA,MAAOZ,IACPH,EAAQG,EAAI,OAEL,KACP,EAEF,GAAIH,EACH,MAAMA,EAGP,OAAOC,CACR,EAEaiB,EAAqB,MAAON,GAAe,CACvD,IAAIZ,EAAQ,KAEZ,MAAMC,EAAM,MAAM,MAAM,GAAGC,CAAkB,UAAUU,CAAE,WAAY,CACpE,OAAQ,MACR,QAAS,CACR,OAAQ,kBAAA,EAET,YAAa,SAAA,CACb,EACC,KAAK,MAAOX,GAAQ,CACpB,GAAI,CAACA,EAAI,GAAI,MAAM,MAAMA,EAAI,KAAA,EAC7B,OAAO,MAAMA,EAAI,YAAA,CAClB,CAAC,EACA,MAAOE,IACPH,EAAQG,EAAI,OAGL,KACP,EAEF,GAAIH,EACH,MAAMA,EAGP,OAAOC,CACR,EAiCakB,EAAiB,MAAOzB,GAAkB,CACtD,IAAIM,EAAQ,KAEZ,MAAMC,EAAM,MAAM,MAAM,GAAGC,CAAkB,aAAc,CAC1D,OAAQ,SACR,QAAS,CACR,OAAQ,mBACR,eAAgB,mBAChB,cAAe,UAAUR,CAAK,EAAA,CAC/B,CACA,EACC,KAAK,MAAOO,GAAQ,CACpB,GAAI,CAACA,EAAI,GAAI,MAAM,MAAMA,EAAI,KAAA,EAC7B,OAAOA,EAAI,KAAA,CACZ,CAAC,EACA,KAAMc,GACCA,CACP,EACA,MAAOZ,IACPH,EAAQG,EAAI,OAEL,KACP,EAEF,GAAIH,EACH,MAAMA,EAGP,OAAOC,CACR,+tBC1UA,CACY,IAAAmB,oBAAY,QAAQ,EACpBC,sBAAc,KAAK,EAG9B,IAAAC,EAAAC,EAAA,SAAAC,EAAAF,EAAA,eAIcD,GAAW,EAJzBI,EAAAH,EAAA,EAAAI,EAMON,EAAS,CAAA,CAAA,IANhBO,EAAAC,EAAAN,CAAA,CAFO"}