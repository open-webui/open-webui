var kr=Object.defineProperty;var Mr=(Ne,o,l)=>o in Ne?kr(Ne,o,{enumerable:!0,configurable:!0,writable:!0,value:l}):Ne[o]=l;var ya=(Ne,o,l)=>Mr(Ne,typeof o!="symbol"?o+"":o,l);import"./CWj6FrbW.js";import"./69_IOA4Y.js";import{p as $t,g as Wt,y as Ba,o as Ca,i as I,m as Se,j as e,q as It,u as i,v as ta,f as m,e as re,w as t,k as E,c as n,r,t as x,s as j,l as Ie,a,aR as Ka,n as ye,b as Et,z as De,d as Me,A as za,aM as Ga,x as rt,B as $a,aQ as da}from"./0WpKKl27.js";import{i as u}from"./Cmf4RC8y.js";import{k as Ia}from"./fZxlt1qL.js";import{e as pt,i as zt}from"./u5Cnd4mY.js";import{s as Le,a as Pe,r as Na,c as Ta,e as Da,f as Ir}from"./CZ1y6KaE.js";import{i as St}from"./C3k0oZ3o.js";import{p as c}from"./DpN1w328.js";import{a as Fe,s as Jt,e as Cr}from"./BVrWTcfB.js";import{a as La,w as $r,b as fa,E as Fa,F as vr,G as Er,e as cr,i as Sr,H as Nr,I as ar,J as Pr,m as gr,u as ja,c as ur,K as rr,T as sr,z as Ya,W as Br,r as nr,v as Tr}from"./PCOILo-8.js";import{t as qt}from"./DYdr9DjX.js";import{a as Lr,u as Or,i as Rr}from"./DR3TfYWm.js";import{d as Ua,I as ka,L as or,n as fr,C as Ma,M as zr,l as mr,m as Ra,z as ir}from"./cX8aofVu.js";import{d as Rt}from"./BC4znSyB.js";import{t as Ea}from"./DXo52D7g.js";import{b as Oa}from"./kb1CvZ3a.js";import{b as _a}from"./Bo3ZTtFv.js";import{u as lr,f as jr}from"./BK8NOjgO.js";import{f as Ar}from"./B6gyXX6T.js";import{s as Hr}from"./CjABQmgs.js";import{a as Yt,W as qr}from"./DLhnqOlE.js";import{P as hr,N as Xa}from"./DLQ8GCeM.js";import{S as er}from"./CYM6LQlA.js";import{C as Wr,d as Dr,b as Fr,e as Ur,M as Pa,I as Ja,F as Jr,B as Vr}from"./mfo8rR81.js";import{T as _t}from"./Db0gdTVr.js";import{T as Zr}from"./DluZzLRt.js";import{X as Aa}from"./CZmZoefv.js";import"./BkyXqnA-.js";import"./DfIywdCw.js";import{f as Sa}from"./CiB29Aqe.js";import"./CsWaRabF.js";import"./B9ZVCkUG.js";import"./B5RARo22.js";import{C as Qr}from"./BtReZMDb.js";import{S as Kr}from"./D_50Gyqd.js";import{C as _r}from"./ByHAJgVC.js";import{b as pr}from"./CMoC6kdu.js";import{M as xr}from"./CcreKc1w.js";import{T as Gr}from"./CWXf-F9t.js";import{S as tr}from"./BO1efK8r.js";import{B as qa}from"./DUufguWK.js";import{C as Yr}from"./Da6FfZ0A.js";import{E as Xr}from"./C2rnPICT.js";import{c as es}from"./Q6Bnvzbc.js";import{c as ts}from"./Bp8N0x0r.js";import{C as as,F as Va}from"./DetCT4Dy.js";import{s as br}from"./3-JilrU5.js";import{b as rs,c as Wa}from"./DA2vpIKA.js";import{f as ss}from"./Dbtivbjp.js";import{D as ns}from"./DD5ATWsz.js";import{C as os}from"./BTdOvR0T.js";import{S as Za}from"./BqWDuYyJ.js";import"./B2185GOa.js";import{L as is}from"./l5Bi75JT.js";import{h as ls}from"./BzXoxdC4.js";import{F as ds}from"./Ch1WBRTM.js";import{E as vs}from"./BAAu3n3-.js";var cs=m('<div class="text-xs font-medium pt-1.5 -mb-0.5"> </div>'),gs=m("<button> </button>"),us=m("<button><!></button>"),fs=m('<div class="text-sm mt-1.5 font-medium"> </div> <div class="flex flex-wrap gap-1.5 text-sm mt-1.5"></div>',1),ms=m('<!> <div class=" my-2.5 rounded-xl px-4 py-3 border border-gray-100/30 dark:border-gray-850/30"><div class="flex justify-between items-center"><div class="text-sm font-medium"> </div> <button><!></button></div> <div class="w-full flex justify-center"><div class=" relative w-fit overflow-x-auto scrollbar-none"><div class="mt-1.5 w-fit flex gap-1 pb-2"></div> <div class="sticky top-0 bottom-0 left-0 right-0 flex justify-between text-xs"><div> </div> <div> </div></div></div></div> <div><!></div> <div class="mt-2"><textarea class="w-full text-sm px-1 py-2 bg-transparent outline-hidden resize-none rounded-xl" rows="3"></textarea></div> <div class="mt-2 gap-1.5 flex justify-between"><div class="flex items-end group"><!></div> <button class="px-3.5 py-1.5 text-sm font-medium bg-black hover:bg-gray-900 text-white dark:bg-white dark:text-black dark:hover:bg-gray-100 transition rounded-full"> </button></div></div>',1);function hs(Ne,o){$t(o,!1);const l=()=>Fe(La,"$models",N),f=()=>Fe(J,"$i18n",N),L=()=>Fe($r,"$_tags",N),[N,M]=Jt(),J=Wt("i18n"),V=Ba();let ne=c(o,"message",8),b=c(o,"show",12,!1),B=["accurate_information","followed_instructions_perfectly","showcased_creativity","positive_attitude","attention_to_detail","thorough_explanation","other"],te=["dont_like_the_style","too_verbose","not_helpful","not_factually_correct","didnt_fully_follow_instructions","refused_when_it_shouldnt_have","being_lazy","other"],v=Se([]),we=Se([]),A=Se(null),Z=Se(""),ce=Se(null),s=Se(null);const oe=()=>{var Y,ue,S,P,k,q,W,ge,me;e(A)||I(A,((ue=(Y=ne())==null?void 0:Y.annotation)==null?void 0:ue.reason)??""),e(Z)||I(Z,((P=(S=ne())==null?void 0:S.annotation)==null?void 0:P.comment)??""),I(v,(((q=(k=ne())==null?void 0:k.annotation)==null?void 0:q.tags)??[]).map($e=>({name:$e}))),e(ce)||I(ce,((me=(ge=(W=ne())==null?void 0:W.annotation)==null?void 0:ge.details)==null?void 0:me.rating)??null)};Ca(()=>{var Y,ue;(Y=ne())!=null&&Y.arena&&(I(s,l().find(S=>S.id===ne().selectedModelId)),qt.success(f().t('This response was generated by "{{model}}"',{model:e(s)?((ue=e(s))==null?void 0:ue.name)??e(s).id:ne().selectedModelId})))});const _e=()=>{V("save",{reason:e(A),comment:e(Z),tags:e(v).map(Y=>Y.name),details:{rating:e(ce)}}),qt.success(f().t("Thanks for your feedback!")),b(!1)};It(()=>i(ne()),()=>{var Y,ue,S,P;((ue=(Y=ne())==null?void 0:Y.annotation)==null?void 0:ue.rating)===1?I(we,B):((P=(S=ne())==null?void 0:S.annotation)==null?void 0:P.rating)===-1&&I(we,te)}),It(()=>i(ne()),()=>{ne()&&oe()}),ta(),St();var he=ms(),ie=re(he);{var xe=Y=>{var ue=cs(),S=n(ue,!0);r(ue),x(P=>j(S,P),[()=>(f(),e(s),i(ne()),t(()=>{var P;return f().t('This response was generated by "{{model}}"',{model:e(s)?((P=e(s))==null?void 0:P.name)??e(s).id:ne().selectedModelId})}))]),a(Y,ue)};u(ie,Y=>{i(ne()),t(()=>{var ue;return(ue=ne())==null?void 0:ue.arena})&&Y(xe)})}var le=E(ie,2),fe=n(le),R=n(fe),ae=n(R,!0);r(R);var d=E(R,2),g=n(d);Aa(g,{className:"size-4"}),r(d),r(fe);var Q=E(fe,2),D=n(Q),C=n(D);pt(C,4,()=>t(()=>Array.from({length:10}).map((Y,ue)=>ue+1)),zt,(Y,ue)=>{var S=gs(),P=n(S,!0);r(S),x(()=>{Le(S,1,`size-7 text-sm border border-gray-100/30 dark:border-gray-850/30 hover:bg-gray-50 dark:hover:bg-gray-850 ${e(ce)===ue?"bg-gray-100 dark:bg-gray-800":""} transition rounded-full disabled:cursor-not-allowed disabled:text-gray-500 disabled:bg-white dark:disabled:bg-gray-900`),S.disabled=(i(ne()),t(()=>{var k,q;return((q=(k=ne())==null?void 0:k.annotation)==null?void 0:q.rating)===-1?ue>5:ue<6})),j(P,ue)}),Ie("click",S,()=>{I(ce,ue)}),a(Y,S)}),r(C);var y=E(C,2),h=n(y),H=n(h);r(h);var _=E(h,2),w=n(_);r(_),r(y),r(D),r(Q);var p=E(Q,2),O=n(p);{var z=Y=>{var ue=fs(),S=re(ue),P=n(S,!0);r(S);var k=E(S,2);pt(k,5,()=>e(we),zt,(q,W)=>{var ge=us(),me=n(ge);{var $e=Ee=>{var ze=De();x(Qe=>j(ze,Qe),[()=>(f(),t(()=>f().t("Accurate information")))]),a(Ee,ze)},pe=Ee=>{var ze=Me(),Qe=re(ze);{var He=G=>{var Ce=De();x(ke=>j(Ce,ke),[()=>(f(),t(()=>f().t("Followed instructions perfectly")))]),a(G,Ce)},be=G=>{var Ce=Me(),ke=re(Ce);{var ee=ve=>{var Be=De();x(je=>j(Be,je),[()=>(f(),t(()=>f().t("Showcased creativity")))]),a(ve,Be)},de=ve=>{var Be=Me(),je=re(Be);{var et=Ke=>{var Je=De();x(Ue=>j(Je,Ue),[()=>(f(),t(()=>f().t("Positive attitude")))]),a(Ke,Je)},kt=Ke=>{var Je=Me(),Ue=re(Je);{var Ye=jt=>{var qe=De();x(ct=>j(qe,ct),[()=>(f(),t(()=>f().t("Attention to detail")))]),a(jt,qe)},Ze=jt=>{var qe=Me(),ct=re(qe);{var ht=it=>{var Mt=De();x(Vt=>j(Mt,Vt),[()=>(f(),t(()=>f().t("Thorough explanation")))]),a(it,Mt)},Nt=it=>{var Mt=Me(),Vt=re(Mt);{var Xt=aa=>{var ra=De();x(ca=>j(ra,ca),[()=>(f(),t(()=>f().t("Don't like the style")))]),a(aa,ra)},ea=aa=>{var ra=Me(),ca=re(ra);{var pa=sa=>{var ia=De();x(Ae=>j(ia,Ae),[()=>(f(),t(()=>f().t("Too verbose")))]),a(sa,ia)},xa=sa=>{var ia=Me(),Ae=re(ia);{var Oe=Te=>{var Xe=De();x(gt=>j(Xe,gt),[()=>(f(),t(()=>f().t("Not helpful")))]),a(Te,Xe)},We=Te=>{var Xe=Me(),gt=re(Xe);{var xt=st=>{var Ve=De();x(Re=>j(Ve,Re),[()=>(f(),t(()=>f().t("Not factually correct")))]),a(st,Ve)},ft=st=>{var Ve=Me(),Re=re(Ve);{var lt=Ct=>{var Dt=De();x(Ht=>j(Dt,Ht),[()=>(f(),t(()=>f().t("Didn't fully follow instructions")))]),a(Ct,Dt)},dt=Ct=>{var Dt=Me(),Ht=re(Dt);{var Qt=na=>{var la=De();x(ua=>j(la,ua),[()=>(f(),t(()=>f().t("Refused when it shouldn't have")))]),a(na,la)},ga=na=>{var la=Me(),ua=re(la);{var ba=Pt=>{var At=De();x(Gt=>j(At,Gt),[()=>(f(),t(()=>f().t("Being lazy")))]),a(Pt,At)},Kt=Pt=>{var At=Me(),Gt=re(At);{var vt=mt=>{var Bt=De();x(ut=>j(Bt,ut),[()=>(f(),t(()=>f().t("Other")))]),a(mt,Bt)},Ft=mt=>{var Bt=De();x(()=>j(Bt,e(W))),a(mt,Bt)};u(Gt,mt=>{e(W)==="other"?mt(vt):mt(Ft,!1)},!0)}a(Pt,At)};u(ua,Pt=>{e(W)==="being_lazy"?Pt(ba):Pt(Kt,!1)},!0)}a(na,la)};u(Ht,na=>{e(W)==="refused_when_it_shouldnt_have"?na(Qt):na(ga,!1)},!0)}a(Ct,Dt)};u(Re,Ct=>{e(W)==="didnt_fully_follow_instructions"?Ct(lt):Ct(dt,!1)},!0)}a(st,Ve)};u(gt,st=>{e(W)==="not_factually_correct"?st(xt):st(ft,!1)},!0)}a(Te,Xe)};u(Ae,Te=>{e(W)==="not_helpful"?Te(Oe):Te(We,!1)},!0)}a(sa,ia)};u(ca,sa=>{e(W)==="too_verbose"?sa(pa):sa(xa,!1)},!0)}a(aa,ra)};u(Vt,aa=>{e(W)==="dont_like_the_style"?aa(Xt):aa(ea,!1)},!0)}a(it,Mt)};u(ct,it=>{e(W)==="thorough_explanation"?it(ht):it(Nt,!1)},!0)}a(jt,qe)};u(Ue,jt=>{e(W)==="attention_to_detail"?jt(Ye):jt(Ze,!1)},!0)}a(Ke,Je)};u(je,Ke=>{e(W)==="positive_attitude"?Ke(et):Ke(kt,!1)},!0)}a(ve,Be)};u(ke,ve=>{e(W)==="showcased_creativity"?ve(ee):ve(de,!1)},!0)}a(G,Ce)};u(Qe,G=>{e(W)==="followed_instructions_perfectly"?G(He):G(be,!1)},!0)}a(Ee,ze)};u(me,Ee=>{e(W)==="accurate_information"?Ee($e):Ee(pe,!1)})}r(ge),x(()=>Le(ge,1,`px-3 py-0.5 border border-gray-100/30 dark:border-gray-850/30 hover:bg-gray-50 dark:hover:bg-gray-850 ${e(A)===e(W)?"bg-gray-100 dark:bg-gray-800":""} transition rounded-xl`)),Ie("click",ge,()=>{I(A,e(W))}),a(q,ge)}),r(k),x(q=>j(P,q),[()=>(f(),t(()=>f().t("Why?")))]),a(Y,ue)};u(O,Y=>{e(we),t(()=>e(we).length>0)&&Y(z)})}r(p);var K=E(p,2),U=n(K);Ka(U),r(K);var se=E(K,2),T=n(se),F=n(T);{let Y=ye(()=>L()??[]);Zr(F,{get tags(){return e(v)},get suggestionTags(){return e(Y)},$$events:{delete:ue=>{I(v,e(v).filter(S=>S.name.replaceAll(" ","_").toLowerCase()!==ue.detail.replaceAll(" ","_").toLowerCase()))},add:ue=>{I(v,[...e(v),{name:ue.detail}])}}})}r(T);var $=E(T,2),X=n($,!0);r($),r(se),r(le),x((Y,ue,S,P,k)=>{Pe(le,"id",`message-feedback-${i(ne()),t(()=>ne().id)??""}`),j(ae,Y),j(H,`1 - ${ue??""}`),j(w,`10 - ${S??""}`),Pe(U,"placeholder",P),j(X,k)},[()=>(f(),t(()=>f().t("How would you rate this response?"))),()=>(f(),t(()=>f().t("Awful"))),()=>(f(),t(()=>f().t("Amazing"))),()=>(f(),t(()=>f().t("Feel free to add specific details"))),()=>(f(),t(()=>f().t("Save")))]),Ie("click",d,()=>{b(!1)}),Oa(U,()=>e(Z),Y=>I(Z,Y)),Ie("click",$,()=>{_e()}),a(Ne,he),Et(),M()}var _s=m('<div class="flex items-center gap-2 text-gray-500 transition"><!> <!></div>'),ps=m('<a target="_blank" class="flex w-full items-center p-1 px-3 group/item justify-between text-gray-800 dark:text-gray-300 font-normal! no-underline!"><div class="flex gap-2 items-center"><!> <div class=" line-clamp-1"> </div></div> <div class=" ml-1 text-white dark:text-gray-900 group-hover/item:text-gray-600 dark:group-hover/item:text-white transition"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" fill="currentColor" class="size-4"><path fill-rule="evenodd" d="M4.22 11.78a.75.75 0 0 1 0-1.06L9.44 5.5H5.75a.75.75 0 0 1 0-1.5h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V6.56l-5.22 5.22a.75.75 0 0 1-1.06 0Z" clip-rule="evenodd"></path></svg></div></a>'),xs=m('<a target="_blank" class="flex w-full items-center p-1 px-3 group/item justify-between text-gray-800 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-850 rounded-lg font-normal! no-underline! mb-1"><div class=" flex justify-center items-center gap-3"><div class="w-fit"><img alt="favicon" class="size-3.5"/></div> <div class="w-full text-sm line-clamp-1"> </div></div> <div class=" ml-1 text-white dark:text-gray-900 group-hover/item:text-gray-600 dark:group-hover/item:text-white transition"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" fill="currentColor" class="size-4"><path fill-rule="evenodd" d="M4.22 11.78a.75.75 0 0 1 0-1.06L9.44 5.5H5.75a.75.75 0 0 1 0-1.5h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V6.56l-5.22 5.22a.75.75 0 0 1-1.06 0Z" clip-rule="evenodd"></path></svg></div></a>'),bs=m('<a target="_blank" class="flex w-full items-center p-1 px-3 group/item justify-between text-gray-800 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-850 rounded-lg no-underline mb-1"><div class=" flex justify-center items-center gap-3"><div class="w-fit"><img alt="favicon" class="size-3.5"/></div> <div class="w-full text-sm line-clamp-1"> </div></div> <div class=" ml-1 text-white dark:text-gray-900 group-hover/item:text-gray-600 dark:group-hover/item:text-white transition"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" fill="currentColor" class="size-4"><path fill-rule="evenodd" d="M4.22 11.78a.75.75 0 0 1 0-1.06L9.44 5.5H5.75a.75.75 0 0 1 0-1.5h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V6.56l-5.22 5.22a.75.75 0 0 1-1.06 0Z" clip-rule="evenodd"></path></svg></div></a>'),ws=m('<div class="text-sm border border-gray-50 dark:border-gray-850/30 rounded-xl my-1.5 p-2 w-full" slot="content"><!> <!></div>');function ys(Ne,o){$t(o,!1);let l=c(o,"status",24,()=>({urls:[],query:""})),f=Se(!1);St(),Wr(Ne,{grow:!0,className:"w-full",buttonClassName:"w-full",get open(){return e(f)},set open(L){I(f,L)},children:(L,N)=>{var M=_s(),J=n(M);br(J,o,"default",{},null);var V=E(J,2);{var ne=B=>{os(B,{strokeWidth:"2.5",className:"size-3.5 "})},b=B=>{Qr(B,{strokeWidth:"2.5",className:"size-3.5 "})};u(V,B=>{e(f)?B(ne):B(b,!1)})}r(M),a(L,M)},$$slots:{default:!0,content:(L,N)=>{var M=ws(),J=n(M);{var V=te=>{var v=ps(),we=n(v),A=n(we);Za(A,{});var Z=E(A,2),ce=n(Z,!0);r(Z),r(we),za(2),r(v),x(()=>{Pe(v,"href",`https://www.google.com/search?q=${i(l()),t(()=>l().query)??""}`),j(ce,(i(l()),t(()=>l().query)))}),a(te,v)};u(J,te=>{i(l()),t(()=>{var v;return(v=l())==null?void 0:v.query})&&te(V)})}var ne=E(J,2);{var b=te=>{var v=Me(),we=re(v);pt(we,1,()=>(i(l()),t(()=>l().items)),zt,(A,Z)=>{var ce=xs(),s=n(ce),oe=n(s),_e=n(oe);r(oe);var he=E(oe,2),ie=n(he,!0);r(he),r(s),za(2),r(ce),x(()=>{Pe(ce,"href",(e(Z),t(()=>e(Z).link))),Pe(_e,"src",`https://www.google.com/s2/favicons?sz=32&domain=${e(Z),t(()=>e(Z).link)??""}`),j(ie,(e(Z),t(()=>{var xe;return((xe=e(Z))==null?void 0:xe.title)??e(Z).link})))}),a(A,ce)}),a(te,v)},B=te=>{var v=Me(),we=re(v);{var A=Z=>{var ce=Me(),s=re(ce);pt(s,1,()=>(i(l()),t(()=>l().urls)),zt,(oe,_e)=>{var he=bs(),ie=n(he),xe=n(ie),le=n(xe);r(xe);var fe=E(xe,2),R=n(fe,!0);r(fe),r(ie),za(2),r(he),x(()=>{Pe(he,"href",e(_e)),Pe(le,"src",`https://www.google.com/s2/favicons?sz=32&domain=${e(_e)??""}`),j(R,e(_e))}),a(oe,he)}),a(Z,ce)};u(we,Z=>{i(l()),t(()=>{var ce;return(ce=l())==null?void 0:ce.urls})&&Z(A)},!0)}a(te,v)};u(ne,te=>{i(l()),t(()=>{var v;return(v=l())==null?void 0:v.items})?te(b):te(B,!1)})}r(M),a(L,M)}},$$legacy:!0}),Et()}var ks=m('<div class="flex my-2 gap-2.5 border px-4 py-3 border-red-600/10 bg-red-600/10 rounded-lg"><div class=" self-start mt-0.5"><!></div> <div class=" self-center text-sm"><!></div></div>');function Ms(Ne,o){$t(o,!1);let l=c(o,"content",8,"");St();var f=ks(),L=n(f),N=n(L);Dr(N,{className:"size-5 text-red-700 dark:text-red-400"}),r(L);var M=E(L,2),J=n(M);{var V=b=>{var B=De();x(()=>j(B,l())),a(b,B)},ne=b=>{var B=Me(),te=re(B);{var v=A=>{var Z=Me(),ce=re(Z);{var s=_e=>{var he=De();x(()=>j(he,(i(l()),t(()=>l().error.message)))),a(_e,he)},oe=_e=>{var he=Me(),ie=re(he);{var xe=fe=>{var R=De();x(()=>j(R,(i(l()),t(()=>l().detail)))),a(fe,R)},le=fe=>{var R=Me(),ae=re(R);{var d=Q=>{var D=De();x(()=>j(D,(i(l()),t(()=>l().message)))),a(Q,D)},g=Q=>{var D=De();x(C=>j(D,C),[()=>(i(l()),t(()=>JSON.stringify(l())))]),a(Q,D)};u(ae,Q=>{i(l()),t(()=>{var D;return(D=l())==null?void 0:D.message})?Q(d):Q(g,!1)},!0)}a(fe,R)};u(ie,fe=>{i(l()),t(()=>{var R;return(R=l())==null?void 0:R.detail})?fe(xe):fe(le,!1)},!0)}a(_e,he)};u(ce,_e=>{i(l()),t(()=>{var he,ie,xe;return((he=l())==null?void 0:he.error)&&((xe=(ie=l())==null?void 0:ie.error)==null?void 0:xe.message)})?_e(s):_e(oe,!1)})}a(A,Z)},we=A=>{var Z=De();x(ce=>j(Z,ce),[()=>(i(l()),t(()=>JSON.stringify(l())))]),a(A,Z)};u(te,A=>{typeof l()=="object"&&l()!==null?A(v):A(we,!1)},!0)}a(b,B)};u(J,b=>{typeof l()=="string"?b(V):b(ne,!1)})}r(M),r(f),a(Ne,f),Et()}var Is=m('<a class="hover:text-gray-500 dark:hover:text-gray-100 underline grow line-clamp-1" target="_blank"> </a>'),Cs=m('<div><div class="text-sm font-medium dark:text-gray-300 mb-1"> </div> <!></div>'),$s=m('<a target="_blank" class="underline hover:text-gray-500 dark:hover:text-gray-100"> </a>'),Es=m("<span> </span>"),Ss=m('<span class="text-gray-500 dark:text-gray-500"> </span>'),Ns=m('<div class="text-sm my-1 dark:text-gray-400 flex items-center gap-2 w-fit"><!></div>'),Ps=m('<span class="text-sm text-gray-500 dark:text-gray-400"> </span>'),Bs=m('<iframe class="w-full border-0 h-auto rounded-none"></iframe>'),Ts=m('<pre class="text-sm dark:text-gray-400 whitespace-pre-line"> </pre>'),Ls=m('<div class="flex flex-col w-full gap-2"><!> <div><div class=" text-sm font-medium dark:text-gray-300 flex items-center gap-2 w-fit mb-1"><!> <!> <!></div> <!></div></div>'),Os=m('<div><div class=" flex justify-between dark:text-gray-300 px-4.5 pt-3 pb-2"><div class=" text-lg font-medium self-center flex items-center"><!></div> <button class="self-center"><!></button></div> <div class="flex flex-col md:flex-row w-full px-5 pb-5 md:space-x-4"><div class="flex flex-col w-full dark:text-gray-200 overflow-y-scroll max-h-[22rem] scrollbar-thin gap-1"></div></div></div>');function Rs(Ne,o){$t(o,!1);const l=()=>Fe(M,"$i18n",L),f=()=>Fe(fa,"$settings",L),[L,N]=Jt(),M=Wt("i18n");let J=c(o,"show",12,!1),V=c(o,"citation",8),ne=c(o,"showPercentage",8,!1),b=c(o,"showRelevance",8,!0),B=Se([]);function te(Z){return typeof Z!="number"?null:Z<0?0:Z>1?100:Math.round(Z*1e4)/100}function v(Z){return Z>=80?"bg-green-200 dark:bg-green-800 text-green-800 dark:text-green-200":Z>=60?"bg-yellow-200 dark:bg-yellow-800 text-yellow-800 dark:text-yellow-200":Z>=40?"bg-orange-200 dark:bg-orange-800 text-orange-800 dark:text-orange-200":"bg-red-200 dark:bg-red-800 text-red-800 dark:text-red-200"}const we=Z=>{try{return decodeURIComponent(Z)}catch{return Z}},A=Z=>{const{metadata:ce,source:s,document:oe}=Z??{},{file_id:_e,page:he}=ce??{},ie=s==null?void 0:s.url,xe=_e?`${Yt}/files/${_e}/content${he!==void 0?`#page=${he+1}`:""}`:ie!=null&&ie.includes("http")?ie:null;if(!xe||!oe)return xe;const le=oe.trim().replace(/\s+/g," ").split(" ").filter(g=>g.length>0&&!/https?:\/\/|[\u{1F300}-\u{1F9FF}]/u.test(g));if(le.length===0)return xe;const fe=g=>g.replace(/[^\w]/g,""),R=fe(le[0]),ae=fe(le.at(-1)),d=le.length===1?R:`${R},${ae}`;return d?`${xe}#:~:text=${d}`:xe};It(()=>(i(V()),e(B)),()=>{var Z;V()&&(I(B,(Z=V().document)==null?void 0:Z.map((ce,s)=>{var oe,_e;return{source:V().source,document:ce,metadata:(oe=V().metadata)==null?void 0:oe[s],distance:(_e=V().distances)==null?void 0:_e[s]}})),e(B).every(ce=>ce.distance!==void 0)&&I(B,e(B).sort((ce,s)=>(s.distance??1/0)-(ce.distance??1/0))))}),ta(),St(),xr(Ne,{size:"lg",get show(){return J()},set show(Z){J(Z)},children:(Z,ce)=>{var s=Os(),oe=n(s),_e=n(oe),he=n(_e);{var ie=d=>{const g=ye(()=>(e(B),t(()=>{var h;return(h=e(B))==null?void 0:h[0]})));var Q=Me(),D=re(Q);{var C=h=>{{let H=ye(()=>(i(e(g)),l(),t(()=>{var _,w;return(w=(_=e(g).source)==null?void 0:_.url)!=null&&w.includes("http")?l().t("Open link"):l().t("Open file")})));_t(h,{className:"w-fit",get content(){return e(H)},placement:"top-start",tippyOptions:{duration:[500,0]},children:(_,w)=>{var p=Is(),O=n(p,!0);r(p),x((z,K)=>{Pe(p,"href",z),j(O,K)},[()=>(i(e(g)),i(Yt),t(()=>{var z,K,U,se,T,F,$,X;return(K=(z=e(g))==null?void 0:z.metadata)!=null&&K.file_id?`${Yt}/files/${(se=(U=e(g))==null?void 0:U.metadata)==null?void 0:se.file_id}/content${((F=(T=e(g))==null?void 0:T.metadata)==null?void 0:F.page)!==void 0?`#page=${e(g).metadata.page+1}`:""}`:(X=($=e(g).source)==null?void 0:$.url)!=null&&X.includes("http")?e(g).source.url:"#"})),()=>(i(V()),t(()=>{var z,K;return we((K=(z=V())==null?void 0:z.source)==null?void 0:K.name)}))]),a(_,p)},$$slots:{default:!0}})}},y=h=>{var H=De();x(_=>j(H,_),[()=>(i(V()),t(()=>{var _,w;return we((w=(_=V())==null?void 0:_.source)==null?void 0:w.name)}))]),a(h,H)};u(D,h=>{i(e(g)),t(()=>{var H,_,w,p;return((_=(H=e(g))==null?void 0:H.metadata)==null?void 0:_.file_id)||((p=(w=e(g).source)==null?void 0:w.url)==null?void 0:p.includes("http"))})?h(C):h(y,!1)})}a(d,Q)},xe=d=>{var g=De();x(Q=>j(g,Q),[()=>(l(),t(()=>l().t("Citation")))]),a(d,g)};u(he,d=>{i(V()),t(()=>{var g,Q;return(Q=(g=V())==null?void 0:g.source)==null?void 0:Q.name})?d(ie):d(xe,!1)})}r(_e);var le=E(_e,2),fe=n(le);Aa(fe,{className:"size-5"}),r(le),r(oe);var R=E(oe,2),ae=n(R);pt(ae,5,()=>e(B),zt,(d,g)=>{var Q=Ls(),D=n(Q);{var C=F=>{var $=Cs(),X=n($),Y=n(X,!0);r(X);var ue=E(X,2);{let S=ye(()=>(e(g),t(()=>JSON.stringify(e(g).metadata.parameters,null,2))));Gr(ue,{readonly:!0,get value(){return e(S)}})}r($),x(S=>j(Y,S),[()=>(l(),t(()=>l().t("Parameters")))]),a(F,$)};u(D,F=>{e(g),t(()=>{var $;return($=e(g).metadata)==null?void 0:$.parameters})&&F(C)})}var y=E(D,2),h=n(y),H=n(h);{var _=F=>{const $=ye(()=>(e(g),t(()=>A(e(g)))));var X=Me(),Y=re(X);{var ue=P=>{var k=$s(),q=n(k,!0);r(k),x(W=>{Pe(k,"href",e($)),j(q,W)},[()=>(l(),t(()=>l().t("Content")))]),a(P,k)},S=P=>{var k=De();x(q=>j(k,q),[()=>(l(),t(()=>l().t("Content")))]),a(P,k)};u(Y,P=>{e($)?P(ue):P(S,!1)})}a(F,X)},w=F=>{var $=De();x(X=>j($,X),[()=>(l(),t(()=>l().t("Content")))]),a(F,$)};u(H,F=>{e(g),t(()=>{var $,X;return(X=($=e(g).source)==null?void 0:$.url)==null?void 0:X.includes("http")})?F(_):F(w,!1)})}var p=E(H,2);{var O=F=>{{let $=ye(()=>(l(),t(()=>l().t("Relevance"))));_t(F,{className:"w-fit",get content(){return e($)},placement:"top-start",tippyOptions:{duration:[500,0]},children:(X,Y)=>{var ue=Ns(),S=n(ue);{var P=q=>{const W=ye(()=>(e(g),t(()=>te(e(g).distance))));var ge=Me(),me=re(ge);{var $e=pe=>{var Ee=Es(),ze=n(Ee);r(Ee),x((Qe,He)=>{Le(Ee,1,Qe),j(ze,`${He??""}%`)},[()=>(i(e(W)),t(()=>`px-1 rounded-sm font-medium ${v(e(W))}`)),()=>(i(e(W)),t(()=>e(W).toFixed(2)))]),a(pe,Ee)};u(me,pe=>{typeof e(W)=="number"&&pe($e)})}a(q,ge)},k=q=>{var W=Me(),ge=re(W);{var me=$e=>{var pe=Ss(),Ee=n(pe);r(pe),x(ze=>j(Ee,`(${ze??""})`),[()=>(e(g),t(()=>{var ze;return(((ze=e(g))==null?void 0:ze.distance)??0).toFixed(4)}))]),a($e,pe)};u(ge,$e=>{e(g),t(()=>{var pe;return typeof((pe=e(g))==null?void 0:pe.distance)=="number"})&&$e(me)},!0)}a(q,W)};u(S,q=>{ne()?q(P):q(k,!1)})}r(ue),a(X,ue)},$$slots:{default:!0}})}};u(p,F=>{i(b()),e(g),t(()=>b()&&e(g).distance!==void 0)&&F(O)})}var z=E(p,2);{var K=F=>{var $=Ps(),X=n($);r($),x(Y=>j(X,`(${Y??""}
										${e(g),t(()=>e(g).metadata.page+1)??""})`),[()=>(l(),t(()=>l().t("page")))]),a(F,$)};u(z,F=>{e(g),t(()=>{var $,X;return Number.isInteger((X=($=e(g))==null?void 0:$.metadata)==null?void 0:X.page)})&&F(K)})}r(h);var U=E(h,2);{var se=F=>{var $=Bs();x(X=>{Pe($,"sandbox",`allow-scripts allow-forms${f(),t(()=>{var Y;return((Y=f())==null?void 0:Y.iframeSandboxAllowSameOrigin)??!1?" allow-same-origin":""})??""}`),Pe($,"srcdoc",(e(g),t(()=>e(g).document))),Pe($,"title",X)},[()=>(l(),t(()=>l().t("Content")))]),a(F,$)},T=F=>{var $=Ts(),X=n($,!0);r($),x(Y=>j(X,Y),[()=>(e(g),t(()=>e(g).document.trim().replace(/\n\n+/g,`

`)))]),a(F,$)};u(U,F=>{e(g),t(()=>{var $;return($=e(g).metadata)==null?void 0:$.html})?F(se):F(T,!1)})}r(y),r(Q),a(d,Q)}),r(ae),r(R),r(s),Ie("click",le,()=>{J(!1)}),a(Z,s)},$$slots:{default:!0},$$legacy:!0}),Et(),N()}var zs=m('<img alt="favicon" class="size-4 rounded-full shrink-0 border border-white dark:border-gray-850 bg-white dark:bg-gray-900"/>'),js=m('<div class="flex -space-x-1 items-center"></div>'),As=m('<div class=" py-1 -mx-0.5 w-full flex gap-1 items-center flex-wrap"><button class="text-xs font-medium text-gray-600 dark:text-gray-300 px-3.5 h-8 rounded-full hover:bg-gray-100 dark:hover:bg-gray-800 transition flex items-center gap-1 border border-gray-50 dark:border-gray-850/30"><!> <div><!></div></button></div>'),Hs=m('<button class="no-toggle outline-hidden flex dark:text-gray-300 bg-transparent text-gray-600 rounded-xl gap-1.5 items-center"><div class=" font-medium bg-gray-50 dark:bg-gray-850 rounded-md px-1"></div> <div class="flex-1 truncate hover:text-black dark:text-white/60 dark:hover:text-white transition text-left"> </div></button>'),qs=m('<div class="py-1.5"><div class="text-xs gap-2 flex flex-col"></div></div>'),Ws=m("<!> <!> <!>",1);function Ds(Ne,o){$t(o,!1);const l=()=>Fe(N,"$i18n",f),[f,L]=Jt(),N=Wt("i18n");let M=c(o,"id",8,""),J=c(o,"chatId",8,""),V=c(o,"sources",24,()=>[]),ne=c(o,"readOnly",8,!1),b=Se([]),B=Se(!1),te=Se(!0),v=Se(!1),we=Se(!1),A=Se(null);const Z=d=>{var Q,D,C,y;let g;if(typeof d=="string"){const h=d.split("#");g=parseInt(h[0])-1,h.length>1&&h[1]}else g=d-1;if(e(b)[g])if(e(b)[g],(D=(Q=e(b)[g])==null?void 0:Q.source)!=null&&D.embed_url){const h=e(b)[g].source.embed_url;if(h)if(ne()){window.open(h,"_blank");return}else Fa.set(!0),vr.set(!0),Er.set({url:h,title:((y=(C=e(b)[g])==null?void 0:C.source)==null?void 0:y.name)||"Embedded Content",source:e(b)[g],chatId:J(),messageId:M(),sourceId:d});else I(A,e(b)[g]),I(we,!0)}else I(A,e(b)[g]),I(we,!0)};function ce(d){const g=d.flatMap(C=>C.distances??[]),Q=g.filter(C=>C!==void 0&&C>=-1&&C<=1).length,D=g.filter(C=>C!==void 0&&(C<-1||C>1)).length;return!(g.length===0||Q===g.length-1&&D===1||D===g.length-1&&Q===1)}function s(d){return d.flatMap(Q=>Q.distances??[]).every(Q=>Q!==void 0&&Q>=-1&&Q<=1)}const oe=d=>{try{return decodeURIComponent(d)}catch{return d}};It(()=>(e(b),i(V())),()=>{I(b,V().reduce((d,g)=>{var Q;return Object.keys(g).length===0||(Q=g==null?void 0:g.document)==null||Q.forEach((D,C)=>{var p,O,z;const y=(p=g==null?void 0:g.metadata)==null?void 0:p[C],h=(O=g==null?void 0:g.distances)==null?void 0:O[C],H=(y==null?void 0:y.source)??((z=g==null?void 0:g.source)==null?void 0:z.id)??"N/A";let _=g==null?void 0:g.source;y!=null&&y.name&&(_={..._,name:y.name}),(H.startsWith("http://")||H.startsWith("https://"))&&(_={..._,name:H,url:H});const w=d.find(K=>K.id===H);w?(w.document.push(D),w.metadata.push(y),h!==void 0&&w.distances.push(h)):d.push({id:H,source:_,document:[D],metadata:y?[y]:[],distances:h!==void 0?[h]:[]})}),d},[])),e(b),I(te,ce(e(b))),I(B,s(e(b)))}),ta();var _e={showSourceModal:Z};St();var he=Ws(),ie=re(he);Rs(ie,{get citation(){return e(A)},get showPercentage(){return e(B)},get showRelevance(){return e(te)},get show(){return e(we)},set show(d){I(we,d)},$$legacy:!0});var xe=E(ie,2);{var le=d=>{const g=ye(()=>(e(b),t(()=>e(b).filter(p=>{var O,z;return(z=(O=p==null?void 0:p.source)==null?void 0:O.name)==null?void 0:z.startsWith("http")}))));var Q=As(),D=n(Q),C=n(D);{var y=p=>{var O=js();pt(O,5,()=>(i(e(g)),t(()=>e(g).slice(0,3))),zt,(z,K)=>{var U=zs();x(()=>Pe(U,"src",`https://www.google.com/s2/favicons?sz=32&domain=${e(K),t(()=>e(K).source.name)??""}`)),a(z,U)}),r(O),a(p,O)};u(C,p=>{i(e(g)),t(()=>e(g).length>0)&&p(y)})}var h=E(C,2),H=n(h);{var _=p=>{var O=De();x(z=>j(O,z),[()=>(l(),t(()=>l().t("1 Source")))]),a(p,O)},w=p=>{var O=De();x(z=>j(O,z),[()=>(l(),e(b),t(()=>l().t("{{COUNT}} Sources",{COUNT:e(b).length})))]),a(p,O)};u(H,p=>{e(b),t(()=>e(b).length===1)?p(_):p(w,!1)})}r(h),r(D),r(Q),Ie("click",D,()=>{I(v,!e(v))}),a(d,Q)};u(xe,d=>{e(b),t(()=>e(b).length>0)&&d(le)})}var fe=E(xe,2);{var R=d=>{var g=qs(),Q=n(g);pt(Q,5,()=>e(b),zt,(D,C,y)=>{var h=Hs(),H=n(h);H.textContent=y+1;var _=E(H,2),w=n(_,!0);r(_),r(h),x(p=>{Pe(h,"id",`source-${M()}-${y+1}`),j(w,p)},[()=>(e(C),t(()=>oe(e(C).source.name)))]),Ie("click",h,()=>{I(we,!0),I(A,e(C))}),a(D,h)}),r(Q),r(g),a(d,g)};u(fe,d=>{e(v)&&d(R)})}a(Ne,he),pr(o,"showSourceModal",Z);var ae=Et(_e);return L(),ae}var Fs=m("<div><!></div>"),Us=m("<div><!></div>"),Js=m('<div><div class=" text-gray-500 text-xs mb-1"> </div> <div class="text-sm"> </div></div>'),Vs=m('<div><div class=" text-gray-500 text-xs mb-1"> </div> <div class="text-sm"> </div></div>'),Zs=m('<div class="dark:bg-[#202123] dark:text-white px-4 py-4 rounded-b-lg flex flex-col gap-3"><!> <!></div>'),Qs=m('<li><a target="_blank"> </a></li>'),Ks=m('<div class="flex flex-col w-full"><hr class="border-gray-100/30 dark:border-gray-850/30 my-2"/> <div class=" text-sm font-medium dark:text-gray-300"> </div> <ul class="mt-1 list-disc pl-4 text-xs"></ul></div>'),Gs=m('<div><div class="flex justify-between dark:text-gray-300 px-5 pt-4 pb-2"><div class="text-lg font-medium self-center flex flex-col gap-0.5 capitalize"><!> <div class="flex gap-2 items-center"><!> <div><!></div></div></div> <button class="self-center"><!></button></div> <div class="flex flex-col md:flex-row w-full px-4 pb-5"><div class="flex flex-col w-full dark:text-gray-200 overflow-y-scroll max-h-[22rem] scrollbar-hidden"><div class="flex flex-col w-full"><!></div> <!> <!></div></div></div>');function Ys(Ne,o){$t(o,!1);const l=()=>Fe(N,"$i18n",f),[f,L]=Jt(),N=Wt("i18n");let M=c(o,"show",12,!1),J=c(o,"codeExecution",12,null);St(),xr(Ne,{size:"lg",get show(){return M()},set show(V){M(V)},children:(V,ne)=>{var b=Gs(),B=n(b),te=n(B),v=n(te);{var we=C=>{var y=Fs(),h=n(y);{var H=w=>{qa(w,{type:"error",content:"error"})},_=w=>{var p=Me(),O=re(p);{var z=U=>{qa(U,{type:"success",content:"success"})},K=U=>{qa(U,{type:"warning",content:"incomplete"})};u(O,U=>{i(J()),t(()=>{var se;return(se=J().result)==null?void 0:se.output})?U(z):U(K,!1)},!0)}a(w,p)};u(h,w=>{i(J()),t(()=>{var p;return(p=J().result)==null?void 0:p.error})?w(H):w(_,!1)})}r(y),a(C,y)};u(v,C=>{i(J()),t(()=>{var y;return(y=J())==null?void 0:y.result})&&C(we)})}var A=E(v,2),Z=n(A);{var ce=C=>{var y=Us(),h=n(y);tr(h,{className:"size-4"}),r(y),a(C,y)};u(Z,C=>{i(J()),t(()=>{var y;return!((y=J())!=null&&y.result)})&&C(ce)})}var s=E(Z,2),oe=n(s);{var _e=C=>{var y=De();x(h=>j(y,`${h??""}: ${i(J()),t(()=>{var H;return(H=J())==null?void 0:H.name})??""}`),[()=>(l(),t(()=>l().t("Code execution")))]),a(C,y)},he=C=>{var y=De();x(h=>j(y,h),[()=>(l(),t(()=>l().t("Code execution")))]),a(C,y)};u(oe,C=>{i(J()),t(()=>{var y;return(y=J())==null?void 0:y.name})?C(_e):C(he,!1)})}r(s),r(A),r(te);var ie=E(te,2),xe=n(ie);Aa(xe,{className:"size-5"}),r(ie),r(B);var le=E(B,2),fe=n(le),R=n(fe),ae=n(R);{let C=ye(()=>(i(J()),t(()=>{var _;return(_=J())==null?void 0:_.id}))),y=ye(()=>(i(J()),t(()=>{var _;return((_=J())==null?void 0:_.language)??""}))),h=ye(()=>(i(J()),t(()=>{var _;return((_=J())==null?void 0:_.code)??""}))),H=ye(()=>(i(J()),t(()=>{var _,w,p,O,z;return(_=J())!=null&&_.result&&((p=(w=J())==null?void 0:w.result)!=null&&p.error||(z=(O=J())==null?void 0:O.result)!=null&&z.output)?"rounded-b-none":""})));Fr(ae,{get id(){return`code-exec-${e(C)??""}-code`},get lang(){return e(y)},get code(){return e(h)},className:"",get editorClassName(){return e(H)},run:!1})}r(R);var d=E(R,2);{var g=C=>{var y=Zs(),h=n(y);{var H=p=>{var O=Js(),z=n(O),K=n(z,!0);r(z);var U=E(z,2),se=n(U,!0);r(U),r(O),x(T=>{j(K,T),j(se,(i(J()),t(()=>{var F,$;return($=(F=J())==null?void 0:F.result)==null?void 0:$.error})))},[()=>(l(),t(()=>l().t("ERROR")))]),a(p,O)};u(h,p=>{i(J()),t(()=>{var O,z;return(z=(O=J())==null?void 0:O.result)==null?void 0:z.error})&&p(H)})}var _=E(h,2);{var w=p=>{var O=Vs(),z=n(O),K=n(z,!0);r(z);var U=E(z,2),se=n(U,!0);r(U),r(O),x(T=>{j(K,T),j(se,(i(J()),t(()=>{var F,$;return($=(F=J())==null?void 0:F.result)==null?void 0:$.output})))},[()=>(l(),t(()=>l().t("OUTPUT")))]),a(p,O)};u(_,p=>{i(J()),t(()=>{var O,z;return(z=(O=J())==null?void 0:O.result)==null?void 0:z.output})&&p(w)})}r(y),a(C,y)};u(d,C=>{i(J()),t(()=>{var y,h,H,_,w;return((y=J())==null?void 0:y.result)&&(((H=(h=J())==null?void 0:h.result)==null?void 0:H.error)||((w=(_=J())==null?void 0:_.result)==null?void 0:w.output))})&&C(g)})}var Q=E(d,2);{var D=C=>{var y=Ks(),h=E(n(y),2),H=n(h,!0);r(h);var _=E(h,2);pt(_,5,()=>(i(J()),t(()=>{var w,p;return(p=(w=J())==null?void 0:w.result)==null?void 0:p.files})),zt,(w,p)=>{var O=Qs(),z=n(O),K=n(z,!0);r(z),r(O),x(()=>{Pe(z,"href",(e(p),t(()=>e(p).url))),j(K,(e(p),t(()=>e(p).name)))}),a(w,O)}),r(_),r(y),x(w=>j(H,w),[()=>(l(),t(()=>l().t("Files")))]),a(C,y)};u(Q,C=>{i(J()),t(()=>{var y,h,H,_;return((h=(y=J())==null?void 0:y.result)==null?void 0:h.files)&&((_=(H=J())==null?void 0:H.result)==null?void 0:_.files.length)>0})&&C(D)})}r(fe),r(le),r(b),Ie("click",ie,()=>{M(!1),J(null)}),a(V,b)},$$slots:{default:!0},$$legacy:!0}),Et(),L()}var Xs=m('<div class="flex gap-1 text-xs font-semibold svelte-tclqny"><button class="flex dark:text-gray-300 py-1 px-1 bg-gray-50 hover:bg-gray-100 dark:bg-gray-850 dark:hover:bg-gray-800 transition rounded-xl max-w-96 svelte-tclqny"><div class="bg-white dark:bg-gray-700 rounded-full size-4 flex items-center justify-center svelte-tclqny"><!></div> <div> </div></button></div>'),en=m('<div class="mt-1 mb-2 w-full flex gap-1 items-center flex-wrap svelte-tclqny"></div>'),tn=m("<!> <!>",1);function an(Ne,o){$t(o,!1);let l=c(o,"codeExecutions",24,()=>[]),f=Se(null),L=Se(!1);const N=()=>{e(f)&&I(f,l().find(b=>b.id===e(f).id))};It(()=>i(l()),()=>{l()&&N()}),ta(),St();var M=tn(),J=re(M);Ys(J,{get codeExecution(){return e(f)},get show(){return e(L)},set show(b){I(L,b)},$$legacy:!0});var V=E(J,2);{var ne=b=>{var B=en();pt(B,5,l,te=>te.id,(te,v)=>{var we=Xs(),A=n(we),Z=n(A),ce=n(Z);{var s=ie=>{var xe=Me(),le=re(xe);{var fe=ae=>{Aa(ae,{})},R=ae=>{var d=Me(),g=re(d);{var Q=C=>{Yr(C,{strokeWidth:"3",className:"size-3"})},D=C=>{Xr(C,{})};u(g,C=>{e(v),t(()=>{var y;return(y=e(v).result)==null?void 0:y.output})?C(Q):C(D,!1)},!0)}a(ae,d)};u(le,ae=>{e(v),t(()=>{var d;return(d=e(v).result)==null?void 0:d.error})?ae(fe):ae(R,!1)})}a(ie,xe)},oe=ie=>{tr(ie,{className:"size-4"})};u(ce,ie=>{e(v),t(()=>{var xe;return(xe=e(v))==null?void 0:xe.result})?ie(s):ie(oe,!1)})}r(Z);var _e=E(Z,2),he=n(_e,!0);r(_e),r(A),r(we),x(()=>{Le(_e,1,`flex-1 mx-2 line-clamp-1 code-execution-name ${e(v),t(()=>{var ie;return(ie=e(v))!=null&&ie.result?"":"pulse"})??""}`,"svelte-tclqny"),j(he,(e(v),t(()=>e(v).name)))}),Ie("click",A,()=>{I(f,e(v)),I(L,!0)}),a(te,we)}),r(B),a(b,B)};u(V,b=>{i(l()),t(()=>l().length>0)&&b(ne)})}a(Ne,M),Et()}var rn=m('<button class="px-1.5 py-[1px] hover:bg-gray-50 dark:hover:bg-gray-800 rounded-xl flex items-center gap-1 min-w-fit transition"><!> <div class="shrink-0"> </div></button>'),sn=m('<div class="flex flex-row shrink-0 p-0.5 bg-white dark:bg-gray-850 dark:text-gray-100 text-medium rounded-xl shadow-xl border border-gray-100 dark:border-gray-800"></div>'),nn=m('<div class="py-1 flex dark:text-gray-100 bg-white dark:bg-gray-850 border border-gray-100 dark:border-gray-800 w-72 rounded-full shadow-xl"><input type="text" id="floating-message-input" class="ml-5 bg-transparent outline-hidden w-full flex-1 text-sm"/> <div class="ml-1 mr-1"><button><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" fill="currentColor" class="size-4"><path fill-rule="evenodd" d="M8 14a.75.75 0 0 1-.75-.75V4.56L4.03 7.78a.75.75 0 0 1-1.06-1.06l4.5-4.5a.75.75 0 0 1 1.06 0l4.5 4.5a.75.75 0 0 1-1.06 1.06L8.75 4.56v8.69A.75.75 0 0 1 8 14Z" clip-rule="evenodd"></path></svg></button></div></div>'),on=m('<div class="flex justify-end pt-3 text-sm font-medium"><button class="px-3.5 py-1.5 text-sm font-medium bg-black hover:bg-gray-900 text-white dark:bg-white dark:text-black dark:hover:bg-gray-100 transition rounded-full"> </button></div>'),ln=m('<div class="bg-white dark:bg-gray-850 dark:text-gray-100 rounded-3xl shadow-xl w-80 max-w-full border border-gray-100 dark:border-gray-800"><div class="bg-white dark:bg-gray-850 dark:text-gray-100 text-medium rounded-3xl px-3.5 pt-3 w-full"><div class="font-medium"><!></div></div> <div class="bg-white dark:bg-gray-850 dark:text-gray-100 text-medium rounded-4xl w-full"><div class=" max-h-80 overflow-y-auto w-full markdown-prose-xs px-3.5 py-3" id="response-container"><!> <!></div></div></div>'),dn=m('<div class="absolute rounded-lg mt-1 text-xs z-9999" style="display: none"><!></div>');function vn(Ne,o){$t(o,!1);const l=()=>Fe(V,"$i18n",M),f=()=>Fe(La,"$models",M),L=()=>Fe(Sr,"$socket",M),N=()=>Fe(cr,"$chatId",M),[M,J]=Jt(),V=Wt("i18n");let ne=c(o,"id",8,""),b=c(o,"messageId",8,""),B=c(o,"model",8,null),te=c(o,"messages",24,()=>[]),v=c(o,"actions",28,()=>[]),we=c(o,"onAdd",8,h=>{}),A=Se(!1),Z=Se(null),ce=Se(""),s=Se(""),oe=Se(""),_e=Se(null),he=Se(!1),ie=null;const xe=[{id:"ask",label:l().t("Ask"),icon:as,input:!0,prompt:`{{SELECTED_CONTENT}}


{{INPUT_CONTENT}}`},{id:"explain",label:l().t("Explain"),icon:Ur,prompt:`{{SELECTED_CONTENT}}


${l().t("Explain")}`}],le=async()=>{const h=document.getElementById("response-container");h&&h.scrollHeight-h.clientHeight<=h.scrollTop+50&&(h.scrollTop=h.scrollHeight)},fe=async h=>{var se;if(!B()){qt.error(l().t("Model not selected"));return}let H=e(ce).split(`
`).map(T=>`> ${T}`).join(`
`),_=v().find(T=>T.id===h);if(!_){qt.error(l().t("Action not found"));return}let w=(_==null?void 0:_.prompt)??"",p=[];const O=/\{\{(.*?)\|tool:id="([^"]+)"\}\}/g;w=w.replace(O,(T,F,$)=>(p.push($),F));let z=/\{\{TOOL:([^\}]+)\}\}/g,K;for(;(K=z.exec(w))!==null;)p.push(K[1]);w=w.replace(z,""),w.includes("{{INPUT_CONTENT}}")&&e(A)&&(w=w.replace("{{INPUT_CONTENT}}",e(s)),I(s,"")),w=w.replace("{{CONTENT}}",e(ce)),w=w.replace("{{SELECTED_CONTENT}}",H),I(oe,w),I(_e,"");let U;if([U,ie]=await ts(localStorage.token,{model:B(),model_item:f().find(T=>T.id===B()),session_id:(se=L())==null?void 0:se.id,chat_id:N(),messages:[...te(),{role:"user",content:e(oe)}].map(T=>({role:T.role,content:T.content})),...p.length>0?{tool_ids:p}:{},stream:!0}),U&&U.ok){const T=U.body.getReader(),F=new TextDecoder,$=async()=>{var X,Y;for(;;){const{done:ue,value:S}=await T.read();if(ue)break;const k=F.decode(S,{stream:!0}).split(`
`).filter(q=>q.trim()!=="");for(const q of k)if(q.startsWith("data: "))if(q.startsWith("data: [DONE]")){I(he,!0),await rt(),le();continue}else try{const W=JSON.parse(q.slice(6));W.choices&&((Y=(X=W.choices[0])==null?void 0:X.delta)!=null&&Y.content)&&(I(_e,e(_e)+W.choices[0].delta.content),le())}catch(W){}}};try{await $()}catch(X){X.name}}else qt.error(l().t("An error occurred while fetching the explanation"))},R=async()=>{const h=[{role:"user",content:e(oe)},{role:"assistant",content:e(_e)}];we()({modelId:B(),parentId:b(),messages:h})},ae=()=>{ie&&ie.abort(),I(Z,null),I(ce,""),I(_e,null),I(he,!1),I(A,!1),I(s,"")};Ga(()=>{ie&&ie.abort()}),It(()=>i(v()),()=>{v().length===0&&v(xe)}),ta();var d={closeHandler:ae};St();var g=dn(),Q=n(g);{var D=h=>{var H=Me(),_=re(H);{var w=O=>{var z=sn();pt(z,5,v,zt,(K,U)=>{var se=rn(),T=n(se);{var F=Y=>{var ue=Me(),S=re(ue);es(S,()=>e(U).icon,(P,k)=>{k(P,{className:"size-3 shrink-0"})}),a(Y,ue)};u(T,Y=>{e(U),t(()=>e(U).icon)&&Y(F)})}var $=E(T,2),X=n($,!0);r($),r(se),x(()=>j(X,(e(U),t(()=>e(U).label)))),Ie("click",se,async()=>{I(ce,window.getSelection().toString()),I(Z,e(U)),e(U).prompt.includes("{{INPUT_CONTENT}}")?(I(A,!0),I(s,""),await rt(),setTimeout(()=>{const Y=document.getElementById("floating-message-input");Y&&Y.focus()},0)):fe(e(U).id)}),a(K,se)}),r(z),a(O,z)},p=O=>{var z=nn(),K=n(z);Na(K);var U=E(K,2),se=n(U);r(U),r(z),x(T=>{Pe(K,"placeholder",T),Le(se,1,`${e(s)!==""?"bg-black text-white hover:bg-gray-900 dark:bg-white dark:text-black dark:hover:bg-gray-100 ":"text-white bg-gray-200 dark:text-gray-900 dark:bg-gray-700 disabled"} transition rounded-full p-1.5 m-0.5 self-center`)},[()=>(l(),t(()=>l().t("Ask a question")))]),Oa(K,()=>e(s),T=>I(s,T)),Ie("keydown",K,T=>{var F;T.key==="Enter"&&fe((F=e(Z))==null?void 0:F.id)}),Ie("click",se,()=>{var T;fe((T=e(Z))==null?void 0:T.id)}),a(O,z)};u(_,O=>{e(A)?O(p,!1):O(w)})}a(h,H)},C=h=>{var H=ln(),_=n(H),w=n(_),p=n(w);{let $=ye(()=>`${ne()}-float-prompt`);Pa(p,{get id(){return e($)},get content(){return e(oe)}})}r(w),r(_);var O=E(_,2),z=n(O),K=n(z);{var U=$=>{er($,{size:"sm"})},se=$=>{{let X=ye(()=>`${ne()}-float-response`);Pa($,{get id(){return e(X)},get content(){return e(_e)}})}};u(K,$=>{e(_e),t(()=>{var X;return!e(_e)||((X=e(_e))==null?void 0:X.trim())===""})?$(U):$(se,!1)})}var T=E(K,2);{var F=$=>{var X=on(),Y=n(X),ue=n(Y,!0);r(Y),r(X),x(S=>j(ue,S),[()=>(l(),t(()=>l().t("Add")))]),Ie("click",Y,R),a($,X)};u(T,$=>{e(he)&&$(F)})}r(z),r(O),r(H),a(h,H)};u(Q,h=>{e(_e)===null?h(D):h(C,!1)})}r(g),x(()=>Pe(g,"id",`floating-buttons-${ne()}`)),a(Ne,g),pr(o,"closeHandler",ae);var y=Et(d);return J(),y}var cn=m("<div><!></div> <!>",1);function gn(Ne,o){$t(o,!1);const l=()=>Fe(gr,"$mobile",N),f=()=>Fe(fa,"$settings",N),L=()=>Fe(cr,"$chatId",N),[N,M]=Jt();Wt("i18n");let J=c(o,"id",8),V=c(o,"content",8),ne=c(o,"history",8),b=c(o,"messageId",8),B=c(o,"selectedModels",24,()=>[]),te=c(o,"done",8,!0),v=c(o,"model",8,null),we=c(o,"sources",8,null),A=c(o,"save",8,!1),Z=c(o,"preview",8,!1),ce=c(o,"floatingButtons",8,!0),s=c(o,"editCodeBlock",8,!0),oe=c(o,"topPadding",8,!1),_e=c(o,"onSave",8,h=>{}),he=c(o,"onSourceClick",8,h=>{}),ie=c(o,"onTaskClick",8,h=>{}),xe=c(o,"onAddMessages",8,h=>{}),le=Se(),fe=Se();const R=h=>{var _;const H=document.getElementById(`floating-buttons-${J()}`);if(!((_=e(le))!=null&&_.contains(h.target))&&!(H!=null&&H.contains(h.target))){ae();return}setTimeout(async()=>{var p;if(await rt(),!((p=e(le))!=null&&p.contains(h.target)))return;let w=window.getSelection();if(w.toString().trim().length>0){const z=w.getRangeAt(0).getBoundingClientRect(),K=e(le).getBoundingClientRect(),U=z.bottom-K.top,se=z.left-K.left;if(H){H.style.display="block";const T=K.width-se;let F=l()?window.innerWidth/2:window.innerWidth/3;if(T<F){const $=K.right-z.right;H.style.right=`${$}px`,H.style.left="auto"}else H.style.left=`${se}px`,H.style.right="auto";H.style.top=`${U+5}px`}}else ae()},0)},ae=()=>{var H,_;const h=document.getElementById(`floating-buttons-${J()}`);h&&(h.style.display="none"),e(fe)&&typeof((H=e(fe))==null?void 0:H.closeHandler)=="function"&&((_=e(fe))==null||_.closeHandler())},d=h=>{h.key==="Escape"&&ae()};Ca(()=>{var h;ce()&&((h=e(le))==null||h.addEventListener("mouseup",R),document.addEventListener("mouseup",R),document.addEventListener("keydown",d))}),Ga(()=>{var h;ce()&&((h=e(le))==null||h.removeEventListener("mouseup",R),document.removeEventListener("mouseup",R),document.removeEventListener("keydown",d))}),St();var g=cn(),Q=re(g),D=n(Q);{let h=ye(()=>(i(we()),i(v()),t(()=>(we()??[]).reduce((H,_)=>{let w=[];return _.document.forEach((p,O)=>{var U,se,T,F,$,X;if(((F=(T=(se=(U=v())==null?void 0:U.info)==null?void 0:se.meta)==null?void 0:T.capabilities)==null?void 0:F.citations)==!1)return w.push("N/A"),w;const z=($=_.metadata)==null?void 0:$[O],K=(z==null?void 0:z.source)??"N/A";return z!=null&&z.name?(w.push(z.name),w):(K.startsWith("http://")||K.startsWith("https://")?w.push(K):w.push(((X=_==null?void 0:_.source)==null?void 0:X.name)??K),w)}),H=[...H,...w],H.filter((p,O)=>H.indexOf(p)===O)},[]))));Pa(D,{get id(){return J()},get content(){return V()},get model(){return v()},get save(){return A()},get preview(){return Z()},get done(){return te()},get editCodeBlock(){return s()},get topPadding(){return oe()},get sourceIds(){return e(h)},get onSourceClick(){return he()},get onTaskClick(){return ie()},get onSave(){return _e()},onUpdate:async H=>{var p;const{lang:_,text:w}=H;(((p=f())==null?void 0:p.detectArtifacts)??!0)&&(["html","svg"].includes(_)||_==="xml"&&w.includes("svg"))&&!l()&&L()&&(await rt(),ar.set(!0),Fa.set(!0))},onPreview:async H=>{await Nr.set(H),await Fa.set(!0),await ar.set(!0),await Pr.set(!1),await vr.set(!1)}})}r(Q),_a(Q,h=>I(le,h),()=>e(le));var C=E(Q,2);{var y=h=>{{let H=ye(()=>(f(),t(()=>{var p;return((p=f())==null?void 0:p.floatingActionButtons)??[]}))),_=ye(()=>(i(B()),i(v()),t(()=>{var p,O,z;return(B()??[]).includes((p=v())==null?void 0:p.id)?(O=v())==null?void 0:O.id:(B()??[]).length>0?B().at(0):(z=v())==null?void 0:z.id}))),w=ye(()=>(i(Ua),i(ne()),i(b()),t(()=>Ua(ne(),b()))));_a(vn(h,{get id(){return J()},get messageId(){return b()},get actions(){return e(H)},get model(){return e(_)},get messages(){return e(w)},onAdd:({modelId:p,parentId:O,messages:z})=>{xe()({modelId:p,parentId:O,messages:z}),ae()},$$legacy:!0}),p=>I(fe,p),()=>e(fe))}};u(C,h=>{ce()&&v()&&h(y)})}a(Ne,g),Et(),M()}function un(Ne){return new Worker(""+new URL("../workers/kokoro.worker-y8zXfoZW.js",import.meta.url).href,{type:"module",name:Ne==null?void 0:Ne.name})}class fn{constructor(o="fp32"){ya(this,"worker",null);ya(this,"initialized",!1);ya(this,"dtype");ya(this,"requestQueue",[]);ya(this,"processing",!1);this.dtype=o}async init(){if(this.worker){console.warn("KokoroWorker is already initialized.");return}return this.worker=new un,this.worker.onmessage=o=>{const{status:l,error:f,audioUrl:L}=o.data;if(l==="init:complete")this.initialized=!0;else if(l==="init:error")this.initialized=!1;else if(l==="generate:complete"){const N=this.requestQueue.shift();N&&(N.resolve(L),this.processNextRequest())}else if(l==="generate:error"){const N=this.requestQueue.shift();N&&(N.reject(new Error(f)),this.processNextRequest())}},new Promise((o,l)=>{this.worker.postMessage({type:"init",payload:{dtype:this.dtype}});const f=L=>{L.data.status==="init:complete"?(this.worker.removeEventListener("message",f),this.initialized=!0,o()):L.data.status==="init:error"&&(this.worker.removeEventListener("message",f),l(new Error(L.data.error)))};this.worker.addEventListener("message",f)})}async generate({text:o,voice:l}){if(!this.initialized||!this.worker)throw new Error("KokoroTTS Worker is not initialized yet.");return new Promise((f,L)=>{this.requestQueue.push({text:o,voice:l,resolve:f,reject:L}),this.processing||this.processNextRequest()})}processNextRequest(){if(this.requestQueue.length===0){this.processing=!1;return}this.processing=!0;const{text:o,voice:l}=this.requestQueue[0];this.worker.postMessage({type:"generate",payload:{text:o,voice:l}})}terminate(){this.worker&&(this.worker.terminate(),this.worker=null,this.initialized=!1,this.requestQueue=[],this.processing=!1)}}var mn=m('<div class=" py-1.5 bg-transparent text-left text-sm flex items-center gap-2 text-gray-500 dark:text-gray-400 hover:text-black dark:hover:text-white transition cursor-pointer"><div class="line-clamp-1"> </div></div>'),hn=m('<hr class="border-gray-50 dark:border-gray-850/30"/>'),_n=m("<!> <!>",1),pn=m('<div class="mt-4"><div class="text-sm font-medium"> </div> <div class="flex flex-col text-left gap-1 mt-1.5"></div></div>');function xn(Ne,o){$t(o,!1);const l=()=>Fe(N,"$i18n",f),[f,L]=Jt(),N=Wt("i18n");let M=c(o,"followUps",24,()=>[]),J=c(o,"onClick",8,()=>{});St();var V=pn(),ne=n(V),b=n(ne,!0);r(ne);var B=E(ne,2);pt(B,5,M,zt,(te,v,we)=>{var A=_n(),Z=re(A);_t(Z,{get content(){return e(v)},placement:"top-start",className:"line-clamp-1",children:(oe,_e)=>{var he=mn(),ie=n(he),xe=n(ie,!0);r(ie),r(he),x(()=>{Pe(he,"aria-label",e(v)),j(xe,e(v))}),Ie("click",he,()=>J()(e(v))),a(oe,he)},$$slots:{default:!0}});var ce=E(Z,2);{var s=oe=>{var _e=hn();a(oe,_e)};u(ce,oe=>{i(M()),t(()=>we<M().length-1)&&oe(s)})}a(te,A)}),r(B),r(V),x(te=>j(b,te),[()=>(l(),t(()=>l().t("Follow up")))]),a(Ne,V),Et(),L()}var bn=$a('<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path d="M11 6H21" stroke-linecap="round" stroke-linejoin="round"></path><path d="M11 12H21" stroke-linecap="round" stroke-linejoin="round"></path><path d="M11 18H21" stroke-linecap="round" stroke-linejoin="round"></path><path d="M5 19V5M5 19L3 16.5M5 19L7 16.5M5 5L3 7M5 5L7 7" stroke-linecap="round" stroke-linejoin="round"></path></svg>');function wn(Ne,o){let l=c(o,"className",8,"size-4"),f=c(o,"strokeWidth",8,"1.5");var L=bn();x(()=>{Pe(L,"stroke-width",f()),Le(L,0,Ta(l()))}),a(Ne,L)}var yn=$a('<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path d="M11 6H21" stroke-linecap="round" stroke-linejoin="round"></path><path d="M11 12H21" stroke-linecap="round" stroke-linejoin="round"></path><path d="M11 18H21" stroke-linecap="round" stroke-linejoin="round"></path><path d="M5 19V5M5 10L3 8M5 10L7 8M5 14L3 16M5 14L7 16" stroke-linecap="round" stroke-linejoin="round"></path></svg>');function kn(Ne,o){let l=c(o,"className",8,"size-4"),f=c(o,"strokeWidth",8,"1.5");var L=yn();x(()=>{Pe(L,"stroke-width",f()),Le(L,0,Ta(l()))}),a(Ne,L)}var Mn=m('<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" aria-hidden="true" stroke="currentColor" class="w-4 h-4"><path stroke-linecap="round" stroke-linejoin="round" d="M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0l3.181 3.183a8.25 8.25 0 0013.803-3.7M4.031 9.865a8.25 8.25 0 0113.803-3.7l3.181 3.182m0-4.991v4.99"></path></svg> <div class="flex items-center"> </div>',1),In=m('<!> <div class="flex items-center"> </div>',1),Cn=m('<!> <div class="flex items-center"> </div>',1),$n=m('<div class="py-1.5 px-2.5 flex dark:text-gray-100"><input type="text" id="floating-message-input" class="bg-transparent outline-hidden w-full flex-1 text-sm" autocomplete="off"/> <div class="ml-2 self-center flex items-center"><button><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" fill="currentColor" class="size-3.5"><path fill-rule="evenodd" d="M8 14a.75.75 0 0 1-.75-.75V4.56L4.03 7.78a.75.75 0 0 1-1.06-1.06l4.5-4.5a.75.75 0 0 1 1.06 0l4.5 4.5a.75.75 0 0 1-1.06 1.06L8.75 4.56v8.69A.75.75 0 0 1 8 14Z" clip-rule="evenodd"></path></svg></button></div></div> <hr class="border-gray-50/30 dark:border-gray-800/30 my-1 mx-2"/> <!> <!> <!>',1),En=m('<div slot="content"><!></div>');function Sn(Ne,o){$t(o,!1);const l=()=>Fe(N,"$i18n",f),[f,L]=Jt(),N=Wt("i18n");let M=c(o,"onRegenerate",8,(b=null)=>{}),J=c(o,"onClose",8,()=>{}),V=Se(!1),ne=Se("");St(),ns(Ne,{align:"end",get show(){return e(V)},set show(b){I(V,b)},$$events:{change:b=>{b.detail===!1&&J()()}},children:(b,B)=>{var te=Me(),v=re(te);br(v,o,"default",{},null),a(b,te)},$$slots:{default:!0,content:(b,B)=>{var te=En(),v=n(te);rs(v,{class:"w-full max-w-[200px] rounded-2xl px-1 py-1 border border-gray-100 dark:border-gray-800 z-50 bg-white dark:bg-gray-850 dark:text-white shadow-lg transition",sideOffset:-2,side:"bottom",align:"start",get transition(){return ss},children:(we,A)=>{var Z=$n(),ce=re(Z),s=n(ce);Na(s);var oe=E(s,2),_e=n(oe);r(oe),r(ce);var he=E(ce,4);Wa(he,{class:"flex  gap-2  items-center px-3 py-1.5 text-sm  cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 rounded-xl",$$events:{click:()=>{M()(),I(V,!1)}},children:(le,fe)=>{var R=Mn(),ae=E(re(R),2),d=n(ae,!0);r(ae),x(g=>j(d,g),[()=>(l(),t(()=>l().t("Try Again")))]),a(le,R)},$$slots:{default:!0}});var ie=E(he,2);Wa(ie,{class:"flex  gap-2  items-center px-3 py-1.5 text-sm  cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 rounded-xl",$$events:{click:()=>{M()(l().t("Add Details"))}},children:(le,fe)=>{var R=In(),ae=re(R);wn(ae,{strokeWidth:"2"});var d=E(ae,2),g=n(d,!0);r(d),x(Q=>j(g,Q),[()=>(l(),t(()=>l().t("Add Details")))]),a(le,R)},$$slots:{default:!0}});var xe=E(ie,2);Wa(xe,{class:"flex  gap-2  items-center px-3 py-1.5 text-sm  cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 rounded-xl",$$events:{click:()=>{M()(l().t("More Concise"))}},children:(le,fe)=>{var R=Cn(),ae=re(R);kn(ae,{strokeWidth:"2"});var d=E(ae,2),g=n(d,!0);r(d),x(Q=>j(g,Q),[()=>(l(),t(()=>l().t("More Concise")))]),a(le,R)},$$slots:{default:!0}}),x(le=>{Pe(s,"placeholder",le),Le(_e,1,`${e(ne)!==""?"bg-black text-white hover:bg-gray-900 dark:bg-white dark:text-black dark:hover:bg-gray-100 ":"text-white bg-gray-200 dark:text-gray-900 dark:bg-gray-700 disabled"} transition rounded-full p-1 self-center`)},[()=>(l(),t(()=>l().t("Suggest a change")))]),Oa(s,()=>e(ne),le=>I(ne,le)),Ie("keydown",s,le=>{le.key==="Enter"&&(M()(e(ne)),I(V,!1))}),Ie("click",_e,()=>{M()(e(ne)),I(V,!1)}),a(we,Z)},$$slots:{default:!0}}),r(te),a(b,te)}},$$legacy:!0}),Et(),L()}var Nn=m('<div class="flex flex-col justify-center -space-y-0.5"><div><!></div></div>'),Pn=m('<div class="flex flex-col justify-center -space-y-0.5"><div> </div></div>'),Bn=m('<div class="bg-gray-50 dark:bg-gray-850 flex rounded-lg py-1 px-2 items-center gap-1 text-xs"><div><!></div> <span class="line-clamp-1"> </span></div>'),Tn=m('<div class="flex flex-col justify-center -space-y-0.5"><div> </div> <div class=" flex gap-1 flex-wrap mt-2"></div></div>'),Ln=m('<div class="bg-gray-50 dark:bg-gray-850 flex rounded-lg py-1 px-2 items-center gap-1 text-xs"><div><!></div> <span class="line-clamp-1"> </span></div>'),On=m('<div class="flex flex-col justify-center -space-y-0.5"><div> </div> <div class=" flex gap-1 flex-wrap mt-2"></div></div>'),Rn=m('<div class="flex flex-col justify-center -space-y-0.5"><div><!></div></div>'),zn=m('<div class="flex flex-col justify-center -space-y-0.5"><div><!></div></div>'),jn=m('<div class="status-description flex items-center gap-2 py-0.5 w-full text-left"><!></div>');function dr(Ne,o){$t(o,!1);const l=()=>Fe(N,"$i18n",f),[f,L]=Jt(),N=Wt("i18n");let M=c(o,"status",8,null),J=c(o,"done",8,!1);St();var V=Me(),ne=re(V);{var b=B=>{var te=jn(),v=n(te);{var we=Z=>{ys(Z,{get status(){return M()},children:(ce,s)=>{var oe=Nn(),_e=n(oe),he=n(_e);{var ie=le=>{var fe=De();x(R=>j(fe,R),[()=>(l(),i(M()),t(()=>{var R,ae,d;return l().t((R=M())==null?void 0:R.description,{count:(((ae=M())==null?void 0:ae.urls)||((d=M())==null?void 0:d.items)).length})}))]),a(le,fe)},xe=le=>{var fe=Me(),R=re(fe);{var ae=g=>{var Q=De();x(D=>j(Q,D),[()=>(l(),t(()=>l().t("No search query generated")))]),a(g,Q)},d=g=>{var Q=Me(),D=re(Q);{var C=h=>{var H=De();x(_=>j(H,_),[()=>(l(),t(()=>l().t("Generating search query")))]),a(h,H)},y=h=>{var H=De();x(()=>j(H,(i(M()),t(()=>{var _;return(_=M())==null?void 0:_.description})))),a(h,H)};u(D,h=>{i(M()),t(()=>{var H;return((H=M())==null?void 0:H.description)==="Generating search query"})?h(C):h(y,!1)},!0)}a(g,Q)};u(R,g=>{i(M()),t(()=>{var Q;return((Q=M())==null?void 0:Q.description)==="No search query generated"})?g(ae):g(d,!1)},!0)}a(le,fe)};u(he,le=>{i(M()),t(()=>{var fe,R;return(R=(fe=M())==null?void 0:fe.description)==null?void 0:R.includes("{{count}}")})?le(ie):le(xe,!1)})}r(_e),r(oe),x(()=>Le(_e,1,`${i(J()),i(M()),t(()=>{var le;return(J()||((le=M())==null?void 0:le.done))===!1?"shimmer":""})??""} text-base line-clamp-1 text-wrap`)),a(ce,oe)},$$slots:{default:!0}})},A=Z=>{var ce=Me(),s=re(ce);{var oe=he=>{var ie=Pn(),xe=n(ie),le=n(xe,!0);r(xe),r(ie),x(fe=>{Le(xe,1,`${i(J()),i(M()),t(()=>{var R;return(J()||((R=M())==null?void 0:R.done))===!1?"shimmer":""})??""} text-gray-500 dark:text-gray-500 text-base line-clamp-1 text-wrap`),j(le,fe)},[()=>(l(),i(M()),t(()=>l().t('Searching Knowledge for "{{searchQuery}}"',{searchQuery:M().query})))]),a(he,ie)},_e=he=>{var ie=Me(),xe=re(ie);{var le=R=>{var ae=Tn(),d=n(ae),g=n(d,!0);r(d);var Q=E(d,2);pt(Q,7,()=>(i(M()),t(()=>M().queries)),D=>D,(D,C)=>{var y=Bn(),h=n(y),H=n(h);Za(H,{className:"size-3"}),r(h);var _=E(h,2),w=n(_,!0);r(_),r(y),x(()=>j(w,e(C))),a(D,y)}),r(Q),r(ae),x(D=>{Le(d,1,`${i(J()),i(M()),t(()=>{var C;return(J()||((C=M())==null?void 0:C.done))===!1?"shimmer":""})??""} text-gray-500 dark:text-gray-500 text-base line-clamp-1 text-wrap`),j(g,D)},[()=>(l(),t(()=>l().t("Searching")))]),a(R,ae)},fe=R=>{var ae=Me(),d=re(ae);{var g=D=>{var C=On(),y=n(C),h=n(y,!0);r(y);var H=E(y,2);pt(H,7,()=>(i(M()),t(()=>M().queries)),_=>_,(_,w)=>{var p=Ln(),O=n(p),z=n(O);Za(z,{className:"size-3"}),r(O);var K=E(O,2),U=n(K,!0);r(K),r(p),x(()=>j(U,e(w))),a(_,p)}),r(H),r(C),x(_=>{Le(y,1,`${i(J()),i(M()),t(()=>{var w;return(J()||((w=M())==null?void 0:w.done))===!1?"shimmer":""})??""} text-gray-500 dark:text-gray-500 text-base line-clamp-1 text-wrap`),j(h,_)},[()=>(l(),t(()=>l().t("Querying")))]),a(D,C)},Q=D=>{var C=Me(),y=re(C);{var h=_=>{var w=Rn(),p=n(w),O=n(p);{var z=U=>{var se=De();x(T=>j(se,T),[()=>(l(),t(()=>l().t("No sources found")))]),a(U,se)},K=U=>{var se=Me(),T=re(se);{var F=X=>{var Y=De();x(ue=>j(Y,ue),[()=>(l(),t(()=>l().t("Retrieved 1 source")))]),a(X,Y)},$=X=>{var Y=De();x(ue=>j(Y,ue),[()=>(l(),i(M()),t(()=>l().t("Retrieved {{count}} sources",{count:M().count})))]),a(X,Y)};u(T,X=>{i(M()),t(()=>M().count===1)?X(F):X($,!1)},!0)}a(U,se)};u(O,U=>{i(M()),t(()=>M().count===0)?U(z):U(K,!1)})}r(p),r(w),x(()=>Le(p,1,`${i(J()),i(M()),t(()=>{var U;return(J()||((U=M())==null?void 0:U.done))===!1?"shimmer":""})??""} text-gray-500 dark:text-gray-500 text-base line-clamp-1 text-wrap`)),a(_,w)},H=_=>{var w=zn(),p=n(w),O=n(p);{var z=U=>{var se=De();x(T=>j(se,T),[()=>(l(),i(M()),t(()=>{var T,F;return l().t((T=M())==null?void 0:T.description,{searchQuery:(F=M())==null?void 0:F.query})}))]),a(U,se)},K=U=>{var se=Me(),T=re(se);{var F=X=>{var Y=De();x(ue=>j(Y,ue),[()=>(l(),t(()=>l().t("No search query generated")))]),a(X,Y)},$=X=>{var Y=Me(),ue=re(Y);{var S=k=>{var q=De();x(W=>j(q,W),[()=>(l(),t(()=>l().t("Generating search query")))]),a(k,q)},P=k=>{var q=Me(),W=re(q);{var ge=$e=>{var pe=De();x(Ee=>j(pe,Ee),[()=>(l(),t(()=>l().t("Searching the web")))]),a($e,pe)},me=$e=>{var pe=De();x(()=>j(pe,(i(M()),t(()=>{var Ee;return(Ee=M())==null?void 0:Ee.description})))),a($e,pe)};u(W,$e=>{i(M()),t(()=>{var pe;return((pe=M())==null?void 0:pe.description)==="Searching the web"})?$e(ge):$e(me,!1)},!0)}a(k,q)};u(ue,k=>{i(M()),t(()=>{var q;return((q=M())==null?void 0:q.description)==="Generating search query"})?k(S):k(P,!1)},!0)}a(X,Y)};u(T,X=>{i(M()),t(()=>{var Y;return((Y=M())==null?void 0:Y.description)==="No search query generated"})?X(F):X($,!1)},!0)}a(U,se)};u(O,U=>{i(M()),t(()=>{var se,T;return(T=(se=M())==null?void 0:se.description)==null?void 0:T.includes("{{searchQuery}}")})?U(z):U(K,!1)})}r(p),r(w),x(()=>Le(p,1,`${i(J()),i(M()),t(()=>{var U;return(J()||((U=M())==null?void 0:U.done))===!1?"shimmer":""})??""} text-gray-500 dark:text-gray-500 text-base line-clamp-1 text-wrap`)),a(_,w)};u(y,_=>{i(M()),t(()=>{var w,p;return((w=M())==null?void 0:w.action)==="sources_retrieved"&&((p=M())==null?void 0:p.count)!==void 0})?_(h):_(H,!1)},!0)}a(D,C)};u(d,D=>{i(M()),t(()=>{var C,y;return((C=M())==null?void 0:C.action)==="queries_generated"&&((y=M())==null?void 0:y.queries)})?D(g):D(Q,!1)},!0)}a(R,ae)};u(xe,R=>{i(M()),t(()=>{var ae,d;return((ae=M())==null?void 0:ae.action)==="web_search_queries_generated"&&((d=M())==null?void 0:d.queries)})?R(le):R(fe,!1)},!0)}a(he,ie)};u(s,he=>{i(M()),t(()=>{var ie;return((ie=M())==null?void 0:ie.action)==="knowledge_search"})?he(oe):he(_e,!1)},!0)}a(Z,ce)};u(v,Z=>{i(M()),t(()=>{var ce,s,oe;return((ce=M())==null?void 0:ce.action)==="web_search"&&(((s=M())==null?void 0:s.urls)||((oe=M())==null?void 0:oe.items))})?Z(we):Z(A,!1)})}r(te),a(B,te)};u(ne,B=>{i(M()),t(()=>{var te;return!((te=M())!=null&&te.hidden)})&&B(b)})}a(Ne,V),Et(),L()}var An=m('<div class="w-[0.5px] ml-[6.5px] h-[calc(100%-14px)] bg-gray-300 dark:bg-gray-700"></div>'),Hn=m('<div class="flex items-stretch gap-2 mb-1"><div class=" "><div class="pt-3 px-1 mb-1.5"><span class="relative flex size-1.5 rounded-full justify-center items-center"><span class="relative inline-flex size-1.5 rounded-full bg-gray-500 dark:bg-gray-400"></span></span></div> <!></div> <!></div>'),qn=m('<div class="w-full"></div>'),Wn=m('<div class="flex flex-row"><!></div>'),Dn=m('<div class="text-sm flex flex-col w-full"><button class="w-full"><div class="flex items-start gap-2"><!></div></button> <!></div>');function Fn(Ne,o){$t(o,!1),Wt("i18n");let l=c(o,"statusHistory",24,()=>[]),f=c(o,"expand",8,!1),L=Se(!0),N=Se([]),M=Se(null);It(()=>i(f()),()=>{f()?I(L,!0):I(L,!1)}),It(()=>(i(l()),e(N)),()=>{JSON.stringify(l())!==JSON.stringify(e(N))&&I(N,l())}),It(()=>e(N),()=>{e(N)&&e(N).length>0&&I(M,e(N).at(-1))}),ta(),St();var J=Me(),V=re(J);{var ne=b=>{var B=Me(),te=re(B);{var v=we=>{var A=Dn(),Z=n(A),ce=n(Z),s=n(ce);dr(s,{get status(){return e(M)}}),r(ce),r(Z);var oe=E(Z,2);{var _e=he=>{var ie=Wn(),xe=n(ie);{var le=fe=>{var R=qn();pt(R,5,()=>e(N),zt,(ae,d,g,Q)=>{var D=Hn(),C=n(D),y=E(n(C),2);{var h=_=>{var w=An();a(_,w)};u(y,_=>{e(N),t(()=>g!==e(N).length-1)&&_(h)})}r(C);var H=E(C,2);dr(H,{get status(){return e(d)},done:!0}),r(D),a(ae,D)}),r(R),a(fe,R)};u(xe,fe=>{e(N),t(()=>e(N).length>1)&&fe(le)})}r(ie),a(he,ie)};u(oe,he=>{e(L)&&he(_e)})}r(A),Ie("click",Z,()=>{I(L,!e(L))}),a(we,A)};u(te,we=>{e(M),t(()=>{var A;return((A=e(M))==null?void 0:A.hidden)!==!0})&&we(v)})}a(b,B)};u(V,b=>{e(N),t(()=>e(N)&&e(N).length>0)&&b(ne)})}a(Ne,J),Et()}var Un=m('<span id="response-message-model-name" class="line-clamp-1 text-black dark:text-white"> </span>'),Jn=m('<span class="line-clamp-1"> </span>'),Vn=m("<div><!></div>"),Zn=m("<!> <!>",1),Qn=m("<div><!></div>"),Kn=m('<div class="my-1 w-full flex overflow-x-auto gap-2 flex-wrap"></div>'),Gn=m('<div class="my-2 w-full"><!></div>'),Yn=m('<div class="my-1 w-full flex overflow-x-auto gap-2 flex-wrap"></div>'),Xn=m('<div class="w-full bg-gray-50 dark:bg-gray-800 rounded-3xl px-5 py-3 my-2"><textarea class=" bg-transparent outline-hidden w-full resize-none"></textarea> <div class=" mt-2 mb-1 flex justify-between text-sm font-medium"><div><button id="save-new-message-button" class="px-3.5 py-1.5 bg-gray-50 hover:bg-gray-100 dark:bg-gray-800 dark:hover:bg-gray-700 border border-gray-100 dark:border-gray-700 text-gray-700 dark:text-gray-200 transition rounded-3xl"> </button></div> <div class="flex space-x-1.5"><button id="close-edit-message-button" class="px-3.5 py-1.5 bg-white dark:bg-gray-900 hover:bg-gray-100 text-gray-800 dark:text-gray-100 transition rounded-3xl"> </button> <button id="confirm-edit-message-button" class="px-3.5 py-1.5 bg-gray-900 dark:bg-white hover:bg-gray-850 text-gray-100 dark:text-gray-800 transition rounded-3xl"> </button></div></div></div>'),eo=m('<div class="text-sm flex justify-center font-semibold self-center dark:text-gray-100 min-w-fit"><input type="number" min="1" class="bg-transparent font-semibold self-center dark:text-gray-100 min-w-fit outline-hidden"/> </div>'),to=m('<div class="text-sm tracking-widest font-semibold self-center dark:text-gray-100 min-w-fit"> </div>'),ao=m('<div class="flex self-center min-w-fit" dir="ltr"><button class="self-center p-1 hover:bg-black/5 dark:hover:bg-white/5 dark:hover:text-white hover:text-black rounded-md transition"><svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5" class="size-3.5"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 19.5 8.25 12l7.5-7.5"></path></svg></button> <!> <button class="self-center p-1 hover:bg-black/5 dark:hover:bg-white/5 dark:hover:text-white hover:text-black rounded-md transition"><svg xmlns="http://www.w3.org/2000/svg" fill="none" aria-hidden="true" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5" class="size-3.5"><path stroke-linecap="round" stroke-linejoin="round" d="m8.25 4.5 7.5 7.5-7.5 7.5"></path></svg></button></div>'),ro=m('<button><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2.3" aria-hidden="true" stroke="currentColor" class="w-4 h-4"><path stroke-linecap="round" stroke-linejoin="round" d="M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L6.832 19.82a4.5 4.5 0 01-1.897 1.13l-2.685.8.8-2.685a4.5 4.5 0 011.13-1.897L16.863 4.487zm0 0L19.5 7.125"></path></svg></button>'),so=m('<button><svg xmlns="http://www.w3.org/2000/svg" fill="none" aria-hidden="true" viewBox="0 0 24 24" stroke-width="2.3" stroke="currentColor" class="w-4 h-4"><path stroke-linecap="round" stroke-linejoin="round" d="M15.666 3.888A2.25 2.25 0 0013.5 2.25h-3c-1.03 0-1.9.693-2.166 1.638m7.332 0c.055.194.084.4.084.612v0a.75.75 0 01-.75.75H9a.75.75 0 01-.75-.75v0c0-.212.03-.418.084-.612m7.332 0c.646.049 1.288.11 1.927.184 1.1.128 1.907 1.077 1.907 2.185V19.5a2.25 2.25 0 01-2.25 2.25H6.75A2.25 2.25 0 014.5 19.5V6.257c0-1.108.806-2.057 1.907-2.185a48.208 48.208 0 011.927-.184"></path></svg></button>'),no=$a(`<svg class=" w-4 h-4" fill="currentColor" viewBox="0 0 24 24" aria-hidden="true" xmlns="http://www.w3.org/2000/svg"><style>.spinner_S1WN {
															animation: spinner_MGfb 0.8s linear infinite;
															animation-delay: -0.8s;
														}

														.spinner_Km9P {
															animation-delay: -0.65s;
														}

														.spinner_JApP {
															animation-delay: -0.5s;
														}

														@keyframes spinner_MGfb {
															93.75%,
															100% {
																opacity: 0.2;
															}
														}</style><circle class="spinner_S1WN" cx="4" cy="12" r="3"></circle><circle class="spinner_S1WN spinner_Km9P" cx="12" cy="12" r="3"></circle><circle class="spinner_S1WN spinner_JApP" cx="20" cy="12" r="3"></circle></svg>`),oo=$a('<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" aria-hidden="true" stroke-width="2.3" stroke="currentColor" class="w-4 h-4"><path stroke-linecap="round" stroke-linejoin="round" d="M17.25 9.75 19.5 12m0 0 2.25 2.25M19.5 12l2.25-2.25M19.5 12l-2.25 2.25m-10.5-6 4.72-4.72a.75.75 0 0 1 1.28.53v15.88a.75.75 0 0 1-1.28.53l-4.72-4.72H4.51c-.88 0-1.704-.507-1.938-1.354A9.009 9.009 0 0 1 2.25 12c0-.83.112-1.633.322-2.396C2.806 8.756 3.63 8.25 4.51 8.25H6.75Z"></path></svg>'),io=$a('<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" aria-hidden="true" stroke-width="2.3" stroke="currentColor" class="w-4 h-4"><path stroke-linecap="round" stroke-linejoin="round" d="M19.114 5.636a9 9 0 010 12.728M16.463 8.288a5.25 5.25 0 010 7.424M6.75 8.25l4.72-4.72a.75.75 0 011.28.53v15.88a.75.75 0 01-1.28.53l-4.72-4.72H4.51c-.88 0-1.704-.507-1.938-1.354A9.01 9.01 0 012.25 12c0-.83.112-1.633.322-2.396C2.806 8.756 3.63 8.25 4.51 8.25H6.75z"></path></svg>'),lo=m("<button><!></button>"),vo=m('<button aria-hidden="true"><svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2.3" stroke="currentColor" class="w-4 h-4"><path stroke-linecap="round" stroke-linejoin="round" d="M11.25 11.25l.041-.02a.75.75 0 011.063.852l-.708 2.836a.75.75 0 001.063.853l.041-.021M21 12a9 9 0 11-18 0 9 9 0 0118 0zm-9-3.75h.008v.008H12V8.25z"></path></svg></button>'),co=m('<button><svg aria-hidden="true" stroke="currentColor" fill="none" stroke-width="2.3" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" class="w-4 h-4" xmlns="http://www.w3.org/2000/svg"><path d="M14 9V5a3 3 0 0 0-3-3l-4 9v11h11.28a2 2 0 0 0 2-1.7l1.38-9a2 2 0 0 0-2-2.3zM7 22H4a2 2 0 0 1-2-2v-7a2 2 0 0 1 2-2h3"></path></svg></button>'),go=m('<button><svg aria-hidden="true" stroke="currentColor" fill="none" stroke-width="2.3" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" class="w-4 h-4" xmlns="http://www.w3.org/2000/svg"><path d="M10 15v4a3 3 0 0 0 3 3l4-9V2H5.72a2 2 0 0 0-2 1.7l-1.38 9a2 2 0 0 0 2 2.3zm7-13h2.67A2.31 2.31 0 0 1 22 4v7a2.31 2.31 0 0 1-2.33 2H17"></path></svg></button>'),uo=m("<!> <!>",1),fo=m('<button type="button" id="continue-response-button"><svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2.3" stroke="currentColor" class="w-4 h-4"><path stroke-linecap="round" stroke-linejoin="round" d="M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"></path><path stroke-linecap="round" stroke-linejoin="round" d="M15.91 11.672a.375.375 0 0 1 0 .656l-5.603 3.113a.375.375 0 0 1-.557-.328V8.887c0-.286.307-.466.557-.327l5.603 3.112Z"></path></svg></button>'),mo=m('<div><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2.3" aria-hidden="true" stroke="currentColor" class="w-4 h-4"><path stroke-linecap="round" stroke-linejoin="round" d="M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0l3.181 3.183a8.25 8.25 0 0013.803-3.7M4.031 9.865a8.25 8.25 0 0113.803-3.7l3.181 3.182m0-4.991v4.99"></path></svg></div>'),ho=m('<button type="button" class="hidden regenerate-response-button"></button> <!>',1),_o=m('<button type="button"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2.3" aria-hidden="true" stroke="currentColor" class="w-4 h-4"><path stroke-linecap="round" stroke-linejoin="round" d="M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0l3.181 3.183a8.25 8.25 0 0013.803-3.7M4.031 9.865a8.25 8.25 0 0113.803-3.7l3.181 3.182m0-4.991v4.99"></path></svg></button>'),po=m('<button type="button" id="delete-response-button"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" aria-hidden="true" class="w-4 h-4"><path stroke-linecap="round" stroke-linejoin="round" d="m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0"></path></svg></button>'),xo=m('<div class="size-4"><img style="fill: currentColor;"/></div>'),bo=m('<button type="button"><!></button>'),wo=m("<!> <!> <!> <!> <!>",1),yo=m("<!> <!> <!> <!> <!>",1),ko=m("<!> <!>",1),Mo=m('<div class="mt-2.5"><!></div>'),Io=m('<div class="flex justify-start overflow-x-auto buttons text-gray-600 dark:text-gray-500 mt-0.5 svelte-1qscqw6"><!></div> <!> <!>',1),Co=m('<div><div><!></div> <div class="flex-auto w-0 pl-1 relative"><!> <div><div><div><!> <!> <!> <!> <div id="response-content-container"><!> <!> <!> <!></div></div></div> <!></div></div></div>'),$o=m("<!> <!>",1);function Qa(Ne,o){$t(o,!1);const l=()=>Fe(La,"$models",b),f=()=>Fe(ur,"$config",b),L=()=>Fe(fa,"$settings",b),N=()=>Fe(te,"$i18n",b),M=()=>Fe(rr,"$audioQueue",b),J=()=>Fe(sr,"$TTSWorker",b),V=()=>Fe(ja,"$user",b),ne=()=>Fe(Ya,"$temporaryChatEnabled",b),[b,B]=Jt(),te=Wt("i18n"),v=Ba();let we=c(o,"chatId",8,""),A=c(o,"history",12),Z=c(o,"messageId",8),ce=c(o,"selectedModels",24,()=>[]),s=Se(JSON.parse(JSON.stringify(A().messages[Z()]))),oe=c(o,"siblings",8),_e=c(o,"setInputText",8,()=>{}),he=c(o,"gotoMessage",8,()=>{}),ie=c(o,"showPreviousMessage",8),xe=c(o,"showNextMessage",8),le=c(o,"updateChat",8),fe=c(o,"editMessage",8),R=c(o,"saveMessage",8);c(o,"rateMessage",8);let ae=c(o,"actionMessage",8),d=c(o,"deleteMessage",8),g=c(o,"submitMessage",8),Q=c(o,"continueResponse",8),D=c(o,"regenerateResponse",8),C=c(o,"addMessages",8),y=c(o,"isLastMessage",8,!0),h=c(o,"readOnly",8,!1),H=c(o,"editCodeBlock",8,!0),_=c(o,"topPadding",8,!1),w=Se(),p=Se(),O=Se(),z=Se(!1),K=Se(null),U=Se(!1),se=Se(""),T=Se(),F=Se(!1),$=Se(!1),X=Se(!1),Y=Se(!1);const ue=async ee=>{var ve,Be,je,et,kt;ee=or(ee),(((Be=(ve=f())==null?void 0:ve.ui)==null?void 0:Be.response_watermark)??"").trim()!==""&&(ee=`${ee}

${(et=(je=f())==null?void 0:je.ui)==null?void 0:et.response_watermark}`),await fr(ee,null,((kt=L())==null?void 0:kt.copyFormatted)??!1)&&qt.success(N().t("Copying to clipboard was successful!"))},S=()=>{try{speechSynthesis.cancel(),M().stop()}catch{}e($)&&I($,!1)},P=async()=>{var ve,Be,je,et,kt,Ke,Je,Ue,Ye,Ze,jt;if(!(((ve=e(s))==null?void 0:ve.content)??"").trim().length){qt.info(N().t("No content to speak"));return}I($,!0);const ee=or(e(s).content),de=()=>{var qe,ct,ht,Nt,it,Mt,Vt,Xt,ea,aa,ra,ca,pa,xa,sa,ia;return(Nt=(ht=(ct=(qe=e(K))==null?void 0:qe.info)==null?void 0:ct.meta)==null?void 0:ht.tts)!=null&&Nt.voice?e(K).info.meta.tts.voice:((Vt=(Mt=(it=L())==null?void 0:it.audio)==null?void 0:Mt.tts)==null?void 0:Vt.defaultVoice)===f().audio.tts.voice?((aa=(ea=(Xt=L())==null?void 0:Xt.audio)==null?void 0:ea.tts)==null?void 0:aa.voice)??((pa=(ca=(ra=f())==null?void 0:ra.audio)==null?void 0:ca.tts)==null?void 0:pa.voice):(ia=(sa=(xa=f())==null?void 0:xa.audio)==null?void 0:sa.tts)==null?void 0:ia.voice};if(f().audio.tts.engine===""){let qe=[];const ct=setInterval(()=>{var ht,Nt,it;if(qe=speechSynthesis.getVoices(),qe.length>0){clearInterval(ct);const Mt=de(),Vt=((ht=qe==null?void 0:qe.filter(ea=>ea.voiceURI===Mt))==null?void 0:ht.at(0))??void 0,Xt=new SpeechSynthesisUtterance(ee);Xt.rate=((it=(Nt=L().audio)==null?void 0:Nt.tts)==null?void 0:it.playbackRate)??1,Xt.onend=()=>{var ea;I($,!1),L().conversationMode&&((ea=document.getElementById("voice-input-button"))==null||ea.click())},Vt&&(Xt.voice=Vt),speechSynthesis.speak(Xt)}},100)}else{M().setId(`${e(s).id}`),M().setPlaybackRate(((je=(Be=L().audio)==null?void 0:Be.tts)==null?void 0:je.playbackRate)??1),Cr(rr,t(M).onStopped=()=>{I($,!1)},t(M)),I(X,!0);const qe=zr(ee,((Ke=(kt=(et=f())==null?void 0:et.audio)==null?void 0:kt.tts)==null?void 0:Ke.split_on)??"punctuation");if(!qe.length){qt.info(N().t("No content to speak")),I($,!1),I(X,!1);return}const ct=de();if(((Ue=(Je=L().audio)==null?void 0:Je.tts)==null?void 0:Ue.engine)==="browser-kokoro"){J()||(await sr.set(new fn({dtype:((jt=(Ze=(Ye=L().audio)==null?void 0:Ye.tts)==null?void 0:Ze.engineConfig)==null?void 0:jt.dtype)??"fp32"})),await J().init());for(const[ht,Nt]of qe.entries()){const it=await J().generate({text:Nt,voice:ct}).catch(Mt=>{qt.error(`${Mt}`),I($,!1),I(X,!1)});it&&e($)&&(M().enqueue(it),I(X,!1))}}else for(const[ht,Nt]of qe.entries()){const it=await Hr(localStorage.token,ct,Nt).catch(Mt=>{qt.error(`${Mt}`),I($,!1),I(X,!1)});if(it&&e($)){const Mt=await it.blob(),Vt=URL.createObjectURL(Mt);M().enqueue(Vt),I(X,!1)}}}};let k=[];function q(ee){const de=[];let ve=0;return ee=ee.replace(/<details[\s\S]*?<\/details>/gi,Be=>(de.push(Be),`<details id="__DETAIL_${ve++}__"/>`)),k=de,ee}function W(ee){return ee.replace(/<details id="__DETAIL_(\d+)__"\/>/g,(ve,Be)=>k[parseInt(Be)]||"")}const ge=async()=>{I(U,!0),I(se,q(e(s).content)),await rt(),da(T,e(T).style.height=""),da(T,e(T).style.height=`${e(T).scrollHeight}px`)},me=async()=>{const ee=W(e(se)?e(se):"");fe()(e(s).id,{content:ee},!1),I(U,!1),I(se,""),await rt()},$e=async()=>{const ee=W(e(se)?e(se):"");fe()(e(s).id,{content:ee}),I(U,!1),I(se,""),await rt()},pe=async()=>{I(U,!1),I(se,""),await rt()};let Ee=Se(!1);const ze=async(ee=null,de=null)=>{var Je,Ue,Ye,Ze,jt;I(Ee,!0);const ve={...e(s),annotation:{...((Je=e(s))==null?void 0:Je.annotation)??{},...ee!==null?{rating:ee}:{},...de||{}}},Be=await Lr(localStorage.token,we()).catch(qe=>{qt.error(`${qe}`)});if(!Be)return;const je=Ua(A(),e(s).id);let et={type:"rating",data:{...ve!=null&&ve.annotation?ve.annotation:{},model_id:((Ue=e(s))==null?void 0:Ue.selectedModelId)??e(s).model,...A().messages[e(s).parentId].childrenIds.length>1?{sibling_model_ids:A().messages[e(s).parentId].childrenIds.filter(qe=>qe!==e(s).id).map(qe=>{var ct;return((ct=A().messages[qe])==null?void 0:ct.selectedModelId)??A().messages[qe].model})}:{}},meta:{arena:e(s)?e(s).arena:!1,model_id:e(s).model,message_id:e(s).id,message_index:je.length,chat_id:we()},snapshot:{chat:Be}};const kt=[et.data.model_id,...et.data.sibling_model_ids??[]].reduce((qe,ct)=>{var Nt;const ht=l().find(it=>it.id===ct);return ht?qe[ht.id]=((Nt=ht==null?void 0:ht.info)==null?void 0:Nt.base_model_id)??null:console.warn(`Model with ID ${ct} not found`),qe},{});et.meta.base_models=kt;let Ke=null;if((Ye=e(s))!=null&&Ye.feedbackId?Ke=await lr(localStorage.token,e(s).feedbackId,et).catch(qe=>{qt.error(`${qe}`)}):(Ke=await jr(localStorage.token,et).catch(qe=>{qt.error(`${qe}`)}),Ke&&(ve.feedbackId=Ke.id)),R()(e(s).id,ve),await rt(),!de&&(I(Y,!0),!((Ze=ve.annotation)!=null&&Ze.tags)&&(((jt=e(s))==null?void 0:jt.content)??"")!=="")){const qe=await Ar(localStorage.token,e(s).model,je,we()).catch(ct=>[]);qe&&(ve.annotation.tags=qe,et.data.tags=qe,R()(e(s).id,ve),await lr(localStorage.token,ve.feedbackId,et).catch(ct=>{qt.error(`${ct}`)}))}I(Ee,!1)},Qe=async()=>{d()(e(s).id)},He=ee=>{if(e(O)){if(e(O).scrollWidth<=e(O).clientWidth)return;ee.preventDefault(),ee.deltaY!==0&&da(O,e(O).scrollLeft+=ee.deltaY)}},be=ee=>{if(e(p)){ee.preventDefault();const de=window.getSelection(),ve=de.getRangeAt(0),Be=document.createElement("div");Be.appendChild(ve.cloneContents()),Be.querySelectorAll("table").forEach(je=>{je.style.borderCollapse="collapse",je.style.width="auto",je.style.tableLayout="auto"}),Be.querySelectorAll("th").forEach(je=>{je.style.whiteSpace="nowrap",je.style.padding="4px 8px"}),ee.clipboardData.setData("text/html",Be.innerHTML),ee.clipboardData.setData("text/plain",de.toString())}};Ca(async()=>{await rt(),e(O)&&e(O).addEventListener("wheel",He),e(p)&&e(p).addEventListener("copy",be)}),Ga(()=>{e(O)&&e(O).removeEventListener("wheel",He),e(p)&&e(p).removeEventListener("copy",be)}),It(()=>(i(A()),e(s),i(Z())),()=>{A().messages&&JSON.stringify(e(s))!==JSON.stringify(A().messages[Z()])&&I(s,JSON.parse(JSON.stringify(A().messages[Z()])))}),It(()=>(l(),e(s)),()=>{I(K,l().find(ee=>ee.id===e(s).model))}),It(()=>(e(U),rt),()=>{e(U)||(async()=>await rt())()}),ta(),St();var G=$o(),Ce=re(G);{let ee=ye(()=>(N(),t(()=>N().t("Delete message?"))));_r(Ce,{get title(){return e(ee)},get show(){return e(z)},set show(de){I(z,de)},$$events:{confirm:()=>{Qe()}},$$legacy:!0})}var ke=E(Ce,2);Ia(ke,()=>(e(s),t(()=>e(s).id)),ee=>{var de=Co(),ve=n(de);Le(ve,1,"shrink-0 ltr:mr-3 rtl:ml-3 hidden @lg:flex mt-1 ","svelte-1qscqw6");var Be=n(ve);{let Ae=ye(()=>(i(Yt),e(K),N(),t(()=>{var Oe;return`${Yt}/models/model/profile/image?id=${(Oe=e(K))==null?void 0:Oe.id}&lang=${N().language}`})));hr(Be,{get src(){return e(Ae)},className:"size-8 assistant-message-profile-image"})}r(ve);var je=E(ve,2),et=n(je);Xa(et,{children:(Ae,Oe)=>{var We=Zn(),Te=re(We);{let xt=ye(()=>(e(K),e(s),t(()=>{var ft;return((ft=e(K))==null?void 0:ft.name)??e(s).model})));_t(Te,{get content(){return e(xt)},placement:"top-start",children:(ft,st)=>{var Ve=Un(),Re=n(Ve,!0);r(Ve),x(()=>j(Re,(e(K),e(s),t(()=>{var lt;return((lt=e(K))==null?void 0:lt.name)??e(s).model})))),a(ft,Ve)},$$slots:{default:!0}})}var Xe=E(Te,2);{var gt=xt=>{var ft=Vn(),st=n(ft);{let Ve=ye(()=>(i(Rt),e(s),t(()=>Rt(e(s).timestamp*1e3).format("LLLL"))));_t(st,{get content(){return e(Ve)},children:(Re,lt)=>{var dt=Jn(),Ct=n(dt,!0);r(dt),x(Dt=>j(Ct,Dt),[()=>(N(),i(ka),e(s),i(Rt),t(()=>N().t(ka(e(s).timestamp*1e3),{LOCALIZED_TIME:Rt(e(s).timestamp*1e3).format("LT"),LOCALIZED_DATE:Rt(e(s).timestamp*1e3).format("L")})))]),a(Re,dt)},$$slots:{default:!0}})}r(ft),x(()=>Le(ft,1,`self-center text-xs font-medium first-letter:capitalize ml-0.5 translate-y-[1px] ${L(),t(()=>{var Ve;return((Ve=L())==null?void 0:Ve.highContrastMode)??!1?"dark:text-gray-100 text-gray-900":"invisible group-hover:visible transition text-gray-400"})??""}`)),a(xt,ft)};u(Xe,xt=>{e(s),t(()=>e(s).timestamp)&&xt(gt)})}a(Ae,We)},$$slots:{default:!0}});var kt=E(et,2),Ke=n(kt),Je=n(Ke),Ue=n(Je);{var Ye=Ae=>{{let Oe=ye(()=>(e(s),t(()=>{var We;return(We=e(s))==null?void 0:We.statusHistory})));Fn(Ae,{get statusHistory(){return e(Oe)}})}};u(Ue,Ae=>{e(K),t(()=>{var Oe,We,Te,Xe;return((Xe=(Te=(We=(Oe=e(K))==null?void 0:Oe.info)==null?void 0:We.meta)==null?void 0:Te.capabilities)==null?void 0:Xe.status_updates)??!0})&&Ae(Ye)})}var Ze=E(Ue,2);{var jt=Ae=>{var Oe=Kn();pt(Oe,5,()=>(e(s),t(()=>e(s).files)),zt,(We,Te)=>{var Xe=Qn(),gt=n(Xe);{var xt=st=>{Ja(st,{get src(){return e(Te),t(()=>e(Te).url)},get alt(){return e(s),t(()=>e(s).content)}})},ft=st=>{{let Ve=ye(()=>(e(Te),t(()=>{var Re;return(Re=e(Te))==null?void 0:Re.size})));Va(st,{get item(){return e(Te)},get url(){return e(Te),t(()=>e(Te).url)},get name(){return e(Te),t(()=>e(Te).name)},get type(){return e(Te),t(()=>e(Te).type)},get size(){return e(Ve)},small:!0})}};u(gt,st=>{e(Te),t(()=>{var Ve;return e(Te).type==="image"||(((Ve=e(Te))==null?void 0:Ve.content_type)??"").startsWith("image/")})?st(xt):st(ft,!1)})}r(Xe),a(We,Xe)}),r(Oe),x(()=>{Pe(Oe,"dir",(L(),t(()=>{var We;return((We=L())==null?void 0:We.chatDirection)??"auto"}))),Oe.dir=Oe.dir}),a(Ae,Oe)};u(Ze,Ae=>{e(s),t(()=>{var Oe,We;return((Oe=e(s))==null?void 0:Oe.files)&&((We=e(s).files)==null?void 0:We.filter(Te=>Te.type==="image").length)>0})&&Ae(jt)})}var qe=E(Ze,2);{var ct=Ae=>{var Oe=Yn();pt(Oe,5,()=>(e(s),t(()=>e(s).embeds)),zt,(We,Te,Xe)=>{var gt=Gn(),xt=n(gt);{let ft=ye(()=>(L(),t(()=>{var st;return((st=L())==null?void 0:st.iframeSandboxAllowSameOrigin)??!1})));Jr(xt,{get src(){return e(Te)},allowScripts:!0,allowForms:!0,get allowSameOrigin(){return e(ft)},allowPopups:!0})}r(gt),x(()=>Pe(gt,"id",(e(s),t(()=>`${e(s).id}-embeds-${Xe}`)))),a(We,gt)}),r(Oe),a(Ae,Oe)};u(qe,Ae=>{e(s),t(()=>{var Oe;return((Oe=e(s))==null?void 0:Oe.embeds)&&e(s).embeds.length>0})&&Ae(ct)})}var ht=E(qe,2);{var Nt=Ae=>{var Oe=Xn(),We=n(Oe);Ka(We),_a(We,dt=>I(T,dt),()=>e(T));var Te=E(We,2),Xe=n(Te),gt=n(Xe),xt=n(gt,!0);r(gt),r(Xe);var ft=E(Xe,2),st=n(ft),Ve=n(st,!0);r(st);var Re=E(st,2),lt=n(Re,!0);r(Re),r(ft),r(Te),r(Oe),x((dt,Ct,Dt)=>{Pe(We,"id",`message-edit-${e(s),t(()=>e(s).id)??""}`),j(xt,dt),j(Ve,Ct),j(lt,Dt)},[()=>(N(),t(()=>N().t("Save As Copy"))),()=>(N(),t(()=>N().t("Cancel"))),()=>(N(),t(()=>N().t("Save")))]),Oa(We,()=>e(se),dt=>I(se,dt)),Ie("input",We,dt=>{dt.target.style.height="",dt.target.style.height=`${dt.target.scrollHeight}px`}),Ie("keydown",We,dt=>{var Ht,Qt;dt.key==="Escape"&&((Ht=document.getElementById("close-edit-message-button"))==null||Ht.click());const Ct=dt.metaKey||dt.ctrlKey,Dt=dt.key==="Enter";Ct&&Dt&&((Qt=document.getElementById("confirm-edit-message-button"))==null||Qt.click())}),Ie("click",gt,()=>{$e()}),Ie("click",st,()=>{pe()}),Ie("click",Re,()=>{me()}),a(Ae,Oe)};u(ht,Ae=>{e(U)===!0&&Ae(Nt)})}var it=E(ht,2),Mt=n(it);{var Vt=Ae=>{er(Ae,{})},Xt=Ae=>{var Oe=Me(),We=re(Oe);{var Te=Xe=>{{let gt=ye(()=>(i(we()),e(s),t(()=>`${we()}-${e(s).id}`))),xt=ye(()=>(e(s),i(h()),L(),t(()=>{var Re,lt;return((Re=e(s))==null?void 0:Re.done)&&!h()&&(((lt=L())==null?void 0:lt.showFloatingActionButtons)??!0)}))),ft=ye(()=>!h()),st=ye(()=>!h()),Ve=ye(()=>(L(),e(s),t(()=>{var Re,lt;return((Re=L())==null?void 0:Re.chatFadeStreamingText)??!0?((lt=e(s))==null?void 0:lt.done)??!1:!0})));gn(Xe,{get id(){return e(gt)},get messageId(){return e(s),t(()=>e(s).id)},get history(){return A()},get selectedModels(){return ce()},get content(){return e(s),t(()=>e(s).content)},get sources(){return e(s),t(()=>e(s).sources)},get floatingButtons(){return e(xt)},get save(){return e(ft)},get preview(){return e(st)},get editCodeBlock(){return H()},get topPadding(){return _()},get done(){return e(Ve)},get model(){return e(K)},onTaskClick:async Re=>{},onSourceClick:async Re=>{var lt;e(w)&&((lt=e(w))==null||lt.showSourceModal(Re))},onAddMessages:({modelId:Re,parentId:lt,messages:dt})=>{C()({modelId:Re,parentId:lt,messages:dt})},onSave:({raw:Re,oldContent:lt,newContent:dt})=>{A(A().messages[e(s).id].content=A().messages[e(s).id].content.replace(Re,Re.replace(lt,dt)),!0),le()()}})}};u(We,Xe=>{e(s),t(()=>e(s).content&&e(s).error!==!0)&&Xe(Te)},!0)}a(Ae,Oe)};u(Mt,Ae=>{e(s),e(K),t(()=>{var Oe,We,Te,Xe,gt,xt,ft,st,Ve,Re;return e(s).content===""&&!e(s).error&&(((Xe=(Te=(We=(Oe=e(K))==null?void 0:Oe.info)==null?void 0:We.meta)==null?void 0:Te.capabilities)==null?void 0:Xe.status_updates)??!0?(((gt=e(s))==null?void 0:gt.statusHistory)??[...(xt=e(s))!=null&&xt.status?[(ft=e(s))==null?void 0:ft.status]:[]]).length===0||(((Re=(Ve=(st=e(s))==null?void 0:st.statusHistory)==null?void 0:Ve.at(-1))==null?void 0:Re.hidden)??!1):!0)})?Ae(Vt):Ae(Xt,!1)})}var ea=E(Mt,2);{var aa=Ae=>{{let Oe=ye(()=>(e(s),t(()=>{var We,Te;return((Te=(We=e(s))==null?void 0:We.error)==null?void 0:Te.content)??e(s).content})));Ms(Ae,{get content(){return e(Oe)}})}};u(ea,Ae=>{e(s),t(()=>{var Oe;return(Oe=e(s))==null?void 0:Oe.error})&&Ae(aa)})}var ra=E(ea,2);{var ca=Ae=>{{let Oe=ye(()=>(e(s),t(()=>{var Te;return(Te=e(s))==null?void 0:Te.id}))),We=ye(()=>(e(s),t(()=>{var Te,Xe;return((Te=e(s))==null?void 0:Te.sources)??((Xe=e(s))==null?void 0:Xe.citations)})));_a(Ds(Ae,{get id(){return e(Oe)},get chatId(){return we()},get sources(){return e(We)},get readOnly(){return h()},$$legacy:!0}),Te=>I(w,Te),()=>e(w))}};u(ra,Ae=>{e(s),e(K),t(()=>{var Oe,We,Te,Xe,gt,xt;return(((Oe=e(s))==null?void 0:Oe.sources)||((We=e(s))==null?void 0:We.citations))&&(((xt=(gt=(Xe=(Te=e(K))==null?void 0:Te.info)==null?void 0:Xe.meta)==null?void 0:gt.capabilities)==null?void 0:xt.citations)??!0)})&&Ae(ca)})}var pa=E(ra,2);{var xa=Ae=>{an(Ae,{get codeExecutions(){return e(s),t(()=>e(s).code_executions)}})};u(pa,Ae=>{e(s),t(()=>e(s).code_executions)&&Ae(xa)})}r(it),_a(it,Ae=>I(p,Ae),()=>e(p)),r(Je),r(Ke);var sa=E(Ke,2);{var ia=Ae=>{var Oe=Io(),We=re(Oe),Te=n(We);{var Xe=Ve=>{var Re=ko(),lt=re(Re);{var dt=Ht=>{var Qt=ao(),ga=n(Qt),na=E(ga,2);{var la=Kt=>{var Pt=eo(),At=n(Pt);Na(At);var Gt=E(At);r(Pt),x(vt=>{Pe(At,"id",`message-index-input-${e(s),t(()=>e(s).id)??""}`),Da(At,vt),Pe(At,"max",(i(oe()),t(()=>oe().length))),j(Gt,`/${i(oe()),t(()=>oe().length)??""}`)},[()=>(i(oe()),e(s),t(()=>oe().indexOf(e(s).id)+1))]),Ie("focus",At,vt=>{vt.target.select()}),Ie("blur",At,vt=>{he()(e(s),vt.target.value-1),I(F,!1)}),Ie("keydown",At,vt=>{vt.key==="Enter"&&(he()(e(s),vt.target.value-1),I(F,!1))}),a(Kt,Pt)},ua=Kt=>{var Pt=to(),At=n(Pt);r(Pt),x(Gt=>j(At,`${Gt??""}/${i(oe()),t(()=>oe().length)??""}`),[()=>(i(oe()),e(s),t(()=>oe().indexOf(e(s).id)+1))]),Ie("dblclick",Pt,async()=>{I(F,!0),await rt();const Gt=document.getElementById(`message-index-input-${e(s).id}`);Gt&&(Gt.focus(),Gt.select())}),a(Kt,Pt)};u(na,Kt=>{e(F)?Kt(la):Kt(ua,!1)})}var ba=E(na,2);r(Qt),x((Kt,Pt)=>{Pe(ga,"aria-label",Kt),Pe(ba,"aria-label",Pt),Qt.dir=Qt.dir},[()=>(N(),t(()=>N().t("Previous message"))),()=>(N(),t(()=>N().t("Next message")))]),Ie("click",ga,()=>{ie()(e(s))}),Ie("click",ba,()=>{xe()(e(s))}),a(Ht,Qt)};u(lt,Ht=>{i(oe()),t(()=>oe().length>1)&&Ht(dt)})}var Ct=E(lt,2);{var Dt=Ht=>{var Qt=yo(),ga=re(Qt);{var na=vt=>{var Ft=Me(),mt=re(Ft);{var Bt=ut=>{{let Zt=ye(()=>(N(),t(()=>N().t("Edit"))));_t(ut,{get content(){return e(Zt)},placement:"bottom",children:(va,ma)=>{var Tt=ro();x(oa=>{Pe(Tt,"aria-label",oa),Le(Tt,1,`${i(y()),L(),t(()=>{var wa;return y()||(((wa=L())==null?void 0:wa.highContrastMode)??!1)?"visible":"invisible group-hover:visible"})??""} p-1.5 hover:bg-black/5 dark:hover:bg-white/5 rounded-lg dark:hover:text-white hover:text-black transition`)},[()=>(N(),t(()=>N().t("Edit")))]),Ie("click",Tt,()=>{ge()}),a(va,Tt)},$$slots:{default:!0}})}};u(mt,ut=>{V(),t(()=>{var Zt,va,ma,Tt;return((Zt=V())==null?void 0:Zt.role)==="user"?((Tt=(ma=(va=V())==null?void 0:va.permissions)==null?void 0:ma.chat)==null?void 0:Tt.edit)??!0:!0})&&ut(Bt)})}a(vt,Ft)};u(ga,vt=>{h()||vt(na)})}var la=E(ga,2);{let vt=ye(()=>(N(),t(()=>N().t("Copy"))));_t(la,{get content(){return e(vt)},placement:"bottom",children:(Ft,mt)=>{var Bt=so();x(ut=>{Pe(Bt,"aria-label",ut),Le(Bt,1,`${i(y()),L(),t(()=>{var Zt;return y()||(((Zt=L())==null?void 0:Zt.highContrastMode)??!1)?"visible":"invisible group-hover:visible"})??""} p-1.5 hover:bg-black/5 dark:hover:bg-white/5 rounded-lg dark:hover:text-white hover:text-black transition copy-response-button`)},[()=>(N(),t(()=>N().t("Copy")))]),Ie("click",Bt,()=>{ue(e(s).content)}),a(Ft,Bt)},$$slots:{default:!0}})}var ua=E(la,2);{var ba=vt=>{{let Ft=ye(()=>(N(),t(()=>N().t("Read Aloud"))));_t(vt,{get content(){return e(Ft)},placement:"bottom",children:(mt,Bt)=>{var ut=lo(),Zt=n(ut);{var va=Tt=>{var oa=no();a(Tt,oa)},ma=Tt=>{var oa=Me(),wa=re(oa);{var yt=ot=>{var bt=oo();a(ot,bt)},Ge=ot=>{var bt=io();a(ot,bt)};u(wa,ot=>{e($)?ot(yt):ot(Ge,!1)},!0)}a(Tt,oa)};u(Zt,Tt=>{e(X)?Tt(va):Tt(ma,!1)})}r(ut),x(Tt=>{Pe(ut,"aria-label",Tt),Pe(ut,"id",`speak-button-${e(s),t(()=>e(s).id)??""}`),Le(ut,1,`${i(y()),L(),t(()=>{var oa;return y()||(((oa=L())==null?void 0:oa.highContrastMode)??!1)?"visible":"invisible group-hover:visible"})??""} p-1.5 hover:bg-black/5 dark:hover:bg-white/5 rounded-lg dark:hover:text-white hover:text-black transition`)},[()=>(N(),t(()=>N().t("Read Aloud")))]),Ie("click",ut,()=>{e(X)||(e($)?S():P())}),a(mt,ut)},$$slots:{default:!0}})}};u(ua,vt=>{V(),t(()=>{var Ft,mt,Bt,ut;return((Ft=V())==null?void 0:Ft.role)==="admin"||(((ut=(Bt=(mt=V())==null?void 0:mt.permissions)==null?void 0:Bt.chat)==null?void 0:ut.tts)??!0)})&&vt(ba)})}var Kt=E(ua,2);{var Pt=vt=>{{let Ft=ye(()=>(e(s),i(Ma),t(()=>e(s).usage?`<pre>${Ma(JSON.stringify(e(s).usage,null,2).replace(/"([^(")"]+)":/g,"$1:").slice(1,-1).split(`
`).map(mt=>mt.slice(2)).map(mt=>mt.endsWith(",")?mt.slice(0,-1):mt).join(`
`))}</pre>`:"")));_t(vt,{get content(){return e(Ft)},placement:"bottom",children:(mt,Bt)=>{var ut=vo();x(()=>{Le(ut,1,` ${i(y()),L(),t(()=>{var Zt;return y()||(((Zt=L())==null?void 0:Zt.highContrastMode)??!1)?"visible":"invisible group-hover:visible"})??""} p-1.5 hover:bg-black/5 dark:hover:bg-white/5 rounded-lg dark:hover:text-white hover:text-black transition whitespace-pre-wrap`),Pe(ut,"id",`info-${e(s),t(()=>e(s).id)??""}`)}),Ie("click",ut,()=>{e(s)}),a(mt,ut)},$$slots:{default:!0}})}};u(Kt,vt=>{e(s),t(()=>e(s).usage)&&vt(Pt)})}var At=E(Kt,2);{var Gt=vt=>{var Ft=wo(),mt=re(Ft);{var Bt=yt=>{var Ge=uo(),ot=re(Ge);{let tt=ye(()=>(N(),t(()=>N().t("Good Response"))));_t(ot,{get content(){return e(tt)},placement:"bottom",children:(Lt,Ut)=>{var Ot=co();x((at,nt)=>{Pe(Ot,"aria-label",at),Le(Ot,1,`${i(y()),L(),t(()=>{var wt;return y()||(((wt=L())==null?void 0:wt.highContrastMode)??!1)?"visible":"invisible group-hover:visible"})??""} p-1.5 hover:bg-black/5 dark:hover:bg-white/5 rounded-lg ${nt??""} dark:hover:text-white hover:text-black transition disabled:cursor-progress disabled:hover:bg-transparent`),Ot.disabled=e(Ee)},[()=>(N(),t(()=>N().t("Good Response"))),()=>(e(s),t(()=>{var at,nt;return(((nt=(at=e(s))==null?void 0:at.annotation)==null?void 0:nt.rating)??"").toString()==="1"?"bg-gray-100 dark:bg-gray-800":""}))]),Ie("click",Ot,async()=>{await ze(1),window.setTimeout(()=>{var at;(at=document.getElementById(`message-feedback-${e(s).id}`))==null||at.scrollIntoView()},0)}),a(Lt,Ot)},$$slots:{default:!0}})}var bt=E(ot,2);{let tt=ye(()=>(N(),t(()=>N().t("Bad Response"))));_t(bt,{get content(){return e(tt)},placement:"bottom",children:(Lt,Ut)=>{var Ot=go();x((at,nt)=>{Pe(Ot,"aria-label",at),Le(Ot,1,`${i(y()),L(),t(()=>{var wt;return y()||(((wt=L())==null?void 0:wt.highContrastMode)??!1)?"visible":"invisible group-hover:visible"})??""} p-1.5 hover:bg-black/5 dark:hover:bg-white/5 rounded-lg ${nt??""} dark:hover:text-white hover:text-black transition disabled:cursor-progress disabled:hover:bg-transparent`),Ot.disabled=e(Ee)},[()=>(N(),t(()=>N().t("Bad Response"))),()=>(e(s),t(()=>{var at,nt;return(((nt=(at=e(s))==null?void 0:at.annotation)==null?void 0:nt.rating)??"").toString()==="-1"?"bg-gray-100 dark:bg-gray-800":""}))]),Ie("click",Ot,async()=>{await ze(-1),window.setTimeout(()=>{var at;(at=document.getElementById(`message-feedback-${e(s).id}`))==null||at.scrollIntoView()},0)}),a(Lt,Ot)},$$slots:{default:!0}})}a(yt,Ge)};u(mt,yt=>{ne(),f(),V(),t(()=>{var Ge,ot,bt,tt,Lt;return!ne()&&(((Ge=f())==null?void 0:Ge.features.enable_message_rating)??!0)&&(((ot=V())==null?void 0:ot.role)==="admin"||(((Lt=(tt=(bt=V())==null?void 0:bt.permissions)==null?void 0:tt.chat)==null?void 0:Lt.rate_response)??!0))})&&yt(Bt)})}var ut=E(mt,2);{var Zt=yt=>{{let Ge=ye(()=>(N(),t(()=>N().t("Continue Response"))));_t(yt,{get content(){return e(Ge)},placement:"bottom",children:(ot,bt)=>{var tt=fo();x(Lt=>{Pe(tt,"aria-label",Lt),Le(tt,1,`${i(y()),L(),t(()=>{var Ut;return y()||(((Ut=L())==null?void 0:Ut.highContrastMode)??!1)?"visible":"invisible group-hover:visible"})??""} p-1.5 hover:bg-black/5 dark:hover:bg-white/5 rounded-lg dark:hover:text-white hover:text-black transition`)},[()=>(N(),t(()=>N().t("Continue Response")))]),Ie("click",tt,()=>{Q()()}),a(ot,tt)},$$slots:{default:!0}})}};u(ut,yt=>{i(y()),V(),t(()=>{var Ge,ot,bt,tt;return y()&&(((Ge=V())==null?void 0:Ge.role)==="admin"||(((tt=(bt=(ot=V())==null?void 0:ot.permissions)==null?void 0:bt.chat)==null?void 0:tt.continue_response)??!0))})&&yt(Zt)})}var va=E(ut,2);{var ma=yt=>{var Ge=Me(),ot=re(Ge);{var bt=Lt=>{var Ut=ho(),Ot=re(Ut),at=E(Ot,2);Sn(at,{onRegenerate:(nt=null)=>{var wt;I(Y,!1),D()(e(s),nt),(((wt=e(K))==null?void 0:wt.actions)??[]).forEach(ha=>{v("action",{id:ha.id,event:{id:"regenerate-response",data:{messageId:e(s).id}}})})},children:(nt,wt)=>{{let ha=ye(()=>(N(),t(()=>N().t("Regenerate"))));_t(nt,{get content(){return e(ha)},placement:"bottom",children:(wr,zi)=>{var Ha=mo();x(yr=>{Pe(Ha,"aria-label",yr),Le(Ha,1,`${y()?"visible":"invisible group-hover:visible"} p-1.5 hover:bg-black/5 dark:hover:bg-white/5 rounded-lg dark:hover:text-white hover:text-black transition`)},[()=>(N(),t(()=>N().t("Regenerate")))]),a(wr,Ha)},$$slots:{default:!0}})}},$$slots:{default:!0}}),Ie("click",Ot,()=>{var nt;I(Y,!1),D()(e(s)),(((nt=e(K))==null?void 0:nt.actions)??[]).forEach(wt=>{v("action",{id:wt.id,event:{id:"regenerate-response",data:{messageId:e(s).id}}})})}),a(Lt,Ut)},tt=Lt=>{{let Ut=ye(()=>(N(),t(()=>N().t("Regenerate"))));_t(Lt,{get content(){return e(Ut)},placement:"bottom",children:(Ot,at)=>{var nt=_o();x(wt=>{Pe(nt,"aria-label",wt),Le(nt,1,`${y()?"visible":"invisible group-hover:visible"} p-1.5 hover:bg-black/5 dark:hover:bg-white/5 rounded-lg dark:hover:text-white hover:text-black transition regenerate-response-button`)},[()=>(N(),t(()=>N().t("Regenerate")))]),Ie("click",nt,()=>{var wt;I(Y,!1),D()(e(s)),(((wt=e(K))==null?void 0:wt.actions)??[]).forEach(ha=>{v("action",{id:ha.id,event:{id:"regenerate-response",data:{messageId:e(s).id}}})})}),a(Ot,nt)},$$slots:{default:!0}})}};u(ot,Lt=>{L(),t(()=>{var Ut;return((Ut=L())==null?void 0:Ut.regenerateMenu)??!0})?Lt(bt):Lt(tt,!1)})}a(yt,Ge)};u(va,yt=>{V(),t(()=>{var Ge,ot,bt,tt;return((Ge=V())==null?void 0:Ge.role)==="admin"||(((tt=(bt=(ot=V())==null?void 0:ot.permissions)==null?void 0:bt.chat)==null?void 0:tt.regenerate_response)??!0)})&&yt(ma)})}var Tt=E(va,2);{var oa=yt=>{var Ge=Me(),ot=re(Ge);{var bt=tt=>{{let Lt=ye(()=>(N(),t(()=>N().t("Delete"))));_t(tt,{get content(){return e(Lt)},placement:"bottom",children:(Ut,Ot)=>{var at=po();x(nt=>{Pe(at,"aria-label",nt),Le(at,1,`${i(y()),L(),t(()=>{var wt;return y()||(((wt=L())==null?void 0:wt.highContrastMode)??!1)?"visible":"invisible group-hover:visible"})??""} p-1.5 hover:bg-black/5 dark:hover:bg-white/5 rounded-lg dark:hover:text-white hover:text-black transition`)},[()=>(N(),t(()=>N().t("Delete")))]),Ie("click",at,()=>{I(z,!0)}),a(Ut,at)},$$slots:{default:!0}})}};u(ot,tt=>{i(oe()),t(()=>oe().length>1)&&tt(bt)})}a(yt,Ge)};u(Tt,yt=>{V(),t(()=>{var Ge,ot,bt,tt;return((Ge=V())==null?void 0:Ge.role)==="admin"||(((tt=(bt=(ot=V())==null?void 0:ot.permissions)==null?void 0:bt.chat)==null?void 0:tt.delete_message)??!0)})&&yt(oa)})}var wa=E(Tt,2);pt(wa,1,()=>(e(K),t(()=>{var yt;return((yt=e(K))==null?void 0:yt.actions)??[]})),zt,(yt,Ge)=>{_t(yt,{get content(){return e(Ge),t(()=>e(Ge).name)},placement:"bottom",children:(ot,bt)=>{var tt=bo(),Lt=n(tt);{var Ut=at=>{var nt=xo(),wt=n(nt);r(nt),x(ha=>{Pe(wt,"src",(e(Ge),t(()=>e(Ge).icon))),Le(wt,1,`w-4 h-4 ${ha??""}`),Pe(wt,"alt",(e(Ge),t(()=>e(Ge).name)))},[()=>(e(Ge),t(()=>e(Ge).icon.includes("svg")?"dark:invert-[80%]":""))]),a(at,nt)},Ot=at=>{Kr(at,{strokeWidth:"2.1",className:"size-4"})};u(Lt,at=>{e(Ge),t(()=>{var nt;return(nt=e(Ge))==null?void 0:nt.icon})?at(Ut):at(Ot,!1)})}r(tt),x(()=>{Pe(tt,"aria-label",(e(Ge),t(()=>e(Ge).name))),Le(tt,1,`${i(y()),L(),t(()=>{var at;return y()||(((at=L())==null?void 0:at.highContrastMode)??!1)?"visible":"invisible group-hover:visible"})??""} p-1.5 hover:bg-black/5 dark:hover:bg-white/5 rounded-lg dark:hover:text-white hover:text-black transition`)}),Ie("click",tt,()=>{ae()(e(Ge).id,e(s))}),a(ot,tt)},$$slots:{default:!0}})}),a(vt,Ft)};u(At,vt=>{h()||vt(Gt)})}a(Ht,Qt)};u(Ct,Ht=>{e(s),t(()=>e(s).done)&&Ht(Dt)})}a(Ve,Re)};u(Te,Ve=>{e(s),i(oe()),t(()=>e(s).done||oe().length>1)&&Ve(Xe)})}r(We),_a(We,Ve=>I(O,Ve),()=>e(O));var gt=E(We,2);{var xt=Ve=>{hs(Ve,{get message(){return e(s)},set message(Re){I(s,Re)},get show(){return e(Y)},set show(Re){I(Y,Re)},$$events:{save:async Re=>{await ze(null,{...Re.detail})}},$$legacy:!0})};u(gt,Ve=>{e(s),e(Y),t(()=>e(s).done&&e(Y))&&Ve(xt)})}var ft=E(gt,2);{var st=Ve=>{var Re=Mo(),lt=n(Re);{let dt=ye(()=>(e(s),t(()=>{var Ct;return(Ct=e(s))==null?void 0:Ct.followUps})));xn(lt,{get followUps(){return e(dt)},onClick:Ct=>{var Dt,Ht;((Dt=L())==null?void 0:Dt.insertFollowUpPrompt)??!1?_e()(Ct):g()((Ht=e(s))==null?void 0:Ht.id,Ct)}})}r(Re),Ea(1,Re,()=>Sa,()=>({duration:100})),a(Ve,Re)};u(ft,Ve=>{i(y()),L(),e(s),i(h()),t(()=>{var Re,lt;return(y()||(((Re=L())==null?void 0:Re.keepFollowUpPrompts)??!1))&&e(s).done&&!h()&&(((lt=e(s))==null?void 0:lt.followUps)??[]).length>0})&&Ve(st)})}a(Ae,Oe)};u(sa,Ae=>{e(U)||Ae(ia)})}r(kt),r(je),r(de),x(()=>{Le(de,1,` flex w-full message-${e(s),t(()=>e(s).id)??""}`,"svelte-1qscqw6"),Pe(de,"id",`message-${e(s),t(()=>e(s).id)??""}`),Pe(de,"dir",(L(),t(()=>L().chatDirection))),Le(Ke,1,`chat-${e(s),t(()=>e(s).role)??""} w-full min-w-full markdown-prose`,"svelte-1qscqw6"),Le(it,1,`w-full flex flex-col relative ${e(U)?"hidden":""}`),de.dir=de.dir}),a(ee,de)}),a(Ne,G),Et(),B()}var Eo=$a('<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M8 8v8m0-8a2 2 0 1 0 0-4 2 2 0 0 0 0 4Zm0 8a2 2 0 1 0 0 4 2 2 0 0 0 0-4Zm6-2a2 2 0 1 1 4 0 2 2 0 0 1-4 0Zm0 0h-1a5 5 0 0 1-5-5v-.5"></path></svg>');function So(Ne,o){let l=c(o,"className",8,"w-4 h-4"),f=c(o,"strokeWidth",8,"1.5");var L=Eo();x(()=>{Pe(L,"stroke-width",f()),Le(L,0,Ta(l()))}),a(Ne,L)}var No=m('<button><div class="flex items-center gap-1.5"><div class="-translate-y-[1px]"> </div></div></button>'),Po=m('<div class="w-full"><div class=" flex w-full mb-4.5 border-b border-gray-200 dark:border-gray-850"><div class="flex gap-2 scrollbar-none overflow-x-auto w-fit text-center font-medium bg-transparent pt-1 text-sm"></div></div> <!></div>'),Bo=m("<div><!></div>"),To=m('<span class=" self-center invisible group-hover:visible text-gray-400 text-xs font-medium uppercase ml-0.5 -mt-0.5"> </span>'),Lo=m(" <!>",1),Oo=m('<div class="w-full rounded-xl pl-5 pr-2 py-2 mt-2"><!> <div class="mt-1 markdown-prose w-full min-w-full"><!></div></div>'),Ro=m('<button type="button" id="merge-response-button"><!></button>'),zo=m('<div class=" shrink-0 text-gray-600 dark:text-gray-500 mt-1"><!></div>'),jo=m('<div class="flex justify-end"><div class="w-full"><!></div> <!></div>'),Ao=m('<div><div class="flex snap-x snap-mandatory overflow-x-auto scrollbar-hidden"><!></div> <!></div>');function Ho(Ne,o){$t(o,!1);const l=()=>Fe(fa,"$settings",M),f=()=>Fe(La,"$models",M),L=()=>Fe(gr,"$mobile",M),N=()=>Fe(V,"$i18n",M),[M,J]=Jt(),V=Wt("i18n");Rt.extend(mr);let ne=c(o,"chatId",8),b=c(o,"history",12),B=c(o,"messageId",8),te=c(o,"selectedModels",24,()=>[]),v=c(o,"isLastMessage",8),we=c(o,"readOnly",8,!1),A=c(o,"editCodeBlock",8,!0),Z=c(o,"setInputText",8,()=>{}),ce=c(o,"updateChat",8),s=c(o,"editMessage",8),oe=c(o,"saveMessage",8),_e=c(o,"rateMessage",8),he=c(o,"actionMessage",8),ie=c(o,"submitMessage",8),xe=c(o,"deleteMessage",8),le=c(o,"continueResponse",8),fe=c(o,"regenerateResponse",8),R=c(o,"mergeResponses",8),ae=c(o,"addMessages",8),d=c(o,"triggerScroll",8),g=c(o,"topPadding",8,!1);Ba();let Q=Se(),D=Se({}),C=Se({}),y=Se(null),h=Se(JSON.parse(JSON.stringify(b().messages[B()])));const H=async(T,F)=>{da(C,e(C)[T]=Math.max(0,Math.min(F,e(D)[T].messageIds.length-1)));let $=e(D)[T].messageIds[e(C)[T]],X=b().messages[$].childrenIds;for(;X.length!==0;)$=X.at(-1),X=b().messages[$].childrenIds;b(b().currentId=$,!0),await rt(),await ce()(),d()()},_=async T=>{da(C,e(C)[T]=Math.max(0,e(C)[T]-1));let F=e(D)[T].messageIds[e(C)[T]],$=b().messages[F].childrenIds;for(;$.length!==0;)F=$.at(-1),$=b().messages[F].childrenIds;b(b().currentId=F,!0),await rt(),await ce()(),d()()},w=async T=>{da(C,e(C)[T]=Math.min(e(D)[T].messageIds.length-1,e(C)[T]+1));let F=e(D)[T].messageIds[e(C)[T]],$=b().messages[F].childrenIds;for(;$.length!==0;)F=$.at(-1),$=b().messages[F].childrenIds;b(b().currentId=F,!0),await rt(),await ce()(),d()()},p=async()=>{var T,F,$;await rt(),B(),I(Q,b().messages[B()].parentId?b().messages[b().messages[B()].parentId]:null),I(D,(T=e(Q))==null?void 0:T.models.reduce((X,Y,ue)=>{var P,k;let S=(P=e(Q))==null?void 0:P.childrenIds.map(q=>b().messages[q]).filter(q=>(q==null?void 0:q.modelIdx)===ue).map(q=>q.id);if(S.length===0){let q=(k=e(Q))==null?void 0:k.childrenIds.map(W=>b().messages[W]).filter(W=>(W==null?void 0:W.model)===Y);q.forEach(W=>{W.modelIdx=ue}),S=q.map(W=>W.id)}return{...X,[ue]:{messageIds:S}}},{})),I(C,(F=e(Q))==null?void 0:F.models.reduce((X,Y,ue)=>{const S=e(D)[ue].messageIds.findIndex(P=>P===B());return S!==-1?{...X,[ue]:S}:{...X,[ue]:e(D)[ue].messageIds.length-1}},{})),I(y,($=b().messages[B()])==null?void 0:$.modelIdx),e(D),e(C),await rt()},O=async(T,F)=>{if(B()!=T){let $=T,X=b().messages[$].childrenIds;for(;X.length!==0;)$=X.at(-1),X=b().messages[$].childrenIds;b(b().currentId=$,!0),I(y,F)}},z=async()=>{const T=Object.keys(e(D)).map(F=>{const{messageIds:$}=e(D)[F],X=$[e(C)[F]];return b().messages[X].content});R()(B(),T,ne())};Ca(async()=>{var T;if(await p(),await rt(),((T=l())==null?void 0:T.scrollOnBranchChange)??!0){const F=document.getElementById(`message-${B()}`);F&&F.scrollIntoView({block:"start"})}}),It(()=>(i(b()),e(h),i(B())),()=>{b().messages&&JSON.stringify(e(h))!==JSON.stringify(b().messages[B()])&&I(h,JSON.parse(JSON.stringify(b().messages[B()])))}),ta(),St();var K=Me(),U=re(K);{var se=T=>{var F=Ao(),$=n(F),X=n($);{var Y=k=>{var q=Po(),W=n(q),ge=n(W);pt(ge,5,()=>(e(D),t(()=>Object.keys(e(D)))),zt,(pe,Ee)=>{var ze=Me(),Qe=re(ze);{var He=be=>{const G=ye(()=>(e(D),e(Ee),e(C),t(()=>e(D)[e(Ee)].messageIds[e(C)[e(Ee)]]))),Ce=ye(()=>(f(),i(b()),i(e(G)),t(()=>f().find(Be=>{var je;return Be.id===((je=b().messages[e(G)])==null?void 0:je.model)}))));var ke=No(),ee=n(ke),de=n(ee),ve=n(de,!0);r(de),r(ee),r(ke),x(()=>{Le(ke,1,`min-w-fit ${e(y)==e(Ee)?" dark:border-gray-300 ":" opacity-35 border-transparent"} pb-1.5 px-2.5 transition border-b-2`),j(ve,(i(e(Ce)),i(b()),i(e(G)),t(()=>{var Be;return e(Ce)?`${e(Ce).name}`:(Be=b().messages[e(G)])==null?void 0:Be.model})))}),Ie("click",ke,async()=>{e(y)!=e(Ee)&&I(y,e(Ee)),O(e(G),e(Ee))}),a(be,ke)};u(Qe,be=>{e(C),e(Ee),e(D),t(()=>{var G;return e(C)[e(Ee)]!==void 0&&(((G=e(D)[e(Ee)])==null?void 0:G.messageIds)??[]).length>0})&&be(He)})}a(pe,ze)}),r(ge),r(W);var me=E(W,2);{var $e=pe=>{var Ee=Me(),ze=re(Ee);Ia(ze,()=>(i(b()),t(()=>b().currentId)),Qe=>{var He=Me(),be=re(He);{var G=Ce=>{{let ke=ye(()=>(e(h),t(()=>{var ee;return(ee=e(h))==null?void 0:ee.id})));Qa(Ce,{get chatId(){return ne()},get history(){return b()},get messageId(){return e(ke)},get selectedModels(){return te()},isLastMessage:!0,get siblings(){return e(D),e(y),t(()=>e(D)[e(y)].messageIds)},gotoMessage:(ee,de)=>H(e(y),de),showPreviousMessage:()=>_(e(y)),showNextMessage:()=>w(e(y)),get setInputText(){return Z()},get updateChat(){return ce()},get editMessage(){return s()},get saveMessage(){return oe()},get rateMessage(){return _e()},get deleteMessage(){return xe()},get actionMessage(){return he()},get submitMessage(){return ie()},get continueResponse(){return le()},regenerateResponse:async(ee,de=null)=>{fe()(ee,de),await rt(),da(C,e(C)[e(y)]=e(D)[e(y)].messageIds.length-1)},get addMessages(){return ae()},get readOnly(){return we()},get topPadding(){return g()}})}};u(be,Ce=>{e(h)&&Ce(G)})}a(Qe,He)}),a(pe,Ee)};u(me,pe=>{e(y)!==null&&pe($e)})}r(q),a(k,q)},ue=k=>{var q=Me(),W=re(q);pt(W,1,()=>(e(D),t(()=>Object.keys(e(D)))),zt,(ge,me)=>{var $e=Me(),pe=re($e);{var Ee=ze=>{const Qe=ye(()=>(e(D),e(me),e(C),t(()=>e(D)[e(me)].messageIds[e(C)[e(me)]])));var He=Bo(),be=n(He);Ia(be,()=>(i(b()),t(()=>b().currentId)),G=>{var Ce=Me(),ke=re(Ce);{var ee=de=>{Qa(de,{get chatId(){return ne()},get history(){return b()},get messageId(){return e(Qe)},get selectedModels(){return te()},isLastMessage:!0,get siblings(){return e(D),e(me),t(()=>e(D)[e(me)].messageIds)},gotoMessage:(ve,Be)=>H(e(me),Be),showPreviousMessage:()=>_(e(me)),showNextMessage:()=>w(e(me)),get setInputText(){return Z()},get updateChat(){return ce()},get editMessage(){return s()},get saveMessage(){return oe()},get rateMessage(){return _e()},get deleteMessage(){return xe()},get actionMessage(){return he()},get submitMessage(){return ie()},get continueResponse(){return le()},regenerateResponse:async(ve,Be=null)=>{fe()(ve,Be),await rt(),da(C,e(C)[e(me)]=e(D)[e(me)].messageIds.length-1)},get addMessages(){return ae()},get readOnly(){return we()},get editCodeBlock(){return A()},get topPadding(){return g()}})};u(ke,de=>{e(h)&&de(ee)})}a(G,Ce)}),r(He),x(()=>Le(He,1,` snap-center w-full max-w-full m-1 border ${i(b()),i(B()),e(me),L(),t(()=>{var G;return((G=b().messages[B()])==null?void 0:G.modelIdx)==e(me)?`bg-gray-50 dark:bg-gray-850 border-gray-100 dark:border-gray-800 border-2 ${L()?"min-w-full":"min-w-80"}`:`border-gray-100/30 dark:border-gray-850/30 border-dashed ${L()?"min-w-full":"min-w-80"}`})??""} transition-all p-5 rounded-2xl`)),Ie("click",He,async()=>{O(e(Qe),e(me))}),a(ze,He)};u(pe,ze=>{e(C),e(me),e(D),t(()=>e(C)[e(me)]!==void 0&&e(D)[e(me)].messageIds.length>0)&&ze(Ee)})}a(ge,$e)}),a(k,q)};u(X,k=>{l(),t(()=>{var q;return((q=l())==null?void 0:q.displayMultiModelResponsesInTabs)??!1})?k(Y):k(ue,!1)})}r($);var S=E($,2);{var P=k=>{var q=Me(),W=re(q);{var ge=me=>{var $e=jo(),pe=n($e),Ee=n(pe);{var ze=be=>{const G=ye(()=>(i(b()),i(B()),t(()=>{var je;return(je=b().messages[B()])==null?void 0:je.merged})));var Ce=Oo(),ke=n(Ce);Xa(ke,{children:(je,et)=>{za();var kt=Lo(),Ke=re(kt),Je=E(Ke);{var Ue=Ye=>{var Ze=To(),jt=n(Ze,!0);r(Ze),x(qe=>j(jt,qe),[()=>(i(Rt),i(e(G)),t(()=>Rt(e(G).timestamp*1e3).format("LT")))]),a(Ye,Ze)};u(Je,Ye=>{i(e(G)),t(()=>e(G).timestamp)&&Ye(Ue)})}x(Ye=>j(Ke,`${Ye??""} `),[()=>(N(),t(()=>N().t("Merged Response")))]),a(je,kt)},$$slots:{default:!0}});var ee=E(ke,2),de=n(ee);{var ve=je=>{er(je,{})},Be=je=>{{let et=ye(()=>(i(e(G)),t(()=>e(G).content??"")));Pa(je,{id:"merged",get content(){return e(et)}})}};u(de,je=>{i(e(G)),t(()=>{var et;return(((et=e(G))==null?void 0:et.content)??"")===""})?je(ve):je(Be,!1)})}r(ee),r(Ce),a(be,Ce)};u(Ee,be=>{i(b()),i(B()),t(()=>{var G,Ce;return(Ce=(G=b().messages[B()])==null?void 0:G.merged)==null?void 0:Ce.status})&&be(ze)})}r(pe);var Qe=E(pe,2);{var He=be=>{var G=zo(),Ce=n(G);{let ke=ye(()=>(N(),t(()=>N().t("Merge Responses"))));_t(Ce,{get content(){return e(ke)},placement:"bottom",children:(ee,de)=>{var ve=Ro();Le(ve,1,"visible p-1 hover:bg-black/5 dark:hover:bg-white/5 rounded-lg dark:hover:text-white hover:text-black transition");var Be=n(ve);So(Be,{className:" size-5 "}),r(ve),Ie("click",ve,()=>{z()}),a(ee,ve)},$$slots:{default:!0}})}r(G),a(be,G)};u(Qe,be=>{v()&&be(He)})}r($e),a(me,$e)};u(W,me=>{e(D),e(C),i(b()),t(()=>!Object.keys(e(D)).find($e=>{var ze;const{messageIds:pe}=e(D)[$e],Ee=pe[e(C)[$e]];return!((ze=b().messages[Ee])!=null&&ze.done)}))&&me(ge)})}a(k,q)};u(S,k=>{we()||k(P)})}r(F),x(()=>Pe($,"id",`responses-container-${ne()??""}-${e(Q),t(()=>e(Q).id)??""}`)),a(T,F)};u(U,T=>{e(Q)&&T(se)})}a(Ne,K),Et(),J()}var qo=m("<div><!></div>"),Wo=m(' <span class=" text-gray-500 text-sm font-medium"> </span>',1),Do=m('<span class="line-clamp-1"> </span>'),Fo=m("<div><!></div>"),Uo=m("<!> <!>",1),Jo=m("<div><!></div>"),Vo=m('<span class="line-clamp-1"> </span>'),Zo=m('<div class="flex justify-end pr-2 text-xs"><div><!></div></div>'),Qo=m("<div><!></div>"),Ko=m('<div class="mb-1 w-full flex flex-col justify-end overflow-x-auto gap-1 flex-wrap"></div>'),Go=m('<div class=" relative group"><div class="relative flex items-center"><!></div> <div class=" absolute -top-1 -right-1"><button type="button"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="size-4"><path d="M6.28 5.22a.75.75 0 00-1.06 1.06L8.94 10l-3.72 3.72a.75.75 0 101.06 1.06L10 11.06l3.72 3.72a.75.75 0 101.06-1.06L11.06 10l3.72-3.72a.75.75 0 00-1.06-1.06L10 8.94 6.28 5.22z"></path></svg></button></div></div>'),Yo=m('<div class="flex items-center flex-wrap gap-2 -mx-2 mb-1"></div>'),Xo=m('<div class=" w-full bg-gray-50 dark:bg-gray-800 rounded-3xl px-5 py-3 mb-2"><!> <div class="max-h-96 overflow-auto"><textarea class=" bg-transparent outline-hidden w-full resize-none"></textarea></div> <div class=" mt-2 mb-1 flex justify-between text-sm font-medium"><div><button id="save-edit-message-button" class="px-3.5 py-1.5 bg-gray-50 hover:bg-gray-100 dark:bg-gray-800 dark:hover:bg-gray-700 border border-gray-100 dark:border-gray-700 text-gray-700 dark:text-gray-200 transition rounded-3xl"> </button></div> <div class="flex space-x-1.5"><button id="close-edit-message-button" class="px-3.5 py-1.5 bg-white dark:bg-gray-900 hover:bg-gray-100 text-gray-800 dark:text-gray-100 transition rounded-3xl"> </button> <button id="confirm-edit-message-button" class="px-3.5 py-1.5 bg-gray-900 dark:bg-white hover:bg-gray-850 text-gray-100 dark:text-gray-800 transition rounded-3xl"> </button></div></div></div>'),ei=m('<div class="w-full"><div><div><!></div></div></div>'),ti=m('<div class="text-sm flex justify-center font-semibold self-center dark:text-gray-100 min-w-fit"><input type="number" min="1" class="bg-transparent font-semibold self-center dark:text-gray-100 min-w-fit outline-hidden"/> </div>'),ai=m('<div class="text-sm tracking-widest font-semibold self-center dark:text-gray-100 min-w-fit"> </div>'),ri=m('<div class="flex self-center" dir="ltr"><button class="self-center p-1 hover:bg-black/5 dark:hover:bg-white/5 dark:hover:text-white hover:text-black rounded-md transition"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5" class="size-3.5"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 19.5 8.25 12l7.5-7.5"></path></svg></button> <!> <button class="self-center p-1 hover:bg-black/5 dark:hover:bg-white/5 dark:hover:text-white hover:text-black rounded-md transition"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5" class="size-3.5"><path stroke-linecap="round" stroke-linejoin="round" d="m8.25 4.5 7.5 7.5-7.5 7.5"></path></svg></button></div>'),si=m('<button><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2.3" stroke="currentColor" class="w-4 h-4"><path stroke-linecap="round" stroke-linejoin="round" d="M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L6.832 19.82a4.5 4.5 0 01-1.897 1.13l-2.685.8.8-2.685a4.5 4.5 0 011.13-1.897L16.863 4.487zm0 0L19.5 7.125"></path></svg></button>'),ni=m('<button><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2.3" stroke="currentColor" class="w-4 h-4"><path stroke-linecap="round" stroke-linejoin="round" d="M15.666 3.888A2.25 2.25 0 0013.5 2.25h-3c-1.03 0-1.9.693-2.166 1.638m7.332 0c.055.194.084.4.084.612v0a.75.75 0 01-.75.75H9a.75.75 0 01-.75-.75v0c0-.212.03-.418.084-.612m7.332 0c.646.049 1.288.11 1.927.184 1.1.128 1.907 1.077 1.907 2.185V19.5a2.25 2.25 0 01-2.25 2.25H6.75A2.25 2.25 0 014.5 19.5V6.257c0-1.108.806-2.057 1.907-2.185a48.208 48.208 0 011.927-.184"></path></svg></button>'),oi=m('<button><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-4 h-4"><path stroke-linecap="round" stroke-linejoin="round" d="m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0"></path></svg></button>'),ii=m('<div class="text-sm flex justify-center font-semibold self-center dark:text-gray-100 min-w-fit"><input type="number" min="1" class="bg-transparent font-semibold self-center dark:text-gray-100 min-w-fit outline-hidden"/> </div>'),li=m('<div class="text-sm tracking-widest font-semibold self-center dark:text-gray-100 min-w-fit"> </div>'),di=m('<div class="flex self-center" dir="ltr"><button class="self-center p-1 hover:bg-black/5 dark:hover:bg-white/5 dark:hover:text-white hover:text-black rounded-md transition"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5" class="size-3.5"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 19.5 8.25 12l7.5-7.5"></path></svg></button> <!> <button class="self-center p-1 hover:bg-black/5 dark:hover:bg-white/5 dark:hover:text-white hover:text-black rounded-md transition"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5" class="size-3.5"><path stroke-linecap="round" stroke-linejoin="round" d="m8.25 4.5 7.5 7.5-7.5 7.5"></path></svg></button></div>'),vi=m("<div><!> <!> <!> <!> <!></div>"),ci=m('<!> <div class=" flex w-full user-message group"><!> <div class="flex-auto w-0 max-w-full pl-1"><!> <div><!> <!> <!></div></div></div>',1);function gi(Ne,o){$t(o,!1);const l=()=>Fe(J,"$i18n",N),f=()=>Fe(fa,"$settings",N),L=()=>Fe(ja,"$_user",N),[N,M]=Jt(),J=Wt("i18n");Rt.extend(mr);let V=c(o,"user",8),ne=c(o,"chatId",8),b=c(o,"history",8),B=c(o,"messageId",8),te=c(o,"siblings",8),v=c(o,"gotoMessage",8),we=c(o,"showPreviousMessage",8),A=c(o,"showNextMessage",8),Z=c(o,"editMessage",8),ce=c(o,"deleteMessage",8),s=c(o,"isFirstMessage",8),oe=c(o,"readOnly",8),_e=c(o,"editCodeBlock",8,!0),he=c(o,"topPadding",8,!1),ie=Se(!1),xe=Se(!1),le=Se(!1),fe=Se(""),R=Se([]),ae=Se(),d=Se(JSON.parse(JSON.stringify(b().messages[B()])));const g=async P=>{await fr(P)&&qt.success(l().t("Copying to clipboard was successful!"))},Q=async()=>{var P,k;I(le,!0),I(fe,((P=e(d))==null?void 0:P.content)??""),I(R,e(d).files),await rt(),e(ae)&&(da(ae,e(ae).style.height=""),da(ae,e(ae).style.height=`${e(ae).scrollHeight}px`),(k=e(ae))==null||k.focus())},D=async(P=!0)=>{if(!e(fe)&&(e(R)??[]).length===0){qt.error(l().t("Please enter a message or attach a file."));return}Z()(e(d).id,{content:e(fe),files:e(R)},P),I(le,!1),I(fe,""),I(R,[])},C=()=>{I(le,!1),I(fe,""),I(R,[])},y=async()=>{ce()(e(d).id)};Ca(()=>{}),It(()=>(i(b()),e(d),i(B())),()=>{b().messages&&JSON.stringify(e(d))!==JSON.stringify(b().messages[B()])&&I(d,JSON.parse(JSON.stringify(b().messages[B()])))}),ta(),St();var h=ci(),H=re(h);{let P=ye(()=>(l(),t(()=>l().t("Delete message?"))));_r(H,{get title(){return e(P)},get show(){return e(ie)},set show(k){I(ie,k)},$$events:{confirm:()=>{y()}},$$legacy:!0})}var _=E(H,2),w=n(_);{var p=P=>{var k=qo();Le(k,1,"shrink-0 ltr:mr-3 rtl:ml-3 mt-1");var q=n(k);{let W=ye(()=>(i(Yt),i(V()),t(()=>`${Yt}/users/${V().id}/profile/image`)));hr(q,{get src(){return e(W)},className:"size-8 user-message-profile-image"})}r(k),a(P,k)};u(w,P=>{f(),t(()=>{var k;return!(((k=f())==null?void 0:k.chatBubble)??!0)})&&P(p)})}var O=E(w,2),z=n(O);{var K=P=>{var k=Jo(),q=n(k);Xa(q,{children:(W,ge)=>{var me=Uo(),$e=re(me);{var pe=He=>{var be=Wo(),G=re(be),Ce=E(G),ke=n(Ce,!0);r(Ce),x(ee=>{j(G,`${ee??""} `),j(ke,(e(d),t(()=>{var de;return((de=e(d))==null?void 0:de.user)??""})))},[()=>(l(),t(()=>l().t("You")))]),a(He,be)},Ee=He=>{var be=Me(),G=re(be);{var Ce=ee=>{var de=De();x(()=>j(de,(i(V()),t(()=>V().name)))),a(ee,de)},ke=ee=>{var de=De();x(ve=>j(de,ve),[()=>(l(),t(()=>l().t("You")))]),a(ee,de)};u(G,ee=>{f(),L(),i(V()),t(()=>f().showUsername||L().name!==V().name)?ee(Ce):ee(ke,!1)},!0)}a(He,be)};u($e,He=>{e(d),t(()=>e(d).user)?He(pe):He(Ee,!1)})}var ze=E($e,2);{var Qe=He=>{var be=Fo(),G=n(be);{let Ce=ye(()=>(i(Rt),e(d),t(()=>Rt(e(d).timestamp*1e3).format("LLLL"))));_t(G,{get content(){return e(Ce)},children:(ke,ee)=>{var de=Do(),ve=n(de,!0);r(de),x(Be=>j(ve,Be),[()=>(l(),i(ka),e(d),i(Rt),t(()=>l().t(ka(e(d).timestamp*1e3),{LOCALIZED_TIME:Rt(e(d).timestamp*1e3).format("LT"),LOCALIZED_DATE:Rt(e(d).timestamp*1e3).format("L")})))]),a(ke,de)},$$slots:{default:!0}})}r(be),x(()=>Le(be,1,`self-center text-xs font-medium first-letter:capitalize ml-0.5 translate-y-[1px] ${f(),t(()=>{var Ce;return((Ce=f())==null?void 0:Ce.highContrastMode)??!1?"dark:text-gray-900 text-gray-100":"invisible group-hover:visible transition"})??""}`)),a(He,be)};u(ze,He=>{e(d),t(()=>e(d).timestamp)&&He(Qe)})}a(W,me)},$$slots:{default:!0}}),r(k),a(P,k)},U=P=>{var k=Me(),q=re(k);{var W=ge=>{var me=Zo(),$e=n(me),pe=n($e);{let Ee=ye(()=>(i(Rt),e(d),t(()=>Rt(e(d).timestamp*1e3).format("LLLL"))));_t(pe,{get content(){return e(Ee)},children:(ze,Qe)=>{var He=Vo(),be=n(He,!0);r(He),x(G=>j(be,G),[()=>(l(),i(ka),e(d),i(Rt),t(()=>l().t(ka(e(d).timestamp*1e3),{LOCALIZED_TIME:Rt(e(d).timestamp*1e3).format("LT"),LOCALIZED_DATE:Rt(e(d).timestamp*1e3).format("L")})))]),a(ze,He)},$$slots:{default:!0}})}r($e),r(me),x(()=>Le($e,1,`text-[0.65rem] font-medium first-letter:capitalize mb-0.5 ${f(),t(()=>{var Ee;return((Ee=f())==null?void 0:Ee.highContrastMode)??!1?"dark:text-gray-100 text-gray-900":"invisible group-hover:visible transition text-gray-400"})??""}`)),a(ge,me)};u(q,ge=>{e(d),t(()=>e(d).timestamp)&&ge(W)},!0)}a(P,k)};u(z,P=>{f(),t(()=>{var k;return!(((k=f())==null?void 0:k.chatBubble)??!0)})?P(K):P(U,!1)})}var se=E(z,2),T=n(se);{var F=P=>{var k=Me(),q=re(k);{var W=ge=>{var me=Ko();pt(me,5,()=>(e(d),t(()=>e(d).files)),zt,($e,pe)=>{const Ee=ye(()=>(e(pe),i(Yt),t(()=>{var G,Ce,ke;return(G=e(pe).url)!=null&&G.startsWith("data")||(Ce=e(pe).url)!=null&&Ce.startsWith("http")?e(pe).url:`${Yt}/files/${e(pe).url}${(ke=e(pe))!=null&&ke.content_type?"/content":""}`})));var ze=Qo(),Qe=n(ze);{var He=G=>{Ja(G,{get src(){return e(Ee)},imageClassName:" max-h-96 rounded-lg"})},be=G=>{{let Ce=ye(()=>(e(pe),t(()=>{var ke;return(ke=e(pe))==null?void 0:ke.size})));Va(G,{get item(){return e(pe)},get url(){return e(pe),t(()=>e(pe).url)},get name(){return e(pe),t(()=>e(pe).name)},get type(){return e(pe),t(()=>e(pe).type)},get size(){return e(Ce)},small:!0})}};u(Qe,G=>{e(pe),t(()=>{var Ce;return e(pe).type==="image"||(((Ce=e(pe))==null?void 0:Ce.content_type)??"").startsWith("image/")})?G(He):G(be,!1)})}r(ze),x(()=>Le(ze,1,Ta((f(),t(()=>{var G;return((G=f())==null?void 0:G.chatBubble)??!0?"self-end":""}))))),a($e,ze)}),r(me),x(()=>{Pe(me,"dir",(f(),t(()=>{var $e;return(($e=f())==null?void 0:$e.chatDirection)??"auto"}))),me.dir=me.dir}),a(ge,me)};u(q,ge=>{e(d),t(()=>e(d).files)&&ge(W)})}a(P,k)};u(T,P=>{e(le)!==!0&&P(F)})}var $=E(T,2);{var X=P=>{var k=Xo(),q=n(k);{var W=ke=>{var ee=Yo();pt(ee,5,()=>e(R),zt,(de,ve,Be)=>{var je=Me(),et=re(je);{var kt=Je=>{const Ue=ye(()=>(e(ve),i(Yt),t(()=>{var ht,Nt,it;return(ht=e(ve).url)!=null&&ht.startsWith("data")||(Nt=e(ve).url)!=null&&Nt.startsWith("http")?e(ve).url:`${Yt}/files/${e(ve).url}${(it=e(ve))!=null&&it.content_type?"/content":""}`})));var Ye=Go(),Ze=n(Ye),jt=n(Ze);Ja(jt,{get src(){return e(Ue)},alt:"input",imageClassName:" size-14 rounded-xl object-cover"}),r(Ze);var qe=E(Ze,2),ct=n(qe);r(qe),r(Ye),x(()=>Le(ct,1,` bg-white text-black border border-white rounded-full ${f(),t(()=>{var ht;return((ht=f())==null?void 0:ht.highContrastMode)??!1?"":"group-hover:visible invisible transition"})??""}`)),Ie("click",ct,()=>{e(R).splice(Be,1),I(R,e(R))}),a(Je,Ye)},Ke=Je=>{{let Ue=ye(()=>(e(ve),t(()=>{var Ze;return(Ze=e(ve))==null?void 0:Ze.size}))),Ye=ye(()=>(e(ve),t(()=>e(ve).status==="uploading")));Va(Je,{get item(){return e(ve)},get name(){return e(ve),t(()=>e(ve).name)},get type(){return e(ve),t(()=>e(ve).type)},get size(){return e(Ue)},get loading(){return e(Ye)},dismissible:!0,edit:!0,$$events:{dismiss:async()=>{e(R).splice(Be,1),I(R,e(R))},click:()=>{e(ve)}}})}};u(et,Je=>{e(ve),t(()=>{var Ue;return e(ve).type==="image"||(((Ue=e(ve))==null?void 0:Ue.content_type)??"").startsWith("image/")})?Je(kt):Je(Ke,!1)})}a(de,je)}),r(ee),a(ke,ee)};u(q,ke=>{e(R),t(()=>(e(R)??[]).length>0)&&ke(W)})}var ge=E(q,2),me=n(ge);Ka(me),_a(me,ke=>I(ae,ke),()=>e(ae)),r(ge);var $e=E(ge,2),pe=n($e),Ee=n(pe),ze=n(Ee,!0);r(Ee),r(pe);var Qe=E(pe,2),He=n(Qe),be=n(He,!0);r(He);var G=E(He,2),Ce=n(G,!0);r(G),r(Qe),r($e),r(k),x((ke,ee,de)=>{Pe(me,"id",`message-edit-${e(d),t(()=>e(d).id)??""}`),j(ze,ke),j(be,ee),j(Ce,de)},[()=>(l(),t(()=>l().t("Save"))),()=>(l(),t(()=>l().t("Cancel"))),()=>(l(),t(()=>l().t("Send")))]),Oa(me,()=>e(fe),ke=>I(fe,ke)),Ie("input",me,ke=>{ke.target.style.height="",ke.target.style.height=`${ke.target.scrollHeight}px`}),Ie("keydown",me,ke=>{var ve,Be;ke.key==="Escape"&&((ve=document.getElementById("close-edit-message-button"))==null||ve.click());const ee=ke.metaKey||ke.ctrlKey,de=ke.key==="Enter";ee&&de&&((Be=document.getElementById("confirm-edit-message-button"))==null||Be.click())}),Ie("click",Ee,()=>{D(!1)}),Ie("click",He,()=>{C()}),Ie("click",G,()=>{D()}),a(P,k)},Y=P=>{var k=Me(),q=re(k);{var W=ge=>{var me=ei(),$e=n(me),pe=n($e),Ee=n(pe);{var ze=Qe=>{{let He=ye(()=>(i(ne()),e(d),t(()=>`${ne()}-${e(d).id}`)));Pa(Qe,{get id(){return e(He)},get content(){return e(d),t(()=>e(d).content)},get editCodeBlock(){return _e()},get topPadding(){return he()}})}};u(Ee,Qe=>{e(d),t(()=>e(d).content)&&Qe(ze)})}r(pe),r($e),r(me),x(()=>{Le($e,1,`flex ${f(),t(()=>{var Qe;return((Qe=f())==null?void 0:Qe.chatBubble)??!0?"justify-end pb-1":"w-full"})??""}`),Le(pe,1,`rounded-3xl ${f(),e(d),t(()=>{var Qe;return((Qe=f())==null?void 0:Qe.chatBubble)??!0?`max-w-[90%] px-4 py-1.5  bg-gray-50 dark:bg-gray-850 ${e(d).files?"rounded-tr-lg":""}`:" w-full"})??""}`)}),a(ge,me)};u(q,ge=>{e(d),t(()=>e(d).content!=="")&&ge(W)},!0)}a(P,k)};u($,P=>{e(le)===!0?P(X):P(Y,!1)})}var ue=E($,2);{var S=P=>{var k=vi(),q=n(k);{var W=be=>{var G=Me(),Ce=re(G);{var ke=ee=>{var de=ri(),ve=n(de),Be=E(ve,2);{var je=Ke=>{var Je=ti(),Ue=n(Je);Na(Ue);var Ye=E(Ue);r(Je),x(Ze=>{Pe(Ue,"id",`message-index-input-${e(d),t(()=>e(d).id)??""}`),Da(Ue,Ze),Pe(Ue,"max",(i(te()),t(()=>te().length))),j(Ye,`/${i(te()),t(()=>te().length)??""}`)},[()=>(i(te()),e(d),t(()=>te().indexOf(e(d).id)+1))]),Ie("focus",Ue,Ze=>{Ze.target.select()}),Ie("blur",Ue,Ze=>{v()(e(d),Ze.target.value-1),I(xe,!1)}),Ie("keydown",Ue,Ze=>{Ze.key==="Enter"&&(v()(e(d),Ze.target.value-1),I(xe,!1))}),a(Ke,Je)},et=Ke=>{var Je=ai(),Ue=n(Je);r(Je),x(Ye=>j(Ue,`${Ye??""}/${i(te()),t(()=>te().length)??""}`),[()=>(i(te()),e(d),t(()=>te().indexOf(e(d).id)+1))]),Ie("dblclick",Je,async()=>{I(xe,!0),await rt();const Ye=document.getElementById(`message-index-input-${e(d).id}`);Ye&&(Ye.focus(),Ye.select())}),a(Ke,Je)};u(Be,Ke=>{e(xe)?Ke(je):Ke(et,!1)})}var kt=E(Be,2);r(de),x(()=>de.dir=de.dir),Ie("click",ve,()=>{we()(e(d))}),Ie("click",kt,()=>{A()(e(d))}),a(ee,de)};u(Ce,ee=>{i(te()),t(()=>te().length>1)&&ee(ke)})}a(be,G)};u(q,be=>{f(),t(()=>{var G;return!(((G=f())==null?void 0:G.chatBubble)??!0)})&&be(W)})}var ge=E(q,2);{var me=be=>{{let G=ye(()=>(l(),t(()=>l().t("Edit"))));_t(be,{get content(){return e(G)},placement:"bottom",children:(Ce,ke)=>{var ee=si();x(()=>Le(ee,1,`${f(),t(()=>{var de;return((de=f())==null?void 0:de.highContrastMode)??!1?"":"invisible group-hover:visible"})??""} p-1.5 hover:bg-black/5 dark:hover:bg-white/5 rounded-lg dark:hover:text-white hover:text-black transition edit-user-message-button`)),Ie("click",ee,()=>{Q()}),a(Ce,ee)},$$slots:{default:!0}})}};u(ge,be=>{oe()||be(me)})}var $e=E(ge,2);{var pe=be=>{{let G=ye(()=>(l(),t(()=>l().t("Copy"))));_t(be,{get content(){return e(G)},placement:"bottom",children:(Ce,ke)=>{var ee=ni();x(()=>Le(ee,1,`${f(),t(()=>{var de;return((de=f())==null?void 0:de.highContrastMode)??!1?"":"invisible group-hover:visible"})??""} p-1.5 hover:bg-black/5 dark:hover:bg-white/5 rounded-lg dark:hover:text-white hover:text-black transition`)),Ie("click",ee,()=>{g(e(d).content)}),a(Ce,ee)},$$slots:{default:!0}})}};u($e,be=>{e(d),t(()=>{var G;return(G=e(d))==null?void 0:G.content})&&be(pe)})}var Ee=E($e,2);{var ze=be=>{var G=Me(),Ce=re(G);{var ke=ee=>{{let de=ye(()=>(l(),t(()=>l().t("Delete"))));_t(ee,{get content(){return e(de)},placement:"bottom",children:(ve,Be)=>{var je=oi();x(()=>Le(je,1,`${f(),t(()=>{var et;return((et=f())==null?void 0:et.highContrastMode)??!1?"":"invisible group-hover:visible"})??""} p-1 rounded-sm dark:hover:text-white hover:text-black transition`)),Ie("click",je,()=>{I(ie,!0)}),a(ve,je)},$$slots:{default:!0}})}};u(Ce,ee=>{i(oe()),i(s()),i(te()),t(()=>!oe()&&(!s()||te().length>1))&&ee(ke)})}a(be,G)};u(Ee,be=>{L(),t(()=>{var G,Ce,ke,ee;return((G=L())==null?void 0:G.role)==="admin"||(((ee=(ke=(Ce=L())==null?void 0:Ce.permissions)==null?void 0:ke.chat)==null?void 0:ee.delete_message)??!1)})&&be(ze)})}var Qe=E(Ee,2);{var He=be=>{var G=Me(),Ce=re(G);{var ke=ee=>{var de=di(),ve=n(de),Be=E(ve,2);{var je=Ke=>{var Je=ii(),Ue=n(Je);Na(Ue);var Ye=E(Ue);r(Je),x(Ze=>{Pe(Ue,"id",`message-index-input-${e(d),t(()=>e(d).id)??""}`),Da(Ue,Ze),Pe(Ue,"max",(i(te()),t(()=>te().length))),j(Ye,`/${i(te()),t(()=>te().length)??""}`)},[()=>(i(te()),e(d),t(()=>te().indexOf(e(d).id)+1))]),Ie("focus",Ue,Ze=>{Ze.target.select()}),Ie("blur",Ue,Ze=>{v()(e(d),Ze.target.value-1),I(xe,!1)}),Ie("keydown",Ue,Ze=>{Ze.key==="Enter"&&(v()(e(d),Ze.target.value-1),I(xe,!1))}),a(Ke,Je)},et=Ke=>{var Je=li(),Ue=n(Je);r(Je),x(Ye=>j(Ue,`${Ye??""}/${i(te()),t(()=>te().length)??""}`),[()=>(i(te()),e(d),t(()=>te().indexOf(e(d).id)+1))]),Ie("dblclick",Je,async()=>{I(xe,!0),await rt();const Ye=document.getElementById(`message-index-input-${e(d).id}`);Ye&&(Ye.focus(),Ye.select())}),a(Ke,Je)};u(Be,Ke=>{e(xe)?Ke(je):Ke(et,!1)})}var kt=E(Be,2);r(de),x(()=>de.dir=de.dir),Ie("click",ve,()=>{we()(e(d))}),Ie("click",kt,()=>{A()(e(d))}),a(ee,de)};u(Ce,ee=>{i(te()),t(()=>te().length>1)&&ee(ke)})}a(be,G)};u(Qe,be=>{f(),t(()=>{var G;return((G=f())==null?void 0:G.chatBubble)??!0})&&be(He)})}r(k),x(()=>Le(k,1,` flex ${f(),t(()=>{var be;return((be=f())==null?void 0:be.chatBubble)??!0?"justify-end":""})??""}  text-gray-600 dark:text-gray-500`)),a(P,k)};u(ue,P=>{e(le)!==!0&&P(S)})}r(se),r(O),r(_),x(()=>{Pe(_,"dir",(f(),t(()=>f().chatDirection))),Pe(_,"id",`message-${e(d),t(()=>e(d).id)??""}`),Le(se,1,`chat-${e(d),t(()=>e(d).role)??""} w-full min-w-full markdown-prose`),_.dir=_.dir}),a(Ne,h),Et(),M()}var ui=m('<div role="listitem"><!></div>');function fi(Ne,o){$t(o,!1);const l=()=>Fe(fa,"$settings",f),[f,L]=Jt();Ba(),Wt("i18n");let N=c(o,"chatId",8),M=c(o,"selectedModels",24,()=>[]),J=c(o,"idx",8,0),V=c(o,"history",12),ne=c(o,"messageId",8),b=c(o,"user",8),B=c(o,"setInputText",8,()=>{}),te=c(o,"gotoMessage",8),v=c(o,"showPreviousMessage",8),we=c(o,"showNextMessage",8),A=c(o,"updateChat",8),Z=c(o,"editMessage",8),ce=c(o,"saveMessage",8),s=c(o,"deleteMessage",8),oe=c(o,"rateMessage",8),_e=c(o,"actionMessage",8),he=c(o,"submitMessage",8),ie=c(o,"regenerateResponse",8),xe=c(o,"continueResponse",8),le=c(o,"mergeResponses",8),fe=c(o,"addMessages",8),R=c(o,"triggerScroll",8),ae=c(o,"readOnly",8,!1),d=c(o,"editCodeBlock",8,!0),g=c(o,"topPadding",8,!1);St();var Q=ui(),D=n(Q);{var C=y=>{var h=Me(),H=re(h);{var _=p=>{{let O=ye(()=>J()===0),z=ye(()=>(i(V()),i(ne()),t(()=>{var K;return V().messages[ne()].parentId!==null?((K=V().messages[V().messages[ne()].parentId])==null?void 0:K.childrenIds)??[]:Object.values(V().messages).filter(U=>U.parentId===null).map(U=>U.id)??[]})));gi(p,{get user(){return b()},get chatId(){return N()},get history(){return V()},get messageId(){return ne()},get isFirstMessage(){return e(O)},get siblings(){return e(z)},get gotoMessage(){return te()},get showPreviousMessage(){return v()},get showNextMessage(){return we()},get editMessage(){return Z()},get deleteMessage(){return s()},get readOnly(){return ae()},get editCodeBlock(){return d()},get topPadding(){return g()}})}},w=p=>{var O=Me(),z=re(O);{var K=se=>{{let T=ye(()=>(i(ne()),i(V()),t(()=>ne()===V().currentId))),F=ye(()=>(i(V()),i(ne()),t(()=>{var $;return(($=V().messages[V().messages[ne()].parentId])==null?void 0:$.childrenIds)??[]})));Qa(se,{get chatId(){return N()},get history(){return V()},get messageId(){return ne()},get selectedModels(){return M()},get isLastMessage(){return e(T)},get siblings(){return e(F)},get setInputText(){return B()},get gotoMessage(){return te()},get showPreviousMessage(){return v()},get showNextMessage(){return we()},get updateChat(){return A()},get editMessage(){return Z()},get saveMessage(){return ce()},get rateMessage(){return oe()},get actionMessage(){return _e()},get submitMessage(){return he()},get deleteMessage(){return s()},get continueResponse(){return xe()},get regenerateResponse(){return ie()},get addMessages(){return fe()},get readOnly(){return ae()},get editCodeBlock(){return d()},get topPadding(){return g()}})}},U=se=>{var T=Me(),F=re(T);Ia(F,ne,$=>{{let X=ye(()=>(i(ne()),i(V()),t(()=>{var Y;return ne()===((Y=V())==null?void 0:Y.currentId)})));Ho($,{get chatId(){return N()},get messageId(){return ne()},get selectedModels(){return M()},get isLastMessage(){return e(X)},get setInputText(){return B()},get updateChat(){return A()},get editMessage(){return Z()},get saveMessage(){return ce()},get rateMessage(){return oe()},get actionMessage(){return _e()},get submitMessage(){return he()},get deleteMessage(){return s()},get continueResponse(){return xe()},get regenerateResponse(){return ie()},get mergeResponses(){return le()},get triggerScroll(){return R()},get addMessages(){return fe()},get readOnly(){return ae()},get editCodeBlock(){return d()},get topPadding(){return g()},get history(){return V()},set history(Y){V(Y)},$$legacy:!0})}}),a(se,T)};u(z,se=>{i(V()),i(ne()),t(()=>{var T,F;return(((F=(T=V().messages[V().messages[ne()].parentId])==null?void 0:T.models)==null?void 0:F.length)??1)===1})?se(K):se(U,!1)},!0)}a(p,O)};u(H,p=>{i(V()),i(ne()),t(()=>V().messages[ne()].role==="user")?p(_):p(w,!1)})}a(y,h)};u(D,y=>{i(V()),i(ne()),t(()=>V().messages[ne()])&&y(C)})}r(Q),x(()=>Le(Q,1,`flex flex-col justify-between px-5 mb-3 w-full ${l(),t(()=>{var y;return((y=l())==null?void 0:y.widescreenMode)??null?"max-w-full":"max-w-5xl"})??""} mx-auto rounded-lg group`)),a(Ne,Q),Et(),L()}var mi=m("<!> ",1),hi=m("<div> </div>"),_i=m('<div class="font-medium dark:text-gray-300 dark:group-hover:text-gray-200 transition line-clamp-1 svelte-6tnq1o"> </div> <div class="text-xs text-gray-600 dark:text-gray-400 font-normal line-clamp-1 svelte-6tnq1o"> </div>',1),pi=m('<div class="font-medium dark:text-gray-300 dark:group-hover:text-gray-200 transition line-clamp-1 svelte-6tnq1o"> </div> <div class="text-xs text-gray-600 dark:text-gray-400 font-normal line-clamp-1 svelte-6tnq1o"> </div>',1),xi=m(`<button role="listitem" class="waterfall flex flex-col flex-1 shrink-0 w-full justify-between
				       px-3 py-2 rounded-xl bg-transparent hover:bg-black/5
				       dark:hover:bg-white/5 transition group svelte-6tnq1o"><div class="flex flex-col text-left svelte-6tnq1o"><!></div></button>`),bi=m('<div role="list"></div>'),wi=m('<div class="mb-1 flex gap-1 text-xs font-medium items-center text-gray-600 dark:text-gray-400 svelte-6tnq1o"><!></div> <div class="h-40 w-full svelte-6tnq1o"><!></div>',1);function yi(Ne,o){$t(o,!1);const l=()=>Fe(J,"$i18n",N),f=()=>Fe(fa,"$settings",N),L=()=>Fe(Br,"$WEBUI_NAME",N),[N,M]=Jt(),J=Wt("i18n");let V=c(o,"suggestionPrompts",24,()=>[]),ne=c(o,"className",8,""),b=c(o,"inputValue",8,""),B=c(o,"onSelect",8,R=>{}),te=Se([]);const v={keys:["content","title"],threshold:.5};let we=Se(),A=Se([]);function Z(R,ae){if(R.length!==ae.length)return!1;for(let d=0;d<R.length;d++)if((R[d].id??R[d].content)!==(ae[d].id??ae[d].content))return!1;return!0}const ce=R=>{if(R.length>500)I(A,[]);else{const ae=R.trim()&&e(we)?e(we).search(R.trim()).map(d=>d.item):e(te);Z(e(A),ae)||I(A,ae)}};It(()=>(i(V()),i(b())),()=>{V()&&(I(te,[...V()??[]].sort(()=>Math.random()-.5)),ce(b()))}),It(()=>e(te),()=>{I(we,new ds(e(te),v))}),It(()=>i(b()),()=>{ce(b())}),ta(),St();var s=wi(),oe=re(s),_e=n(oe);{var he=R=>{var ae=mi(),d=re(ae);Vr(d,{});var g=E(d);x(Q=>j(g,` ${Q??""}`),[()=>(l(),t(()=>l().t("Suggested")))]),a(R,ae)},ie=R=>{var ae=hi(),d=n(ae);r(ae),x(()=>{Le(ae,1,`flex w-full ${f(),t(()=>{var g;return((g=f())==null?void 0:g.landingPageMode)==="chat"?" -mt-1":"text-center items-center justify-center"})??""}  self-start text-gray-600 dark:text-gray-400`,"svelte-6tnq1o"),j(d,`${L()??""}  v${qr}`)}),a(R,ae)};u(_e,R=>{e(A),t(()=>e(A).length>0)?R(he):R(ie,!1)})}r(oe);var xe=E(oe,2),le=n(xe);{var fe=R=>{var ae=bi();pt(ae,7,()=>e(A),(d,g)=>d.id||`${d.content}-${g}`,(d,g,Q)=>{var D=xi(),C=n(D),y=n(C);{var h=_=>{var w=_i(),p=re(w),O=n(p,!0);r(p);var z=E(p,2),K=n(z,!0);r(z),x(()=>{j(O,(e(g),t(()=>e(g).title[0]))),j(K,(e(g),t(()=>e(g).title[1])))}),a(_,w)},H=_=>{var w=pi(),p=re(w),O=n(p,!0);r(p);var z=E(p,2),K=n(z,!0);r(z),x(U=>{j(O,(e(g),t(()=>e(g).content))),j(K,U)},[()=>(l(),t(()=>l().t("Prompt")))]),a(_,w)};u(y,_=>{e(g),t(()=>e(g).title&&e(g).title[0]!=="")?_(h):_(H,!1)})}r(C),r(D),x(()=>Ir(D,`animation-delay: ${e(Q)*60}ms`)),Ie("click",D,()=>B()({type:"prompt",data:e(g).content})),a(d,D)}),r(ae),x(()=>Le(ae,1,`max-h-40 overflow-auto scrollbar-none items-start ${ne()??""}`,"svelte-6tnq1o")),a(R,ae)};u(le,R=>{e(A),t(()=>e(A).length>0)&&R(fe)})}r(xe),a(Ne,s),Et(),M()}var ki=m('<img class=" size-[2.7rem] rounded-full border-[1px] border-gray-100 dark:border-none" alt="logo" draggable="false"/>'),Mi=m("<button><!></button>"),Ii=m('<div class="flex items-center gap-2 text-gray-500 text-lg mt-2 w-fit"><!> </div>'),Ci=m("<a> </a>"),$i=m('<div class="mt-0.5 text-sm font-normal text-gray-400 dark:text-gray-500">By <!></div>'),Ei=m('<div class="mt-0.5 text-base font-normal text-gray-500 dark:text-gray-400 line-clamp-3 markdown"><!></div> <!>',1),Si=m('<div class=" text-gray-400 dark:text-gray-500 line-clamp-1 font-p"> </div>'),Ni=m('<div class="m-auto w-full max-w-6xl px-8 lg:px-20"><div class="flex justify-start"><div class="flex -space-x-4 mb-0.5"></div></div> <!> <div class=" mt-2 mb-4 text-3xl text-gray-800 dark:text-gray-100 text-left flex items-center gap-4 font-primary"><div><div class=" capitalize line-clamp-1"><!></div> <div><!></div></div></div> <div class=" w-full font-primary"><!></div></div>');function Pi(Ne,o){$t(o,!1);const l=()=>Fe(La,"$_models",J),f=()=>Fe(ne,"$i18n",J),L=()=>Fe(Ya,"$temporaryChatEnabled",J),N=()=>Fe(ja,"$user",J),M=()=>Fe(ur,"$config",J),[J,V]=Jt(),ne=Wt("i18n");let b=c(o,"modelIds",24,()=>[]),B=c(o,"models",28,()=>[]),te=c(o,"atSelectedModel",8),v=c(o,"onSelect",8,s=>{}),we=Se(!1),A=Se(0);Ca(()=>{I(we,!0)}),It(()=>(i(b()),l()),()=>{B(b().map(s=>l().find(oe=>oe.id===s)))}),It(()=>(i(b()),i(B())),()=>{b().length>0&&I(A,B().length-1)}),ta(),St();var Z=Me(),ce=re(Z);Ia(ce,()=>e(we),s=>{var oe=Ni(),_e=n(oe),he=n(_e);pt(he,5,B,zt,(_,w,p)=>{var O=Mi(),z=n(O);{let K=ye(()=>(i(Ra),i(Ma),i(B()),e(A),t(()=>{var U,se,T;return Ra.parse(Ma(((T=(se=(U=B()[e(A)])==null?void 0:U.info)==null?void 0:se.meta)==null?void 0:T.description)??"").replaceAll(`
`,"<br>"))})));_t(z,{get content(){return e(K)},placement:"right",children:(U,se)=>{var T=ki();x(()=>Pe(T,"src",(i(Yt),e(w),f(),t(()=>{var F;return`${Yt}/models/model/profile/image?id=${(F=e(w))==null?void 0:F.id}&lang=${f().language}`})))),a(U,T)},$$slots:{default:!0}})}r(O),Ie("click",O,()=>{I(A,p)}),a(_,O)}),r(he),r(_e);var ie=E(_e,2);{var xe=_=>{{let w=ye(()=>(f(),t(()=>f().t("This chat won't appear in history and your messages will not be saved."))));_t(_,{get content(){return e(w)},className:"w-full flex justify-start mb-0.5",placement:"top",children:(p,O)=>{var z=Ii(),K=n(z);vs(K,{strokeWidth:"2.5",className:"size-5"});var U=E(K,1,!0);r(z),x(se=>j(U,se),[()=>(f(),t(()=>f().t("Temporary Chat")))]),a(p,z)},$$slots:{default:!0}})}};u(ie,_=>{L()&&_(xe)})}var le=E(ie,2),fe=n(le),R=n(fe),ae=n(R);{var d=_=>{var w=De();x(()=>j(w,(i(B()),e(A),t(()=>{var p;return(p=B()[e(A)])==null?void 0:p.name})))),a(_,w)},g=_=>{var w=De();x(p=>j(w,p),[()=>(f(),N(),t(()=>{var p;return f().t("Hello, {{name}}",{name:(p=N())==null?void 0:p.name})}))]),a(_,w)};u(ae,_=>{i(B()),e(A),t(()=>{var w;return(w=B()[e(A)])==null?void 0:w.name})?_(d):_(g,!1)})}r(R);var Q=E(R,2),D=n(Q);{var C=_=>{var w=Ei(),p=re(w),O=n(p);ls(O,()=>(i(Ra),i(Ma),i(B()),e(A),t(()=>{var U,se,T;return Ra.parse(Ma((T=(se=(U=B()[e(A)])==null?void 0:U.info)==null?void 0:se.meta)==null?void 0:T.description).replaceAll(`
`,"<br>"))}))),r(p);var z=E(p,2);{var K=U=>{var se=$i(),T=E(n(se));{var F=X=>{var Y=Ci(),ue=n(Y,!0);r(Y),x(()=>{Pe(Y,"href",`https://openwebui.com/m/${i(B()),e(A),t(()=>{var S,P,k;return(k=(P=(S=B()[e(A)])==null?void 0:S.info)==null?void 0:P.meta)==null?void 0:k.user.username})??""}`),j(ue,(i(B()),e(A),t(()=>{var S,P,k,q,W,ge,me,$e,pe;return(k=(P=(S=B()[e(A)])==null?void 0:S.info)==null?void 0:P.meta)!=null&&k.user.name?(ge=(W=(q=B()[e(A)])==null?void 0:q.info)==null?void 0:W.meta)==null?void 0:ge.user.name:`@${(pe=($e=(me=B()[e(A)])==null?void 0:me.info)==null?void 0:$e.meta)==null?void 0:pe.user.username}`})))}),a(X,Y)},$=X=>{var Y=De();x(()=>j(Y,(i(B()),e(A),t(()=>{var ue,S,P;return(P=(S=(ue=B()[e(A)])==null?void 0:ue.info)==null?void 0:S.meta)==null?void 0:P.user.name})))),a(X,Y)};u(T,X=>{i(B()),e(A),t(()=>{var Y,ue,S;return(S=(ue=(Y=B()[e(A)])==null?void 0:Y.info)==null?void 0:ue.meta)==null?void 0:S.user.community})?X(F):X($,!1)})}r(se),a(U,se)};u(z,U=>{i(B()),e(A),t(()=>{var se,T,F;return(F=(T=(se=B()[e(A)])==null?void 0:se.info)==null?void 0:T.meta)==null?void 0:F.user})&&U(K)})}a(_,w)},y=_=>{var w=Si(),p=n(w,!0);r(w),x(O=>j(p,O),[()=>(f(),t(()=>f().t("How can I help you today?")))]),a(_,w)};u(D,_=>{i(B()),e(A),t(()=>{var w,p,O;return((O=(p=(w=B()[e(A)])==null?void 0:w.info)==null?void 0:p.meta)==null?void 0:O.description)??null})?_(C):_(y,!1)})}r(Q),r(fe),r(le);var h=E(le,2),H=n(h);{let _=ye(()=>(i(te()),i(B()),e(A),M(),t(()=>{var w,p,O,z,K,U,se;return((O=(p=(w=te())==null?void 0:w.info)==null?void 0:p.meta)==null?void 0:O.suggestion_prompts)??((U=(K=(z=B()[e(A)])==null?void 0:z.info)==null?void 0:K.meta)==null?void 0:U.suggestion_prompts)??((se=M())==null?void 0:se.default_prompt_suggestions)??[]})));yi(H,{className:"grid grid-cols-2",get suggestionPrompts(){return e(_)},get onSelect(){return v()}})}r(h),r(oe),Ea(1,he,()=>Sa,()=>({duration:200})),Ea(1,R,()=>Sa,()=>({duration:200})),Ea(1,Q,()=>Sa,()=>({duration:200,delay:200})),Ea(1,h,()=>Sa,()=>({duration:200,delay:300})),a(s,oe)}),a(Ne,Z),Et(),V()}var Bi=m('<div class="w-full flex justify-center py-1 text-xs animate-pulse items-center gap-2"><!> <div class=" "> </div></div>'),Ti=m('<div class="  pb-6"></div>'),Li=m('<section class="w-full" aria-labelledby="chat-conversation"><h2 class="sr-only" id="chat-conversation"> </h2> <!> <ul role="log" aria-live="polite" aria-relevant="additions" aria-atomic="false"></ul></section> <div class="pb-18"></div> <!>',1),Oi=m('<div class="w-full pt-2"><!></div>'),Ri=m("<div><!></div>");function Dl(Ne,o){$t(o,!1);const l=()=>Fe(ja,"$_user",J),f=()=>Fe(Ya,"$temporaryChatEnabled",J),L=()=>Fe(nr,"$currentChatPage",J),N=()=>Fe(fa,"$settings",J),M=()=>Fe(ne,"$i18n",J),[J,V]=Jt();Ba();const ne=Wt("i18n");let b=c(o,"className",8,"h-full flex pt-8"),B=c(o,"chatId",8,""),te=c(o,"user",24,l);c(o,"prompt",8);let v=c(o,"history",28,()=>({})),we=c(o,"selectedModels",8),A=c(o,"atSelectedModel",8),Z=Se([]),ce=c(o,"setInputText",8,()=>{}),s=c(o,"sendMessage",8),oe=c(o,"continueResponse",8),_e=c(o,"regenerateResponse",8),he=c(o,"mergeResponses",8),ie=c(o,"chatActionHandler",8),xe=c(o,"showMessage",8,()=>{}),le=c(o,"submitMessage",8,()=>{}),fe=c(o,"addMessages",8,()=>{}),R=c(o,"readOnly",8,!1),ae=c(o,"editCodeBlock",8,!0),d=c(o,"topPadding",8,!1),g=c(o,"bottomPadding",8,!1),Q=c(o,"autoScroll",12),D=c(o,"onSelect",8,S=>{}),C=c(o,"messagesCount",12,20),y=Se(!1);const h=async()=>{const S=document.getElementById("messages-container");S.scrollTop=S.scrollTop+100,I(y,!0),C(C()+20),await rt(),I(y,!1)},H=()=>{const S=document.getElementById("messages-container");S.scrollTop=S.scrollHeight},_=async()=>{f()||(v(v()),await rt(),await Or(localStorage.token,B(),{history:v(),messages:e(Z)}),nr.set(1),await Tr.set(await Rr(localStorage.token,L())))},w=async(S,P)=>{var W;let k;S.parentId!==null?k=v().messages[S.parentId].childrenIds:k=Object.values(v().messages).filter(ge=>ge.parentId===null).map(ge=>ge.id),P=Math.max(0,Math.min(P,k.length-1));let q=k[P];if(S.id!==q){let ge=v().messages[q].childrenIds;for(;ge.length!==0;)q=ge.at(-1),ge=v().messages[q].childrenIds;v(v().currentId=q,!0)}if(await rt(),((W=N())==null?void 0:W.scrollOnBranchChange)??!0){const ge=document.getElementById("messages-container");Q(ge.scrollHeight-ge.scrollTop<=ge.clientHeight+50),setTimeout(()=>{H()},100)}},p=async S=>{var P;if(S.parentId!==null){let k=v().messages[S.parentId].childrenIds[Math.max(v().messages[S.parentId].childrenIds.indexOf(S.id)-1,0)];if(S.id!==k){let q=v().messages[k].childrenIds;for(;q.length!==0;)k=q.at(-1),q=v().messages[k].childrenIds;v(v().currentId=k,!0)}}else{let k=Object.values(v().messages).filter(W=>W.parentId===null).map(W=>W.id),q=k[Math.max(k.indexOf(S.id)-1,0)];if(S.id!==q){let W=v().messages[q].childrenIds;for(;W.length!==0;)q=W.at(-1),W=v().messages[q].childrenIds;v(v().currentId=q,!0)}}if(await rt(),((P=N())==null?void 0:P.scrollOnBranchChange)??!0){const k=document.getElementById("messages-container");Q(k.scrollHeight-k.scrollTop<=k.clientHeight+50),setTimeout(()=>{H()},100)}},O=async S=>{var P;if(S.parentId!==null){let k=v().messages[S.parentId].childrenIds[Math.min(v().messages[S.parentId].childrenIds.indexOf(S.id)+1,v().messages[S.parentId].childrenIds.length-1)];if(S.id!==k){let q=v().messages[k].childrenIds;for(;q.length!==0;)k=q.at(-1),q=v().messages[k].childrenIds;v(v().currentId=k,!0)}}else{let k=Object.values(v().messages).filter(W=>W.parentId===null).map(W=>W.id),q=k[Math.min(k.indexOf(S.id)+1,k.length-1)];if(S.id!==q){let W=v().messages[q].childrenIds;for(;W.length!==0;)q=W.at(-1),W=v().messages[q].childrenIds;v(v().currentId=q,!0)}}if(await rt(),((P=N())==null?void 0:P.scrollOnBranchChange)??!0){const k=document.getElementById("messages-container");Q(k.scrollHeight-k.scrollTop<=k.clientHeight+50),setTimeout(()=>{H()},100)}},z=async(S,P)=>{v(v().messages[S].annotation={...v().messages[S].annotation,rating:P},!0),await _()},K=async(S,{content:P,files:k},q=!0)=>{if((we()??[]).filter(W=>W).length===0){qt.error(M().t("Model not selected"));return}if(v().messages[S].role==="user")if(q){let W=P,ge=ir(),me={id:ge,parentId:v().messages[S].parentId,childrenIds:[],role:"user",content:W,...k&&{files:k},models:we(),timestamp:Math.floor(Date.now()/1e3)},$e=v().messages[S].parentId;$e!==null&&v(v().messages[$e].childrenIds=[...v().messages[$e].childrenIds,ge],!0),v(v().messages[ge]=me,!0),v(v().currentId=ge,!0),await rt(),await s()(v(),ge)}else v(v().messages[S].content=P,!0),v(v().messages[S].files=k,!0),await _();else if(q){const W=ir(),ge=v().messages[S],me=ge.parentId,$e={...ge,id:W,parentId:me,childrenIds:[],files:void 0,content:P,timestamp:Math.floor(Date.now()/1e3)};v(v().messages[W]=$e,!0),v(v().currentId=W,!0),me!==null&&v(v().messages[me].childrenIds=[...v().messages[me].childrenIds,W],!0),await _()}else v(v().messages[S].originalContent=v().messages[S].content,!0),v(v().messages[S].content=P,!0),await _()},U=async(S,P,k=null)=>{await ie()(B(),S,P.model,P.id,k)},se=async(S,P)=>{var k;(k=v().messages)!=null&&k[S]&&(v(v().messages[S]=P,!0),await _())},T=async S=>{const P=v().messages[S],k=P.parentId,q=P.childrenIds??[],W=q.flatMap(ge=>{var me;return((me=v().messages[ge])==null?void 0:me.childrenIds)??[]});k&&v().messages[k]&&v(v().messages[k].childrenIds=[...v().messages[k].childrenIds.filter(ge=>ge!==S),...W],!0),W.forEach(ge=>{v().messages[ge]&&v(v().messages[ge].parentId=k,!0)}),[S,...q].forEach(ge=>{delete v().messages[ge]}),await rt(),xe()({id:k}),await _()},F=()=>{if(Q()){const S=document.getElementById("messages-container");Q(S.scrollHeight-S.scrollTop<=S.clientHeight+50),setTimeout(()=>{H()},100)}};It(()=>(i(v()),i(C())),()=>{if(v().currentId){let S=[],P=v().messages[v().currentId];const k=new Set;for(;P&&(C()===null||S.length<=C());){if(k.has(P.id)){console.warn("Circular dependency detected in message history",P.id);break}k.add(P.id),S.unshift({...P}),P=P.parentId!==null?v().messages[P.parentId]:null}I(Z,S)}else I(Z,[])}),It(()=>(i(Q()),i(g()),rt),()=>{Q()&&g()&&(async()=>(await rt(),H()))()}),ta(),St();var $=Ri(),X=n($);{var Y=S=>{Pi(S,{get modelIds(){return we()},get atSelectedModel(){return A()},get onSelect(){return D()}})},ue=S=>{var P=Oi(),k=n(P);Ia(k,B,q=>{var W=Li(),ge=re(W),me=n(ge),$e=n(me,!0);r(me);var pe=E(me,2);{var Ee=be=>{is(be,{$$events:{visible:G=>{e(y)||h()}},children:(G,Ce)=>{var ke=Bi(),ee=n(ke);tr(ee,{className:" size-4"});var de=E(ee,2),ve=n(de,!0);r(de),r(ke),x(Be=>j(ve,Be),[()=>(M(),t(()=>M().t("Loading...")))]),a(G,ke)},$$slots:{default:!0}})};u(pe,be=>{e(Z),t(()=>{var G;return((G=e(Z).at(0))==null?void 0:G.parentId)!==null})&&be(Ee)})}var ze=E(pe,2);pt(ze,7,()=>e(Z),be=>be.id,(be,G,Ce)=>{fi(be,{get chatId(){return B()},get selectedModels(){return we()},get messageId(){return e(G),t(()=>e(G).id)},get idx(){return e(Ce)},get user(){return te()},get setInputText(){return ce()},gotoMessage:w,showPreviousMessage:p,showNextMessage:O,updateChat:_,editMessage:K,deleteMessage:T,rateMessage:z,actionMessage:U,saveMessage:se,get submitMessage(){return le()},get regenerateResponse(){return _e()},get continueResponse(){return oe()},get mergeResponses(){return he()},get addMessages(){return fe()},triggerScroll:F,get readOnly(){return R()},get editCodeBlock(){return ae()},get topPadding(){return d()},get history(){return v()},set history(ke){v(ke)},$$legacy:!0})}),r(ze),r(ge);var Qe=E(ge,4);{var He=be=>{var G=Ti();a(be,G)};u(Qe,be=>{g()&&be(He)})}x(be=>j($e,be),[()=>(M(),t(()=>M().t("Chat Conversation")))]),a(q,W)}),r(P),a(S,P)};u(X,S=>{i(v()),t(()=>{var P;return Object.keys(((P=v())==null?void 0:P.messages)??{}).length==0})?S(Y):S(ue,!1)})}r($),x(()=>Le($,1,Ta(b()))),a(Ne,$),Et(),V()}export{fn as K,Dl as M,yi as S};
//# sourceMappingURL=C-5A-I7X.js.map
