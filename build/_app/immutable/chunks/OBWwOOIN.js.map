{"version":3,"mappings":";+KAKO,MAAMA,EAAc,MAAOC,GAAS,SAC1C,KAAM,CAAC,CAAE,QAASC,GAAS,CAAE,QAASC,EAAa,EAAI,MAAM,QAAQ,IAAI,CAAAC,EAAA,IACxE,OAAO,eAAO,4CAAAA,EAAA,IACd,OAAO,eAAiB,sBACxB,EAGKC,EAAe,KACfC,EAAgB,KAGhBC,EAAOC,EAAU,WAASC,GAAAC,EAAAT,EAAK,OAAL,YAAAS,EAAW,UAAX,YAAAD,EAAoB,OAAQ,EAAE,EACxDE,EAAa,SAAS,gBAAgB,UAAU,SAAS,MAAM,EAErE,IAAIC,EACJ,GAAIL,aAAgB,YACnBK,EAAOL,MACD,CAINK,EAAO,SAAS,cAAc,KAAK,EAGnC,MAAMC,EAAY,SAAS,cAAc,KAAK,EAC9CA,EAAU,YAAcZ,EAAK,MAC7BY,EAAU,MAAM,SAAW,OAC3BA,EAAU,MAAM,WAAa,SAC7BA,EAAU,MAAM,cAAgB,OAChCA,EAAU,MAAM,MAAQF,EAAa,QAAU,QAC/CC,EAAK,YAAYC,CAAS,EAE1B,MAAMC,EAAc,SAAS,cAAc,KAAK,EAEhDA,EAAY,UAAYP,EAExBK,EAAK,YAAYE,CAAW,EAE5BF,EAAK,UAAU,IAAI,YAAY,EAC/BA,EAAK,UAAU,IAAI,iBAAiB,EACpCA,EAAK,MAAM,MAAQ,QACnBA,EAAK,MAAM,SAAW,WACtBA,EAAK,MAAM,KAAO,UAClBA,EAAK,MAAM,OAAS,OACpBA,EAAK,MAAM,QAAU,YAGrB,SAAS,KAAK,YAAYA,CAAI,CAC/B,CAGA,MAAMG,EAAS,MAAMZ,EAAYS,EAAM,CACtC,QAAS,GACT,gBAAiBD,EAAa,OAAS,OACvC,MAAO,EACP,MAAON,EACP,YAAaA,EACb,aAAcC,CAAA,CACd,EAGKC,aAAgB,aACrB,SAAS,KAAK,YAAYK,CAAI,EAG/B,MAAMI,EAAUD,EAAO,UAAU,aAAc,EAAG,EAG5CE,EAAM,IAAIf,EAAM,IAAK,KAAM,IAAI,EAC/BgB,EAAW,IACXC,EAAc,IACdC,EAAa,IACbC,EAAe,IAEjBV,IACHM,EAAI,aAAa,EAAG,EAAG,CAAC,EACxBA,EAAI,KAAK,EAAG,EAAGE,EAAaE,EAAc,GAAG,GAI9C,MAAMC,EAAaP,EAAO,OAASG,EAAYH,EAAO,MACtD,IAAIQ,EAAaD,EACbE,EAAW,EAMf,IAJAP,EAAI,SAASD,EAAS,OAAQ,EAAGQ,EAAUN,EAAUI,CAAS,EAC9DC,GAAcH,EAGPG,EAAa,GACnBC,GAAYJ,EACZH,EAAI,UAEAN,IACHM,EAAI,aAAa,EAAG,EAAG,CAAC,EACxBA,EAAI,KAAK,EAAG,EAAGE,EAAaE,EAAc,GAAG,GAG9CJ,EAAI,SAASD,EAAS,OAAQ,EAAGQ,EAAUN,EAAUI,CAAS,EAC9DC,GAAcH,EAGfH,EAAI,KAAK,GAAGhB,EAAK,KAAK,MAAM,CAC7B,EAEawB,EAAoB,MAAOC,EAAeC,EAAapB,IAAkB,CAErF,MAAMqB,EAAM,MAAMC,EAAc,aAAa,MAAO,CAEnD,MAAAH,EACA,KAAM,CACL,QAAS,CACR,KAAM,KACN,KAAMnB,GAAQoB,GAAM,GACpB,GAAIA,GAAM,GACX,EAED,KAAM,KACN,eAAgB,EAAC,CACjB,EAAE,MAAOG,IACTC,EAAM,MAAM,GAAGD,CAAK,EAAE,EACf,KACP,EAED,GAAIF,EACH,OAAOA,CAET","names":["downloadPdf","note","jsPDF","html2canvas","__vitePreload","virtualWidth","virtualHeight","html","DOMPurify","_b","_a","isDarkMode","node","titleNode","contentNode","canvas","imgData","pdf","imgWidth","pageWidthMM","pageHeight","pageHeightMM","imgHeight","heightLeft","position","createNoteHandler","title","md","res","createNewNote","error","toast"],"ignoreList":[],"sources":["../../../../../../src/lib/components/notes/utils.ts"],"sourcesContent":["import DOMPurify from 'dompurify';\nimport { toast } from 'svelte-sonner';\n\nimport { createNewNote } from '$lib/apis/notes';\n\nexport const downloadPdf = async (note) => {\n\tconst [{ default: jsPDF }, { default: html2canvas }] = await Promise.all([\n\t\timport('jspdf'),\n\t\timport('html2canvas-pro')\n\t]);\n\n\t// Define a fixed virtual screen size\n\tconst virtualWidth = 1024; // Fixed width (adjust as needed)\n\tconst virtualHeight = 1400; // Fixed height (adjust as needed)\n\n\t// STEP 1. Get a DOM node to render\n\tconst html = DOMPurify.sanitize(note.data?.content?.html ?? '');\n\tconst isDarkMode = document.documentElement.classList.contains('dark');\n\n\tlet node;\n\tif (html instanceof HTMLElement) {\n\t\tnode = html;\n\t} else {\n\t\tconst virtualWidth = 800; // px, fixed width for cloned element\n\n\t\t// Clone and style\n\t\tnode = document.createElement('div');\n\n\t\t// title node\n\t\tconst titleNode = document.createElement('div');\n\t\ttitleNode.textContent = note.title;\n\t\ttitleNode.style.fontSize = '24px';\n\t\ttitleNode.style.fontWeight = 'medium';\n\t\ttitleNode.style.paddingBottom = '20px';\n\t\ttitleNode.style.color = isDarkMode ? 'white' : 'black';\n\t\tnode.appendChild(titleNode);\n\n\t\tconst contentNode = document.createElement('div');\n\n\t\tcontentNode.innerHTML = html;\n\n\t\tnode.appendChild(contentNode);\n\n\t\tnode.classList.add('text-black');\n\t\tnode.classList.add('dark:text-white');\n\t\tnode.style.width = `${virtualWidth}px`;\n\t\tnode.style.position = 'absolute';\n\t\tnode.style.left = '-9999px';\n\t\tnode.style.height = 'auto';\n\t\tnode.style.padding = '40px 40px';\n\n\t\tconsole.log(node);\n\t\tdocument.body.appendChild(node);\n\t}\n\n\t// Render to canvas with predefined width\n\tconst canvas = await html2canvas(node, {\n\t\tuseCORS: true,\n\t\tbackgroundColor: isDarkMode ? '#000' : '#fff',\n\t\tscale: 2, // Keep at 1x to avoid unexpected enlargements\n\t\twidth: virtualWidth, // Set fixed virtual screen width\n\t\twindowWidth: virtualWidth, // Ensure consistent rendering\n\t\twindowHeight: virtualHeight\n\t});\n\n\t// Remove hidden node if needed\n\tif (!(html instanceof HTMLElement)) {\n\t\tdocument.body.removeChild(node);\n\t}\n\n\tconst imgData = canvas.toDataURL('image/jpeg', 0.7);\n\n\t// A4 page settings\n\tconst pdf = new jsPDF('p', 'mm', 'a4');\n\tconst imgWidth = 210; // A4 width in mm\n\tconst pageWidthMM = 210; // A4 width in mm\n\tconst pageHeight = 297; // A4 height in mm\n\tconst pageHeightMM = 297; // A4 height in mm\n\n\tif (isDarkMode) {\n\t\tpdf.setFillColor(0, 0, 0);\n\t\tpdf.rect(0, 0, pageWidthMM, pageHeightMM, 'F'); // black bg\n\t}\n\n\t// Maintain aspect ratio\n\tconst imgHeight = (canvas.height * imgWidth) / canvas.width;\n\tlet heightLeft = imgHeight;\n\tlet position = 0;\n\n\tpdf.addImage(imgData, 'JPEG', 0, position, imgWidth, imgHeight);\n\theightLeft -= pageHeight;\n\n\t// Handle additional pages\n\twhile (heightLeft > 0) {\n\t\tposition -= pageHeight;\n\t\tpdf.addPage();\n\n\t\tif (isDarkMode) {\n\t\t\tpdf.setFillColor(0, 0, 0);\n\t\t\tpdf.rect(0, 0, pageWidthMM, pageHeightMM, 'F'); // black bg\n\t\t}\n\n\t\tpdf.addImage(imgData, 'JPEG', 0, position, imgWidth, imgHeight);\n\t\theightLeft -= pageHeight;\n\t}\n\n\tpdf.save(`${note.title}.pdf`);\n};\n\nexport const createNoteHandler = async (title: string, md?: string, html?: string) => {\n\t//  $i18n.t('New Note'),\n\tconst res = await createNewNote(localStorage.token, {\n\t\t// YYYY-MM-DD\n\t\ttitle: title,\n\t\tdata: {\n\t\t\tcontent: {\n\t\t\t\tjson: null,\n\t\t\t\thtml: html || md || '',\n\t\t\t\tmd: md || ''\n\t\t\t}\n\t\t},\n\t\tmeta: null,\n\t\taccess_control: {}\n\t}).catch((error) => {\n\t\ttoast.error(`${error}`);\n\t\treturn null;\n\t});\n\n\tif (res) {\n\t\treturn res;\n\t}\n};\n"],"file":"_app/immutable/chunks/OBWwOOIN.js"}