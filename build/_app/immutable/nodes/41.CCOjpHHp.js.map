{"version":3,"file":"41.CCOjpHHp.js","sources":["../../../../../../src/routes/(app)/workspace/tools/create/+page.svelte"],"sourcesContent":["<script>\n\timport { goto } from '$app/navigation';\n\timport { createNewTool, getTools } from '$lib/apis/tools';\n\timport ToolkitEditor from '$lib/components/workspace/Tools/ToolkitEditor.svelte';\n\timport { WEBUI_VERSION } from '$lib/constants';\n\timport { tools } from '$lib/stores';\n\timport { compareVersion, extractFrontmatter } from '$lib/utils';\n\timport { onMount, getContext } from 'svelte';\n\timport { toast } from 'svelte-sonner';\n\n\tconst i18n = getContext('i18n');\n\n\tlet mounted = false;\n\tlet clone = false;\n\tlet tool = null;\n\n\tconst saveHandler = async (data) => {\n\t\tconsole.log(data);\n\n\t\tconst manifest = extractFrontmatter(data.content);\n\t\tif (compareVersion(manifest?.required_open_webui_version ?? '0.0.0', WEBUI_VERSION)) {\n\t\t\tconsole.log('Version is lower than required');\n\t\t\ttoast.error(\n\t\t\t\t$i18n.t(\n\t\t\t\t\t'Open WebUI version (v{{OPEN_WEBUI_VERSION}}) is lower than required version (v{{REQUIRED_VERSION}})',\n\t\t\t\t\t{\n\t\t\t\t\t\tOPEN_WEBUI_VERSION: WEBUI_VERSION,\n\t\t\t\t\t\tREQUIRED_VERSION: manifest?.required_open_webui_version ?? '0.0.0'\n\t\t\t\t\t}\n\t\t\t\t)\n\t\t\t);\n\t\t\treturn;\n\t\t}\n\n\t\tconst res = await createNewTool(localStorage.token, {\n\t\t\tid: data.id,\n\t\t\tname: data.name,\n\t\t\tmeta: data.meta,\n\t\t\tcontent: data.content,\n\t\t\taccess_control: data.access_control\n\t\t}).catch((error) => {\n\t\t\ttoast.error(`${error}`);\n\t\t\treturn null;\n\t\t});\n\n\t\tif (res) {\n\t\t\ttoast.success($i18n.t('Tool created successfully'));\n\t\t\ttools.set(await getTools(localStorage.token));\n\n\t\t\tawait goto('/workspace/tools');\n\t\t}\n\t};\n\n\tonMount(() => {\n\t\twindow.addEventListener('message', async (event) => {\n\t\t\tif (\n\t\t\t\t!['https://openwebui.com', 'https://www.openwebui.com', 'http://localhost:9999'].includes(\n\t\t\t\t\tevent.origin\n\t\t\t\t)\n\t\t\t)\n\t\t\t\treturn;\n\n\t\t\ttool = JSON.parse(event.data);\n\t\t\tconsole.log(tool);\n\t\t});\n\n\t\tif (window.opener ?? false) {\n\t\t\twindow.opener.postMessage('loaded', '*');\n\t\t}\n\n\t\tif (sessionStorage.tool) {\n\t\t\ttool = JSON.parse(sessionStorage.tool);\n\t\t\tsessionStorage.removeItem('tool');\n\n\t\t\tconsole.log(tool);\n\t\t\tclone = true;\n\t\t}\n\n\t\tmounted = true;\n\t});\n</script>\n\n{#if mounted}\n\t{#key tool?.content}\n\t\t<ToolkitEditor\n\t\t\tid={tool?.id ?? ''}\n\t\t\tname={tool?.name ?? ''}\n\t\t\tmeta={tool?.meta ?? { description: '' }}\n\t\t\tcontent={tool?.content ?? ''}\n\t\t\taccessControl={tool?.access_control !== undefined ? tool.access_control : {}}\n\t\t\t{clone}\n\t\t\tonSave={(value) => {\n\t\t\t\tsaveHandler(value);\n\t\t\t}}\n\t\t/>\n\t{/key}\n{/if}\n"],"names":["i18n","getContext","mounted","clone","tool","saveHandler","data","manifest","extractFrontmatter","compareVersion","WEBUI_VERSION","toast","$i18n","createNewTool","error","tools","getTools","goto","onMount","event","$.set","$.get","$.key","node_1","$$anchor","$2","$.derived_safe_equal","$4","ToolkitEditor","value","$$render","consequent"],"mappings":"0pBAAA,8CAUOA,EAAOC,EAAW,MAAM,EAE1B,IAAAC,IAAU,EAAK,EACfC,IAAQ,EAAK,EACbC,IAAO,IAAI,QAETC,EAAW,MAAUC,GAAS,CAG7B,MAAAC,EAAWC,EAAmBF,EAAK,OAAO,KAC5CG,GAAeF,GAAA,YAAAA,EAAU,8BAA+B,QAASG,CAAa,EAAG,CAEpFC,EAAM,MACLC,IAAM,EACL,sGAAqG,CAEpG,mBAAoBF,EACpB,kBAAkBH,GAAA,YAAAA,EAAU,8BAA+B,iBAK/D,CAES,MAASM,EAAc,aAAa,MAAK,CACjD,GAAIP,EAAK,GACT,KAAMA,EAAK,KACX,KAAMA,EAAK,KACX,QAASA,EAAK,QACd,eAAgBA,EAAK,iBACnB,MAAOQ,IACTH,EAAM,MAAK,GAAIG,CAAK,EAAA,EACb,KACP,IAGAH,EAAM,QAAQC,EAAK,EAAC,EAAE,2BAA2B,CAAA,EACjDG,EAAM,IAAG,MAAOC,EAAS,aAAa,KAAK,CAAA,EAErC,MAAAC,EAAK,kBAAkB,EAE/B,EAEAC,EAAO,IAAO,CACb,OAAO,iBAAiB,UAAS,MAASC,GAAU,EAEhD,wBAAyB,4BAA6B,yBAAyB,SAChFA,EAAM,MAAA,IAKRC,EAAAhB,EAAO,KAAK,MAAMe,EAAM,IAAI,CAAA,EACjBE,EAACjB,CAAI,EACjB,CAAC,GAEG,OAAO,QAAU,KACpB,OAAO,OAAO,YAAY,SAAU,GAAG,EAGpC,eAAe,OAClBgB,EAAAhB,EAAO,KAAK,MAAM,eAAe,IAAI,CAAA,EACrC,eAAe,WAAW,MAAM,EAErBiB,EAACjB,CAAI,EAChBgB,EAAAjB,EAAQ,EAAI,GAGbiB,EAAAlB,EAAU,EAAI,CACf,CAAC,mDAIKoB,EAAAC,EAAA,WAAAF,OAAAA,EAAAA,EAAAjB,CAAI,IAAJiB,YAAAA,EAAM,SAAOG,GAAA,iCAEbpB,CAAI,kBAAE,KAAM,GAAE,6BACZA,CAAI,kBAAE,OAAQ,GAAE,EAChBqB,EAAAC,EAAA,IAAA,OAAAL,QAAAA,EAAAA,EAAAjB,CAAI,IAAJiB,YAAAA,EAAM,OAAI,CAAM,YAAa,IAAE,6BAC5BjB,CAAI,kBAAE,UAAW,GAAE,EACbuB,EAAAD,EAAA,IAAA,OAAAL,QAAAA,EAAAA,EAAAjB,CAAI,IAAJiB,YAAAA,EAAM,kBAAmB,OAASA,EAAGjB,CAAI,EAAC,eAAc,CAAA,EAAA,EALvEwB,EAAAJ,EAAA,wJAMCrB,CAAK,GACG,OAAA0B,GAAU,CAClBxB,EAAYwB,CAAK,CAClB,yBAXE3B,CAAO,GAAA4B,EAAAC,CAAA,kBAFJ"}