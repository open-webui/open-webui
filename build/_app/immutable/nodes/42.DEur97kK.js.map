{"version":3,"file":"42.DEur97kK.js","sources":["../../../../../../src/routes/(app)/workspace/tools/edit/+page.svelte"],"sourcesContent":["<script>\n\timport { goto } from '$app/navigation';\n\timport { page } from '$app/stores';\n\timport { getToolById, getTools, updateToolById } from '$lib/apis/tools';\n\timport Spinner from '$lib/components/common/Spinner.svelte';\n\timport ToolkitEditor from '$lib/components/workspace/Tools/ToolkitEditor.svelte';\n\timport { WEBUI_VERSION } from '$lib/constants';\n\timport { tools } from '$lib/stores';\n\timport { compareVersion, extractFrontmatter } from '$lib/utils';\n\timport { onMount, getContext } from 'svelte';\n\timport { toast } from 'svelte-sonner';\n\n\tconst i18n = getContext('i18n');\n\n\tlet tool = null;\n\n\tconst saveHandler = async (data) => {\n\t\tconsole.log(data);\n\n\t\tconst manifest = extractFrontmatter(data.content);\n\t\tif (compareVersion(manifest?.required_open_webui_version ?? '0.0.0', WEBUI_VERSION)) {\n\t\t\tconsole.log('Version is lower than required');\n\t\t\ttoast.error(\n\t\t\t\t$i18n.t(\n\t\t\t\t\t'Open WebUI version (v{{OPEN_WEBUI_VERSION}}) is lower than required version (v{{REQUIRED_VERSION}})',\n\t\t\t\t\t{\n\t\t\t\t\t\tOPEN_WEBUI_VERSION: WEBUI_VERSION,\n\t\t\t\t\t\tREQUIRED_VERSION: manifest?.required_open_webui_version ?? '0.0.0'\n\t\t\t\t\t}\n\t\t\t\t)\n\t\t\t);\n\t\t\treturn;\n\t\t}\n\n\t\tconst res = await updateToolById(localStorage.token, tool.id, {\n\t\t\tid: data.id,\n\t\t\tname: data.name,\n\t\t\tmeta: data.meta,\n\t\t\tcontent: data.content,\n\t\t\taccess_control: data.access_control\n\t\t}).catch((error) => {\n\t\t\ttoast.error(`${error}`);\n\t\t\treturn null;\n\t\t});\n\n\t\tif (res) {\n\t\t\ttoast.success($i18n.t('Tool updated successfully'));\n\t\t\ttools.set(await getTools(localStorage.token));\n\n\t\t\t// await goto('/workspace/tools');\n\t\t}\n\t};\n\n\tonMount(async () => {\n\t\tconsole.log('mounted');\n\t\tconst id = $page.url.searchParams.get('id');\n\n\t\tif (id) {\n\t\t\ttool = await getToolById(localStorage.token, id).catch((error) => {\n\t\t\t\ttoast.error(`${error}`);\n\t\t\t\tgoto('/workspace/tools');\n\t\t\t\treturn null;\n\t\t\t});\n\n\t\t\tconsole.log(tool);\n\t\t}\n\t});\n</script>\n\n{#if tool}\n\t<ToolkitEditor\n\t\tedit={true}\n\t\tid={tool.id}\n\t\tname={tool.name}\n\t\tmeta={tool.meta}\n\t\tcontent={tool.content}\n\t\taccessControl={tool.access_control}\n\t\tonSave={(value) => {\n\t\t\tsaveHandler(value);\n\t\t}}\n\t/>\n{:else}\n\t<div class=\"flex items-center justify-center h-full\">\n\t\t<div class=\" pb-16\">\n\t\t\t<Spinner className=\"size-5\" />\n\t\t</div>\n\t</div>\n{/if}\n"],"names":["i18n","getContext","tool","saveHandler","data","manifest","extractFrontmatter","compareVersion","WEBUI_VERSION","toast","$i18n","updateToolById","$.get","error","tools","getTools","onMount","id","$page","$.set","getToolById","goto","ToolkitEditor","$$anchor","value","div","root_2","div_1","Spinner","node_1","$$render","consequent","alternate"],"mappings":"k0BAAA,mEAYOA,EAAOC,EAAW,MAAM,EAE1B,IAAAC,IAAO,IAAI,QAETC,EAAW,MAAUC,GAAS,CAG7B,MAAAC,EAAWC,EAAmBF,EAAK,OAAO,KAC5CG,GAAeF,GAAA,YAAAA,EAAU,8BAA+B,QAASG,CAAa,EAAG,CAEpFC,EAAM,MACLC,IAAM,EACL,sGAAqG,CAEpG,mBAAoBF,EACpB,kBAAkBH,GAAA,YAAAA,EAAU,8BAA+B,iBAK/D,CAES,MAASM,EAAe,aAAa,MAAKC,EAAEV,CAAI,EAAC,GAAE,CAC3D,GAAIE,EAAK,GACT,KAAMA,EAAK,KACX,KAAMA,EAAK,KACX,QAASA,EAAK,QACd,eAAgBA,EAAK,iBACnB,MAAOS,IACTJ,EAAM,MAAK,GAAII,CAAK,EAAA,EACb,KACP,IAGAJ,EAAM,QAAQC,EAAK,EAAC,EAAE,2BAA2B,CAAA,EACjDI,EAAM,IAAG,MAAOC,EAAS,aAAa,KAAK,CAAA,EAI7C,EAEAC,EAAO,SAAa,OAEbC,EAAKC,EAAK,EAAC,IAAI,aAAa,IAAI,IAAI,EAEtCD,IACHE,EAAAjB,EAAI,MAASkB,EAAY,aAAa,MAAOH,CAAE,EAAE,MAAOJ,IACvDJ,EAAM,MAAK,GAAII,CAAK,EAAA,EACpBQ,EAAK,kBAAkB,EAChB,KACP,CAAA,EAEUT,EAACV,CAAI,EAElB,CAAC,kCAIAoB,EAAAC,EAAA,MACM,YACF,OAAAX,EAAAV,CAAI,EAAC,eACH,OAAAU,EAAAV,CAAI,EAAC,iBACL,OAAAU,EAAAV,CAAI,EAAC,oBACF,OAAAU,EAAAV,CAAI,EAAC,6BACC,OAAAU,EAAAV,CAAI,EAAC,gBACX,OAAAsB,GAAU,CAClBrB,EAAYqB,CAAK,CAClB,eAGAC,EAAGC,EAAA,EACFC,IADDF,CAAG,MACFE,CAAG,EACFC,EAAOC,EAAA,CAAA,UAAA,QAAA,CAAA,IADRF,CAAG,IADJF,CAAG,MAAHA,CAAG,aAbAvB,CAAI,EAAA4B,EAAAC,CAAA,EAAAD,EAAAE,EAAA,EAAA,kBAFD"}