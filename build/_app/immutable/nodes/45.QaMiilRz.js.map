{"version":3,"file":"45.QaMiilRz.js","sources":["../../../../../../src/routes/s/[id]/+page.svelte"],"sourcesContent":["<script lang=\"ts\">\n\timport { onMount, tick, getContext } from 'svelte';\n\timport { goto } from '$app/navigation';\n\timport { page } from '$app/stores';\n\n\timport dayjs from 'dayjs';\n\n\timport { settings, chatId, WEBUI_NAME, models, config } from '$lib/stores';\n\timport { convertMessagesToHistory, createMessagesList } from '$lib/utils';\n\n\timport { getChatByShareId, cloneSharedChatById } from '$lib/apis/chats';\n\n\timport Messages from '$lib/components/chat/Messages.svelte';\n\n\timport { getUserById, getUserSettings } from '$lib/apis/users';\n\timport { getModels } from '$lib/apis';\n\timport { toast } from 'svelte-sonner';\n\timport localizedFormat from 'dayjs/plugin/localizedFormat';\n\n\tconst i18n = getContext('i18n');\n\tdayjs.extend(localizedFormat);\n\n\tlet loaded = false;\n\n\tlet autoScroll = true;\n\tlet processing = '';\n\tlet messagesContainerElement: HTMLDivElement;\n\n\t// let chatId = $page.params.id;\n\tlet showModelSelector = false;\n\tlet selectedModels = [''];\n\n\tlet chat = null;\n\tlet user = null;\n\n\tlet title = '';\n\tlet files = [];\n\n\tlet messages = [];\n\tlet history = {\n\t\tmessages: {},\n\t\tcurrentId: null\n\t};\n\n\t$: messages = createMessagesList(history, history.currentId);\n\n\t$: if ($page.params.id) {\n\t\t(async () => {\n\t\t\tif (await loadSharedChat()) {\n\t\t\t\tawait tick();\n\t\t\t\tloaded = true;\n\t\t\t} else {\n\t\t\t\tawait goto('/');\n\t\t\t}\n\t\t})();\n\t}\n\n\t//////////////////////////\n\t// Web functions\n\t//////////////////////////\n\n\tconst loadSharedChat = async () => {\n\t\tconst userSettings = await getUserSettings(localStorage.token).catch((error) => {\n\t\t\tconsole.error(error);\n\t\t\treturn null;\n\t\t});\n\n\t\tif (userSettings) {\n\t\t\tsettings.set(userSettings.ui);\n\t\t} else {\n\t\t\tlet localStorageSettings = {} as Parameters<(typeof settings)['set']>[0];\n\n\t\t\ttry {\n\t\t\t\tlocalStorageSettings = JSON.parse(localStorage.getItem('settings') ?? '{}');\n\t\t\t} catch (e: unknown) {\n\t\t\t\tconsole.error('Failed to parse settings from localStorage', e);\n\t\t\t}\n\n\t\t\tsettings.set(localStorageSettings);\n\t\t}\n\n\t\tawait models.set(\n\t\t\tawait getModels(\n\t\t\t\tlocalStorage.token,\n\t\t\t\t$config?.features?.enable_direct_connections && ($settings?.directConnections ?? null)\n\t\t\t)\n\t\t);\n\t\tawait chatId.set($page.params.id);\n\t\tchat = await getChatByShareId(localStorage.token, $chatId).catch(async (error) => {\n\t\t\tawait goto('/');\n\t\t\treturn null;\n\t\t});\n\n\t\tif (chat) {\n\t\t\tuser = await getUserById(localStorage.token, chat.user_id).catch((error) => {\n\t\t\t\tconsole.error(error);\n\t\t\t\treturn null;\n\t\t\t});\n\n\t\t\tconst chatContent = chat.chat;\n\n\t\t\tif (chatContent) {\n\t\t\t\tconsole.log(chatContent);\n\n\t\t\t\tselectedModels =\n\t\t\t\t\t(chatContent?.models ?? undefined) !== undefined\n\t\t\t\t\t\t? chatContent.models\n\t\t\t\t\t\t: [chatContent.models ?? ''];\n\t\t\t\thistory =\n\t\t\t\t\t(chatContent?.history ?? undefined) !== undefined\n\t\t\t\t\t\t? chatContent.history\n\t\t\t\t\t\t: convertMessagesToHistory(chatContent.messages);\n\t\t\t\ttitle = chatContent.title;\n\n\t\t\t\tautoScroll = true;\n\t\t\t\tawait tick();\n\n\t\t\t\tif (messages.length > 0 && messages.at(-1)?.id && messages.at(-1)?.id in history.messages) {\n\t\t\t\t\thistory.messages[messages.at(-1)?.id].done = true;\n\t\t\t\t}\n\t\t\t\tawait tick();\n\n\t\t\t\treturn true;\n\t\t\t} else {\n\t\t\t\treturn null;\n\t\t\t}\n\t\t}\n\t};\n\n\tconst cloneSharedChat = async () => {\n\t\tif (!chat) return;\n\n\t\tconst res = await cloneSharedChatById(localStorage.token, chat.id).catch((error) => {\n\t\t\ttoast.error(`${error}`);\n\t\t\treturn null;\n\t\t});\n\n\t\tif (res) {\n\t\t\tgoto(`/c/${res.id}`);\n\t\t}\n\t};\n</script>\n\n<svelte:head>\n\t<title>\n\t\t{title\n\t\t\t? `${title.length > 30 ? `${title.slice(0, 30)}...` : title} â€¢ ${$WEBUI_NAME}`\n\t\t\t: `${$WEBUI_NAME}`}\n\t</title>\n</svelte:head>\n\n{#if loaded}\n\t<div\n\t\tclass=\"h-screen max-h-[100dvh] w-full flex flex-col text-gray-700 dark:text-gray-100 bg-white dark:bg-gray-900\"\n\t>\n\t\t<div class=\"flex flex-col flex-auto justify-center relative\">\n\t\t\t<div class=\" flex flex-col w-full flex-auto overflow-auto h-0\" id=\"messages-container\">\n\t\t\t\t<div\n\t\t\t\t\tclass=\"pt-5 px-2 w-full {($settings?.widescreenMode ?? null)\n\t\t\t\t\t\t? 'max-w-full'\n\t\t\t\t\t\t: 'max-w-5xl'} mx-auto\"\n\t\t\t\t>\n\t\t\t\t\t<div class=\"px-3\">\n\t\t\t\t\t\t<div class=\" text-2xl font-medium line-clamp-1\">\n\t\t\t\t\t\t\t{title}\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<div class=\"flex text-sm justify-between items-center mt-1\">\n\t\t\t\t\t\t\t<div class=\"text-gray-400\">\n\t\t\t\t\t\t\t\t{dayjs(chat.chat.timestamp).format('LLL')}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\n\t\t\t\t<div class=\" h-full w-full flex flex-col py-2\">\n\t\t\t\t\t<div class=\"w-full\">\n\t\t\t\t\t\t<Messages\n\t\t\t\t\t\t\tclassName=\"h-full flex pt-4 pb-8 \"\n\t\t\t\t\t\t\t{user}\n\t\t\t\t\t\t\tchatId={$chatId}\n\t\t\t\t\t\t\treadOnly={true}\n\t\t\t\t\t\t\t{selectedModels}\n\t\t\t\t\t\t\t{processing}\n\t\t\t\t\t\t\tbind:history\n\t\t\t\t\t\t\tbind:messages\n\t\t\t\t\t\t\tbind:autoScroll\n\t\t\t\t\t\t\tbottomPadding={files.length > 0}\n\t\t\t\t\t\t\tsendMessage={() => {}}\n\t\t\t\t\t\t\tcontinueResponse={() => {}}\n\t\t\t\t\t\t\tregenerateResponse={() => {}}\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<div\n\t\t\t\tclass=\"absolute bottom-0 right-0 left-0 flex justify-center w-full bg-linear-to-b from-transparent to-white dark:to-gray-900\"\n\t\t\t>\n\t\t\t\t<div class=\"pb-5\">\n\t\t\t\t\t<button\n\t\t\t\t\t\tclass=\"px-3.5 py-1.5 text-sm font-medium bg-black hover:bg-gray-900 text-white dark:bg-white dark:text-black dark:hover:bg-gray-100 transition rounded-full\"\n\t\t\t\t\t\ton:click={cloneSharedChat}\n\t\t\t\t\t>\n\t\t\t\t\t\t{$i18n.t('Clone Chat')}\n\t\t\t\t\t</button>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n{/if}\n"],"names":["i18n","getContext","dayjs","localizedFormat","loaded","autoScroll","processing","selectedModels","chat","user","title","files","messages","$.mutable_source","history","loadSharedChat","userSettings","getUserSettings","error","settings","localStorageSettings","e","models","getModels","_b","_a","$config","_c","$settings","chatId","$page","$.set","getChatByShareId","$chatId","goto","$.get","getUserById","chatContent","convertMessagesToHistory","tick","$.mutate","cloneSharedChat","res","cloneSharedChatById","toast","createMessagesList","$.head","$$anchor","$.untrack","$WEBUI_NAME","div","root_2","div_1","$.child","div_2","div_3","div_4","div_5","div_6","div_7","$.reset","div_8","$.sibling","div_9","Messages","node_1","$$value","div_10","div_11","button","text_2","$.set_class","$i18n","$.event","$.append","$$render","consequent"],"mappings":"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"}