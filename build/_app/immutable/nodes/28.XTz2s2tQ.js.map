{"version":3,"file":"28.XTz2s2tQ.js","sources":["../../../../../../src/lib/components/playground/Completions.svelte","../../../../../../src/routes/(app)/playground/completions/+page.svelte"],"sourcesContent":["<script lang=\"ts\">\n\timport { toast } from 'svelte-sonner';\n\n\timport { goto } from '$app/navigation';\n\timport { onMount, tick, getContext } from 'svelte';\n\n\timport { WEBUI_BASE_URL } from '$lib/constants';\n\timport { WEBUI_NAME, config, user, models, settings, showSidebar } from '$lib/stores';\n\timport { chatCompletion } from '$lib/apis/openai';\n\n\timport { splitStream } from '$lib/utils';\n\timport Selector from '$lib/components/chat/ModelSelector/Selector.svelte';\n\n\tconst i18n = getContext('i18n');\n\n\tlet loaded = false;\n\tlet text = '';\n\n\tlet selectedModelId = '';\n\n\tlet loading = false;\n\tlet stopResponseFlag = false;\n\n\tlet textCompletionAreaElement: HTMLTextAreaElement;\n\n\tconst scrollToBottom = () => {\n\t\tconst element = textCompletionAreaElement;\n\n\t\tif (element) {\n\t\t\telement.scrollTop = element?.scrollHeight;\n\t\t}\n\t};\n\n\tconst stopResponse = () => {\n\t\tstopResponseFlag = true;\n\t\tconsole.log('stopResponse');\n\t};\n\n\tconst textCompletionHandler = async () => {\n\t\tconst model = $models.find((model) => model.id === selectedModelId);\n\n\t\tconst [res, controller] = await chatCompletion(\n\t\t\tlocalStorage.token,\n\t\t\t{\n\t\t\t\tmodel: model.id,\n\t\t\t\tstream: true,\n\t\t\t\tmessages: [\n\t\t\t\t\t{\n\t\t\t\t\t\trole: 'assistant',\n\t\t\t\t\t\tcontent: text\n\t\t\t\t\t}\n\t\t\t\t]\n\t\t\t},\n\t\t\t`${WEBUI_BASE_URL}/api`\n\t\t);\n\n\t\tif (res && res.ok) {\n\t\t\tconst reader = res.body\n\t\t\t\t.pipeThrough(new TextDecoderStream())\n\t\t\t\t.pipeThrough(splitStream('\\n'))\n\t\t\t\t.getReader();\n\n\t\t\twhile (true) {\n\t\t\t\tconst { value, done } = await reader.read();\n\t\t\t\tif (done || stopResponseFlag) {\n\t\t\t\t\tif (stopResponseFlag) {\n\t\t\t\t\t\tcontroller.abort('User: Stop Response');\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\ttry {\n\t\t\t\t\tlet lines = value.split('\\n');\n\n\t\t\t\t\tfor (const line of lines) {\n\t\t\t\t\t\tif (line !== '') {\n\t\t\t\t\t\t\tif (line.includes('[DONE]')) {\n\t\t\t\t\t\t\t\tconsole.log('done');\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tlet data = JSON.parse(line.replace(/^data: /, ''));\n\t\t\t\t\t\t\t\tconsole.log(data);\n\n\t\t\t\t\t\t\t\ttext += data.choices[0].delta.content ?? '';\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} catch (error) {\n\t\t\t\t\tconsole.log(error);\n\t\t\t\t}\n\n\t\t\t\tscrollToBottom();\n\t\t\t}\n\t\t}\n\t};\n\n\tconst submitHandler = async () => {\n\t\tif (selectedModelId) {\n\t\t\tloading = true;\n\t\t\tawait textCompletionHandler();\n\n\t\t\tloading = false;\n\t\t\tstopResponseFlag = false;\n\t\t}\n\t};\n\n\tonMount(async () => {\n\t\tif ($user?.role !== 'admin') {\n\t\t\tawait goto('/');\n\t\t}\n\n\t\tif ($settings?.models) {\n\t\t\tselectedModelId = $settings?.models[0];\n\t\t} else if ($config?.default_models) {\n\t\t\tselectedModelId = $config?.default_models.split(',')[0];\n\t\t} else {\n\t\t\tselectedModelId = '';\n\t\t}\n\t\tloaded = true;\n\t});\n</script>\n\n<div class=\" flex flex-col justify-between w-full overflow-y-auto h-full\">\n\t<div class=\"mx-auto w-full md:px-0 h-full\">\n\t\t<div class=\" flex flex-col h-full px-4\">\n\t\t\t<div class=\"flex flex-col justify-between mb-1 gap-1\">\n\t\t\t\t<div class=\"flex flex-col gap-1 w-full\">\n\t\t\t\t\t<div class=\"flex w-full\">\n\t\t\t\t\t\t<div class=\"overflow-hidden w-full\">\n\t\t\t\t\t\t\t<div class=\"max-w-full\">\n\t\t\t\t\t\t\t\t<Selector\n\t\t\t\t\t\t\t\t\tplaceholder={$i18n.t('Select a model')}\n\t\t\t\t\t\t\t\t\titems={$models.map((model) => ({\n\t\t\t\t\t\t\t\t\t\tvalue: model.id,\n\t\t\t\t\t\t\t\t\t\tlabel: model.name,\n\t\t\t\t\t\t\t\t\t\tmodel: model\n\t\t\t\t\t\t\t\t\t}))}\n\t\t\t\t\t\t\t\t\tbind:value={selectedModelId}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<div\n\t\t\t\tclass=\" pt-0.5 pb-2.5 flex flex-col justify-between w-full flex-auto overflow-auto h-0\"\n\t\t\t\tid=\"messages-container\"\n\t\t\t>\n\t\t\t\t<div class=\" h-full w-full flex flex-col\">\n\t\t\t\t\t<div class=\"flex-1\">\n\t\t\t\t\t\t<textarea\n\t\t\t\t\t\t\tid=\"text-completion-textarea\"\n\t\t\t\t\t\t\tbind:this={textCompletionAreaElement}\n\t\t\t\t\t\t\tclass=\"w-full h-full p-3 bg-transparent border border-gray-100/30 dark:border-gray-850/30 outline-hidden resize-none rounded-lg text-sm\"\n\t\t\t\t\t\t\tbind:value={text}\n\t\t\t\t\t\t\tplaceholder={$i18n.t(\"You're a helpful assistant.\")}\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<div class=\"pb-3 flex justify-end\">\n\t\t\t\t{#if !loading}\n\t\t\t\t\t<button\n\t\t\t\t\t\tclass=\"px-3.5 py-1.5 text-sm font-medium bg-black hover:bg-gray-900 text-white dark:bg-white dark:text-black dark:hover:bg-gray-100 transition rounded-full\"\n\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\tsubmitHandler();\n\t\t\t\t\t\t}}\n\t\t\t\t\t>\n\t\t\t\t\t\t{$i18n.t('Run')}\n\t\t\t\t\t</button>\n\t\t\t\t{:else}\n\t\t\t\t\t<button\n\t\t\t\t\t\tclass=\"px-3 py-1.5 text-sm font-medium bg-gray-300 text-black transition rounded-full\"\n\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\tstopResponse();\n\t\t\t\t\t\t}}\n\t\t\t\t\t>\n\t\t\t\t\t\t{$i18n.t('Cancel')}\n\t\t\t\t\t</button>\n\t\t\t\t{/if}\n\t\t\t</div>\n\t\t</div>\n\t</div>\n</div>\n\n<style>\n\t.scrollbar-hidden::-webkit-scrollbar {\n\t\tdisplay: none; /* for Chrome, Safari and Opera */\n\t}\n\n\t.scrollbar-hidden {\n\t\t-ms-overflow-style: none; /* IE and Edge */\n\t\tscrollbar-width: none; /* Firefox */\n\t}\n</style>\n","<script>\n\timport Completions from '$lib/components/playground/Completions.svelte';\n</script>\n\n<Completions />\n"],"names":["i18n","getContext","text","selectedModelId","loading","stopResponseFlag","textCompletionAreaElement","$.mutable_source","scrollToBottom","element","stopResponse","textCompletionHandler","model","$models","$.get","res","controller","chatCompletion","WEBUI_BASE_URL","reader","splitStream","value","done","lines","line","data","$.set","error","submitHandler","onMount","_a","$user","goto","_b","$settings","_c","_d","$config","_e","div","root","div_1","div_2","div_3","div_4","div_5","div_6","div_7","$i18n","$1","$.derived_safe_equal","Selector","node","$$value","div_8","$.sibling","div_9","$.child","div_10","textarea","$.remove_textarea_child","$.reset","div_11","button","root_1","text_1","$.append","$$anchor","button_1","root_2","text_2","$$render","alternate","consequent","$.template_effect","$0","$.set_attribute","Completions"],"mappings":"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"}