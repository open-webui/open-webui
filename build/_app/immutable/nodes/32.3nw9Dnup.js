import"../chunks/CWj6FrbW.js";import"../chunks/69_IOA4Y.js";import{B as bt,t as U,a as y,p as lt,g as st,f as w,c as l,j as e,w as i,r as a,k as p,u as Ye,s as J,l as oe,n as Q,b as ot,y as Ot,e as xe,i as s,m as T,o as mr,aM as pr,q as Et,v as gr,aQ as wt,aR as hr}from"../chunks/0WpKKl27.js";import{i as Y}from"../chunks/Cmf4RC8y.js";import{k as xr}from"../chunks/fZxlt1qL.js";import{a as We,s as nt,c as $t,r as rt}from"../chunks/CZ1y6KaE.js";import{b as Xe,a as yr}from"../chunks/kb1CvZ3a.js";import{i as it}from"../chunks/C3k0oZ3o.js";import{a as Ae,s as dt}from"../chunks/BVrWTcfB.js";import{t as x}from"../chunks/DYdr9DjX.js";import{g as wr}from"../chunks/B5RARo22.js";import{p as _r}from"../chunks/CLoTtgoA.js";import{c as br,b as $r,u as kr}from"../chunks/PCOILo-8.js";import{D as Fr,u as Lt,b as Sr}from"../chunks/CYBNiUQ7.js";import{r as Cr,b as Pr,f as Dr,g as Ir,u as zr,h as Mr}from"../chunks/D93vMDi1.js";import{p as Ar}from"../chunks/B56tcsjd.js";import{D as Ut,k as Bt,z as jt,F as Wr}from"../chunks/cX8aofVu.js";import{S as at}from"../chunks/BO1efK8r.js";import{e as Nr}from"../chunks/u5Cnd4mY.js";import{p as re}from"../chunks/DpN1w328.js";import{d as Ue,r as Tr}from"../chunks/BC4znSyB.js";import"../chunks/BkyXqnA-.js";import{d as Er}from"../chunks/DfIywdCw.js";import{T as Ee}from"../chunks/Db0gdTVr.js";import{X as Kt}from"../chunks/CZmZoefv.js";import"../chunks/BtReZMDb.js";import{b as Lr,c as Ge}from"../chunks/DA2vpIKA.js";import{f as Ur}from"../chunks/Dbtivbjp.js";import{D as Br}from"../chunks/DD5ATWsz.js";import{F as jr}from"../chunks/CmQv0SfQ.js";import{G as Or}from"../chunks/D4rRqD24.js";import{p as Kr}from"../chunks/Bfc47y5P.js";import{M as Rr}from"../chunks/CcreKc1w.js";import{R as Hr,V as qr}from"../chunks/ZPyp4hUC.js";import{M as Vr}from"../chunks/kOKC9sgK.js";import{C as Yr}from"../chunks/ByHAJgVC.js";import{D as Gr}from"../chunks/DcAIj4L_.js";import{C as Xr}from"../chunks/B0N4-HfZ.js";import{L as Qr}from"../chunks/C1SugFh_.js";import{A as Jr}from"../chunks/BHCb5XAX.js";import{S as Zr}from"../chunks/BqWDuYyJ.js";import{F as ea}from"../chunks/6usEtNPi.js";import{D as _t}from"../chunks/DmbrTe5t.js";import{P as ta}from"../chunks/DyEgVTRu.js";import{A as ra}from"../chunks/DmHUk7u7.js";var aa=bt('<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="m15 11.25-3-3m0 0-3 3m3-3v7.5M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"></path></svg>');function la(Z,P){let t=re(P,"className",8,"size-4"),G=re(P,"strokeWidth",8,"1.5");var K=aa();U(()=>{We(K,"stroke-width",G()),nt(K,0,$t(t()))}),y(Z,K)}var sa=w('<span class="text-xs text-gray-500"> </span>'),oa=w("<div> </div>"),na=w('<div class="shrink-0 text-gray-500"> </div>'),ia=w('<button class="p-1 rounded-full hover:bg-gray-100 dark:hover:bg-gray-850 transition" type="button"><!></button>'),da=w('<div class="flex items-center"><!></div>'),ca=w('<div><button class="relative group flex items-center gap-1 rounded-xl p-2 text-left flex-1 justify-between" type="button"><div><div class="flex gap-2 items-center line-clamp-1"><div class="shrink-0"><!></div> <div class="line-clamp-1 text-sm"> <!></div></div></div> <div class="flex items-center gap-2 shrink-0"><!> <!></div></button> <!></div>'),va=w('<div class=" max-h-full flex flex-col w-full gap-[0.5px]"></div>');function ua(Z,P){lt(P,!1);const t=()=>Ae(Ne,"$i18n",G),[G,K]=dt();Ue.extend(Er),Ue.extend(Tr);const Ne=st("i18n");let ne=re(P,"knowledge",8,null),ae=re(P,"selectedFileId",8,null),X=re(P,"files",24,()=>[]),q=re(P,"onClick",8,A=>{}),B=re(P,"onDelete",8,A=>{});it();var ie=va();Nr(ie,5,X,A=>(A==null?void 0:A.id)??(A==null?void 0:A.itemId)??(A==null?void 0:A.tempId),(A,h)=>{var ee=ca(),R=l(ee),v=l(R),de=l(v),j=l(de),O=l(j);{var ce=c=>{Fr(c,{className:"size-3.5"})},le=c=>{at(c,{className:"size-3.5"})};Y(O,c=>{e(h),i(()=>{var u;return((u=e(h))==null?void 0:u.status)!=="uploading"})?c(ce):c(le,!1)})}a(j);var E=p(j,2),H=l(E),S=p(H);{var C=c=>{var u=sa(),$=l(u,!0);a(u),U(W=>J($,W),[()=>(Ye(Ut),e(h),i(()=>{var W,N;return Ut((N=(W=e(h))==null?void 0:W.meta)==null?void 0:N.size)}))]),y(c,u)};Y(S,c=>{e(h),i(()=>{var u,$;return($=(u=e(h))==null?void 0:u.meta)==null?void 0:$.size})&&c(C)})}a(E),a(de),a(v);var D=p(v,2),d=l(D);{var L=c=>{{let u=Q(()=>(Ye(Ue),e(h),i(()=>Ue(e(h).updated_at*1e3).format("LLLL"))));Ee(c,{get content(){return e(u)},children:($,W)=>{var N=oa(),ue=l(N,!0);a(N),U(V=>J(ue,V),[()=>(Ye(Ue),e(h),i(()=>Ue(e(h).updated_at*1e3).fromNow()))]),y($,N)},$$slots:{default:!0}})}};Y(d,c=>{e(h),i(()=>{var u;return(u=e(h))==null?void 0:u.updated_at})&&c(L)})}var ye=p(d,2);{var we=c=>{{let u=Q(()=>(e(h),t(),i(()=>{var $,W;return((W=($=e(h))==null?void 0:$.user)==null?void 0:W.email)??t().t("Deleted User")})));Ee(c,{get content(){return e(u)},className:"flex shrink-0",placement:"top-start",children:($,W)=>{var N=na(),ue=l(N,!0);a(N),U(V=>J(ue,V),[()=>(t(),Ye(Bt),e(h),i(()=>{var V,be,$e,Se;return t().t("By {{name}}",{name:Bt(((be=(V=e(h))==null?void 0:V.user)==null?void 0:be.name)??((Se=($e=e(h))==null?void 0:$e.user)==null?void 0:Se.email)??t().t("Deleted User"))})}))]),y($,N)},$$slots:{default:!0}})}};Y(ye,c=>{e(h),i(()=>{var u;return(u=e(h))==null?void 0:u.user})&&c(we)})}a(D),a(R);var _e=p(R,2);{var Be=c=>{var u=da(),$=l(u);{let W=Q(()=>(t(),i(()=>t().t("Delete"))));Ee($,{get content(){return e(W)},children:(N,ue)=>{var V=ia(),be=l(V);Kt(be,{}),a(V),oe("click",V,()=>{var $e,Se;B()((($e=e(h))==null?void 0:$e.id)??((Se=e(h))==null?void 0:Se.tempId))}),y(N,V)},$$slots:{default:!0}})}a(u),y(c,u)};Y(_e,c=>{Ye(ne()),i(()=>{var u;return(u=ne())==null?void 0:u.write_access})&&c(Be)})}a(ee),U(()=>{nt(ee,1,` flex cursor-pointer w-full px-1.5 py-0.5 bg-transparent dark:hover:bg-gray-850/50 hover:bg-white rounded-xl transition ${ae()?"":"hover:bg-gray-100 dark:hover:bg-gray-850"}`),J(H,`${e(h),i(()=>{var c,u,$;return((c=e(h))==null?void 0:c.name)??(($=(u=e(h))==null?void 0:u.meta)==null?void 0:$.name)})??""} `)}),oe("click",R,async()=>{var c,u;e(h),q()(((c=e(h))==null?void 0:c.id)??((u=e(h))==null?void 0:u.tempId))}),y(A,ee)}),a(ie),y(Z,ie),ot(),K()}var fa=bt('<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M3 4.5h14.25M3 9h9.75M3 13.5h5.25m5.25-.75L17.25 9m0 0L21 12.75M17.25 9v12"></path></svg>');function ma(Z,P){let t=re(P,"className",8,"size-4"),G=re(P,"strokeWidth",8,"1.5");var K=fa();U(()=>{We(K,"stroke-width",G()),nt(K,0,$t(t()))}),y(Z,K)}var pa=bt('<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0 3.181 3.183a8.25 8.25 0 0 0 13.803-3.7M4.031 9.865a8.25 8.25 0 0 1 13.803-3.7l3.181 3.182m0-4.991v4.99"></path></svg>');function ga(Z,P){let t=re(P,"className",8,"size-4"),G=re(P,"strokeWidth",8,"1.5");var K=pa();U(()=>{We(K,"stroke-width",G()),nt(K,0,$t(t()))}),y(Z,K)}var ha=w('<button class=" p-1.5 rounded-xl hover:bg-gray-100 dark:bg-gray-850 dark:hover:bg-gray-800 transition font-medium text-sm flex items-center space-x-1"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" fill="currentColor" class="w-4 h-4"><path d="M8.75 3.75a.75.75 0 0 0-1.5 0v3.5h-3.5a.75.75 0 0 0 0 1.5h3.5v3.5a.75.75 0 0 0 1.5 0v-3.5h3.5a.75.75 0 0 0 0-1.5h-3.5v-3.5Z"></path></svg></button>'),xa=w('<!> <div class="flex items-center"> </div>',1),ya=w('<!> <div class="flex items-center"> </div>',1),wa=w('<!> <div class="flex items-center"> </div>',1),_a=w('<!> <div class="flex items-center"> </div>',1),ba=w('<!> <div class="flex items-center"> </div>',1),$a=w("<!> <!> <!> <!> <!>",1),ka=w('<div slot="content"><!></div>');function Fa(Z,P){lt(P,!1);const t=()=>Ae(Ne,"$i18n",G),[G,K]=dt();Ot();const Ne=st("i18n");let ne=re(P,"onClose",8,()=>{}),ae=re(P,"onSync",8,()=>{}),X=re(P,"onUpload",8,B=>{}),q=T(!1);it(),Br(Z,{align:"end",get show(){return e(q)},set show(B){s(q,B)},$$events:{change:B=>{B.detail===!1&&ne()()}},children:(B,ie)=>{{let A=Q(()=>(t(),i(()=>t().t("Add Content"))));Ee(B,{get content(){return e(A)},children:(h,ee)=>{var R=ha();oe("click",R,v=>{v.stopPropagation(),s(q,!0)}),y(h,R)},$$slots:{default:!0}})}},$$slots:{default:!0,content:(B,ie)=>{var A=ka(),h=l(A);Lr(h,{class:"w-full max-w-[200px] rounded-2xl px-1 py-1  border border-gray-100  dark:border-gray-800 z-50 bg-white dark:bg-gray-850 dark:text-white shadow-lg transition",sideOffset:4,side:"bottom",align:"end",get transition(){return Ur},children:(ee,R)=>{var v=$a(),de=xe(v);Ge(de,{class:"flex gap-2 items-center px-3 py-1.5 text-sm  cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800  rounded-xl",$$events:{click:()=>{X()({type:"files"})}},children:(E,H)=>{var S=xa(),C=xe(S);la(C,{strokeWidth:"2"});var D=p(C,2),d=l(D,!0);a(D),U(L=>J(d,L),[()=>(t(),i(()=>t().t("Upload files")))]),y(E,S)},$$slots:{default:!0}});var j=p(de,2);Ge(j,{class:"flex gap-2 items-center px-3 py-1.5 text-sm  cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800  rounded-xl",$$events:{click:()=>{X()({type:"directory"})}},children:(E,H)=>{var S=ya(),C=xe(S);jr(C,{strokeWidth:"2"});var D=p(C,2),d=l(D,!0);a(D),U(L=>J(d,L),[()=>(t(),i(()=>t().t("Upload directory")))]),y(E,S)},$$slots:{default:!0}});var O=p(j,2);{let E=Q(()=>(t(),i(()=>t().t("This option will delete all existing files in the collection and replace them with newly uploaded files."))));Ee(O,{get content(){return e(E)},className:"w-full",children:(H,S)=>{Ge(H,{class:"flex gap-2 items-center px-3 py-1.5 text-sm  cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800  rounded-xl",$$events:{click:()=>{ae()()}},children:(C,D)=>{var d=wa(),L=xe(d);ga(L,{strokeWidth:"2"});var ye=p(L,2),we=l(ye,!0);a(ye),U(_e=>J(we,_e),[()=>(t(),i(()=>t().t("Sync directory")))]),y(C,d)},$$slots:{default:!0}})},$$slots:{default:!0}})}var ce=p(O,2);Ge(ce,{class:"flex gap-2 items-center px-3 py-1.5 text-sm  cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800  rounded-xl",$$events:{click:()=>{X()({type:"web"})}},children:(E,H)=>{var S=_a(),C=xe(S);Or(C,{strokeWidth:"2"});var D=p(C,2),d=l(D,!0);a(D),U(L=>J(d,L),[()=>(t(),i(()=>t().t("Add webpage")))]),y(E,S)},$$slots:{default:!0}});var le=p(ce,2);Ge(le,{class:"flex gap-2 items-center px-3 py-1.5 text-sm  cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800  rounded-xl",$$events:{click:()=>{X()({type:"text"})}},children:(E,H)=>{var S=ba(),C=xe(S);ma(C,{strokeWidth:"2"});var D=p(C,2),d=l(D,!0);a(D),U(L=>J(d,L),[()=>(t(),i(()=>t().t("Add text content")))]),y(E,S)},$$slots:{default:!0}}),y(ee,v)},$$slots:{default:!0}}),a(A),y(B,A)}},$$legacy:!0}),ot(),K()}var Sa=w('<div class=" max-w-full w-full"><!></div>'),Ca=w('<button class=" p-2 bg-gray-50 text-gray-700 dark:bg-gray-700 dark:text-white transition rounded-full" type="button"><!></button>'),Pa=w('<button class=" px-3.5 py-2 bg-black text-white dark:bg-white dark:text-black transition rounded-full" type="submit"> </button>'),Da=w('<div class="absolute top-0 right-0 p-5"><button class="self-center dark:text-white" type="button"><!></button></div> <div class="flex flex-col md:flex-row w-full h-full md:space-x-4 dark:text-gray-200"><form class="flex flex-col w-full h-full"><div class=" flex-1 w-full h-full flex justify-center overflow-auto px-5 py-4"><div class=" max-w-3xl py-2 md:py-10 w-full flex flex-col gap-2"><div class="shrink-0 w-full flex justify-between items-center"><div class="w-full"><input class="w-full text-3xl font-medium bg-transparent outline-hidden svelte-1bctwft" type="text" required/></div></div> <div class=" flex-1 w-full h-full"><!></div></div></div> <div class="flex flex-row items-center justify-end text-sm font-medium shrink-0 mt-1 p-4 gap-1.5"><div><!></div> <div class=" shrink-0"><!></div></div></form></div>',1);function Ia(Z,P){lt(P,!1);const t=()=>Ae(Ne,"$i18n",G),[G,K]=dt(),Ne=st("i18n"),ne=Ot();let ae=re(P,"show",12,!1),X=T(t().t("Untitled")),q=T(""),B=T(!1);it(),Rr(Z,{size:"full",containerClassName:"",className:"h-full bg-white dark:bg-gray-900",get show(){return ae()},set show(ie){ae(ie)},children:(ie,A)=>{var h=Da(),ee=xe(h),R=l(ee),v=l(R);Kt(v,{className:"size-3.5"}),a(R),a(ee);var de=p(ee,2),j=l(de),O=l(j),ce=l(O),le=l(ce),E=l(le),H=l(E);rt(H),a(E),a(le);var S=p(le,2),C=l(S);{let c=Q(()=>(t(),i(()=>t().t("Write something..."))));Hr(C,{get placeholder(){return e(c)},preserveBreaks:!0,get value(){return e(q)},set value(u){s(q,u)},$$legacy:!0})}a(S),a(ce),a(O);var D=p(O,2),d=l(D),L=l(d);{var ye=c=>{var u=Sa(),$=l(u);qr($,{className:"p-1",onCancel:()=>{s(B,!1)},onConfirm:W=>{const{text:N,filename:ue}=W;s(q,`${e(q)}${N} `),s(B,!1)},get recording(){return e(B)},set recording(W){s(B,W)},$$legacy:!0}),a(u),y(c,u)},we=c=>{{let u=Q(()=>(t(),i(()=>t().t("Voice Input"))));Ee(c,{get content(){return e(u)},children:($,W)=>{var N=Ca(),ue=l(N);Vr(ue,{className:"size-5"}),a(N),oe("click",N,async()=>{try{let V=await navigator.mediaDevices.getUserMedia({audio:!0}).catch(function(be){return x.error(t().t("Permission denied when accessing microphone: {{error}}",{error:be})),null});V&&(s(B,!0),V.getTracks().forEach($e=>$e.stop())),V=null}catch{x.error(t().t("Permission denied when accessing microphone"))}}),y($,N)},$$slots:{default:!0}})}};Y(L,c=>{e(B)?c(ye):c(we,!1)})}a(d);var _e=p(d,2),Be=l(_e);{let c=Q(()=>(t(),i(()=>t().t("Save"))));Ee(Be,{get content(){return e(c)},children:(u,$)=>{var W=Pa(),N=l(W,!0);a(W),U(ue=>J(N,ue),[()=>(t(),i(()=>t().t("Save")))]),y(u,W)},$$slots:{default:!0}})}a(_e),a(D),a(j),a(de),U(c=>We(H,"placeholder",c),[()=>(t(),i(()=>t().t("Title")))]),oe("click",R,()=>{ae(!1)}),Xe(H,()=>e(X),c=>s(X,c)),oe("submit",j,Kr(()=>{if(e(X).trim()===""||e(q).trim()===""){x.error(t().t("Please fill in all fields.")),s(X,e(X).trim()),s(q,e(q).trim());return}ne("submit",{name:e(X),content:e(q)}),ae(!1),s(X,""),s(q,"")})),y(ie,h)},$$slots:{default:!0},$$legacy:!0}),ot(),K()}var za=w('<div class="text-xs text-gray-500"> </div>'),Ma=w('<div class="self-center shrink-0"><button class="bg-gray-50 hover:bg-gray-100 text-black dark:bg-gray-850 dark:hover:bg-gray-800 dark:text-white transition px-2 py-1 rounded-full flex gap-1 items-center" type="button"><!> <div class="text-sm font-medium shrink-0"> </div></button></div>'),Aa=w('<div class="text-xs shrink-0 text-gray-500"> </div>'),Wa=w("<div><!></div>"),Na=w('<div class=" flex overflow-y-auto h-full w-full scrollbar-hidden text-xs"><!></div> <!>',1),Ta=w('<div class="my-3 flex flex-col justify-center text-center text-gray-500 text-xs"><div> </div></div>'),Ea=w('<div class="ml-2 self-center"><!></div>'),La=w('<div><button class="flex self-center w-fit text-sm py-1 px-2.5 dark:text-gray-300 dark:hover:text-white hover:bg-black/5 dark:hover:bg-white/5 rounded-lg disabled:opacity-50 disabled:cursor-not-allowed"> <!></button></div>'),Ua=w('<textarea class="w-full h-full text-sm outline-none resize-none px-3 py-2"></textarea>'),Ba=w('<div class="flex flex-col justify-start h-full max-h-full"><div class=" flex flex-col w-full h-full max-h-full"><div class="shrink-0 flex items-center p-2"><div class="mr-2"><button class="w-full text-left text-sm p-1.5 rounded-lg dark:text-gray-300 dark:hover:text-white hover:bg-black/5 dark:hover:bg-gray-850"><!></button></div> <div class=" flex-1 text-lg line-clamp-1"> </div> <!></div> <!></div></div>'),ja=w('<div class="flex flex-row flex-1 gap-3 px-2.5 mt-2"><div class="flex-1 flex"><div class=" flex flex-col w-full space-x-2 rounded-lg h-full"><div class="w-full h-full flex flex-col min-h-full"><!></div></div></div> <!></div>'),Oa=w('<div class="my-10"><!></div>'),Ka=w('<!> <div class="w-full px-2"><div class=" flex w-full"><div class="flex-1"><div class="flex items-center justify-between w-full"><div class="w-full flex justify-between items-center"><input type="text" class="text-left w-full font-medium text-lg font-primary bg-transparent outline-hidden flex-1"/> <div class="shrink-0 mr-2.5"><!></div></div> <!></div> <div class="flex w-full"><input type="text" class="text-left text-xs w-full text-gray-500 bg-transparent outline-hidden"/></div></div></div></div> <div class="mt-2 mb-2.5 py-2 -mx-0 bg-white dark:bg-gray-900 rounded-3xl border border-gray-100/30 dark:border-gray-850/30 flex-1"><div class="px-3.5 flex flex-1 items-center w-full space-x-2 py-0.5 pb-2"><div class="flex flex-1 items-center"><div class=" self-center ml-1 mr-3"><!></div> <input class=" w-full text-sm pr-4 py-1 rounded-r-xl outline-hidden bg-transparent"/> <!></div></div> <div class="px-3 flex justify-between"><div class="flex w-full bg-transparent overflow-x-auto scrollbar-none"><div class="flex gap-3 w-fit text-center text-sm rounded-full bg-transparent px-0.5 whitespace-nowrap"><!> <!> <!></div></div></div> <!></div>',1),Ra=w('<!> <!> <!> <!> <input id="files-input" type="file" multiple hidden=""/> <div class="flex flex-col w-full h-full min-h-full" id="collection-container"><!></div>',1);function Ha(Z,P){lt(P,!1);const t=()=>Ae(q,"$i18n",ae),G=()=>Ae(br,"$config",ae),K=()=>Ae($r,"$settings",ae),Ne=()=>Ae(_r,"$page",ae),ne=()=>Ae(kr,"$user",ae),[ae,X]=dt(),q=st("i18n");let B=!0,ie=T(!1),A=T(!1),h=T(!1),ee=T(!1),R=T(null),v=T(null),de=T(null),j=T(null),O=T(null),ce=T(""),le=T(null),E=T(""),H=T(null),S=T(null),C=T(null),D=T(1),d=T(null),L=T(null);const ye=()=>{s(D,1)},we=async()=>{ye(),await _e()},_e=async()=>{if(e(de)===null)return;s(d,null),s(L,null),e(S)===null&&s(C,null);const r=await Dr(localStorage.token,e(v).id,e(E),e(H),e(S),e(C),e(D)).catch(()=>null);return r&&(s(d,r.items),s(L,r.total)),r},Be=async r=>{var o,n;try{s(O,r),s(ce,((n=(o=e(O))==null?void 0:o.data)==null?void 0:n.content)||"")}catch{x.error(t().t("Failed to load file content."))}},c=(r,o)=>{const n=new Blob([o],{type:"text/plain"}),g=Wr(n,`${r}.txt`);return g},u=async r=>{Array.isArray(r)||(r=[r]);const o=r.map(n=>({type:"file",file:"",id:null,url:n,name:n,size:null,status:"uploading",error:"",itemId:jt()}));s(d,[...o,...e(d)??[]]);for(const n of o)try{const g=await Ar(localStorage.token,"",n.url,!1).catch(I=>null);if(g){const I=c(n.url.replace(/[^a-z0-9]/gi,"_").toLowerCase().slice(0,50),g.content),k=await Lt(localStorage.token,I).catch(F=>(x.error(`${F}`),null));k?(s(d,e(d).map(F=>(F.itemId===n.itemId&&(F.id=k.id),F))),k.error?(console.warn("File upload warning:",k.error),x.warning(k.error),s(d,e(d).filter(F=>F.id!==k.id))):await Se(k.id)):x.error(t().t("Failed to upload file."))}else s(d,e(d).filter(I=>I.itemId!==n.itemId)),x.error(t().t("Failed to process URL: {{url}}",{url:n.url}))}catch(g){s(d,e(d).filter(I=>I.itemId!==n.itemId)),x.error(`${g}`)}},$=async r=>{var n,g,I,k,F,_,z,se,Ce,ve,Qe,Je,Ze,Ke;const o={type:"file",file:"",id:null,url:"",name:r.name,size:r.size,status:"uploading",error:"",itemId:jt()};if(o.size==0)return x.error(t().t("You cannot upload an empty file.")),null;if((((g=(n=G())==null?void 0:n.file)==null?void 0:g.max_size)??null)!==null&&r.size>(((k=(I=G())==null?void 0:I.file)==null?void 0:k.max_size)??0)*1024*1024){r.size,(((_=(F=G())==null?void 0:F.file)==null?void 0:_.max_size)??0)*1024*1024,x.error(t().t("File size should not exceed {{maxSize}} MB.",{maxSize:(se=(z=G())==null?void 0:z.file)==null?void 0:se.max_size}));return}s(d,[o,...e(d)??[]]);try{let ke={knowledge_id:e(v).id,...(r.type.startsWith("audio/")||r.type.startsWith("video/"))&&((Qe=(ve=(Ce=K())==null?void 0:Ce.audio)==null?void 0:ve.stt)!=null&&Qe.language)?{language:(Ke=(Ze=(Je=K())==null?void 0:Je.audio)==null?void 0:Ze.stt)==null?void 0:Ke.language}:{}};const fe=await Lt(localStorage.token,r,ke).catch(me=>(x.error(`${me}`),null));fe?(s(d,e(d).map(me=>(me.itemId===o.itemId&&(me.id=fe.id),me))),fe.error?(console.warn("File upload warning:",fe.error),x.warning(fe.error),s(d,e(d).filter(me=>me.id!==fe.id))):await Se(fe.id)):x.error(t().t("Failed to upload file."))}catch(ke){x.error(`${ke}`)}},W=async()=>{const r="showDirectoryPicker"in window;try{r?await ue():await V()}catch(o){be(o)}},N=r=>r.split("/").some(o=>o.startsWith(".")),ue=async()=>{const r=await window.showDirectoryPicker();let o=0,n=0;const g=()=>{const F=n/o*100;x.info(t().t("Upload Progress: {{uploadedFiles}}/{{totalFiles}} ({{percentage}}%)",{uploadedFiles:n,totalFiles:o,percentage:F.toFixed(2)}))};async function I(F){for await(const _ of F.values())_.name.startsWith(".")||(_.kind==="file"?o++:_.kind==="directory"&&(_.name.startsWith(".")||await I(_)))}async function k(F,_=""){for await(const z of F.values()){if(z.name.startsWith("."))continue;const se=_?`${_}/${z.name}`:z.name;if(!N(se))if(z.kind==="file"){const Ce=await z.getFile(),ve=new File([Ce],se,{type:Ce.type});await $(ve),n++,g()}else z.kind==="directory"&&(z.name.startsWith(".")||await k(z,se))}}await I(r),g(),o>0&&await k(r)},V=async()=>new Promise((r,o)=>{const n=document.createElement("input");n.type="file",n.webkitdirectory=!0,n.directory=!0,n.multiple=!0,n.style.display="none",document.body.appendChild(n),n.onchange=async()=>{try{const g=Array.from(n.files).filter(_=>!N(_.webkitRelativePath));let I=g.length,k=0;const F=()=>{const _=k/I*100;x.info(t().t("Upload Progress: {{uploadedFiles}}/{{totalFiles}} ({{percentage}}%)",{uploadedFiles:k,totalFiles:I,percentage:_.toFixed(2)}))};F();for(const _ of g)if(!_.name.startsWith(".")){const z=_.webkitRelativePath||_.name,se=new File([_],z,{type:_.type});await $(se),k++,F()}document.body.removeChild(n),r()}catch(g){o(g)}},n.onerror=g=>{document.body.removeChild(n),o(g)},n.click()}),be=r=>{r.name==="AbortError"?x.info(t().t("Directory selection was cancelled")):x.error(t().t("Error accessing directory"))},$e=async()=>{e(d).length>0?await Cr(localStorage.token,e(R)).catch(o=>{x.error(`${o}`)})&&(s(d,[]),x.success(t().t("Knowledge reset successfully.")),W()):W()},Se=async r=>{await Pr(localStorage.token,e(R),r).catch(n=>(x.error(`${n}`),null))?(x.success(t().t("File added successfully.")),we()):(x.error(t().t("Failed to add file.")),s(d,e(d).filter(n=>n.id!==r)))},Rt=async r=>{try{const o=await Mr(localStorage.token,e(R),r);o&&(x.success(t().t("File removed successfully.")),await we())}catch(o){x.error(`${o}`)}};let ct=null,Le,je=T(!1),Oe=T(!1);const Ht=async()=>{if(!e(Oe)){s(Oe,!0);try{await Sr(localStorage.token,e(O).id,e(ce)).catch(o=>(x.error(`${o}`),null))&&(x.success(t().t("File content updated successfully.")),s(j,null),s(O,null),s(ce,""),await we())}finally{s(Oe,!1)}}},vt=()=>{ct&&clearTimeout(ct),ct=setTimeout(async()=>{if(e(v).name.trim()===""||e(v).description.trim()===""){x.error(t().t("Please fill in all fields."));return}await zr(localStorage.token,e(R),{...e(v),name:e(v).name,description:e(v).description,access_control:e(v).access_control}).catch(o=>{x.error(`${o}`)})&&x.success(t().t("Knowledge updated successfully"))},1e3)},ut=async r=>{r.matches?B=!0:B=!1},kt=r=>{var o,n;r.preventDefault(),(n=(o=r.dataTransfer)==null?void 0:o.types)!=null&&n.includes("Files")?s(je,!0):s(je,!1)},Ft=()=>{s(je,!1)},St=async r=>{var n,g,I,k,F;if(r.preventDefault(),s(je,!1),!((n=e(v))!=null&&n.write_access)){x.error(t().t("You do not have permission to upload files to this knowledge base."));return}const o=_=>{for(const z of _){if(z.isFile){z.file(ve=>{$(ve)});continue}const se=z.webkitGetAsEntry();se.isDirectory?se.createReader().readEntries(ve=>{o(ve)},ve=>{}):(x.info(t().t("Uploading file...")),$(z.getAsFile()),x.success(t().t("File uploaded!")))}};if((I=(g=r.dataTransfer)==null?void 0:g.types)!=null&&I.includes("Files")&&(k=r.dataTransfer)!=null&&k.files){const _=(F=r.dataTransfer)==null?void 0:F.items;_&&_.length>0?o(_):x.error(t().t("File not found."))}};mr(async()=>{var I;Le=window.matchMedia("(min-width: 1024px)"),Le.addEventListener("change",ut),ut(Le);const r=document.getElementById("collection-container");B&&Math.floor(300/r.clientWidth*100),new ResizeObserver(k=>{for(let F of k)F.contentRect.width}).observe(r),s(R,Ne().params.id);const n=await Ir(localStorage.token,e(R)).catch(k=>(x.error(`${k}`),null));n?(s(v,n),s(de,(I=e(v))==null?void 0:I.id)):wr("/workspace/knowledge");const g=document.querySelector("body");g==null||g.addEventListener("dragover",kt),g==null||g.addEventListener("drop",St),g==null||g.addEventListener("dragleave",Ft)}),pr(()=>{Le==null||Le.removeEventListener("change",ut);const r=document.querySelector("body");r==null||r.removeEventListener("dragover",kt),r==null||r.removeEventListener("drop",St),r==null||r.removeEventListener("dragleave",Ft)}),Et(()=>(e(de),e(E),e(H),e(S),e(C),e(D)),()=>{e(de)!==null&&e(E)!==void 0&&e(H)!==void 0&&e(S)!==void 0&&e(C)!==void 0&&e(D)!==void 0&&_e()}),Et(()=>(e(E),e(H),e(S),e(C)),()=>{e(E)!==void 0&&e(H)!==void 0&&e(S)!==void 0&&e(C)!==void 0&&ye()}),gr(),it();var Ct=Ra(),Pt=xe(Ct);ea(Pt,{get show(){return e(je)}});var Dt=p(Pt,2);{let r=Q(()=>(t(),i(()=>t().t("This will reset the knowledge base and sync all files. Do you wish to continue?"))));Yr(Dt,{get message(){return e(r)},get show(){return e(h)},set show(o){s(h,o)},$$events:{confirm:()=>{$e()}},$$legacy:!0})}var It=p(Dt,2);ra(It,{onSubmit:async r=>{u(r.data)},get show(){return e(ie)},set show(r){s(ie,r)},$$legacy:!0});var zt=p(It,2);Ia(zt,{get show(){return e(A)},set show(r){s(A,r)},$$events:{submit:r=>{const o=c(r.detail.name,r.detail.content);$(o)}},$$legacy:!0});var ft=p(zt,2),Mt=p(ft,2),qt=l(Mt);{var Vt=r=>{var o=Ka(),n=xe(o);{let f=Q(()=>(ne(),i(()=>{var b,M,pe,Fe;return((pe=(M=(b=ne())==null?void 0:b.permissions)==null?void 0:M.sharing)==null?void 0:pe.knowledge)||((Fe=ne())==null?void 0:Fe.role)==="admin"}))),m=Q(()=>(ne(),i(()=>{var b,M,pe,Fe;return((pe=(M=(b=ne())==null?void 0:b.permissions)==null?void 0:M.sharing)==null?void 0:pe.public_knowledge)||((Fe=ne())==null?void 0:Fe.role)==="admin"})));Jr(n,{get share(){return e(f)},get sharePublic(){return e(m)},onChange:()=>{vt()},accessRoles:["read","write"],get show(){return e(ee)},set show(b){s(ee,b)},get accessControl(){return e(v).access_control},set accessControl(b){wt(v,e(v).access_control=b)},$$legacy:!0})}var g=p(n,2),I=l(g),k=l(I),F=l(k),_=l(F),z=l(_);rt(z);var se=p(z,2),Ce=l(se);{var ve=f=>{var m=za(),b=l(m,!0);a(m),U(M=>J(b,M),[()=>(t(),e(L),i(()=>t().t("{{COUNT}} files",{COUNT:e(L)})))]),y(f,m)};Y(Ce,f=>{e(L)&&f(ve)})}a(se),a(_);var Qe=p(_,2);{var Je=f=>{var m=Ma(),b=l(m),M=l(b);Qr(M,{strokeWidth:"2.5",className:"size-3.5"});var pe=p(M,2),Fe=l(pe,!0);a(pe),a(b),a(m),U(ht=>J(Fe,ht),[()=>(t(),i(()=>t().t("Access")))]),oe("click",b,()=>{s(ee,!0)}),y(f,m)},Ze=f=>{var m=Aa(),b=l(m,!0);a(m),U(M=>J(b,M),[()=>(t(),i(()=>t().t("Read Only")))]),y(f,m)};Y(Qe,f=>{e(v),i(()=>{var m;return(m=e(v))==null?void 0:m.write_access})?f(Je):f(Ze,!1)})}a(F);var Ke=p(F,2),ke=l(Ke);rt(ke),a(Ke),a(k),a(I),a(g);var fe=p(g,2),me=l(fe),At=l(me),mt=l(At),Gt=l(mt);Zr(Gt,{className:"size-3.5"}),a(mt);var Re=p(mt,2);rt(Re);var Xt=p(Re,2);{var Qt=f=>{var m=Wa(),b=l(m);Fa(b,{onUpload:M=>{M.type==="directory"?W():M.type==="web"?s(ie,!0):M.type==="text"?s(A,!0):document.getElementById("files-input").click()},onSync:()=>{s(h,!0)}}),a(m),y(f,m)};Y(Xt,f=>{e(v),i(()=>{var m;return(m=e(v))==null?void 0:m.write_access})&&f(Qt)})}a(At),a(me);var pt=p(me,2),gt=l(pt),Wt=l(gt),Nt=l(Wt);{let f=Q(()=>(t(),i(()=>[{value:null,label:t().t("All")},{value:"created",label:t().t("Created by you")},{value:"shared",label:t().t("Shared with you")}])));_t(Nt,{align:"start",className:"flex w-full items-center gap-2 truncate px-3 py-1.5 text-sm bg-gray-50 dark:bg-gray-850 rounded-xl  placeholder-gray-400 outline-hidden focus:outline-hidden",get items(){return e(f)},onChange:m=>{m?localStorage.workspaceViewOption=m:delete localStorage.workspaceViewOption},get value(){return e(H)},set value(m){s(H,m)},$$legacy:!0})}var Tt=p(Nt,2);{let f=Q(()=>(t(),i(()=>t().t("Sort")))),m=Q(()=>(t(),i(()=>[{value:"name",label:t().t("Name")},{value:"created_at",label:t().t("Created At")},{value:"updated_at",label:t().t("Updated At")}])));_t(Tt,{align:"start",get placeholder(){return e(f)},get items(){return e(m)},get value(){return e(S)},set value(b){s(S,b)},$$legacy:!0})}var Jt=p(Tt,2);{var Zt=f=>{{let m=Q(()=>(t(),i(()=>[{value:"asc",label:t().t("Asc")},{value:null,label:t().t("Desc")}])));_t(f,{align:"start",get items(){return e(m)},get value(){return e(C)},set value(b){s(C,b)},$$legacy:!0})}};Y(Jt,f=>{e(S)&&f(Zt)})}a(Wt),a(gt),a(pt);var er=p(pt,2);{var tr=f=>{var m=ja(),b=l(m),M=l(b),pe=l(M),Fe=l(pe);{var ht=he=>{var Pe=Na(),De=xe(Pe),et=l(De);ua(et,{get files(){return e(d)},get knowledge(){return e(v)},get selectedFileId(){return e(j)},onClick:ge=>{if(s(j,ge),e(d)){const Ie=e(d).find(He=>He.id===e(j));Ie?Be(Ie):s(O,null)}},onDelete:ge=>{s(j,null),s(O,null),Rt(ge)}}),a(De);var Te=p(De,2);{var tt=ge=>{ta(ge,{get count(){return e(L)},perPage:30,get page(){return e(D)},set page(Ie){s(D,Ie)},$$legacy:!0})};Y(Te,ge=>{e(L)>30&&ge(tt)})}y(he,Pe)},ar=he=>{var Pe=Ta(),De=l(Pe),et=l(De,!0);a(De),a(Pe),U(Te=>J(et,Te),[()=>(t(),i(()=>t().t("No content found")))]),y(he,Pe)};Y(Fe,he=>{e(d),i(()=>e(d).length>0)?he(ht):he(ar,!1)})}a(pe),a(M),a(b);var lr=p(b,2);{var sr=he=>{{let Pe=Q(()=>e(j)!==null);Gr(he,{className:"h-full",get show(){return e(Pe)},onClose:()=>{s(j,null),s(O,null)},children:(De,et)=>{var Te=Ba(),tt=l(Te),ge=l(tt),Ie=l(ge),He=l(Ie),or=l(He);Xr(or,{strokeWidth:"2.5"}),a(He),a(Ie);var xt=p(Ie,2),nr=l(xt,!0);a(xt);var ir=p(xt,2);{var dr=ze=>{var te=La(),Me=l(te),qe=l(Me),vr=p(qe);{var ur=Ve=>{var yt=Ea(),fr=l(yt);at(fr,{}),a(yt),y(Ve,yt)};Y(vr,Ve=>{e(Oe)&&Ve(ur)})}a(Me),a(te),U(Ve=>{Me.disabled=e(Oe),J(qe,`${Ve??""} `)},[()=>(t(),i(()=>t().t("Save")))]),oe("click",Me,()=>{Ht()}),y(ze,te)};Y(ir,ze=>{e(v),i(()=>{var te;return(te=e(v))==null?void 0:te.write_access})&&ze(dr)})}a(ge);var cr=p(ge,2);xr(cr,()=>(e(O),i(()=>e(O).id)),ze=>{var te=Ua();hr(te),U(Me=>{te.disabled=(e(v),i(()=>{var qe;return!((qe=e(v))!=null&&qe.write_access)})),We(te,"placeholder",Me)},[()=>(t(),i(()=>t().t("Add content here")))]),Xe(te,()=>e(ce),Me=>s(ce,Me)),y(ze,te)}),a(tt),a(Te),U(()=>J(nr,(e(O),i(()=>{var ze,te;return(te=(ze=e(O))==null?void 0:ze.meta)==null?void 0:te.name})))),oe("click",He,()=>{s(j,null),s(O,null)}),y(De,Te)},$$slots:{default:!0}})}};Y(lr,he=>{e(j)!==null&&he(sr)})}a(m),y(f,m)},rr=f=>{var m=Oa(),b=l(m);at(b,{className:"size-4"}),a(m),y(f,m)};Y(er,f=>{e(d)!==null&&e(L)!==null?f(tr):f(rr,!1)})}a(fe),U((f,m,b)=>{We(z,"placeholder",f),z.disabled=(e(v),i(()=>{var M;return!((M=e(v))!=null&&M.write_access)})),We(ke,"placeholder",m),ke.disabled=(e(v),i(()=>{var M;return!((M=e(v))!=null&&M.write_access)})),We(Re,"placeholder",b)},[()=>(t(),i(()=>t().t("Knowledge Name"))),()=>(t(),i(()=>t().t("Knowledge Description"))),()=>(t(),i(()=>`${t().t("Search Collection")}`))]),Xe(z,()=>e(v).name,f=>wt(v,e(v).name=f)),oe("input",z,()=>{vt()}),Xe(ke,()=>e(v).description,f=>wt(v,e(v).description=f)),oe("input",ke,()=>{vt()}),Xe(Re,()=>e(E),f=>s(E,f)),oe("focus",Re,()=>{s(j,null)}),oe("wheel",gt,f=>{f.deltaY!==0&&(f.preventDefault(),f.currentTarget.scrollLeft+=f.deltaY)}),y(r,o)},Yt=r=>{at(r,{className:"size-5"})};Y(qt,r=>{e(R)&&e(v)?r(Vt):r(Yt,!1)})}a(Mt),yr(ft,()=>e(le),r=>s(le,r)),oe("change",ft,async()=>{if(e(le)&&e(le).length>0){for(const o of e(le))await $(o);s(le,null);const r=document.getElementById("files-input");r&&(r.value="")}else x.error(t().t("File not found."))}),y(Z,Ct),ot(),X()}function El(Z){Ha(Z,{})}export{El as component};
//# sourceMappingURL=32.3nw9Dnup.js.map
